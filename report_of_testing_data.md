 
# ОПИСАНИЕ ДАННЫХ ДЛЯ ТЕСТИРОВАНИЯ МОДЕЛИ PD-12

Документ описывает состав, источники данных для тестирования модели PD-12 ЦАЛ, алгоритм формирования фичей. 

## ФОРМАТ ДАННЫХ

Данные для тестирования модели PD-12 ЦАЛ поставляются в виде файла csv «target_features.csv» со следующими параметрами:

•	разделитель ";" (точка с запятой),   
•	кодировка "Windows-1251",   
•	формат даты "YYYY.MM.DD",   
•	разделитель дробной и целой части ‘.’ (точка).  

Возможным вариантом чтения данных на Python является:  

```bash 
dateparse = lambda x: datetime.strptime(x, '%Y.%m.%d')
pd.read_csv('target_features.csv', sep=';', encoding='cp1251', dtype = {"ИНН контрагента":str}, parse_dates=['Дата принятия решения по сделке'], date_parser=dateparse, decimal='.')
```

## СОСТАВ ДАННЫХ

В качестве исходных данных был взят файл dataset_local_application_inf_ssf.01.07.2022.pkl, содержащий как фактический портфель АО «***», так и экспертные отказы по сделкам. В таблице 1 приводится состав данных. 

**Таблица 1. Состав данных для тестирования модели PD-12 ЦАЛ**

| Столбец                         | Описание                                                            |
| ------------------------------- | ------------------------------------------------------------------- |
| PL                              | Условный ключ строки таблицы - аналог договора                      |
| Номер сделки                    | Номер сделки                                                        |
| Номер договора (кратко)         | Номер договора                                                      |
| ИНН контрагента                 | ИНН лизингополучателя                                               |
| Продукт                         | Характеристика договора по его условию  и типу транспортных средств |
| Дата принятия решения по сделке | Дата принятия решения по сделке                                     |
| Метка кред дефолта              | 1 - наличие кред дефолта, 0 - отсутствие кред дефолта               |
| lessee_okved_1                  | первые 2 цифры основного ОКВЭД лизингополучателя                    |
| ctr_count_6m                    | Количество договоров, действующих в течение последних 6 месяцев     |
| debt_ctr                        | Количество договоров с долгом больше 0                              |
| day_from_last_paid_delay        | Количество дней с последней оплаченной просрочки                    |

Поле «Номер договора (кратко)» не заполнено в случае отсутствия заключения договора. Такие данные являются экспертным заключением на стадии принятия решения по сделке.

При формировании данных были исключены сделки с крупными клиентами по критерию превышения лимита суммы финансирования по стандартным продуктам. Также исключены сделки со значениями фичей «Количество договоров, действующих в течение последних 6 месяцев» и «Количество договоров с долгом больше 0» превышающими 99-й процентиль.

Столбец «Продукт» является характеристикой предмета лизинга договора. Добавлен для возможности отдельной проверки модели PD-12 по продукту «Грузовая техника». Остальные типы: 'Express', 'Стандарт', 'Такси', 'Такси+' относятся к легковым транспортным средствам. Сделки лизинга автобусов, самоходных машин и складской техники в состав «target_features.csv» не включались. 

В выходной файл включены договоры с самой поздней датой принятия решения 09.06.2023. Классификационные признаки дефолтов — метка кредитного (далее по тексту кред) дефолта проставлены на 01.07.2023. Данные формировались с учетом 12-ти месячного вызревания дефолтов, то есть действующие договоры, заключенные после 01.07.2022 и не имеющие признаков дефолта, в состав не включались.

Данные агрегированы по сделке, то есть, если в одной сделке несколько договоров, то в выходной файл включен только один из них. При этом, метка кред дефолта установлена в дефолтное состояние, если хотя бы по одному из договоров в рамках сделки был кред дефолт.

«Основной ОКВЭД лизингополучателя», «Количество договоров», «Количество договоров с долгом больше 0», «Количество дней с последней оплаченной просрочки» — фичи, вошедшие в финальный вариант модели PD-12. Алгоритмы расчета фичей представлены в разделе «Описание расчета фичей».

## ОПИСАНИЕ РАСЧЕТА ФИЧЕЙ

•	**lessee_okved_1** — первые 2 цифры основного ОКВЭД лизингополучателя

lessee_okved_1 — первые 2 цифры последнего ОКВЭД лизингополучателя (ИНН контрагента), хранящегося в системах данных АО ***, без учета возможного изменения в прошлом. 

•	**ctr_count_6m** — «Количество договоров, действующих в течение последних 6 месяцев»

ctr_count_6m — количество различных наименований договоров лизингополучателя (ИНН контрагента) до даты принятия решения по сделке, за исключением договоров, завершенных более 6 месяцев назад (до даты принятия решения). 

•	**debt_ctr** — Количество договоров с долгом больше 0

debt_ctr— количество различных наименований договоров лизингополучателя (ИНН контрагента) до даты принятия решения по сделке, по которым был выставлен признак просрочки, за исключением договоров, завершенных более 5 лет назад (до даты принятия решения). Если значение не определено, то проставлен 0. 

Признак просрочки договора выставлялся, если в рамках договора или приложения плановый лизинговый платеж не оплачен или оплачен полностью/частично с задержкой не в месяце (в т. ч. году) планового лизингового платежа. Таким образом, у просроченного платежа, если он был оплачен полностью в течение одного календарного месяца, признак просрочки договора не выставлялся. Такой алгоритм обусловлен тем, что данные для построения модели PD подавались в виде срезов на последний день каждого месяца, и, таким образом, просрочка по платежам фиксировалась только, если платеж не был оплачен в срок на конец месяца. 

Пятилетний диапазон выбран из-за того, что модель PD-12 строилась в 2022 году на данных с 2017 года, более ранние договора в состав для построения модели не входили. 

•	**day_from_last_paid_delay** — Количество дней с последней оплаченной просрочки

day_from_last_paid_delay— разница между датой принятия решения по сделке и самой последней датой оплаченной просроченной задолженности по лизинговым платежам у договоров в разрезе ИНН лизингополучателя. Если по всем договорам лизингополучателя (ИНН лизингополучателя) дата последней оплаченной просроченной задолженности по лизинговым платежам не определена, то проставлено значение null. Оплаченные просроченные задолженности по договорам, завершенным более 5 лет назад (до даты принятия решения), не учитывались.

Расчет фичей «Количество договоров, действующих в течение последних 6 месяцев», «Количество договоров с долгом больше 0», «Количество дней с последней оплаченной просрочки» производился с учетом всех договоров портфеля «***», включая лизинг автобусов, самоходных машин и складской техники.

{"#",e603c0f2-92fb-4d47-8f38-a44a381cf235,
{1,
{6,
{0,"Запрос",
{"Pattern",
{"S",100,1}
},"Запрос",172},
{1,"ТекстЗапроса",
{"Pattern"},"",0},
{2,"ПараметрыЗапроса",
{"Pattern"},"",0},
{3,"СпособВыгрузки",
{"Pattern"},"",0},
{4,"ВариантыКода",
{"Pattern"},"",0},
{5,"ТаблицыПараметров",
{"Pattern"},"",0}
},
{2,6,0,0,1,1,2,2,3,3,4,4,5,5,
{1,2,
{2,0,6,
{"S","Запросы"},
{"S",""},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",22},
{1,"ЭтоВыражение",
{"Pattern"},"В",9},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"#",5a49abd5-936d-4f46-8499-9cb204efe378},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",22}
},
{2,3,0,0,1,1,2,2,
{1,0},2,-1},
{0,0}
}
},
{"N",1},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{2,
{0,"ИмяВарианта",
{"Pattern",
{"S"}
},"Имя варианта",15},
{1,"ТекстКода",
{"Pattern",
{"S"}
},"Текст кода",87}
},
{2,2,0,0,1,1,
{1,0},1,-1},
{0,0}
}
},
{"#",e199ca70-93cf-46ce-a54b-6edc88c3a296,
{#base64:AQE4EgAAAAAAAO+7v3siIyIsM2Q0OGZlYWUtYTljNi00YzVhLWEwOTktOWViNjQ3
NzYzMGM2LA0KezIsDQp7DQp7IlMiLCLRhdC70J3QvtC80LXRgNCU0L7Qs9C+0LLQ
vtGA0LAifSwNCnsiIyIsNDIzODAxOWQtN2U0OS00ZmM5LTkxZGItYjZiOTUxZDVj
ZjhlLA0KezUsDQp7DQp7IlMiLCLQndCw0YfQsNC70YzQvdCw0Y/QodGC0YDQvtC6
0LAifSwNCnsiTiIsMH0NCn0sDQp7DQp7IlMiLCLQmtC+0L3QtdGH0L3QsNGP0KHR
gtGA0L7QutCwIn0sDQp7Ik4iLDB9DQp9LA0Kew0KeyJTIiwi0KLQuNC/0JfQvdCw
0YfQtdC90LjRj9Ce0LHRitC10LrRgtCwIn0sDQp7IlUifQ0KfSwNCnsNCnsiUyIs
ItCf0L7Qu9GP0KHQuNC90YXRgNC+0L3QuNC30LDRhtC40LgifSwNCnsiIyIsYWNm
NjE5MmUtODFjYS00NmVmLTkzYTYtNWE2OTY4Yjc4NjYzLA0KezksDQp7NCwNCnsw
LCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC90LjQt9Cw0YbQuNC4IiwNCnsiUGF0dGVy
biIsDQp7IlMifQ0KfSwi0J/QvtC70LUg0YHQuNC90YXRgNC+0L3QuNC30LDRhtC4
0LgiLDMxfSwNCnsxLCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC90LjQt9Cw0YbQuNC4
0J/RgNC10LTRgdGC0LDQstC70LXQvdC40LUiLA0KeyJQYXR0ZXJuIiwNCnsiUyJ9
DQp9LCLQn9GA0LXQtNGB0YLQsNCy0LvQtdC90LjQtSIsMzF9LA0KezIsItCf0L7Q
u9C10KHQuNC90YXRgNC+0L3QuNC30LDRhtC40LjQotC40L/Ql9C90LDRh9C10L3Q
uNGPIiwNCnsiUGF0dGVybiIsDQp7IiMiLGY1YzY1MDUwLTNiYmItMTFkNS1iOTg4
LTAwNTBiYWUwYTk1ZH0NCn0sItCi0LjQvyDQt9C90LDRh9C10L3QuNGPIiwyMX0s
DQp7Mywi0J3QvtC80LXRgNCa0L7Qu9C+0L3QutC40J7RgtCx0L7RgNCwIiwNCnsi
UGF0dGVybiIsDQp7Ik4iLDEwLDAsMX0NCn0sItCd0L7QvNC10YAg0LrQvtC70L7Q
vdC60Lgg0YLQsNCx0LvQuNGG0Ysg0L7RgtCx0L7RgNCwIiwyNn0NCn0sDQp7Miw0
LDAsMCwxLDEsMiwyLDMsMywNCnsxLDB9LDMsLTF9LA0KezAsMH0NCn0NCn0NCn0s
DQp7DQp7IlMiLCLQotCw0LHQu9C40YfQvdGL0LnQlNC+0LrRg9C80LXQvdGC0J7R
gtCx0L7RgNCwIn0sDQp7IiMiLGU2MDMxMDNlLWEzMTgtNGVkYy1hMDE0LWIxYzZj
Zjk0ZDQ5ZiwNCns4LDEsMTEsDQp7IiMiLCIiLDEsMSwiIyIsItCv0LfRi9C6INC/
0L4g0YPQvNC+0LvRh9Cw0L3QuNGOIiwi0K/Qt9GL0Log0L/QviDRg9C80L7Qu9GH
0LDQvdC40Y4iLDB9LA0KezEyOCw3Mn0sDQp7MH0sMCwNCnswLDB9LA0KezAsMH0s
DQp7MCwwfSwNCnswLDB9LA0KezAsMH0sDQp7MCwwfSwwLDIsMCwNCnswLDAsMDAw
MDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAwLDB9LDAsMCwwLDAsMCww
LDAsMCwwLA0KezB9LA0KezB9LA0KezB9LA0KezB9LCIiLA0Kew0KezAsNiw2LA0K
eyJOIiwxMDAwfSw3LA0KeyJOIiwxMDAwfSw4LA0KeyJOIiwxMDAwfSw5LA0KeyJO
IiwxMDAwfSwxMCwNCnsiTiIsMTAwMH0sMTEsDQp7Ik4iLDEwMDB9DQp9DQp9LA0K
ezAsLTEsLTEsLTEsLTEsMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAw
MDAwfSwwLDAsMCwwLDAsMCwwLDEsMCwxLDAsMCwwLDAsMCwyLA0KezMsMywNCnst
MX0NCn0sDQp7MywzLA0Key0zfQ0KfSwwLDAsMCwiIiwwLA0KezMsMCwwLDEwMCwx
LDEsMCwxLDEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsIiIsMCwwLDAsMCwwLDAs
MH0sDQp7MH0sMCwwLDAsMSwwLDB9DQp9DQp9DQp9DQp9DQp9LA0Kew0KeyJTIiwi
0JTQvtCz0L7QstC+0YDQm9C40LfQuNC90LPQsCJ9LA0KeyIjIiw0MjM4MDE5ZC03
ZTQ5LTRmYzktOTFkYi1iNmI5NTFkNWNmOGUsDQp7NSwNCnsNCnsiUyIsItCd0LDR
h9Cw0LvRjNC90LDRj9Ch0YLRgNC+0LrQsCJ9LA0KeyJOIiwxfQ0KfSwNCnsNCnsi
UyIsItCa0L7QvdC10YfQvdCw0Y/QodGC0YDQvtC60LAifSwNCnsiTiIsMX0NCn0s
DQp7DQp7IlMiLCLQotC40L/Ql9C90LDRh9C10L3QuNGP0J7QsdGK0LXQutGC0LAi
fSwNCnsiVCIsMzc2ODA3YmMtMGQ4OC00YzA2LTllYjItNDJiNzJiOTcwYWZifQ0K
fSwNCnsNCnsiUyIsItCf0L7Qu9GP0KHQuNC90YXRgNC+0L3QuNC30LDRhtC40Lgi
fSwNCnsiIyIsYWNmNjE5MmUtODFjYS00NmVmLTkzYTYtNWE2OTY4Yjc4NjYzLA0K
ezksDQp7NCwNCnswLCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC90LjQt9Cw0YbQuNC4
IiwNCnsiUGF0dGVybiIsDQp7IlMifQ0KfSwi0J/QvtC70LUg0YHQuNC90YXRgNC+
0L3QuNC30LDRhtC40LgiLDMxfSwNCnsxLCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC9
0LjQt9Cw0YbQuNC40J/RgNC10LTRgdGC0LDQstC70LXQvdC40LUiLA0KeyJQYXR0
ZXJuIiwNCnsiUyJ9DQp9LCLQn9GA0LXQtNGB0YLQsNCy0LvQtdC90LjQtSIsMzF9
LA0KezIsItCf0L7Qu9C10KHQuNC90YXRgNC+0L3QuNC30LDRhtC40LjQotC40L/Q
l9C90LDRh9C10L3QuNGPIiwNCnsiUGF0dGVybiIsDQp7IiMiLGY1YzY1MDUwLTNi
YmItMTFkNS1iOTg4LTAwNTBiYWUwYTk1ZH0NCn0sItCi0LjQvyDQt9C90LDRh9C1
0L3QuNGPIiwyMX0sDQp7Mywi0J3QvtC80LXRgNCa0L7Qu9C+0L3QutC40J7RgtCx
0L7RgNCwIiwNCnsiUGF0dGVybiIsDQp7Ik4iLDEwLDAsMX0NCn0sItCd0L7QvNC1
0YAg0LrQvtC70L7QvdC60Lgg0YLQsNCx0LvQuNGG0Ysg0L7RgtCx0L7RgNCwIiwy
Nn0NCn0sDQp7Miw0LDAsMCwxLDEsMiwyLDMsMywNCnsxLDEsDQp7MiwwLDQsDQp7
IlMiLCLRhdC70J3QvtC80LXRgNCU0L7Qs9C+0LLQvtGA0LAifSwNCnsiUyIsItCU
0L7Qs9C+0LLQvtGA0JvQuNC30LjQvdCz0LAu0J3QvtC80LXRgCDQtNC+0LPQvtCy
0L7RgNCwIn0sDQp7IiMiLGY1YzY1MDUwLTNiYmItMTFkNS1iOTg4LTAwNTBiYWUw
YTk1ZCwNCnsiUGF0dGVybiIsDQp7IlMiLDEwMCwxfQ0KfQ0KfSwNCnsiTiIsMX0s
MH0NCn0sMywwfSwNCnswLDB9DQp9DQp9DQp9LA0Kew0KeyJTIiwi0KLQsNCx0LvQ
uNGH0L3Ri9C50JTQvtC60YPQvNC10L3RgtCe0YLQsdC+0YDQsCJ9LA0KeyIjIixl
NjAzMTAzZS1hMzE4LTRlZGMtYTAxNC1iMWM2Y2Y5NGQ0OWYsDQp7OCwxLDExLA0K
eyIjIiwiIiwxLDEsIiMiLCLQr9C30YvQuiDQv9C+INGD0LzQvtC70YfQsNC90LjR
jiIsItCv0LfRi9C6INC/0L4g0YPQvNC+0LvRh9Cw0L3QuNGOIiwwfSwNCnsxMjgs
NzJ9LA0KezB9LDAsDQp7MCwwfSwNCnswLDB9LA0KezAsMH0sDQp7MCwwfSwNCnsw
LDB9LA0KezAsMH0sMCwyLDE2LDAsMCwxLDAsDQp7MTYsMSwNCnsxLDEsDQp7IiMi
LCLQkNCbIDI1MDcyLzAxLTE0INCa0JfQnSJ9DQp9LDB9LDEsMCwxLDAsDQp7MTYs
MCwNCnsxLDEsDQp7IiMiLCLQkNCbIDI2NjA5LzAxLTE0INCj0JvQnSJ9DQp9LDB9
LDIsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDI1NTA1LzAyLTE0
INCS0KDQliJ9DQp9LDB9LDMsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQ
kNCbIDI0MTQ0LzA0LTE0INCa0JfQnSJ9DQp9LDB9LDQsMCwxLDAsDQp7MTYsMCwN
CnsxLDEsDQp7IiMiLCLQkNCbIDI2MTA3LzAyLTE0INCf0J3QlyJ9DQp9LDB9LDUs
MCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDI0Njg1LzAyLTE0INCV
0JrQkSJ9DQp9LDB9LDYsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCb
IDMwOTU5LzAxLTE0INCd0JHQpyJ9DQp9LDB9LDcsMCwxLDAsDQp7MTYsMCwNCnsx
LDEsDQp7IiMiLCLQkNCbIDc0Mjc4LzAxLTE2INCh0KDQoiJ9DQp9LDB9LDgsMCwx
LDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDkyNTAwLzAxLTE3INCh0JzQ
oCJ9DQp9LDB9LDksMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDk4
NzA4LzAxLTE3INCi0K7QnCJ9DQp9LDB9LDEwLDAsMSwwLA0KezE2LDAsDQp7MSwx
LA0KeyIjIiwi0JDQmyAxMTExNjgvMDEtMTgg0J7QoNCRIn0NCn0sMH0sMTEsMCwx
LDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDIxNzAvMTQtMTkg0JrQoNCh
In0NCn0sMH0sMTIsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDEw
MzgxOC8wMi0xOCJ9DQp9LDB9LDEzLDAsMSwwLA0KezE2LDAsDQp7MSwxLA0KeyIj
Iiwi0JDQmyAxMDM4MTgvMDMtMTgifQ0KfSwwfSwxNCwwLDEsMCwNCnsxNiwwLA0K
ezEsMSwNCnsiIyIsItCQ0JsgOTM5NDMvMDItMTgg0KLQm9CiIn0NCn0sMH0sMTUs
MCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDY2OTg4LzAyLTE2INCR
0JPQlCJ9DQp9LDB9LA0KezEsMCwwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAw
MDAwMDAwMDAsMSwwLDJ9LDE2LDAsMCwwLDAsMCwwLDAsMCwNCnswfSwNCnswfSwN
CnswfSwNCnswfSwiIiwNCnsNCnswLDYsNiwNCnsiTiIsMTAwMH0sNywNCnsiTiIs
MTAwMH0sOCwNCnsiTiIsMTAwMH0sOSwNCnsiTiIsMTAwMH0sMTAsDQp7Ik4iLDEw
MDB9LDExLA0KeyJOIiwxMDAwfQ0KfQ0KfSwNCnswLC0xLC0xLC0xLC0xLDAwMDAw
MDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMH0sMCwwLDAsMCwwLDAsMCwx
LDAsMSwyLA0KezIxNzYsMjAxLDJ9LA0KezEyOCwyMTd9LDAsMCwwLDAsMywNCnsz
LDMsDQp7LTF9DQp9LA0KezMsMywNCnstM30NCn0sDQp7MywzLA0Key03fQ0KfSww
LDAsMCwiIiwwLA0KezMsMCwwLDEwMCwxLDEsMCwxLDEsMCwwLDAsMCwwLDAsMCww
LDAsMCwwLDAsIiIsMCwwLDAsMCwwLDAsMH0sDQp7MH0sMCwwLDAsMSwwLDB9DQp9
DQp9DQp9DQp9DQp9DQp9DQp9}
},1,
{1,7,
{2,1,6,
{"S","просрочка"},
{"S","ВЫБРАТЬ
	ПроизводственныеКалендариСтранМира.Дата КАК Дата,
	ВЫБОР
		КОГДА ПроизводственныеКалендариСтранМира.ВидДня = ЗНАЧЕНИЕ(Перечисление.ВидыДнейПроизводственногоКалендаря.Рабочий)
			ТОГДА ИСТИНА
		КОГДА ПроизводственныеКалендариСтранМира.ВидДня = ЗНАЧЕНИЕ(Перечисление.ВидыДнейПроизводственногоКалендаря.Предпраздничный)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоРабочийДень
ПОМЕСТИТЬ КалендарьПолный
ИЗ
	РегистрСведений.хлПроизводственныеКалендариСтранМира КАК ПроизводственныеКалендариСтранМира
ГДЕ
	ПроизводственныеКалендариСтранМира.Страна = &Страна
	И ПроизводственныеКалендариСтранМира.Дата <= &КонецПериода

ИНДЕКСИРОВАТЬ ПО
	Дата
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	КалендарьПолный.Дата КАК Дата
ПОМЕСТИТЬ КалендарьРабочиеДни
ИЗ
	КалендарьПолный КАК КалендарьПолный
ГДЕ
	КалендарьПолный.ЭтоРабочийДень

ИНДЕКСИРОВАТЬ ПО
	Дата
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	КалендарьПолный.Дата КАК Дата,
	МИНИМУМ(ЕСТЬNULL(КалендарьРабочиеДни.Дата, КалендарьПолный.Дата)) КАК ПервыйРабочийДень
ПОМЕСТИТЬ ПроизводственныйКалендарь
ИЗ
	КалендарьПолный КАК КалендарьПолный
		ЛЕВОЕ СОЕДИНЕНИЕ КалендарьРабочиеДни КАК КалендарьРабочиеДни
		ПО (ВЫБОР
				КОГДА КалендарьПолный.ЭтоРабочийДень
					ТОГДА ЛОЖЬ
				ИНАЧЕ КалендарьПолный.Дата <= КалендарьРабочиеДни.Дата
			КОНЕЦ)

СГРУППИРОВАТЬ ПО
	КалендарьПолный.Дата

ИНДЕКСИРОВАТЬ ПО
	Дата
;

////////////////////////////////////////////////////////////////////////////////
УНИЧТОЖИТЬ КалендарьПолный
;

////////////////////////////////////////////////////////////////////////////////
УНИЧТОЖИТЬ КалендарьРабочиеДни
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга.Владелец КАК Контрагент,
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга КАК ДоговорЛизинга,
	МИНИМУМ(ВЫБОР
			КОГДА ПредметыЛизингаВЛизингеОбороты.КоличествоПриход > 0
				ТОГДА ПредметыЛизингаВЛизингеОбороты.Период
		КОНЕЦ) КАК ДатаПередачи
ПОМЕСТИТЬ ТаблицаПередач
ИЗ
	РегистрНакопления.хлПредметыЛизингаВЛизинге.Обороты(&НачалоВеденияУчета, &КонецПериода, День, ДоговорЛизинга = &ДоговорЛизинга) КАК ПредметыЛизингаВЛизингеОбороты

СГРУППИРОВАТЬ ПО
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга,
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга.Владелец

ИНДЕКСИРОВАТЬ ПО
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ КАК ЭтоФакт,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга.Владелец КАК Контрагент,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга КАК ДоговорЛизинга,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Приложение КАК Приложение,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Статья КАК СтатьяГрафика,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Валюта КАК Валюта,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Дата КАК ПлановаяДатаОплаты,
	ЕСТЬNULL(ТаблицаПередач.ДатаПередачи, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаПередачи,
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
		ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
	КОНЕЦ КАК ДатаОплаты,
	СУММА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Сумма) КАК Сумма,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	МАКСИМУМ(ВЫБОР
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
					И (хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика
						ИЛИ хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Регистратор = ТаблицаАктуальныхУтверждений.Регистратор)
				ТОГДА ИСТИНА
			ИНАЧЕ ЛОЖЬ
		КОНЕЦ) КАК ЭтоПлатежПоТекущемуГрафику
ПОМЕСТИТЬ ВзаиморасчетыВесьПериод
ИЗ
	РегистрНакопления.хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику КАК хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.хлДанныеУтвержденийГрафиков.СрезПоследних(&КонецПериода, ВидГрафика = ЗНАЧЕНИЕ(Справочник.хлВидыГрафиков.ГрафикПлатежейПоДоговоруЛизинга)) КАК ТаблицаАктуальныхУтверждений
		ПО хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга = ТаблицаАктуальныхУтверждений.Договор
			И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Приложение = ТаблицаАктуальныхУтверждений.Приложение
			И (хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход))
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаПередач КАК ТаблицаПередач
		ПО хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга = ТаблицаПередач.ДоговорЛизинга
ГДЕ
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Активность
	И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период <= &КонецПериода
	И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Дата <= &КонецПериода
	И ВЫБОР
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
					И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
				ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
			ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
		КОНЕЦ <= &КонецПериода

СГРУППИРОВАТЬ ПО
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Валюта,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга.Владелец,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Статья,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Приложение,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Дата,
	ЕСТЬNULL(ТаблицаПередач.ДатаПередачи, ДАТАВРЕМЯ(1, 1, 1)),
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
		ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
	КОНЕЦ

ИМЕЮЩИЕ
	СУММА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Сумма) <> 0

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика,
	ДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение КАК Приложение,
	ВзаиморасчетыВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ВзаиморасчетыВесьПериод.Валюта КАК Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.Сумма КАК Сумма,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ВзаиморасчетыВесьПериод.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику
ПОМЕСТИТЬ ТаблицаНачисленийВесьПериод
ИЗ
	ВзаиморасчетыВесьПериод КАК ВзаиморасчетыВесьПериод
ГДЕ
	ВзаиморасчетыВесьПериод.ЭтоФакт = ЛОЖЬ

ИНДЕКСИРОВАТЬ ПО
	ВзаиморасчетыВесьПериод.ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение,
	ВзаиморасчетыВесьПериод.СтатьяГрафика,
	ВзаиморасчетыВесьПериод.Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение КАК Приложение,
	ВзаиморасчетыВесьПериод.Валюта КАК Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.ДатаПередачи КАК ДатаПередачи,
	ВзаиморасчетыВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ВзаиморасчетыВесьПериод.ДатаОплаты КАК ДатаОплаты,
	ВзаиморасчетыВесьПериод.Сумма КАК СуммаОплаты,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика
ПОМЕСТИТЬ ТаблицаОплатВесьПериод
ИЗ
	ВзаиморасчетыВесьПериод КАК ВзаиморасчетыВесьПериод
ГДЕ
	ВзаиморасчетыВесьПериод.ЭтоФакт = ИСТИНА

ИНДЕКСИРОВАТЬ ПО
	ВзаиморасчетыВесьПериод.ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение,
	ВзаиморасчетыВесьПериод.СтатьяГрафика,
	ВзаиморасчетыВесьПериод.Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика,
	ВзаиморасчетыВесьПериод.ДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаОплатВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение КАК Приложение,
	ТаблицаОплатВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаОплатВесьПериод.Валюта КАК Валюта,
	ТаблицаОплатВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаОплатВесьПериод.ДатаПередачи КАК ДатаПередачи,
	ТаблицаОплатВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	МАКСИМУМ(ВЫБОР
			КОГДА ТаблицаОплатВесьПериодДляОстатков.ДатаОплаты >= ТаблицаОплатВесьПериод.ДатаОплаты
				ТОГДА ТаблицаОплатВесьПериод.ПлановаяДатаОплаты
			ИНАЧЕ ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.ДатаОплаты, ТаблицаОплатВесьПериод.ПлановаяДатаОплаты)
		КОНЕЦ) КАК НачалоИнтервалаРасчета,
	ТаблицаОплатВесьПериод.ДатаОплаты КАК ДатаОплаты,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.ЭтоФакт, ЛОЖЬ) = ЛОЖЬ
				ТОГДА 1
			ИНАЧЕ -1
		КОНЕЦ * ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.Сумма, 0)) + ТаблицаОплатВесьПериод.СуммаОплаты КАК СуммаНачальныйОстаток,
	ТаблицаОплатВесьПериод.СуммаОплаты КАК СуммаОплаты,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.ЭтоФакт, ЛОЖЬ) = ЛОЖЬ
				ТОГДА 1
			ИНАЧЕ -1
		КОНЕЦ * ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.Сумма, 0)) КАК СуммаКонечныйОстаток
ПОМЕСТИТЬ ТаблицаОплатСОстаткамиВесьПериод
ИЗ
	ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ ВзаиморасчетыВесьПериод КАК ТаблицаОплатВесьПериодДляОстатков
		ПО ТаблицаОплатВесьПериод.ДоговорЛизинга = ТаблицаОплатВесьПериодДляОстатков.ДоговорЛизинга
			И ТаблицаОплатВесьПериод.Приложение = ТаблицаОплатВесьПериодДляОстатков.Приложение
			И ТаблицаОплатВесьПериод.СтатьяГрафика = ТаблицаОплатВесьПериодДляОстатков.СтатьяГрафика
			И ТаблицаОплатВесьПериод.Валюта = ТаблицаОплатВесьПериодДляОстатков.Валюта
			И ТаблицаОплатВесьПериод.ПлановаяДатаОплаты = ТаблицаОплатВесьПериодДляОстатков.ПлановаяДатаОплаты
			И ТаблицаОплатВесьПериод.НачислениеВнеГрафика = ТаблицаОплатВесьПериодДляОстатков.НачислениеВнеГрафика
			И ТаблицаОплатВесьПериод.ДатаОплаты >= ТаблицаОплатВесьПериодДляОстатков.ДатаОплаты

СГРУППИРОВАТЬ ПО
	ТаблицаОплатВесьПериод.Валюта,
	ТаблицаОплатВесьПериод.СтатьяГрафика,
	ТаблицаОплатВесьПериод.ПлановаяДатаОплаты,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.СуммаОплаты,
	ТаблицаОплатВесьПериод.ДатаОплаты,
	ТаблицаОплатВесьПериод.ДатаПередачи,
	ТаблицаОплатВесьПериод.НачислениеВнеГрафика

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика,
	ДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыВесьПериодОстатки.ДоговорЛизинга КАК ДоговорЛизинга,
	ВзаиморасчетыВесьПериодОстатки.Приложение КАК Приложение,
	ВзаиморасчетыВесьПериодОстатки.СтатьяГрафика КАК СтатьяГрафика,
	ВзаиморасчетыВесьПериодОстатки.Валюта КАК Валюта,
	ВзаиморасчетыВесьПериодОстатки.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериодОстатки.ДатаПередачи КАК ДатаПередачи,
	ВзаиморасчетыВесьПериодОстатки.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) КАК СуммаОстаток,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) КАК СуммаОстаток1,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) КАК СуммаОстаток2
ПОМЕСТИТЬ ТаблицаОстатков
ИЗ
	ВзаиморасчетыВесьПериод КАК ВзаиморасчетыВесьПериодОстатки

СГРУППИРОВАТЬ ПО
	ВзаиморасчетыВесьПериодОстатки.ДоговорЛизинга,
	ВзаиморасчетыВесьПериодОстатки.Приложение,
	ВзаиморасчетыВесьПериодОстатки.СтатьяГрафика,
	ВзаиморасчетыВесьПериодОстатки.Валюта,
	ВзаиморасчетыВесьПериодОстатки.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериодОстатки.ДатаПередачи,
	ВзаиморасчетыВесьПериодОстатки.НачислениеВнеГрафика

ИМЕЮЩИЕ
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) <> 0

ИНДЕКСИРОВАТЬ ПО
	ВзаиморасчетыВесьПериодОстатки.ДоговорЛизинга,
	ВзаиморасчетыВесьПериодОстатки.Приложение,
	ВзаиморасчетыВесьПериодОстатки.СтатьяГрафика,
	ВзаиморасчетыВесьПериодОстатки.Валюта,
	ВзаиморасчетыВесьПериодОстатки.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериодОстатки.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
УНИЧТОЖИТЬ ВзаиморасчетыВесьПериод
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ ПЕРВЫЕ 1
	НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья КАК СтатьяКомпенсация
ПОМЕСТИТЬ врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях
ИЗ
	Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ИсключаемыеСтатьи КАК НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи
ГДЕ
	ВЫБОР
			КОГДА &НаборСтатейИсключаемыхИзБазыРасчетаПени = ЗНАЧЕНИЕ(Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ПустаяСсылка)
				ТОГДА ИСТИНА
			ИНАЧЕ НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Ссылка = &НаборСтатейИсключаемыхИзБазыРасчетаПени
		КОНЕЦ
	И НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья = &СтатьяКомпенсацияСтрахования
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаОплатВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение КАК Приложение,
	ТаблицаОплатВесьПериод.Валюта КАК Валюта,
	СУММА(ТаблицаОплатВесьПериод.СуммаОплаты) КАК СуммаОплаты,
	1 КАК РазделительСтатейПоОплатеПеней
ПОМЕСТИТЬ ТаблицаОплатПенейВесьПериод
ИЗ
	ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.хлНазначенияОбъектов КАК НазначенияОбъектов
		ПО ТаблицаОплатВесьПериод.СтатьяГрафика = НазначенияОбъектов.Объект
			И (НазначенияОбъектов.Назначение = &НазначениеПени)
ГДЕ
	НазначенияОбъектов.Назначение = &НазначениеПени

СГРУППИРОВАТЬ ПО
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.Валюта

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.Валюта,
	СУММА(ТаблицаОплатВесьПериод.СуммаОплаты),
	2
ИЗ
	ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях КАК врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях
		ПО (ИСТИНА)
ГДЕ
	ТаблицаОплатВесьПериод.СтатьяГрафика = &ШтрафыЗаСтрахование
	И врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях.СтатьяКомпенсация ЕСТЬ NULL

СГРУППИРОВАТЬ ПО
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.Валюта
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение КАК Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта КАК Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.Сумма КАК Сумма,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику,
	СУММА(ТаблицаОплатВесьПериод.СуммаОплаты) КАК СуммаОплаты,
	МАКСИМУМ(ТаблицаОплатВесьПериод.ДатаОплаты) КАК ДатаОплаты,
	ВЫБОР
		КОГДА МАКСИМУМ(ТаблицаОплатВесьПериод.ДатаОплаты) ЕСТЬ NULL
				ИЛИ ТаблицаНачисленийВесьПериод.Сумма - ЕСТЬNULL(СУММА(ТаблицаОплатВесьПериод.СуммаОплаты), 0) > 0
				ИЛИ РАЗНОСТЬДАТ(ПроизводственныйКалендарь.ПервыйРабочийДень, МАКСИМУМ(ТаблицаОплатВесьПериод.ДатаОплаты), ДЕНЬ) > 0
			ТОГДА 1
		ИНАЧЕ 0
	КОНЕЦ КАК ПросроченныйПлатеж
ПОМЕСТИТЬ ТаблицаВзаиморасчетовВесьПериод
ИЗ
	ТаблицаНачисленийВесьПериод КАК ТаблицаНачисленийВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ПО ТаблицаНачисленийВесьПериод.ДоговорЛизинга = ТаблицаОплатВесьПериод.ДоговорЛизинга
			И ТаблицаНачисленийВесьПериод.Приложение = ТаблицаОплатВесьПериод.Приложение
			И ТаблицаНачисленийВесьПериод.СтатьяГрафика = ТаблицаОплатВесьПериод.СтатьяГрафика
			И ТаблицаНачисленийВесьПериод.Валюта = ТаблицаОплатВесьПериод.Валюта
			И ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты = ТаблицаОплатВесьПериод.ПлановаяДатаОплаты
			И ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика = ТаблицаОплатВесьПериод.НачислениеВнеГрафика
		ЛЕВОЕ СОЕДИНЕНИЕ ПроизводственныйКалендарь КАК ПроизводственныйКалендарь
		ПО ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты = ПроизводственныйКалендарь.Дата

СГРУППИРОВАТЬ ПО
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.Сумма,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику,
	ПроизводственныйКалендарь.ПервыйРабочийДень

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение КАК Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта КАК Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.Сумма КАК Сумма,
	КОЛИЧЕСТВО(ТаблицаНачисленийВесьПериодДляНомераПлатежа.ПлановаяДатаОплаты) КАК НомерПлатежа,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику
ПОМЕСТИТЬ ТаблицаНачислений
ИЗ
	ТаблицаНачисленийВесьПериод КАК ТаблицаНачисленийВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаНачисленийВесьПериод КАК ТаблицаНачисленийВесьПериодДляНомераПлатежа
		ПО ТаблицаНачисленийВесьПериод.ДоговорЛизинга = ТаблицаНачисленийВесьПериодДляНомераПлатежа.ДоговорЛизинга
			И ТаблицаНачисленийВесьПериод.Приложение = ТаблицаНачисленийВесьПериодДляНомераПлатежа.Приложение
			И ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты >= ТаблицаНачисленийВесьПериодДляНомераПлатежа.ПлановаяДатаОплаты
			И ТаблицаНачисленийВесьПериод.СтатьяГрафика = ТаблицаНачисленийВесьПериодДляНомераПлатежа.СтатьяГрафика
			И ТаблицаНачисленийВесьПериод.Валюта = ТаблицаНачисленийВесьПериодДляНомераПлатежа.Валюта
			И (НЕ ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика
				ИЛИ ТаблицаНачисленийВесьПериод.СтатьяГрафика = &СтатьяЛП)

СГРУППИРОВАТЬ ПО
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.Сумма,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
УНИЧТОЖИТЬ ТаблицаНачисленийВесьПериод
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОплатыИОстатки.ДоговорЛизинга КАК ДоговорЛизинга,
	ОплатыИОстатки.Приложение КАК Приложение,
	ОплатыИОстатки.СтатьяГрафика КАК СтатьяГрафика,
	ОплатыИОстатки.Валюта КАК Валюта,
	ОплатыИОстатки.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ОплатыИОстатки.ДатаПередачи КАК ДатаПередачи,
	ОплатыИОстатки.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ОплатыИОстатки.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	КОНЕЦПЕРИОДА(ОплатыИОстатки.КонецИнтервалаРасчета, ДЕНЬ) КАК КонецИнтервалаРасчета,
	ЕСТЬNULL(ОплатыИОстатки.ДатаОплаты, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаОплаты,
	ОплатыИОстатки.БазаРасчетаПеней КАК БазаРасчетаПеней,
	ОплатыИОстатки.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
	ОплатыИОстатки.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток,
	ОплатыИОстатки.СуммаОплаты КАК СуммаОплаты
ПОМЕСТИТЬ ТаблицаДляРасчетаПеней
ИЗ
	(ВЫБРАТЬ
		Оплаты.ДоговорЛизинга КАК ДоговорЛизинга,
		Оплаты.Приложение КАК Приложение,
		Оплаты.СтатьяГрафика КАК СтатьяГрафика,
		Оплаты.Валюта КАК Валюта,
		Оплаты.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
		Оплаты.ДатаПередачи КАК ДатаПередачи,
		Оплаты.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
		Оплаты.ДатаОплаты КАК КонецИнтервалаРасчета,
		Оплаты.ДатаОплаты КАК ДатаОплаты,
		Оплаты.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
		Оплаты.СуммаНачальныйОстаток КАК БазаРасчетаПеней,
		Оплаты.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
		Оплаты.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток,
		Оплаты.СуммаОплаты КАК СуммаОплаты
	ИЗ
		ТаблицаОплатСОстаткамиВесьПериод КАК Оплаты
	ГДЕ
		Оплаты.ДатаОплаты <= &КонецПериода
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		Остатки.ДоговорЛизинга,
		Остатки.Приложение,
		Остатки.СтатьяГрафика,
		Остатки.Валюта,
		Остатки.ПлановаяДатаОплаты,
		Остатки.ДатаПередачи,
		ЕСТЬNULL(МАКСИМУМ(Оплаты.ДатаОплаты), Остатки.ПлановаяДатаОплаты),
		&КонецПериода,
		NULL,
		Остатки.НачислениеВнеГрафика,
		Остатки.СуммаОстаток,
		Остатки.СуммаОстаток1,
		Остатки.СуммаОстаток2,
		0
	ИЗ
		ТаблицаОстатков КАК Остатки
			ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОплатВесьПериод КАК Оплаты
			ПО (Оплаты.ДоговорЛизинга = Остатки.ДоговорЛизинга)
				И (Оплаты.Приложение = Остатки.Приложение)
				И (Оплаты.СтатьяГрафика = Остатки.СтатьяГрафика)
				И (Оплаты.Валюта = Остатки.Валюта)
				И (Оплаты.ПлановаяДатаОплаты = Остатки.ПлановаяДатаОплаты)
				И (Оплаты.НачислениеВнеГрафика = Остатки.НачислениеВнеГрафика)
				И (Оплаты.ДатаОплаты <= &КонецПериода)
	ГДЕ
		Остатки.СуммаОстаток > 0
	
	СГРУППИРОВАТЬ ПО
		Остатки.ДоговорЛизинга,
		Остатки.Приложение,
		Остатки.СтатьяГрафика,
		Остатки.Валюта,
		Остатки.ПлановаяДатаОплаты,
		Остатки.ДатаПередачи,
		Остатки.НачислениеВнеГрафика,
		Остатки.СуммаОстаток,
		Остатки.СуммаОстаток1,
		Остатки.СуммаОстаток2) КАК ОплатыИОстатки

СГРУППИРОВАТЬ ПО
	ОплатыИОстатки.Приложение,
	ОплатыИОстатки.Валюта,
	ОплатыИОстатки.ПлановаяДатаОплаты,
	ОплатыИОстатки.ДатаПередачи,
	ОплатыИОстатки.НачалоИнтервалаРасчета,
	ОплатыИОстатки.НачислениеВнеГрафика,
	ОплатыИОстатки.ДоговорЛизинга,
	ОплатыИОстатки.СтатьяГрафика,
	ОплатыИОстатки.КонецИнтервалаРасчета,
	ОплатыИОстатки.ДатаОплаты,
	ОплатыИОстатки.СуммаНачальныйОстаток,
	ОплатыИОстатки.СуммаКонечныйОстаток,
	ОплатыИОстатки.СуммаОплаты,
	ОплатыИОстатки.БазаРасчетаПеней

ИНДЕКСИРОВАТЬ ПО
	ОплатыИОстатки.ДоговорЛизинга,
	ОплатыИОстатки.Приложение,
	ОплатыИОстатки.СтатьяГрафика,
	ОплатыИОстатки.Валюта,
	ОплатыИОстатки.ПлановаяДатаОплаты,
	ОплатыИОстатки.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПараметрыНачисленияПениПоДоговорамЛизинга.Период КАК Период,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ДоговорКонтрагента КАК ДоговорКонтрагента,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ПараметрыНачисленияПениПоДоговорамЛизинга.НаборИсключаемыхСтатей КАК НаборИсключаемыхСтатей,
	ПараметрыНачисленияПениПоДоговорамЛизинга.СтавкаПени КАК СтавкаПени,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ЛьготныйПериод КАК ЛьготныйПериод
ПОМЕСТИТЬ ПараметрыНачисленияПени
ИЗ
	РегистрСведений.хлПараметрыНачисленияПениПоДоговорамЛизинга КАК ПараметрыНачисленияПениПоДоговорамЛизинга
ГДЕ
	ПараметрыНачисленияПениПоДоговорамЛизинга.ДоговорКонтрагента = &ДоговорЛизинга

ИНДЕКСИРОВАТЬ ПО
	ПараметрыНачисленияПениПоДоговорамЛизинга.Период,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ДоговорКонтрагента,
	НаборИсключаемыхСтатей,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ПлановаяДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	ПараметрыНачисленияПени.ДоговорКонтрагента КАК ДоговорКонтрагента,
	ПараметрыНачисленияПени.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты
ПОМЕСТИТЬ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
ИЗ
	ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
ГДЕ
	ПараметрыНачисленияПени.ПлановаяДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)

ИНДЕКСИРОВАТЬ ПО
	ПараметрыНачисленияПени.ПлановаяДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета КАК ДатаПараметров,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение КАК Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта КАК Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика
ПОМЕСТИТЬ ДатыПараметровНачисленияПени
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
ГДЕ
	ТаблицаДляРасчетаПеней.ДатаПередачи <> ДАТАВРЕМЯ(1, 1, 1)
	И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты >= ТаблицаДляРасчетаПеней.ДатаПередачи

ОБЪЕДИНИТЬ

ВЫБРАТЬ
	НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ),
	ТаблицаДляРасчетаПеней.ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
ГДЕ
	ТаблицаДляРасчетаПеней.ДатаПередачи <> ДАТАВРЕМЯ(1, 1, 1)
	И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты >= ТаблицаДляРасчетаПеней.ДатаПередачи

ОБЪЕДИНИТЬ

ВЫБРАТЬ
	ПараметрыНачисленияПени.Период,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты КАК ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
		ПО ТаблицаДляРасчетаПеней.ДоговорЛизинга = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ДоговорКонтрагента
			И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
		ПО (ПараметрыНачисленияПени.Период <= ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			И (ПараметрыНачисленияПени.Период >= ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета)
			И (ПараметрыНачисленияПени.ДоговорКонтрагента = ТаблицаДляРасчетаПеней.ДоговорЛизинга)
			И (ВЫБОР
				КОГДА ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты ЕСТЬ NULL
					ТОГДА ПараметрыНачисленияПени.ПлановаяДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ПараметрыНачисленияПени.ПлановаяДатаОплаты = ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты
			КОНЕЦ)
			И (ТаблицаДляРасчетаПеней.ДатаПередачи <> ДАТАВРЕМЯ(1, 1, 1))
			И (ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты >= ТаблицаДляРасчетаПеней.ДатаПередачи)

ИНДЕКСИРОВАТЬ ПО
	ДатаПараметров,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение КАК Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта КАК Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ДатыПараметровНачисленияПени.ДатаПараметров КАК ДатаПараметров
ПОМЕСТИТЬ ИнтервалыРасчетаПенейСДатамиИзмененияПараметровНачисленияПени
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДатыПараметровНачисленияПени КАК ДатыПараметровНачисленияПени
		ПО (ВЫБОР
				КОГДА ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета > ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета
					ТОГДА ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета = ДатыПараметровНачисленияПени.ДатаПараметров
				ИНАЧЕ ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета <= ДатыПараметровНачисленияПени.ДатаПараметров
						И ДатыПараметровНачисленияПени.ДатаПараметров <= ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета
			КОНЕЦ)
			И ТаблицаДляРасчетаПеней.ДоговорЛизинга = ДатыПараметровНачисленияПени.ДоговорЛизинга
			И ТаблицаДляРасчетаПеней.Приложение = ДатыПараметровНачисленияПени.Приложение
			И ТаблицаДляРасчетаПеней.СтатьяГрафика = ДатыПараметровНачисленияПени.СтатьяГрафика
			И ТаблицаДляРасчетаПеней.Валюта = ДатыПараметровНачисленияПени.Валюта
			И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты = ДатыПараметровНачисленияПени.ПлановаяДатаОплаты
			И ТаблицаДляРасчетаПеней.НачислениеВнеГрафика = ДатыПараметровНачисленияПени.НачислениеВнеГрафика

ИНДЕКСИРОВАТЬ ПО
	НачалоИнтервалаРасчета,
	КонецИнтервалаРасчета,
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика,
	ДатаПараметров
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Приложение КАК Приложение,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Валюта КАК Валюта,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров КАК НачалоИнтервалаПараметров,
	МИНИМУМ(ВЫБОР
			КОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета <= КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров, ДЕНЬ)
				ТОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета
			ИНАЧЕ КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров, ДЕНЬ)
		КОНЕЦ) КАК КонецИнтервалаПараметров
ПОМЕСТИТЬ ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПени
ИЗ
	ИнтервалыРасчетаПенейСДатамиИзмененияПараметровНачисленияПени КАК ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ИнтервалыРасчетаПенейСДатамиИзмененияПараметровНачисленияПени КАК ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1
		ПО ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.НачалоИнтервалаРасчета
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.КонецИнтервалаРасчета
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДоговорЛизинга = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДоговорЛизинга
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Приложение = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.Приложение
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.СтатьяГрафика = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.СтатьяГрафика
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Валюта = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.Валюта
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ПлановаяДатаОплаты
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачислениеВнеГрафика = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.НачислениеВнеГрафика
			И (ВЫБОР
				КОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета >= НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета, ДЕНЬ)
					ТОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров
				ИНАЧЕ ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров < ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров
			КОНЕЦ)
ГДЕ
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты <= ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров

СГРУППИРОВАТЬ ПО
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДоговорЛизинга,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Приложение,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.СтатьяГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Валюта,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров

ИНДЕКСИРОВАТЬ ПО
	НачалоИнтервалаРасчета,
	ДоговорЛизинга
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Приложение КАК Приложение,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Валюта КАК Валюта,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаПараметров КАК НачалоИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаПараметров КАК КонецИнтервалаПараметров,
	МАКСИМУМ(ПараметрыНачисленияПени.Период) КАК ПериодПараметров
ПОМЕСТИТЬ ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПениСДатамиПараметров
ИЗ
	ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПени КАК ТаблицаДляРасчетаПенейПоИнтерваламПараметров
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты КАК ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ДоговорКонтрагента
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаПараметров >= ПараметрыНачисленияПени.Период
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга = ПараметрыНачисленияПени.ДоговорКонтрагента
			И (ВЫБОР
				КОГДА ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты ЕСТЬ NULL
					ТОГДА ПараметрыНачисленияПени.ПлановаяДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПени.ПлановаяДатаОплаты
			КОНЕЦ)

СГРУППИРОВАТЬ ПО
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Приложение,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.СтатьяГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Валюта,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаПараметров

ИНДЕКСИРОВАТЬ ПО
	ПериодПараметров,
	ДоговорЛизинга,
	СтатьяГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.Приложение КАК Приложение,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.Валюта КАК Валюта,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.НачалоИнтервалаПараметров КАК НачалоИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.КонецИнтервалаПараметров КАК КонецИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПериодПараметров КАК ПериодПараметров,
	ЕСТЬNULL(ПараметрыНачисленияПени.СтавкаПени, 0) КАК СтавкаПени,
	ЕСТЬNULL(ПараметрыНачисленияПени.ЛьготныйПериод, 0) КАК ЛьготныйПериод
ПОМЕСТИТЬ ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени
ИЗ
	ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПениСДатамиПараметров КАК ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты КАК ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ДоговорЛизинга = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ДоговорКонтрагента
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПериодПараметров = ПараметрыНачисленияПени.Период
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ДоговорЛизинга = ПараметрыНачисленияПени.ДоговорКонтрагента
			И (ВЫБОР
				КОГДА ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты ЕСТЬ NULL
					ТОГДА ПараметрыНачисленияПени.ПлановаяДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПени.ПлановаяДатаОплаты
			КОНЕЦ)
		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ИсключаемыеСтатьи КАК НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи
		ПО (ВЫБОР
				КОГДА &НаборСтатейИсключаемыхИзБазыРасчетаПени = ЗНАЧЕНИЕ(Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ПустаяСсылка)
					ТОГДА ПараметрыНачисленияПени.НаборИсключаемыхСтатей = НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Ссылка
				ИНАЧЕ НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Ссылка = &НаборСтатейИсключаемыхИзБазыРасчетаПени
			КОНЕЦ)
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.СтатьяГрафика = НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья
ГДЕ
	НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья ЕСТЬ NULL

ИНДЕКСИРОВАТЬ ПО
	НачалоИнтервалаРасчета,
	КонецИнтервалаРасчета,
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение КАК Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта КАК Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.НачалоИнтервалаПараметров, ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета) КАК НачалоИнтервалаРасчета,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета) КАК КонецИнтервалаРасчета,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ТаблицаДляРасчетаПеней.ДатаОплаты
		ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1)
	КОНЕЦ КАК ДатаОплаты,
	ТаблицаДляРасчетаПеней.БазаРасчетаПеней КАК БазаРасчетаПеней,
	ТаблицаДляРасчетаПеней.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ТаблицаДляРасчетаПеней.СуммаКонечныйОстаток
		ИНАЧЕ ТаблицаДляРасчетаПеней.СуммаНачальныйОстаток
	КОНЕЦ КАК СуммаКонечныйОстаток,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ТаблицаДляРасчетаПеней.СуммаОплаты
		ИНАЧЕ 0
	КОНЕЦ КАК СуммаОплаты,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.СтавкаПени, 0) КАК СтавкаПени,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.ЛьготныйПериод, 0) КАК ЛьготныйПериод,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		ИНАЧЕ ВЫБОР
				КОГДА ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета) = &КонецПериода
					ТОГДА ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			КОНЕЦ
	КОНЕЦ КАК ДатаИзмененияПараметров
ПОМЕСТИТЬ ТаблицаДляРасчетаПенейСПараметрамиНачисленияПени
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
		ЛЕВОЕ СОЕДИНЕНИЕ ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени КАК ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени
		ПО ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.НачалоИнтервалаРасчета
			И ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаРасчета
			И ТаблицаДляРасчетаПеней.ДоговорЛизинга = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.ДоговорЛизинга
			И ТаблицаДляРасчетаПеней.Приложение = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.Приложение
			И ТаблицаДляРасчетаПеней.СтатьяГрафика = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.СтатьяГрафика
			И ТаблицаДляРасчетаПеней.Валюта = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.Валюта
			И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.ПлановаяДатаОплаты
			И ТаблицаДляРасчетаПеней.НачислениеВнеГрафика = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.НачислениеВнеГрафика

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика,
	НачалоИнтервалаРасчета
;

////////////////////////////////////////////////////////////////////////////////
УНИЧТОЖИТЬ ТаблицаОплатВесьПериод
;

////////////////////////////////////////////////////////////////////////////////
УНИЧТОЖИТЬ ТаблицаОстатков
;

////////////////////////////////////////////////////////////////////////////////
УНИЧТОЖИТЬ ТаблицаОплатСОстаткамиВесьПериод
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ЕСТЬNULL(ТаблицаВзаиморасчетов.ДоговорЛизинга, ТаблицаДляРасчетаПеней.ДоговорЛизинга) КАК ДоговорЛизинга,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.Приложение, ТаблицаДляРасчетаПеней.Приложение) КАК Приложение,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.СтатьяГрафика, ТаблицаДляРасчетаПеней.СтатьяГрафика) КАК СтатьяГрафика,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.Валюта, ТаблицаДляРасчетаПеней.Валюта) КАК Валюта,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.ПлановаяДатаОплаты, ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты) КАК ПлановаяДатаОплаты,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.НачислениеВнеГрафика, ТаблицаДляРасчетаПеней.НачислениеВнеГрафика) КАК НачислениеВнеГрафика,
	ЕСТЬNULL(ТаблицаДляРасчетаПеней.СуммаНачальныйОстаток, ТаблицаВзаиморасчетов.Сумма) КАК СуммаКОплате,
	ТаблицаВзаиморасчетов.Сумма КАК СуммаНачисленная,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.ЭтоПлатежПоТекущемуГрафику, ИСТИНА) КАК ЭтоПлатежПоТекущемуГрафику,
	ВЫБОР
		КОГДА ТаблицаВзаиморасчетов.ПлановаяДатаОплаты > ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
			ТОГДА ТаблицаВзаиморасчетов.ПлановаяДатаОплаты
		ИНАЧЕ ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
	КОНЕЦ КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.ДатаОплаты КАК ДатаОплаты,
	ТаблицаДляРасчетаПеней.СуммаОплаты КАК СуммаОплаты,
	ТаблицаДляРасчетаПеней.СуммаКонечныйОстаток КАК СуммаОстаток,
	ТаблицаВзаиморасчетов.НомерПлатежа КАК НомерПлатежа,
	ПроизводственныйКалендарь.ПервыйРабочийДень КАК ПервыйРабочийДень,
	ТаблицаПередач.ДатаПередачи КАК ДатаПередачи,
	ВЫБОР
		КОГДА ПроизводственныйКалендарь.ПервыйРабочийДень < ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
			ТОГДА РАЗНОСТЬДАТ(ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
		КОГДА ПроизводственныйКалендарь.ПервыйРабочийДень < ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета
			ТОГДА РАЗНОСТЬДАТ(ПроизводственныйКалендарь.ПервыйРабочийДень, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
		ИНАЧЕ 0
	КОНЕЦ КАК ДнейСкорректированных,
	ВЫБОР
		КОГДА НАЧАЛОПЕРИОДА(ПроизводственныйКалендарь.ПервыйРабочийДень, ДЕНЬ) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоПросроченныйПлатеж,
	ТаблицаДляРасчетаПеней.СтавкаПени КАК СтавкаПени,
	ТаблицаДляРасчетаПеней.ЛьготныйПериод КАК ЛьготныйПериод,
	ТаблицаДляРасчетаПеней.БазаРасчетаПеней КАК БазаРасчетаПеней,
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА ДОБАВИТЬКДАТЕ(ПроизводственныйКалендарь.ПервыйРабочийДень, ДЕНЬ, ТаблицаДляРасчетаПеней.ЛьготныйПериод) < ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
				ТОГДА РАЗНОСТЬДАТ(ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			КОГДА ДОБАВИТЬКДАТЕ(ПроизводственныйКалендарь.ПервыйРабочийДень, ДЕНЬ, ТаблицаДляРасчетаПеней.ЛьготныйПериод) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
				ТОГДА РАЗНОСТЬДАТ(ПроизводственныйКалендарь.ПервыйРабочийДень, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			ИНАЧЕ 0
		КОНЕЦ * ВЫБОР
			КОГДА ЕСТЬNULL(ТаблицаДляРасчетаПеней.БазаРасчетаПеней, 0) < 0
				ТОГДА 0
			ИНАЧЕ ЕСТЬNULL(ТаблицаДляРасчетаПеней.БазаРасчетаПеней, 0)
		КОНЕЦ * ТаблицаДляРасчетаПеней.СтавкаПени * 0.01 КАК ЧИСЛО(15, 2)) КАК СуммаПеней,
	ТаблицаДляРасчетаПеней.ДатаИзмененияПараметров КАК ДатаИзмененияПараметров,
	ВЫБОР
		КОГДА ЕСТЬNULL(ТаблицаВзаиморасчетов.СтатьяГрафика, ТаблицаДляРасчетаПеней.СтатьяГрафика) = &СтатьяЛП
			ТОГДА 1
		ИНАЧЕ 2
	КОНЕЦ КАК РазделительСтатейПоОплатеПеней
ПОМЕСТИТЬ ТаблицаРассчитанныхПеней
ИЗ
	ТаблицаНачислений КАК ТаблицаВзаиморасчетов
		ПОЛНОЕ СОЕДИНЕНИЕ ТаблицаДляРасчетаПенейСПараметрамиНачисленияПени КАК ТаблицаДляРасчетаПеней
		ПО ТаблицаВзаиморасчетов.ДоговорЛизинга = ТаблицаДляРасчетаПеней.ДоговорЛизинга
			И ТаблицаВзаиморасчетов.Приложение = ТаблицаДляРасчетаПеней.Приложение
			И ТаблицаВзаиморасчетов.СтатьяГрафика = ТаблицаДляРасчетаПеней.СтатьяГрафика
			И ТаблицаВзаиморасчетов.Валюта = ТаблицаДляРасчетаПеней.Валюта
			И ТаблицаВзаиморасчетов.ПлановаяДатаОплаты = ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты
			И ТаблицаВзаиморасчетов.НачислениеВнеГрафика = ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
		ЛЕВОЕ СОЕДИНЕНИЕ ПроизводственныйКалендарь КАК ПроизводственныйКалендарь
		ПО ТаблицаВзаиморасчетов.ПлановаяДатаОплаты = ПроизводственныйКалендарь.Дата
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаПередач КАК ТаблицаПередач
		ПО ТаблицаВзаиморасчетов.ДоговорЛизинга = ТаблицаПередач.ДоговорЛизинга

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	Валюта,
	КонецИнтервалаРасчета,
	НомерПлатежа
;

////////////////////////////////////////////////////////////////////////////////
УНИЧТОЖИТЬ ТаблицаНачислений
;

////////////////////////////////////////////////////////////////////////////////
УНИЧТОЖИТЬ ТаблицаДляРасчетаПеней
;

////////////////////////////////////////////////////////////////////////////////
УНИЧТОЖИТЬ ПроизводственныйКалендарь
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаРассчитанныхПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаРассчитанныхПеней.Приложение КАК Приложение,
	ТаблицаРассчитанныхПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаРассчитанныхПеней.Валюта КАК Валюта,
	ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаРассчитанныхПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаРассчитанныхПеней.СуммаКОплате КАК СуммаКОплате,
	ТаблицаРассчитанныхПеней.СуммаНачисленная КАК СуммаНачисленная,
	ТаблицаРассчитанныхПеней.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику,
	ТаблицаРассчитанныхПеней.ДатаПередачи КАК ДатаПередачи,
	ТаблицаРассчитанныхПеней.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.ДатаОплаты КАК ДатаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОплаты КАК СуммаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОстаток КАК СуммаОстаток,
	ТаблицаРассчитанныхПеней.НомерПлатежа КАК НомерПлатежа,
	ТаблицаРассчитанныхПеней.ПервыйРабочийДень КАК ПервыйРабочийДень,
	ТаблицаРассчитанныхПеней.ДнейСкорректированных КАК ДнейСкорректированных,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатеж КАК ЭтоПросроченныйПлатеж,
	ТаблицаРассчитанныхПеней.ДатаИзмененияПараметров КАК ДатаИзмененияПараметров,
	ТаблицаРассчитанныхПеней.СтавкаПени КАК СтавкаПени,
	ТаблицаРассчитанныхПеней.ЛьготныйПериод КАК ЛьготныйПериод,
	ТаблицаРассчитанныхПеней.СуммаПеней КАК СуммаПеней,
	ТаблицаРассчитанныхПеней.РазделительСтатейПоОплатеПеней КАК РазделительСтатейПоОплатеПеней,
	СУММА(ЕСТЬNULL(ТаблицаРассчитанныхПеней1.СуммаПеней, 0)) КАК СуммаПенейНарастающийИтог
ПОМЕСТИТЬ ТаблицаРассчитанныхПенейСНарастающимИтогом
ИЗ
	ТаблицаРассчитанныхПеней КАК ТаблицаРассчитанныхПеней
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаРассчитанныхПеней КАК ТаблицаРассчитанныхПеней1
		ПО ТаблицаРассчитанныхПеней.ДоговорЛизинга = ТаблицаРассчитанныхПеней1.ДоговорЛизинга
			И ТаблицаРассчитанныхПеней.Приложение = ТаблицаРассчитанныхПеней1.Приложение
			И ТаблицаРассчитанныхПеней.Валюта = ТаблицаРассчитанныхПеней1.Валюта
			И (ВЫБОР
				КОГДА ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета = ТаблицаРассчитанныхПеней1.КонецИнтервалаРасчета
					ТОГДА ВЫБОР
							КОГДА ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты = ТаблицаРассчитанныхПеней1.ПлановаяДатаОплаты
								ТОГДА ВЫБОР
										КОГДА ТаблицаРассчитанныхПеней.НачислениеВнеГрафика = ТаблицаРассчитанныхПеней1.НачислениеВнеГрафика
											ТОГДА ТаблицаРассчитанныхПеней.СтатьяГрафика >= ТаблицаРассчитанныхПеней1.СтатьяГрафика
										ИНАЧЕ ТаблицаРассчитанныхПеней.НачислениеВнеГрафика >= ТаблицаРассчитанныхПеней1.НачислениеВнеГрафика
									КОНЕЦ
							ИНАЧЕ ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты >= ТаблицаРассчитанныхПеней1.ПлановаяДатаОплаты
						КОНЕЦ
				ИНАЧЕ ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета >= ТаблицаРассчитанныхПеней1.КонецИнтервалаРасчета
			КОНЕЦ)
			И ТаблицаРассчитанныхПеней.РазделительСтатейПоОплатеПеней = ТаблицаРассчитанныхПеней1.РазделительСтатейПоОплатеПеней

СГРУППИРОВАТЬ ПО
	ТаблицаРассчитанныхПеней.ДоговорЛизинга,
	ТаблицаРассчитанныхПеней.Приложение,
	ТаблицаРассчитанныхПеней.СтатьяГрафика,
	ТаблицаРассчитанныхПеней.Валюта,
	ТаблицаРассчитанныхПеней.НачислениеВнеГрафика,
	ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты,
	ТаблицаРассчитанныхПеней.СуммаКОплате,
	ТаблицаРассчитанныхПеней.СуммаНачисленная,
	ТаблицаРассчитанныхПеней.ЭтоПлатежПоТекущемуГрафику,
	ТаблицаРассчитанныхПеней.ДатаПередачи,
	ТаблицаРассчитанныхПеней.НачалоИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.ДатаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОстаток,
	ТаблицаРассчитанныхПеней.НомерПлатежа,
	ТаблицаРассчитанныхПеней.ПервыйРабочийДень,
	ТаблицаРассчитанныхПеней.ДнейСкорректированных,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатеж,
	ТаблицаРассчитанныхПеней.СтавкаПени,
	ТаблицаРассчитанныхПеней.ЛьготныйПериод,
	ТаблицаРассчитанныхПеней.СуммаПеней,
	ТаблицаРассчитанныхПеней.ДатаИзмененияПараметров,
	ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.РазделительСтатейПоОплатеПеней

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОсновнаяТаблица.ДоговорЛизинга.Владелец КАК Контрагент,
	ОсновнаяТаблица.ДоговорЛизинга КАК ДоговорЛизинга,
	ОсновнаяТаблица.Приложение КАК Приложение,
	ОсновнаяТаблица.СтатьяГрафика КАК Статья,
	ОсновнаяТаблица.Валюта КАК Валюта,
	ОсновнаяТаблица.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ОсновнаяТаблица.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ОсновнаяТаблица.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ОсновнаяТаблица.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ОсновнаяТаблица.ПервыйРабочийДень КАК ПервыйРабочийДень,
	ОсновнаяТаблица.СуммаКОплате КАК СуммаКОплате,
	ОсновнаяТаблица.СуммаНачисленная КАК СуммаНачисленная,
	ОсновнаяТаблица.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафикуПлатежей,
	ОсновнаяТаблица.НомерПлатежа КАК НомерПлатежа,
	ОсновнаяТаблица.ДатаОплаты КАК ДатаОплаты,
	ОсновнаяТаблица.СуммаОплаты КАК СуммаОплаты,
	ОсновнаяТаблица.СуммаОстаток КАК СуммаОстаток,
	ОсновнаяТаблица.ДатаПередачи КАК ДатаПередачи,
	ОсновнаяТаблица.ДнейСкорректированных КАК ДнейСкорректированных,
	ОсновнаяТаблица.ЭтоПросроченныйПлатеж КАК ЭтоПросроченныйПлатеж,
	ОсновнаяТаблица.ДатаИзмененияПараметров КАК ДатаИзмененияПараметров,
	ОсновнаяТаблица.СтавкаПени КАК СтавкаПени,
	ОсновнаяТаблица.ЛьготныйПериод КАК ЛьготныйПериод,
	ОсновнаяТаблица.СуммаПеней КАК СуммаПеней,
	ОсновнаяТаблица.СуммаПенейНарастающийИтог КАК СуммаПенейНарастающийИтог,
	МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0)) КАК ОбщаяСуммаОплаченныхПеней,
	ВЫБОР
		КОГДА МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0)) > ОсновнаяТаблица.СуммаПенейНарастающийИтог
			ТОГДА ОсновнаяТаблица.СуммаПеней
		КОГДА ОсновнаяТаблица.СуммаПенейНарастающийИтог - ОсновнаяТаблица.СуммаПеней > МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0))
			ТОГДА 0
		ИНАЧЕ МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0)) - ОсновнаяТаблица.СуммаПенейНарастающийИтог + ОсновнаяТаблица.СуммаПеней
	КОНЕЦ КАК ПениОплачено,
	ВЫБОР
		КОГДА ОсновнаяТаблица.ЭтоПросроченныйПлатеж
			ТОГДА ЕСТЬNULL(СУММА(ТаблицаВзаиморасчетовВесьПериод.ПросроченныйПлатеж), 0) + 1
		ИНАЧЕ 0
	КОНЕЦ КАК ПовторениеПросрочки,
	ОсновнаяТаблица.РазделительСтатейПоОплатеПеней КАК РазделительСтатейПоОплатеПеней
ИЗ
	ТаблицаРассчитанныхПенейСНарастающимИтогом КАК ОсновнаяТаблица
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаВзаиморасчетовВесьПериод КАК ТаблицаВзаиморасчетовВесьПериод
		ПО ОсновнаяТаблица.ДоговорЛизинга = ТаблицаВзаиморасчетовВесьПериод.ДоговорЛизинга
			И ОсновнаяТаблица.Приложение = ТаблицаВзаиморасчетовВесьПериод.Приложение
			И ОсновнаяТаблица.СтатьяГрафика = ТаблицаВзаиморасчетовВесьПериод.СтатьяГрафика
			И ОсновнаяТаблица.Валюта = ТаблицаВзаиморасчетовВесьПериод.Валюта
			И ОсновнаяТаблица.ПлановаяДатаОплаты > ТаблицаВзаиморасчетовВесьПериод.ПлановаяДатаОплаты
			И ОсновнаяТаблица.НачислениеВнеГрафика = ТаблицаВзаиморасчетовВесьПериод.НачислениеВнеГрафика
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОплатПенейВесьПериод КАК ОплатыПеней
		ПО ОсновнаяТаблица.ДоговорЛизинга = ОплатыПеней.ДоговорЛизинга
			И ОсновнаяТаблица.Приложение = ОплатыПеней.Приложение
			И ОсновнаяТаблица.Валюта = ОплатыПеней.Валюта
			И ОсновнаяТаблица.РазделительСтатейПоОплатеПеней = ОплатыПеней.РазделительСтатейПоОплатеПеней
ГДЕ
	ОсновнаяТаблица.ПлановаяДатаОплаты МЕЖДУ &НачалоПериода И &КонецПериода

СГРУППИРОВАТЬ ПО
	ОсновнаяТаблица.ДоговорЛизинга.Владелец,
	ОсновнаяТаблица.ДоговорЛизинга,
	ОсновнаяТаблица.Приложение,
	ОсновнаяТаблица.СтатьяГрафика,
	ОсновнаяТаблица.Валюта,
	ОсновнаяТаблица.ДатаПередачи,
	ОсновнаяТаблица.НачислениеВнеГрафика,
	ОсновнаяТаблица.ПлановаяДатаОплаты,
	ОсновнаяТаблица.ЭтоПросроченныйПлатеж,
	ОсновнаяТаблица.НомерПлатежа,
	ОсновнаяТаблица.ПервыйРабочийДень,
	ОсновнаяТаблица.ДатаОплаты,
	ОсновнаяТаблица.НачалоИнтервалаРасчета,
	ОсновнаяТаблица.СуммаКОплате,
	ОсновнаяТаблица.СуммаНачисленная,
	ОсновнаяТаблица.СуммаПенейНарастающийИтог,
	ОсновнаяТаблица.ЭтоПлатежПоТекущемуГрафику,
	ОсновнаяТаблица.СуммаОплаты,
	ОсновнаяТаблица.СуммаОстаток,
	ОсновнаяТаблица.ДнейСкорректированных,
	ОсновнаяТаблица.СтавкаПени,
	ОсновнаяТаблица.ЛьготныйПериод,
	ОсновнаяТаблица.СуммаПеней,
	ОсновнаяТаблица.ДатаИзмененияПараметров,
	ОсновнаяТаблица.КонецИнтервалаРасчета,
	ОсновнаяТаблица.РазделительСтатейПоОплатеПеней"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",22},
{1,"ЭтоВыражение",
{"Pattern"},"В",9},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"#",5a49abd5-936d-4f46-8499-9cb204efe378},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",22}
},
{2,3,0,0,1,1,2,2,
{1,10,
{2,163,3,
{"S","ДоговорЛизинга"},
{"B",0},
{"#",376807bc-0d88-4c06-9eb2-42b72b970afb,25:834c94049cc883ef11ec0ef714c71e47},0},
{2,164,3,
{"S","НачалоПериода"},
{"B",0},
{"D",20220101000000},0},
{2,165,3,
{"S","КонецПериода"},
{"B",0},
{"D",20230101000000},0},
{2,166,3,
{"S","НаборСтатейИсключаемыхИзБазыРасчетаПени"},
{"B",0},
{"#",c3ec4375-8577-46d5-be3b-185e29cc8b67,17853:00000000000000000000000000000000},0},
{2,167,3,
{"S","НазначениеПени"},
{"B",0},
{"#",6bcdbfc3-84d1-4e5c-8ca9-d8e2b284449a,10672:ab6d3182f5ebc532496b0dcec964ddde},0},
{2,168,3,
{"S","НачалоВеденияУчета"},
{"B",0},
{"D",20010101000000},0},
{2,169,3,
{"S","СтатьяКомпенсацияСтрахования"},
{"B",0},
{"#",6bcdbfc3-84d1-4e5c-8ca9-d8e2b284449a,10672:86c101a9072f8a0e40fec391bb9e00a9},0},
{2,170,3,
{"S","СтатьяЛП"},
{"B",0},
{"#",46acbd87-b2d2-42f3-a9cc-ae9d20da8355,531:b6f2001b78e1182a11de1aad5fa16558},0},
{2,171,3,
{"S","Страна"},
{"B",0},
{"#",4ee4f6c6-683e-4abc-8890-ed6cde5a53cb,33:8ce4d57185730a3b4108effa215d0c81},0},
{2,172,3,
{"S","ШтрафыЗаСтрахование"},
{"B",0},
{"#",46acbd87-b2d2-42f3-a9cc-ae9d20da8355,531:816494049cc883ef11e5523c750d54c3},0}
},2,172},
{0,0}
}
},
{"N",1},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{2,
{0,"ИмяВарианта",
{"Pattern",
{"S"}
},"Имя варианта",15},
{1,"ТекстКода",
{"Pattern",
{"S"}
},"Текст кода",87}
},
{2,2,0,0,1,1,
{1,0},1,-1},
{0,0}
}
},
{"#",e199ca70-93cf-46ce-a54b-6edc88c3a296,
{#base64:AQE4EgAAAAAAAO+7v3siIyIsM2Q0OGZlYWUtYTljNi00YzVhLWEwOTktOWViNjQ3
NzYzMGM2LA0KezIsDQp7DQp7IlMiLCLRhdC70J3QvtC80LXRgNCU0L7Qs9C+0LLQ
vtGA0LAifSwNCnsiIyIsNDIzODAxOWQtN2U0OS00ZmM5LTkxZGItYjZiOTUxZDVj
ZjhlLA0KezUsDQp7DQp7IlMiLCLQndCw0YfQsNC70YzQvdCw0Y/QodGC0YDQvtC6
0LAifSwNCnsiTiIsMH0NCn0sDQp7DQp7IlMiLCLQmtC+0L3QtdGH0L3QsNGP0KHR
gtGA0L7QutCwIn0sDQp7Ik4iLDB9DQp9LA0Kew0KeyJTIiwi0KLQuNC/0JfQvdCw
0YfQtdC90LjRj9Ce0LHRitC10LrRgtCwIn0sDQp7IlUifQ0KfSwNCnsNCnsiUyIs
ItCf0L7Qu9GP0KHQuNC90YXRgNC+0L3QuNC30LDRhtC40LgifSwNCnsiIyIsYWNm
NjE5MmUtODFjYS00NmVmLTkzYTYtNWE2OTY4Yjc4NjYzLA0KezksDQp7NCwNCnsw
LCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC90LjQt9Cw0YbQuNC4IiwNCnsiUGF0dGVy
biIsDQp7IlMifQ0KfSwi0J/QvtC70LUg0YHQuNC90YXRgNC+0L3QuNC30LDRhtC4
0LgiLDMxfSwNCnsxLCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC90LjQt9Cw0YbQuNC4
0J/RgNC10LTRgdGC0LDQstC70LXQvdC40LUiLA0KeyJQYXR0ZXJuIiwNCnsiUyJ9
DQp9LCLQn9GA0LXQtNGB0YLQsNCy0LvQtdC90LjQtSIsMzF9LA0KezIsItCf0L7Q
u9C10KHQuNC90YXRgNC+0L3QuNC30LDRhtC40LjQotC40L/Ql9C90LDRh9C10L3Q
uNGPIiwNCnsiUGF0dGVybiIsDQp7IiMiLGY1YzY1MDUwLTNiYmItMTFkNS1iOTg4
LTAwNTBiYWUwYTk1ZH0NCn0sItCi0LjQvyDQt9C90LDRh9C10L3QuNGPIiwyMX0s
DQp7Mywi0J3QvtC80LXRgNCa0L7Qu9C+0L3QutC40J7RgtCx0L7RgNCwIiwNCnsi
UGF0dGVybiIsDQp7Ik4iLDEwLDAsMX0NCn0sItCd0L7QvNC10YAg0LrQvtC70L7Q
vdC60Lgg0YLQsNCx0LvQuNGG0Ysg0L7RgtCx0L7RgNCwIiwyNn0NCn0sDQp7Miw0
LDAsMCwxLDEsMiwyLDMsMywNCnsxLDB9LDMsLTF9LA0KezAsMH0NCn0NCn0NCn0s
DQp7DQp7IlMiLCLQotCw0LHQu9C40YfQvdGL0LnQlNC+0LrRg9C80LXQvdGC0J7R
gtCx0L7RgNCwIn0sDQp7IiMiLGU2MDMxMDNlLWEzMTgtNGVkYy1hMDE0LWIxYzZj
Zjk0ZDQ5ZiwNCns4LDEsMTEsDQp7IiMiLCIiLDEsMSwiIyIsItCv0LfRi9C6INC/
0L4g0YPQvNC+0LvRh9Cw0L3QuNGOIiwi0K/Qt9GL0Log0L/QviDRg9C80L7Qu9GH
0LDQvdC40Y4iLDB9LA0KezEyOCw3Mn0sDQp7MH0sMCwNCnswLDB9LA0KezAsMH0s
DQp7MCwwfSwNCnswLDB9LA0KezAsMH0sDQp7MCwwfSwwLDIsMCwNCnswLDAsMDAw
MDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAwLDB9LDAsMCwwLDAsMCww
LDAsMCwwLA0KezB9LA0KezB9LA0KezB9LA0KezB9LCIiLA0Kew0KezAsNiw2LA0K
eyJOIiwxMDAwfSw3LA0KeyJOIiwxMDAwfSw4LA0KeyJOIiwxMDAwfSw5LA0KeyJO
IiwxMDAwfSwxMCwNCnsiTiIsMTAwMH0sMTEsDQp7Ik4iLDEwMDB9DQp9DQp9LA0K
ezAsLTEsLTEsLTEsLTEsMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAw
MDAwfSwwLDAsMCwwLDAsMCwwLDEsMCwxLDAsMCwwLDAsMCwyLA0KezMsMywNCnst
MX0NCn0sDQp7MywzLA0Key0zfQ0KfSwwLDAsMCwiIiwwLA0KezMsMCwwLDEwMCwx
LDEsMCwxLDEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsIiIsMCwwLDAsMCwwLDAs
MH0sDQp7MH0sMCwwLDAsMSwwLDB9DQp9DQp9DQp9DQp9DQp9LA0Kew0KeyJTIiwi
0JTQvtCz0L7QstC+0YDQm9C40LfQuNC90LPQsCJ9LA0KeyIjIiw0MjM4MDE5ZC03
ZTQ5LTRmYzktOTFkYi1iNmI5NTFkNWNmOGUsDQp7NSwNCnsNCnsiUyIsItCd0LDR
h9Cw0LvRjNC90LDRj9Ch0YLRgNC+0LrQsCJ9LA0KeyJOIiwxfQ0KfSwNCnsNCnsi
UyIsItCa0L7QvdC10YfQvdCw0Y/QodGC0YDQvtC60LAifSwNCnsiTiIsMX0NCn0s
DQp7DQp7IlMiLCLQotC40L/Ql9C90LDRh9C10L3QuNGP0J7QsdGK0LXQutGC0LAi
fSwNCnsiVCIsMzc2ODA3YmMtMGQ4OC00YzA2LTllYjItNDJiNzJiOTcwYWZifQ0K
fSwNCnsNCnsiUyIsItCf0L7Qu9GP0KHQuNC90YXRgNC+0L3QuNC30LDRhtC40Lgi
fSwNCnsiIyIsYWNmNjE5MmUtODFjYS00NmVmLTkzYTYtNWE2OTY4Yjc4NjYzLA0K
ezksDQp7NCwNCnswLCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC90LjQt9Cw0YbQuNC4
IiwNCnsiUGF0dGVybiIsDQp7IlMifQ0KfSwi0J/QvtC70LUg0YHQuNC90YXRgNC+
0L3QuNC30LDRhtC40LgiLDMxfSwNCnsxLCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC9
0LjQt9Cw0YbQuNC40J/RgNC10LTRgdGC0LDQstC70LXQvdC40LUiLA0KeyJQYXR0
ZXJuIiwNCnsiUyJ9DQp9LCLQn9GA0LXQtNGB0YLQsNCy0LvQtdC90LjQtSIsMzF9
LA0KezIsItCf0L7Qu9C10KHQuNC90YXRgNC+0L3QuNC30LDRhtC40LjQotC40L/Q
l9C90LDRh9C10L3QuNGPIiwNCnsiUGF0dGVybiIsDQp7IiMiLGY1YzY1MDUwLTNi
YmItMTFkNS1iOTg4LTAwNTBiYWUwYTk1ZH0NCn0sItCi0LjQvyDQt9C90LDRh9C1
0L3QuNGPIiwyMX0sDQp7Mywi0J3QvtC80LXRgNCa0L7Qu9C+0L3QutC40J7RgtCx
0L7RgNCwIiwNCnsiUGF0dGVybiIsDQp7Ik4iLDEwLDAsMX0NCn0sItCd0L7QvNC1
0YAg0LrQvtC70L7QvdC60Lgg0YLQsNCx0LvQuNGG0Ysg0L7RgtCx0L7RgNCwIiwy
Nn0NCn0sDQp7Miw0LDAsMCwxLDEsMiwyLDMsMywNCnsxLDEsDQp7MiwwLDQsDQp7
IlMiLCLRhdC70J3QvtC80LXRgNCU0L7Qs9C+0LLQvtGA0LAifSwNCnsiUyIsItCU
0L7Qs9C+0LLQvtGA0JvQuNC30LjQvdCz0LAu0J3QvtC80LXRgCDQtNC+0LPQvtCy
0L7RgNCwIn0sDQp7IiMiLGY1YzY1MDUwLTNiYmItMTFkNS1iOTg4LTAwNTBiYWUw
YTk1ZCwNCnsiUGF0dGVybiIsDQp7IlMiLDEwMCwxfQ0KfQ0KfSwNCnsiTiIsMX0s
MH0NCn0sMywwfSwNCnswLDB9DQp9DQp9DQp9LA0Kew0KeyJTIiwi0KLQsNCx0LvQ
uNGH0L3Ri9C50JTQvtC60YPQvNC10L3RgtCe0YLQsdC+0YDQsCJ9LA0KeyIjIixl
NjAzMTAzZS1hMzE4LTRlZGMtYTAxNC1iMWM2Y2Y5NGQ0OWYsDQp7OCwxLDExLA0K
eyIjIiwiIiwxLDEsIiMiLCLQr9C30YvQuiDQv9C+INGD0LzQvtC70YfQsNC90LjR
jiIsItCv0LfRi9C6INC/0L4g0YPQvNC+0LvRh9Cw0L3QuNGOIiwwfSwNCnsxMjgs
NzJ9LA0KezB9LDAsDQp7MCwwfSwNCnswLDB9LA0KezAsMH0sDQp7MCwwfSwNCnsw
LDB9LA0KezAsMH0sMCwyLDE2LDAsMCwxLDAsDQp7MTYsMSwNCnsxLDEsDQp7IiMi
LCLQkNCbIDI1MDcyLzAxLTE0INCa0JfQnSJ9DQp9LDB9LDEsMCwxLDAsDQp7MTYs
MCwNCnsxLDEsDQp7IiMiLCLQkNCbIDI2NjA5LzAxLTE0INCj0JvQnSJ9DQp9LDB9
LDIsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDI1NTA1LzAyLTE0
INCS0KDQliJ9DQp9LDB9LDMsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQ
kNCbIDI0MTQ0LzA0LTE0INCa0JfQnSJ9DQp9LDB9LDQsMCwxLDAsDQp7MTYsMCwN
CnsxLDEsDQp7IiMiLCLQkNCbIDI2MTA3LzAyLTE0INCf0J3QlyJ9DQp9LDB9LDUs
MCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDI0Njg1LzAyLTE0INCV
0JrQkSJ9DQp9LDB9LDYsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCb
IDMwOTU5LzAxLTE0INCd0JHQpyJ9DQp9LDB9LDcsMCwxLDAsDQp7MTYsMCwNCnsx
LDEsDQp7IiMiLCLQkNCbIDc0Mjc4LzAxLTE2INCh0KDQoiJ9DQp9LDB9LDgsMCwx
LDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDkyNTAwLzAxLTE3INCh0JzQ
oCJ9DQp9LDB9LDksMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDk4
NzA4LzAxLTE3INCi0K7QnCJ9DQp9LDB9LDEwLDAsMSwwLA0KezE2LDAsDQp7MSwx
LA0KeyIjIiwi0JDQmyAxMTExNjgvMDEtMTgg0J7QoNCRIn0NCn0sMH0sMTEsMCwx
LDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDIxNzAvMTQtMTkg0JrQoNCh
In0NCn0sMH0sMTIsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDEw
MzgxOC8wMi0xOCJ9DQp9LDB9LDEzLDAsMSwwLA0KezE2LDAsDQp7MSwxLA0KeyIj
Iiwi0JDQmyAxMDM4MTgvMDMtMTgifQ0KfSwwfSwxNCwwLDEsMCwNCnsxNiwwLA0K
ezEsMSwNCnsiIyIsItCQ0JsgOTM5NDMvMDItMTgg0KLQm9CiIn0NCn0sMH0sMTUs
MCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDY2OTg4LzAyLTE2INCR
0JPQlCJ9DQp9LDB9LA0KezEsMCwwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAw
MDAwMDAwMDAsMSwwLDJ9LDE2LDAsMCwwLDAsMCwwLDAsMCwNCnswfSwNCnswfSwN
CnswfSwNCnswfSwiIiwNCnsNCnswLDYsNiwNCnsiTiIsMTAwMH0sNywNCnsiTiIs
MTAwMH0sOCwNCnsiTiIsMTAwMH0sOSwNCnsiTiIsMTAwMH0sMTAsDQp7Ik4iLDEw
MDB9LDExLA0KeyJOIiwxMDAwfQ0KfQ0KfSwNCnswLC0xLC0xLC0xLC0xLDAwMDAw
MDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMH0sMCwwLDAsMCwwLDAsMCwx
LDAsMSwyLA0KezIxNzYsMjAxLDJ9LA0KezEyOCwyMTd9LDAsMCwwLDAsMywNCnsz
LDMsDQp7LTF9DQp9LA0KezMsMywNCnstM30NCn0sDQp7MywzLA0Key03fQ0KfSww
LDAsMCwiIiwwLA0KezMsMCwwLDEwMCwxLDEsMCwxLDEsMCwwLDAsMCwwLDAsMCww
LDAsMCwwLDAsIiIsMCwwLDAsMCwwLDAsMH0sDQp7MH0sMCwwLDAsMSwwLDB9DQp9
DQp9DQp9DQp9DQp9DQp9DQp9}
},0},
{2,2,6,
{"S","день последней оплаты просрочки по всем договорам"},
{"S","ВЫБРАТЬ
	хлПриложениеКДоговоруЛизинга.ДоговорЛизинга КАК ДоговорЛизинга,
	хлПриложениеКДоговоруЛизинга.ДоговорЛизинга.ДоговорКонтрагента КАК ДоговорКонтрагента,
	хлПриложениеКДоговоруЛизинга.Номер КАК НомерПриложения
ПОМЕСТИТЬ ВтВсеДоговоры
ИЗ
	Документ.хлПриложениеКДоговоруЛизинга КАК хлПриложениеКДоговоруЛизинга
ГДЕ
	хлПриложениеКДоговоруЛизинга.хлпДоговорКонтрагента.хлНомерДоговора ПОДОБНО ""АЛ %""
	И НЕ хлПриложениеКДоговоруЛизинга.ПометкаУдаления
	И НЕ хлПриложениеКДоговоруЛизинга.хлпДоговорКонтрагента.ПометкаУдаления
	И НЕ хлПриложениеКДоговоруЛизинга.ДоговорЛизинга.ДоговорКонтрагента.Код ЕСТЬ NULL
//	И хлПриложениеКДоговоруЛизинга.ДоговорЛизинга.ДоговорКонтрагента = &ДоговорЛизинга
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПроизводственныеКалендариСтранМира.Дата КАК Дата,
	ВЫБОР
		КОГДА ПроизводственныеКалендариСтранМира.ВидДня = ЗНАЧЕНИЕ(Перечисление.ВидыДнейПроизводственногоКалендаря.Рабочий)
			ТОГДА ИСТИНА
		КОГДА ПроизводственныеКалендариСтранМира.ВидДня = ЗНАЧЕНИЕ(Перечисление.ВидыДнейПроизводственногоКалендаря.Предпраздничный)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоРабочийДень
ПОМЕСТИТЬ КалендарьПолный
ИЗ
	РегистрСведений.хлПроизводственныеКалендариСтранМира КАК ПроизводственныеКалендариСтранМира
ГДЕ
	ПроизводственныеКалендариСтранМира.Страна = &Страна
	И ПроизводственныеКалендариСтранМира.Дата <= &КонецПериода

ИНДЕКСИРОВАТЬ ПО
	Дата
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	КалендарьПолный.Дата КАК Дата
ПОМЕСТИТЬ КалендарьРабочиеДни
ИЗ
	КалендарьПолный КАК КалендарьПолный
ГДЕ
	КалендарьПолный.ЭтоРабочийДень

ИНДЕКСИРОВАТЬ ПО
	Дата
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	КалендарьПолный.Дата КАК Дата,
	МИНИМУМ(ЕСТЬNULL(КалендарьРабочиеДни.Дата, КалендарьПолный.Дата)) КАК ПервыйРабочийДень
ПОМЕСТИТЬ ПроизводственныйКалендарь
ИЗ
	КалендарьПолный КАК КалендарьПолный
		ЛЕВОЕ СОЕДИНЕНИЕ КалендарьРабочиеДни КАК КалендарьРабочиеДни
		ПО (ВЫБОР
				КОГДА КалендарьПолный.ЭтоРабочийДень
					ТОГДА ЛОЖЬ
				ИНАЧЕ КалендарьПолный.Дата <= КалендарьРабочиеДни.Дата
			КОНЕЦ)

СГРУППИРОВАТЬ ПО
	КалендарьПолный.Дата

ИНДЕКСИРОВАТЬ ПО
	Дата
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга.Владелец КАК Контрагент,
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга КАК ДоговорЛизинга,
	МИНИМУМ(ВЫБОР
			КОГДА ПредметыЛизингаВЛизингеОбороты.КоличествоПриход > 0
				ТОГДА ПредметыЛизингаВЛизингеОбороты.Период
		КОНЕЦ) КАК ДатаПередачи
ПОМЕСТИТЬ ТаблицаПередач
ИЗ
	РегистрНакопления.хлПредметыЛизингаВЛизинге.Обороты(
			&НачалоВеденияУчета,
			&КонецПериода,
			День,
			ДоговорЛизинга В
				(ВЫБРАТЬ
					ВтВсеДоговоры.ДоговорКонтрагента
				ИЗ
					ВтВсеДоговоры)) КАК ПредметыЛизингаВЛизингеОбороты

СГРУППИРОВАТЬ ПО
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга,
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга.Владелец

ИНДЕКСИРОВАТЬ ПО
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ КАК ЭтоФакт,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга.Владелец КАК Контрагент,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга КАК ДоговорЛизинга,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Приложение КАК Приложение,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Статья КАК СтатьяГрафика,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Валюта КАК Валюта,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Дата КАК ПлановаяДатаОплаты,
	ЕСТЬNULL(ТаблицаПередач.ДатаПередачи, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаПередачи,
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
		ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
	КОНЕЦ КАК ДатаОплаты,
	СУММА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Сумма) КАК Сумма,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	МАКСИМУМ(ВЫБОР
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
					И (хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика
						ИЛИ хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Регистратор = ТаблицаАктуальныхУтверждений.Регистратор)
				ТОГДА ИСТИНА
			ИНАЧЕ ЛОЖЬ
		КОНЕЦ) КАК ЭтоПлатежПоТекущемуГрафику
ПОМЕСТИТЬ ВзаиморасчетыВесьПериод
ИЗ
	ВтВсеДоговоры КАК ВтВсеДоговоры
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику КАК хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику
			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.хлДанныеУтвержденийГрафиков.СрезПоследних(
					&КонецПериода,
					ВидГрафика = ЗНАЧЕНИЕ(Справочник.хлВидыГрафиков.ГрафикПлатежейПоДоговоруЛизинга)
						И Договор В
							(ВЫБРАТЬ
								ВтВсеДоговоры.ДоговорКонтрагента
							ИЗ
								ВтВсеДоговоры)) КАК ТаблицаАктуальныхУтверждений
			ПО хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга = ТаблицаАктуальныхУтверждений.Договор
				И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Приложение = ТаблицаАктуальныхУтверждений.Приложение
				И (хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход))
			ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаПередач КАК ТаблицаПередач
			ПО хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга = ТаблицаПередач.ДоговорЛизинга
		ПО ВтВсеДоговоры.ДоговорКонтрагента = хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга
ГДЕ
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Активность
	И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период <= &КонецПериода
	И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Дата <= &ДатаСреза
	И ВЫБОР
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
					И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
				ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
			ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
		КОНЕЦ <= &КонецПериода
	И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Статья = &Статья
	И ВЫБОР
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
				ТОГДА ДАТАВРЕМЯ(1, 1, 1)
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
				ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
			ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
		КОНЕЦ <= &ДатаСреза

СГРУППИРОВАТЬ ПО
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Валюта,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга.Владелец,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Статья,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Приложение,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Дата,
	ЕСТЬNULL(ТаблицаПередач.ДатаПередачи, ДАТАВРЕМЯ(1, 1, 1)),
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
		ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
	КОНЕЦ

ИМЕЮЩИЕ
	СУММА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Сумма) <> 0

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика,
	ДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение КАК Приложение,
	ВзаиморасчетыВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ВзаиморасчетыВесьПериод.Валюта КАК Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.Сумма КАК Сумма,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ВзаиморасчетыВесьПериод.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику
ПОМЕСТИТЬ ТаблицаНачисленийВесьПериод
ИЗ
	ВзаиморасчетыВесьПериод КАК ВзаиморасчетыВесьПериод
ГДЕ
	ВзаиморасчетыВесьПериод.ЭтоФакт = ЛОЖЬ

ИНДЕКСИРОВАТЬ ПО
	ВзаиморасчетыВесьПериод.ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение,
	ВзаиморасчетыВесьПериод.СтатьяГрафика,
	ВзаиморасчетыВесьПериод.Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение КАК Приложение,
	ВзаиморасчетыВесьПериод.Валюта КАК Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.ДатаПередачи КАК ДатаПередачи,
	ВзаиморасчетыВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ВзаиморасчетыВесьПериод.ДатаОплаты КАК ДатаОплаты,
	ВзаиморасчетыВесьПериод.Сумма КАК СуммаОплаты,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика
ПОМЕСТИТЬ ТаблицаОплатВесьПериод
ИЗ
	ВзаиморасчетыВесьПериод КАК ВзаиморасчетыВесьПериод
ГДЕ
	ВзаиморасчетыВесьПериод.ЭтоФакт = ИСТИНА

ИНДЕКСИРОВАТЬ ПО
	ВзаиморасчетыВесьПериод.ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение,
	ВзаиморасчетыВесьПериод.СтатьяГрафика,
	ВзаиморасчетыВесьПериод.Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика,
	ВзаиморасчетыВесьПериод.ДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаОплатВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение КАК Приложение,
	ТаблицаОплатВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаОплатВесьПериод.Валюта КАК Валюта,
	ТаблицаОплатВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаОплатВесьПериод.ДатаПередачи КАК ДатаПередачи,
	ТаблицаОплатВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	МАКСИМУМ(ВЫБОР
			КОГДА ТаблицаОплатВесьПериодДляОстатков.ДатаОплаты >= ТаблицаОплатВесьПериод.ДатаОплаты
				ТОГДА ТаблицаОплатВесьПериод.ПлановаяДатаОплаты
			ИНАЧЕ ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.ДатаОплаты, ТаблицаОплатВесьПериод.ПлановаяДатаОплаты)
		КОНЕЦ) КАК НачалоИнтервалаРасчета,
	ТаблицаОплатВесьПериод.ДатаОплаты КАК ДатаОплаты,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.ЭтоФакт, ЛОЖЬ) = ЛОЖЬ
				ТОГДА 1
			ИНАЧЕ -1
		КОНЕЦ * ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.Сумма, 0)) + ТаблицаОплатВесьПериод.СуммаОплаты КАК СуммаНачальныйОстаток,
	ТаблицаОплатВесьПериод.СуммаОплаты КАК СуммаОплаты,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.ЭтоФакт, ЛОЖЬ) = ЛОЖЬ
				ТОГДА 1
			ИНАЧЕ -1
		КОНЕЦ * ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.Сумма, 0)) КАК СуммаКонечныйОстаток
ПОМЕСТИТЬ ТаблицаОплатСОстаткамиВесьПериод
ИЗ
	ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ ВзаиморасчетыВесьПериод КАК ТаблицаОплатВесьПериодДляОстатков
		ПО ТаблицаОплатВесьПериод.ДоговорЛизинга = ТаблицаОплатВесьПериодДляОстатков.ДоговорЛизинга
			И ТаблицаОплатВесьПериод.Приложение = ТаблицаОплатВесьПериодДляОстатков.Приложение
			И ТаблицаОплатВесьПериод.СтатьяГрафика = ТаблицаОплатВесьПериодДляОстатков.СтатьяГрафика
			И ТаблицаОплатВесьПериод.Валюта = ТаблицаОплатВесьПериодДляОстатков.Валюта
			И ТаблицаОплатВесьПериод.ПлановаяДатаОплаты = ТаблицаОплатВесьПериодДляОстатков.ПлановаяДатаОплаты
			И ТаблицаОплатВесьПериод.НачислениеВнеГрафика = ТаблицаОплатВесьПериодДляОстатков.НачислениеВнеГрафика
			И ТаблицаОплатВесьПериод.ДатаОплаты >= ТаблицаОплатВесьПериодДляОстатков.ДатаОплаты

СГРУППИРОВАТЬ ПО
	ТаблицаОплатВесьПериод.Валюта,
	ТаблицаОплатВесьПериод.СтатьяГрафика,
	ТаблицаОплатВесьПериод.ПлановаяДатаОплаты,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.СуммаОплаты,
	ТаблицаОплатВесьПериод.ДатаОплаты,
	ТаблицаОплатВесьПериод.ДатаПередачи,
	ТаблицаОплатВесьПериод.НачислениеВнеГрафика

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика,
	ДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыВесьПериодОстатки.ДоговорЛизинга КАК ДоговорЛизинга,
	ВзаиморасчетыВесьПериодОстатки.Приложение КАК Приложение,
	ВзаиморасчетыВесьПериодОстатки.СтатьяГрафика КАК СтатьяГрафика,
	ВзаиморасчетыВесьПериодОстатки.Валюта КАК Валюта,
	ВзаиморасчетыВесьПериодОстатки.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериодОстатки.ДатаПередачи КАК ДатаПередачи,
	ВзаиморасчетыВесьПериодОстатки.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) КАК СуммаОстаток,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) КАК СуммаОстаток1,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) КАК СуммаОстаток2
ПОМЕСТИТЬ ТаблицаОстатков
ИЗ
	ВзаиморасчетыВесьПериод КАК ВзаиморасчетыВесьПериодОстатки

СГРУППИРОВАТЬ ПО
	ВзаиморасчетыВесьПериодОстатки.ДоговорЛизинга,
	ВзаиморасчетыВесьПериодОстатки.Приложение,
	ВзаиморасчетыВесьПериодОстатки.СтатьяГрафика,
	ВзаиморасчетыВесьПериодОстатки.Валюта,
	ВзаиморасчетыВесьПериодОстатки.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериодОстатки.ДатаПередачи,
	ВзаиморасчетыВесьПериодОстатки.НачислениеВнеГрафика

ИМЕЮЩИЕ
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) <> 0

ИНДЕКСИРОВАТЬ ПО
	ВзаиморасчетыВесьПериодОстатки.ДоговорЛизинга,
	ВзаиморасчетыВесьПериодОстатки.Приложение,
	ВзаиморасчетыВесьПериодОстатки.СтатьяГрафика,
	ВзаиморасчетыВесьПериодОстатки.Валюта,
	ВзаиморасчетыВесьПериодОстатки.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериодОстатки.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ ПЕРВЫЕ 1
	НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья КАК СтатьяКомпенсация
ПОМЕСТИТЬ врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях
ИЗ
	Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ИсключаемыеСтатьи КАК НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи
ГДЕ
	ВЫБОР
			КОГДА &НаборСтатейИсключаемыхИзБазыРасчетаПени = ЗНАЧЕНИЕ(Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ПустаяСсылка)
				ТОГДА ИСТИНА
			ИНАЧЕ НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Ссылка = &НаборСтатейИсключаемыхИзБазыРасчетаПени
		КОНЕЦ
	И НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья = &СтатьяКомпенсацияСтрахования
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаОплатВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение КАК Приложение,
	ТаблицаОплатВесьПериод.Валюта КАК Валюта,
	СУММА(ТаблицаОплатВесьПериод.СуммаОплаты) КАК СуммаОплаты,
	1 КАК РазделительСтатейПоОплатеПеней
ПОМЕСТИТЬ ТаблицаОплатПенейВесьПериод
ИЗ
	ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.хлНазначенияОбъектов КАК НазначенияОбъектов
		ПО ТаблицаОплатВесьПериод.СтатьяГрафика = НазначенияОбъектов.Объект
			И (НазначенияОбъектов.Назначение = &НазначениеПени)
ГДЕ
	НазначенияОбъектов.Назначение = &НазначениеПени

СГРУППИРОВАТЬ ПО
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.Валюта

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.Валюта,
	СУММА(ТаблицаОплатВесьПериод.СуммаОплаты),
	2
ИЗ
	ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях КАК врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях
		ПО (ИСТИНА)
ГДЕ
	ТаблицаОплатВесьПериод.СтатьяГрафика = &ШтрафыЗаСтрахование
	И врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях.СтатьяКомпенсация ЕСТЬ NULL

СГРУППИРОВАТЬ ПО
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.Валюта
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение КАК Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта КАК Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.Сумма КАК Сумма,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику,
	СУММА(ТаблицаОплатВесьПериод.СуммаОплаты) КАК СуммаОплаты,
	МАКСИМУМ(ТаблицаОплатВесьПериод.ДатаОплаты) КАК ДатаОплаты,
	ВЫБОР
		КОГДА МАКСИМУМ(ТаблицаОплатВесьПериод.ДатаОплаты) ЕСТЬ NULL
				ИЛИ ТаблицаНачисленийВесьПериод.Сумма - ЕСТЬNULL(СУММА(ТаблицаОплатВесьПериод.СуммаОплаты), 0) > 0
				ИЛИ РАЗНОСТЬДАТ(ПроизводственныйКалендарь.ПервыйРабочийДень, МАКСИМУМ(ТаблицаОплатВесьПериод.ДатаОплаты), ДЕНЬ) > 0
			ТОГДА 1
		ИНАЧЕ 0
	КОНЕЦ КАК ПросроченныйПлатеж
ПОМЕСТИТЬ ТаблицаВзаиморасчетовВесьПериод
ИЗ
	ТаблицаНачисленийВесьПериод КАК ТаблицаНачисленийВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ПО ТаблицаНачисленийВесьПериод.ДоговорЛизинга = ТаблицаОплатВесьПериод.ДоговорЛизинга
			И ТаблицаНачисленийВесьПериод.Приложение = ТаблицаОплатВесьПериод.Приложение
			И ТаблицаНачисленийВесьПериод.СтатьяГрафика = ТаблицаОплатВесьПериод.СтатьяГрафика
			И ТаблицаНачисленийВесьПериод.Валюта = ТаблицаОплатВесьПериод.Валюта
			И ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты = ТаблицаОплатВесьПериод.ПлановаяДатаОплаты
			И ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика = ТаблицаОплатВесьПериод.НачислениеВнеГрафика
		ЛЕВОЕ СОЕДИНЕНИЕ ПроизводственныйКалендарь КАК ПроизводственныйКалендарь
		ПО ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты = ПроизводственныйКалендарь.Дата

СГРУППИРОВАТЬ ПО
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.Сумма,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику,
	ПроизводственныйКалендарь.ПервыйРабочийДень

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение КАК Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта КАК Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.Сумма КАК Сумма,
	КОЛИЧЕСТВО(ТаблицаНачисленийВесьПериодДляНомераПлатежа.ПлановаяДатаОплаты) КАК НомерПлатежа,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику
ПОМЕСТИТЬ ТаблицаНачислений
ИЗ
	ТаблицаНачисленийВесьПериод КАК ТаблицаНачисленийВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаНачисленийВесьПериод КАК ТаблицаНачисленийВесьПериодДляНомераПлатежа
		ПО ТаблицаНачисленийВесьПериод.ДоговорЛизинга = ТаблицаНачисленийВесьПериодДляНомераПлатежа.ДоговорЛизинга
			И ТаблицаНачисленийВесьПериод.Приложение = ТаблицаНачисленийВесьПериодДляНомераПлатежа.Приложение
			И ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты >= ТаблицаНачисленийВесьПериодДляНомераПлатежа.ПлановаяДатаОплаты
			И ТаблицаНачисленийВесьПериод.СтатьяГрафика = ТаблицаНачисленийВесьПериодДляНомераПлатежа.СтатьяГрафика
			И ТаблицаНачисленийВесьПериод.Валюта = ТаблицаНачисленийВесьПериодДляНомераПлатежа.Валюта
			И (НЕ ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика
				ИЛИ ТаблицаНачисленийВесьПериод.СтатьяГрафика = &СтатьяЛП)

СГРУППИРОВАТЬ ПО
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.Сумма,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОплатыИОстатки.ДоговорЛизинга КАК ДоговорЛизинга,
	ОплатыИОстатки.Приложение КАК Приложение,
	ОплатыИОстатки.СтатьяГрафика КАК СтатьяГрафика,
	ОплатыИОстатки.Валюта КАК Валюта,
	ОплатыИОстатки.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ОплатыИОстатки.ДатаПередачи КАК ДатаПередачи,
	ОплатыИОстатки.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ОплатыИОстатки.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	КОНЕЦПЕРИОДА(ОплатыИОстатки.КонецИнтервалаРасчета, ДЕНЬ) КАК КонецИнтервалаРасчета,
	ЕСТЬNULL(ОплатыИОстатки.ДатаОплаты, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаОплаты,
	ОплатыИОстатки.БазаРасчетаПеней КАК БазаРасчетаПеней,
	ОплатыИОстатки.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
	ОплатыИОстатки.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток,
	ОплатыИОстатки.СуммаОплаты КАК СуммаОплаты
ПОМЕСТИТЬ ТаблицаДляРасчетаПеней
ИЗ
	(ВЫБРАТЬ
		Оплаты.ДоговорЛизинга КАК ДоговорЛизинга,
		Оплаты.Приложение КАК Приложение,
		Оплаты.СтатьяГрафика КАК СтатьяГрафика,
		Оплаты.Валюта КАК Валюта,
		Оплаты.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
		Оплаты.ДатаПередачи КАК ДатаПередачи,
		Оплаты.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
		Оплаты.ДатаОплаты КАК КонецИнтервалаРасчета,
		Оплаты.ДатаОплаты КАК ДатаОплаты,
		Оплаты.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
		Оплаты.СуммаНачальныйОстаток КАК БазаРасчетаПеней,
		Оплаты.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
		Оплаты.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток,
		Оплаты.СуммаОплаты КАК СуммаОплаты
	ИЗ
		ТаблицаОплатСОстаткамиВесьПериод КАК Оплаты
	ГДЕ
		Оплаты.ДатаОплаты <= &КонецПериода
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		Остатки.ДоговорЛизинга,
		Остатки.Приложение,
		Остатки.СтатьяГрафика,
		Остатки.Валюта,
		Остатки.ПлановаяДатаОплаты,
		Остатки.ДатаПередачи,
		ЕСТЬNULL(МАКСИМУМ(Оплаты.ДатаОплаты), Остатки.ПлановаяДатаОплаты),
		&КонецПериода,
		NULL,
		Остатки.НачислениеВнеГрафика,
		Остатки.СуммаОстаток,
		Остатки.СуммаОстаток1,
		Остатки.СуммаОстаток2,
		0
	ИЗ
		ТаблицаОстатков КАК Остатки
			ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОплатВесьПериод КАК Оплаты
			ПО (Оплаты.ДоговорЛизинга = Остатки.ДоговорЛизинга)
				И (Оплаты.Приложение = Остатки.Приложение)
				И (Оплаты.СтатьяГрафика = Остатки.СтатьяГрафика)
				И (Оплаты.Валюта = Остатки.Валюта)
				И (Оплаты.ПлановаяДатаОплаты = Остатки.ПлановаяДатаОплаты)
				И (Оплаты.НачислениеВнеГрафика = Остатки.НачислениеВнеГрафика)
				И (Оплаты.ДатаОплаты <= &КонецПериода)
	ГДЕ
		Остатки.СуммаОстаток > 0
	
	СГРУППИРОВАТЬ ПО
		Остатки.ДоговорЛизинга,
		Остатки.Приложение,
		Остатки.СтатьяГрафика,
		Остатки.Валюта,
		Остатки.ПлановаяДатаОплаты,
		Остатки.ДатаПередачи,
		Остатки.НачислениеВнеГрафика,
		Остатки.СуммаОстаток,
		Остатки.СуммаОстаток1,
		Остатки.СуммаОстаток2) КАК ОплатыИОстатки

СГРУППИРОВАТЬ ПО
	ОплатыИОстатки.Приложение,
	ОплатыИОстатки.Валюта,
	ОплатыИОстатки.ПлановаяДатаОплаты,
	ОплатыИОстатки.ДатаПередачи,
	ОплатыИОстатки.НачалоИнтервалаРасчета,
	ОплатыИОстатки.НачислениеВнеГрафика,
	ОплатыИОстатки.ДоговорЛизинга,
	ОплатыИОстатки.СтатьяГрафика,
	ОплатыИОстатки.КонецИнтервалаРасчета,
	ОплатыИОстатки.ДатаОплаты,
	ОплатыИОстатки.СуммаНачальныйОстаток,
	ОплатыИОстатки.СуммаКонечныйОстаток,
	ОплатыИОстатки.СуммаОплаты,
	ОплатыИОстатки.БазаРасчетаПеней

ИНДЕКСИРОВАТЬ ПО
	ОплатыИОстатки.ДоговорЛизинга,
	ОплатыИОстатки.Приложение,
	ОплатыИОстатки.СтатьяГрафика,
	ОплатыИОстатки.Валюта,
	ОплатыИОстатки.ПлановаяДатаОплаты,
	ОплатыИОстатки.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПараметрыНачисленияПениПоДоговорамЛизинга.Период КАК Период,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ДоговорКонтрагента КАК ДоговорКонтрагента,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ПараметрыНачисленияПениПоДоговорамЛизинга.НаборИсключаемыхСтатей КАК НаборИсключаемыхСтатей,
	ПараметрыНачисленияПениПоДоговорамЛизинга.СтавкаПени КАК СтавкаПени,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ЛьготныйПериод КАК ЛьготныйПериод
ПОМЕСТИТЬ ПараметрыНачисленияПени
ИЗ
	РегистрСведений.хлПараметрыНачисленияПениПоДоговорамЛизинга КАК ПараметрыНачисленияПениПоДоговорамЛизинга
ГДЕ
	ПараметрыНачисленияПениПоДоговорамЛизинга.ДоговорКонтрагента В
			(ВЫБРАТЬ
				ВтВсеДоговоры.ДоговорКонтрагента
			ИЗ
				ВтВсеДоговоры)

ИНДЕКСИРОВАТЬ ПО
	ПараметрыНачисленияПениПоДоговорамЛизинга.Период,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ДоговорКонтрагента,
	НаборИсключаемыхСтатей,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ПлановаяДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	ПараметрыНачисленияПени.ДоговорКонтрагента КАК ДоговорКонтрагента,
	ПараметрыНачисленияПени.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты
ПОМЕСТИТЬ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
ИЗ
	ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
ГДЕ
	ПараметрыНачисленияПени.ПлановаяДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)

ИНДЕКСИРОВАТЬ ПО
	ПараметрыНачисленияПени.ПлановаяДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета КАК ДатаПараметров,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение КАК Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта КАК Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика
ПОМЕСТИТЬ ДатыПараметровНачисленияПени
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
ГДЕ
	ТаблицаДляРасчетаПеней.ДатаПередачи <> ДАТАВРЕМЯ(1, 1, 1)
	И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты >= ТаблицаДляРасчетаПеней.ДатаПередачи

ОБЪЕДИНИТЬ

ВЫБРАТЬ
	НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ),
	ТаблицаДляРасчетаПеней.ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
ГДЕ
	ТаблицаДляРасчетаПеней.ДатаПередачи <> ДАТАВРЕМЯ(1, 1, 1)
	И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты >= ТаблицаДляРасчетаПеней.ДатаПередачи

ОБЪЕДИНИТЬ

ВЫБРАТЬ
	ПараметрыНачисленияПени.Период,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты КАК ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
		ПО ТаблицаДляРасчетаПеней.ДоговорЛизинга = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ДоговорКонтрагента
			И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
		ПО (ПараметрыНачисленияПени.Период <= ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			И (ПараметрыНачисленияПени.Период >= ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета)
			И (ПараметрыНачисленияПени.ДоговорКонтрагента = ТаблицаДляРасчетаПеней.ДоговорЛизинга)
			И (ВЫБОР
				КОГДА ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты ЕСТЬ NULL
					ТОГДА ПараметрыНачисленияПени.ПлановаяДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ПараметрыНачисленияПени.ПлановаяДатаОплаты = ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты
			КОНЕЦ)
			И (ТаблицаДляРасчетаПеней.ДатаПередачи <> ДАТАВРЕМЯ(1, 1, 1))
			И (ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты >= ТаблицаДляРасчетаПеней.ДатаПередачи)

ИНДЕКСИРОВАТЬ ПО
	ДатаПараметров,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение КАК Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта КАК Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ДатыПараметровНачисленияПени.ДатаПараметров КАК ДатаПараметров
ПОМЕСТИТЬ ИнтервалыРасчетаПенейСДатамиИзмененияПараметровНачисленияПени
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДатыПараметровНачисленияПени КАК ДатыПараметровНачисленияПени
		ПО (ВЫБОР
				КОГДА ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета > ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета
					ТОГДА ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета = ДатыПараметровНачисленияПени.ДатаПараметров
				ИНАЧЕ ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета <= ДатыПараметровНачисленияПени.ДатаПараметров
						И ДатыПараметровНачисленияПени.ДатаПараметров <= ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета
			КОНЕЦ)
			И ТаблицаДляРасчетаПеней.ДоговорЛизинга = ДатыПараметровНачисленияПени.ДоговорЛизинга
			И ТаблицаДляРасчетаПеней.Приложение = ДатыПараметровНачисленияПени.Приложение
			И ТаблицаДляРасчетаПеней.СтатьяГрафика = ДатыПараметровНачисленияПени.СтатьяГрафика
			И ТаблицаДляРасчетаПеней.Валюта = ДатыПараметровНачисленияПени.Валюта
			И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты = ДатыПараметровНачисленияПени.ПлановаяДатаОплаты
			И ТаблицаДляРасчетаПеней.НачислениеВнеГрафика = ДатыПараметровНачисленияПени.НачислениеВнеГрафика

ИНДЕКСИРОВАТЬ ПО
	НачалоИнтервалаРасчета,
	КонецИнтервалаРасчета,
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика,
	ДатаПараметров
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Приложение КАК Приложение,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Валюта КАК Валюта,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров КАК НачалоИнтервалаПараметров,
	МИНИМУМ(ВЫБОР
			КОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета <= КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров, ДЕНЬ)
				ТОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета
			ИНАЧЕ КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров, ДЕНЬ)
		КОНЕЦ) КАК КонецИнтервалаПараметров
ПОМЕСТИТЬ ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПени
ИЗ
	ИнтервалыРасчетаПенейСДатамиИзмененияПараметровНачисленияПени КАК ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ИнтервалыРасчетаПенейСДатамиИзмененияПараметровНачисленияПени КАК ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1
		ПО ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.НачалоИнтервалаРасчета
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.КонецИнтервалаРасчета
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДоговорЛизинга = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДоговорЛизинга
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Приложение = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.Приложение
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.СтатьяГрафика = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.СтатьяГрафика
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Валюта = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.Валюта
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ПлановаяДатаОплаты
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачислениеВнеГрафика = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.НачислениеВнеГрафика
			И (ВЫБОР
				КОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета >= НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета, ДЕНЬ)
					ТОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров
				ИНАЧЕ ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров < ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров
			КОНЕЦ)
ГДЕ
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты <= ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров

СГРУППИРОВАТЬ ПО
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДоговорЛизинга,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Приложение,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.СтатьяГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Валюта,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров

ИНДЕКСИРОВАТЬ ПО
	НачалоИнтервалаРасчета,
	ДоговорЛизинга
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Приложение КАК Приложение,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Валюта КАК Валюта,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаПараметров КАК НачалоИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаПараметров КАК КонецИнтервалаПараметров,
	МАКСИМУМ(ПараметрыНачисленияПени.Период) КАК ПериодПараметров
ПОМЕСТИТЬ ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПениСДатамиПараметров
ИЗ
	ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПени КАК ТаблицаДляРасчетаПенейПоИнтерваламПараметров
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты КАК ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ДоговорКонтрагента
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаПараметров >= ПараметрыНачисленияПени.Период
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга = ПараметрыНачисленияПени.ДоговорКонтрагента
			И (ВЫБОР
				КОГДА ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты ЕСТЬ NULL
					ТОГДА ПараметрыНачисленияПени.ПлановаяДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПени.ПлановаяДатаОплаты
			КОНЕЦ)

СГРУППИРОВАТЬ ПО
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Приложение,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.СтатьяГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Валюта,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаПараметров

ИНДЕКСИРОВАТЬ ПО
	ПериодПараметров,
	ДоговорЛизинга,
	СтатьяГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.Приложение КАК Приложение,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.Валюта КАК Валюта,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.НачалоИнтервалаПараметров КАК НачалоИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.КонецИнтервалаПараметров КАК КонецИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПериодПараметров КАК ПериодПараметров,
	ЕСТЬNULL(ПараметрыНачисленияПени.СтавкаПени, 0) КАК СтавкаПени,
	ЕСТЬNULL(ПараметрыНачисленияПени.ЛьготныйПериод, 0) КАК ЛьготныйПериод
ПОМЕСТИТЬ ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени
ИЗ
	ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПениСДатамиПараметров КАК ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты КАК ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ДоговорЛизинга = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ДоговорКонтрагента
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПериодПараметров = ПараметрыНачисленияПени.Период
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ДоговорЛизинга = ПараметрыНачисленияПени.ДоговорКонтрагента
			И (ВЫБОР
				КОГДА ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты ЕСТЬ NULL
					ТОГДА ПараметрыНачисленияПени.ПлановаяДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПени.ПлановаяДатаОплаты
			КОНЕЦ)
		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ИсключаемыеСтатьи КАК НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи
		ПО (ВЫБОР
				КОГДА &НаборСтатейИсключаемыхИзБазыРасчетаПени = ЗНАЧЕНИЕ(Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ПустаяСсылка)
					ТОГДА ПараметрыНачисленияПени.НаборИсключаемыхСтатей = НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Ссылка
				ИНАЧЕ НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Ссылка = &НаборСтатейИсключаемыхИзБазыРасчетаПени
			КОНЕЦ)
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.СтатьяГрафика = НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья
ГДЕ
	НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья ЕСТЬ NULL

ИНДЕКСИРОВАТЬ ПО
	НачалоИнтервалаРасчета,
	КонецИнтервалаРасчета,
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение КАК Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта КАК Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.НачалоИнтервалаПараметров, ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета) КАК НачалоИнтервалаРасчета,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета) КАК КонецИнтервалаРасчета,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ТаблицаДляРасчетаПеней.ДатаОплаты
		ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1)
	КОНЕЦ КАК ДатаОплаты,
	ТаблицаДляРасчетаПеней.БазаРасчетаПеней КАК БазаРасчетаПеней,
	ТаблицаДляРасчетаПеней.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ТаблицаДляРасчетаПеней.СуммаКонечныйОстаток
		ИНАЧЕ ТаблицаДляРасчетаПеней.СуммаНачальныйОстаток
	КОНЕЦ КАК СуммаКонечныйОстаток,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ТаблицаДляРасчетаПеней.СуммаОплаты
		ИНАЧЕ 0
	КОНЕЦ КАК СуммаОплаты,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.СтавкаПени, 0) КАК СтавкаПени,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.ЛьготныйПериод, 0) КАК ЛьготныйПериод,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		ИНАЧЕ ВЫБОР
				КОГДА ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета) = &КонецПериода
					ТОГДА ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			КОНЕЦ
	КОНЕЦ КАК ДатаИзмененияПараметров
ПОМЕСТИТЬ ТаблицаДляРасчетаПенейСПараметрамиНачисленияПени
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
		ЛЕВОЕ СОЕДИНЕНИЕ ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени КАК ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени
		ПО ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.НачалоИнтервалаРасчета
			И ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаРасчета
			И ТаблицаДляРасчетаПеней.ДоговорЛизинга = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.ДоговорЛизинга
			И ТаблицаДляРасчетаПеней.Приложение = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.Приложение
			И ТаблицаДляРасчетаПеней.СтатьяГрафика = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.СтатьяГрафика
			И ТаблицаДляРасчетаПеней.Валюта = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.Валюта
			И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.ПлановаяДатаОплаты
			И ТаблицаДляРасчетаПеней.НачислениеВнеГрафика = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.НачислениеВнеГрафика

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика,
	НачалоИнтервалаРасчета
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ЕСТЬNULL(ТаблицаВзаиморасчетов.ДоговорЛизинга, ТаблицаДляРасчетаПеней.ДоговорЛизинга) КАК ДоговорЛизинга,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.Приложение, ТаблицаДляРасчетаПеней.Приложение) КАК Приложение,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.СтатьяГрафика, ТаблицаДляРасчетаПеней.СтатьяГрафика) КАК СтатьяГрафика,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.Валюта, ТаблицаДляРасчетаПеней.Валюта) КАК Валюта,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.ПлановаяДатаОплаты, ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты) КАК ПлановаяДатаОплаты,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.НачислениеВнеГрафика, ТаблицаДляРасчетаПеней.НачислениеВнеГрафика) КАК НачислениеВнеГрафика,
	ЕСТЬNULL(ТаблицаДляРасчетаПеней.СуммаНачальныйОстаток, ТаблицаВзаиморасчетов.Сумма) КАК СуммаКОплате,
	ТаблицаВзаиморасчетов.Сумма КАК СуммаНачисленная,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.ЭтоПлатежПоТекущемуГрафику, ИСТИНА) КАК ЭтоПлатежПоТекущемуГрафику,
	ВЫБОР
		КОГДА ТаблицаВзаиморасчетов.ПлановаяДатаОплаты > ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
			ТОГДА ТаблицаВзаиморасчетов.ПлановаяДатаОплаты
		ИНАЧЕ ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
	КОНЕЦ КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.ДатаОплаты КАК ДатаОплаты,
	ТаблицаДляРасчетаПеней.СуммаОплаты КАК СуммаОплаты,
	ТаблицаДляРасчетаПеней.СуммаКонечныйОстаток КАК СуммаОстаток,
	ТаблицаВзаиморасчетов.НомерПлатежа КАК НомерПлатежа,
	ПроизводственныйКалендарь.ПервыйРабочийДень КАК ПервыйРабочийДень,
	ТаблицаПередач.ДатаПередачи КАК ДатаПередачи,
	ВЫБОР
		КОГДА ПроизводственныйКалендарь.ПервыйРабочийДень < ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
			ТОГДА РАЗНОСТЬДАТ(ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
		КОГДА ПроизводственныйКалендарь.ПервыйРабочийДень < ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета
			ТОГДА РАЗНОСТЬДАТ(ПроизводственныйКалендарь.ПервыйРабочийДень, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
		ИНАЧЕ 0
	КОНЕЦ КАК ДнейСкорректированных,
	ВЫБОР
		КОГДА НАЧАЛОПЕРИОДА(ПроизводственныйКалендарь.ПервыйРабочийДень, ДЕНЬ) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоПросроченныйПлатеж,
	ВЫБОР
		КОГДА НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты, ДЕНЬ) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоПросроченныйПлатежПоКалендарнымДням,
	ТаблицаДляРасчетаПеней.СтавкаПени КАК СтавкаПени,
	ТаблицаДляРасчетаПеней.ЛьготныйПериод КАК ЛьготныйПериод,
	ТаблицаДляРасчетаПеней.БазаРасчетаПеней КАК БазаРасчетаПеней,
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА ДОБАВИТЬКДАТЕ(ПроизводственныйКалендарь.ПервыйРабочийДень, ДЕНЬ, ТаблицаДляРасчетаПеней.ЛьготныйПериод) < ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
				ТОГДА РАЗНОСТЬДАТ(ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			КОГДА ДОБАВИТЬКДАТЕ(ПроизводственныйКалендарь.ПервыйРабочийДень, ДЕНЬ, ТаблицаДляРасчетаПеней.ЛьготныйПериод) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
				ТОГДА РАЗНОСТЬДАТ(ПроизводственныйКалендарь.ПервыйРабочийДень, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			ИНАЧЕ 0
		КОНЕЦ * ВЫБОР
			КОГДА ЕСТЬNULL(ТаблицаДляРасчетаПеней.БазаРасчетаПеней, 0) < 0
				ТОГДА 0
			ИНАЧЕ ЕСТЬNULL(ТаблицаДляРасчетаПеней.БазаРасчетаПеней, 0)
		КОНЕЦ * ТаблицаДляРасчетаПеней.СтавкаПени * 0.01 КАК ЧИСЛО(15, 2)) КАК СуммаПеней,
	ТаблицаДляРасчетаПеней.ДатаИзмененияПараметров КАК ДатаИзмененияПараметров,
	ВЫБОР
		КОГДА ЕСТЬNULL(ТаблицаВзаиморасчетов.СтатьяГрафика, ТаблицаДляРасчетаПеней.СтатьяГрафика) = &СтатьяЛП
			ТОГДА 1
		ИНАЧЕ 2
	КОНЕЦ КАК РазделительСтатейПоОплатеПеней
ПОМЕСТИТЬ ТаблицаРассчитанныхПеней
ИЗ
	ТаблицаНачислений КАК ТаблицаВзаиморасчетов
		ПОЛНОЕ СОЕДИНЕНИЕ ТаблицаДляРасчетаПенейСПараметрамиНачисленияПени КАК ТаблицаДляРасчетаПеней
		ПО ТаблицаВзаиморасчетов.ДоговорЛизинга = ТаблицаДляРасчетаПеней.ДоговорЛизинга
			И ТаблицаВзаиморасчетов.Приложение = ТаблицаДляРасчетаПеней.Приложение
			И ТаблицаВзаиморасчетов.СтатьяГрафика = ТаблицаДляРасчетаПеней.СтатьяГрафика
			И ТаблицаВзаиморасчетов.Валюта = ТаблицаДляРасчетаПеней.Валюта
			И ТаблицаВзаиморасчетов.ПлановаяДатаОплаты = ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты
			И ТаблицаВзаиморасчетов.НачислениеВнеГрафика = ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
		ЛЕВОЕ СОЕДИНЕНИЕ ПроизводственныйКалендарь КАК ПроизводственныйКалендарь
		ПО ТаблицаВзаиморасчетов.ПлановаяДатаОплаты = ПроизводственныйКалендарь.Дата
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаПередач КАК ТаблицаПередач
		ПО ТаблицаВзаиморасчетов.ДоговорЛизинга = ТаблицаПередач.ДоговорЛизинга

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	Валюта,
	КонецИнтервалаРасчета,
	НомерПлатежа
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаРассчитанныхПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаРассчитанныхПеней.Приложение КАК Приложение,
	ТаблицаРассчитанныхПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаРассчитанныхПеней.Валюта КАК Валюта,
	ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаРассчитанныхПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаРассчитанныхПеней.СуммаКОплате КАК СуммаКОплате,
	ТаблицаРассчитанныхПеней.СуммаНачисленная КАК СуммаНачисленная,
	ТаблицаРассчитанныхПеней.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику,
	ТаблицаРассчитанныхПеней.ДатаПередачи КАК ДатаПередачи,
	ТаблицаРассчитанныхПеней.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.ДатаОплаты КАК ДатаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОплаты КАК СуммаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОстаток КАК СуммаОстаток,
	ТаблицаРассчитанныхПеней.НомерПлатежа КАК НомерПлатежа,
	ТаблицаРассчитанныхПеней.ПервыйРабочийДень КАК ПервыйРабочийДень,
	ТаблицаРассчитанныхПеней.ДнейСкорректированных КАК ДнейСкорректированных,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатеж КАК ЭтоПросроченныйПлатеж,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатежПоКалендарнымДням КАК ЭтоПросроченныйПлатежПоКалендарнымДням,
	ТаблицаРассчитанныхПеней.ДатаИзмененияПараметров КАК ДатаИзмененияПараметров,
	ТаблицаРассчитанныхПеней.СтавкаПени КАК СтавкаПени,
	ТаблицаРассчитанныхПеней.ЛьготныйПериод КАК ЛьготныйПериод,
	ТаблицаРассчитанныхПеней.СуммаПеней КАК СуммаПеней,
	ТаблицаРассчитанныхПеней.РазделительСтатейПоОплатеПеней КАК РазделительСтатейПоОплатеПеней,
	СУММА(ЕСТЬNULL(ТаблицаРассчитанныхПеней1.СуммаПеней, 0)) КАК СуммаПенейНарастающийИтог
ПОМЕСТИТЬ ТаблицаРассчитанныхПенейСНарастающимИтогом
ИЗ
	ТаблицаРассчитанныхПеней КАК ТаблицаРассчитанныхПеней
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаРассчитанныхПеней КАК ТаблицаРассчитанныхПеней1
		ПО ТаблицаРассчитанныхПеней.ДоговорЛизинга = ТаблицаРассчитанныхПеней1.ДоговорЛизинга
			И ТаблицаРассчитанныхПеней.Приложение = ТаблицаРассчитанныхПеней1.Приложение
			И ТаблицаРассчитанныхПеней.Валюта = ТаблицаРассчитанныхПеней1.Валюта
			И (ВЫБОР
				КОГДА ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета = ТаблицаРассчитанныхПеней1.КонецИнтервалаРасчета
					ТОГДА ВЫБОР
							КОГДА ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты = ТаблицаРассчитанныхПеней1.ПлановаяДатаОплаты
								ТОГДА ВЫБОР
										КОГДА ТаблицаРассчитанныхПеней.НачислениеВнеГрафика = ТаблицаРассчитанныхПеней1.НачислениеВнеГрафика
											ТОГДА ТаблицаРассчитанныхПеней.СтатьяГрафика >= ТаблицаРассчитанныхПеней1.СтатьяГрафика
										ИНАЧЕ ТаблицаРассчитанныхПеней.НачислениеВнеГрафика >= ТаблицаРассчитанныхПеней1.НачислениеВнеГрафика
									КОНЕЦ
							ИНАЧЕ ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты >= ТаблицаРассчитанныхПеней1.ПлановаяДатаОплаты
						КОНЕЦ
				ИНАЧЕ ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета >= ТаблицаРассчитанныхПеней1.КонецИнтервалаРасчета
			КОНЕЦ)
			И ТаблицаРассчитанныхПеней.РазделительСтатейПоОплатеПеней = ТаблицаРассчитанныхПеней1.РазделительСтатейПоОплатеПеней

СГРУППИРОВАТЬ ПО
	ТаблицаРассчитанныхПеней.ДоговорЛизинга,
	ТаблицаРассчитанныхПеней.Приложение,
	ТаблицаРассчитанныхПеней.СтатьяГрафика,
	ТаблицаРассчитанныхПеней.Валюта,
	ТаблицаРассчитанныхПеней.НачислениеВнеГрафика,
	ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты,
	ТаблицаРассчитанныхПеней.СуммаКОплате,
	ТаблицаРассчитанныхПеней.СуммаНачисленная,
	ТаблицаРассчитанныхПеней.ЭтоПлатежПоТекущемуГрафику,
	ТаблицаРассчитанныхПеней.ДатаПередачи,
	ТаблицаРассчитанныхПеней.НачалоИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.ДатаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОстаток,
	ТаблицаРассчитанныхПеней.НомерПлатежа,
	ТаблицаРассчитанныхПеней.ПервыйРабочийДень,
	ТаблицаРассчитанныхПеней.ДнейСкорректированных,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатеж,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатежПоКалендарнымДням,
	ТаблицаРассчитанныхПеней.СтавкаПени,
	ТаблицаРассчитанныхПеней.ЛьготныйПериод,
	ТаблицаРассчитанныхПеней.СуммаПеней,
	ТаблицаРассчитанныхПеней.ДатаИзмененияПараметров,
	ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.РазделительСтатейПоОплатеПеней

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОсновнаяТаблица.ДоговорЛизинга.Владелец КАК Контрагент,
	ОсновнаяТаблица.ДоговорЛизинга КАК ДоговорЛизинга,
	ОсновнаяТаблица.Приложение КАК Приложение,
	ОсновнаяТаблица.СтатьяГрафика КАК Статья,
	ОсновнаяТаблица.Валюта КАК Валюта,
	ОсновнаяТаблица.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ОсновнаяТаблица.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ОсновнаяТаблица.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ОсновнаяТаблица.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ОсновнаяТаблица.ПервыйРабочийДень КАК ПервыйРабочийДень,
	ОсновнаяТаблица.СуммаКОплате КАК СуммаКОплате,
	ОсновнаяТаблица.СуммаНачисленная КАК СуммаНачисленная,
	ОсновнаяТаблица.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафикуПлатежей,
	ОсновнаяТаблица.НомерПлатежа КАК НомерПлатежа,
	ОсновнаяТаблица.ДатаОплаты КАК ДатаОплаты,
	ОсновнаяТаблица.СуммаОплаты КАК СуммаОплаты,
	ОсновнаяТаблица.СуммаОстаток КАК СуммаОстаток,
	ОсновнаяТаблица.ДатаПередачи КАК ДатаПередачи,
	ОсновнаяТаблица.ДнейСкорректированных КАК ДнейСкорректированных,
	ОсновнаяТаблица.ЭтоПросроченныйПлатеж КАК ЭтоПросроченныйПлатеж,
	ОсновнаяТаблица.ЭтоПросроченныйПлатежПоКалендарнымДням КАК ЭтоПросроченныйПлатежПоКалендарнымДням,
	ОсновнаяТаблица.ДатаИзмененияПараметров КАК ДатаИзмененияПараметров,
	ОсновнаяТаблица.СтавкаПени КАК СтавкаПени,
	ОсновнаяТаблица.ЛьготныйПериод КАК ЛьготныйПериод,
	ОсновнаяТаблица.СуммаПеней КАК СуммаПеней,
	ОсновнаяТаблица.СуммаПенейНарастающийИтог КАК СуммаПенейНарастающийИтог,
	МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0)) КАК ОбщаяСуммаОплаченныхПеней,
	ВЫБОР
		КОГДА МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0)) > ОсновнаяТаблица.СуммаПенейНарастающийИтог
			ТОГДА ОсновнаяТаблица.СуммаПеней
		КОГДА ОсновнаяТаблица.СуммаПенейНарастающийИтог - ОсновнаяТаблица.СуммаПеней > МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0))
			ТОГДА 0
		ИНАЧЕ МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0)) - ОсновнаяТаблица.СуммаПенейНарастающийИтог + ОсновнаяТаблица.СуммаПеней
	КОНЕЦ КАК ПениОплачено,
	ВЫБОР
		КОГДА ОсновнаяТаблица.ЭтоПросроченныйПлатеж
			ТОГДА ЕСТЬNULL(СУММА(ТаблицаВзаиморасчетовВесьПериод.ПросроченныйПлатеж), 0) + 1
		ИНАЧЕ 0
	КОНЕЦ КАК ПовторениеПросрочки,
	ОсновнаяТаблица.РазделительСтатейПоОплатеПеней КАК РазделительСтатейПоОплатеПеней
ПОМЕСТИТЬ ВтИтог
ИЗ
	ТаблицаРассчитанныхПенейСНарастающимИтогом КАК ОсновнаяТаблица
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаВзаиморасчетовВесьПериод КАК ТаблицаВзаиморасчетовВесьПериод
		ПО ОсновнаяТаблица.ДоговорЛизинга = ТаблицаВзаиморасчетовВесьПериод.ДоговорЛизинга
			И ОсновнаяТаблица.Приложение = ТаблицаВзаиморасчетовВесьПериод.Приложение
			И ОсновнаяТаблица.СтатьяГрафика = ТаблицаВзаиморасчетовВесьПериод.СтатьяГрафика
			И ОсновнаяТаблица.Валюта = ТаблицаВзаиморасчетовВесьПериод.Валюта
			И ОсновнаяТаблица.ПлановаяДатаОплаты > ТаблицаВзаиморасчетовВесьПериод.ПлановаяДатаОплаты
			И ОсновнаяТаблица.НачислениеВнеГрафика = ТаблицаВзаиморасчетовВесьПериод.НачислениеВнеГрафика
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОплатПенейВесьПериод КАК ОплатыПеней
		ПО ОсновнаяТаблица.ДоговорЛизинга = ОплатыПеней.ДоговорЛизинга
			И ОсновнаяТаблица.Приложение = ОплатыПеней.Приложение
			И ОсновнаяТаблица.Валюта = ОплатыПеней.Валюта
			И ОсновнаяТаблица.РазделительСтатейПоОплатеПеней = ОплатыПеней.РазделительСтатейПоОплатеПеней
ГДЕ
	ОсновнаяТаблица.ПлановаяДатаОплаты МЕЖДУ &НачалоПериода И &КонецПериода

СГРУППИРОВАТЬ ПО
	ОсновнаяТаблица.ДоговорЛизинга.Владелец,
	ОсновнаяТаблица.ДоговорЛизинга,
	ОсновнаяТаблица.Приложение,
	ОсновнаяТаблица.СтатьяГрафика,
	ОсновнаяТаблица.Валюта,
	ОсновнаяТаблица.ДатаПередачи,
	ОсновнаяТаблица.НачислениеВнеГрафика,
	ОсновнаяТаблица.ПлановаяДатаОплаты,
	ОсновнаяТаблица.ЭтоПросроченныйПлатеж,
	ОсновнаяТаблица.ЭтоПросроченныйПлатежПоКалендарнымДням,
	ОсновнаяТаблица.НомерПлатежа,
	ОсновнаяТаблица.ПервыйРабочийДень,
	ОсновнаяТаблица.ДатаОплаты,
	ОсновнаяТаблица.НачалоИнтервалаРасчета,
	ОсновнаяТаблица.СуммаКОплате,
	ОсновнаяТаблица.СуммаНачисленная,
	ОсновнаяТаблица.СуммаПенейНарастающийИтог,
	ОсновнаяТаблица.ЭтоПлатежПоТекущемуГрафику,
	ОсновнаяТаблица.СуммаОплаты,
	ОсновнаяТаблица.СуммаОстаток,
	ОсновнаяТаблица.ДнейСкорректированных,
	ОсновнаяТаблица.СтавкаПени,
	ОсновнаяТаблица.ЛьготныйПериод,
	ОсновнаяТаблица.СуммаПеней,
	ОсновнаяТаблица.ДатаИзмененияПараметров,
	ОсновнаяТаблица.КонецИнтервалаРасчета,
	ОсновнаяТаблица.РазделительСтатейПоОплатеПеней
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	&ДатаСреза КАК ДатаАктуальности,
	ВтИтог.Контрагент КАК Контрагент,
	ВтИтог.ДоговорЛизинга.Код КАК ДоговорКод,
	ВтИтог.ДоговорЛизинга.хлНомерДоговора как НомерДоговора,
	МАКСИМУМ(ВтИтог.ДатаОплаты) КАК ПоследнийДеньОплатыПросрочки,
	ВтИтог.ДатаПередачи КАК ДатаПередачи
ИЗ
	ВтИтог КАК ВтИтог
ГДЕ
	ВтИтог.СуммаОстаток <= 0
	И ВтИтог.ЭтоПросроченныйПлатежПоКалендарнымДням = ИСТИНА    
	И ВтИтог.ПервыйРабочийДень IS NOT NULL
	И ВтИтог.СуммаКОплате > 0

СГРУППИРОВАТЬ ПО
	ВтИтог.ДоговорЛизинга.хлНомерДоговора,
	ВтИтог.Контрагент,
	ВтИтог.ДоговорЛизинга.Код,
	ВтИтог.ДатаПередачи"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",22},
{1,"ЭтоВыражение",
{"Pattern"},"В",9},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"#",5a49abd5-936d-4f46-8499-9cb204efe378},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",22}
},
{2,3,0,0,1,1,2,2,
{1,12,
{2,43,3,
{"S","ДоговорЛизинга"},
{"B",0},
{"#",376807bc-0d88-4c06-9eb2-42b72b970afb,25:836f94049cc883ef11edb2998899c864},0},
{2,44,3,
{"S","НачалоПериода"},
{"B",0},
{"D",20010101000000},0},
{2,45,3,
{"S","КонецПериода"},
{"B",0},
{"D",20230705000000},0},
{2,46,3,
{"S","ДатаСреза"},
{"B",0},
{"D",20230705000000},0},
{2,47,3,
{"S","НаборСтатейИсключаемыхИзБазыРасчетаПени"},
{"B",0},
{"#",c3ec4375-8577-46d5-be3b-185e29cc8b67,17853:00000000000000000000000000000000},0},
{2,48,3,
{"S","НазначениеПени"},
{"B",0},
{"#",6bcdbfc3-84d1-4e5c-8ca9-d8e2b284449a,10672:ab6d3182f5ebc532496b0dcec964ddde},0},
{2,49,3,
{"S","НачалоВеденияУчета"},
{"B",0},
{"D",20010101000000},0},
{2,50,3,
{"S","СтатьяКомпенсацияСтрахования"},
{"B",0},
{"#",6bcdbfc3-84d1-4e5c-8ca9-d8e2b284449a,10672:86c101a9072f8a0e40fec391bb9e00a9},0},
{2,51,3,
{"S","СтатьяЛП"},
{"B",0},
{"#",46acbd87-b2d2-42f3-a9cc-ae9d20da8355,531:b6f2001b78e1182a11de1aad5fa16558},0},
{2,52,3,
{"S","Страна"},
{"B",0},
{"#",4ee4f6c6-683e-4abc-8890-ed6cde5a53cb,33:8ce4d57185730a3b4108effa215d0c81},0},
{2,53,3,
{"S","ШтрафыЗаСтрахование"},
{"B",0},
{"#",46acbd87-b2d2-42f3-a9cc-ae9d20da8355,531:816494049cc883ef11e5523c750d54c3},0},
{2,54,3,
{"S","Статья"},
{"B",0},
{"#",46acbd87-b2d2-42f3-a9cc-ae9d20da8355,531:b6f2001b78e1182a11de1aad5fa16558},0}
},2,54},
{0,0}
}
},
{"N",1},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{2,
{0,"ИмяВарианта",
{"Pattern",
{"S"}
},"Имя варианта",15},
{1,"ТекстКода",
{"Pattern",
{"S"}
},"Текст кода",87}
},
{2,2,0,0,1,1,
{1,0},1,-1},
{0,0}
}
},
{"#",e199ca70-93cf-46ce-a54b-6edc88c3a296,
{#base64:AQE4EgAAAAAAAO+7v3siIyIsM2Q0OGZlYWUtYTljNi00YzVhLWEwOTktOWViNjQ3
NzYzMGM2LA0KezIsDQp7DQp7IlMiLCLQlNC+0LPQvtCy0L7RgNCb0LjQt9C40L3Q
s9CwIn0sDQp7IiMiLDQyMzgwMTlkLTdlNDktNGZjOS05MWRiLWI2Yjk1MWQ1Y2Y4
ZSwNCns1LA0Kew0KeyJTIiwi0J3QsNGH0LDQu9GM0L3QsNGP0KHRgtGA0L7QutCw
In0sDQp7Ik4iLDF9DQp9LA0Kew0KeyJTIiwi0JrQvtC90LXRh9C90LDRj9Ch0YLR
gNC+0LrQsCJ9LA0KeyJOIiwxfQ0KfSwNCnsNCnsiUyIsItCi0LjQv9CX0L3QsNGH
0LXQvdC40Y/QntCx0YrQtdC60YLQsCJ9LA0KeyJUIiwzNzY4MDdiYy0wZDg4LTRj
MDYtOWViMi00MmI3MmI5NzBhZmJ9DQp9LA0Kew0KeyJTIiwi0J/QvtC70Y/QodC4
0L3RhdGA0L7QvdC40LfQsNGG0LjQuCJ9LA0KeyIjIixhY2Y2MTkyZS04MWNhLTQ2
ZWYtOTNhNi01YTY5NjhiNzg2NjMsDQp7OSwNCns0LA0KezAsItCf0L7Qu9C10KHQ
uNC90YXRgNC+0L3QuNC30LDRhtC40LgiLA0KeyJQYXR0ZXJuIiwNCnsiUyJ9DQp9
LCLQn9C+0LvQtSDRgdC40L3RhdGA0L7QvdC40LfQsNGG0LjQuCIsMzF9LA0KezEs
ItCf0L7Qu9C10KHQuNC90YXRgNC+0L3QuNC30LDRhtC40LjQn9GA0LXQtNGB0YLQ
sNCy0LvQtdC90LjQtSIsDQp7IlBhdHRlcm4iLA0KeyJTIn0NCn0sItCf0YDQtdC0
0YHRgtCw0LLQu9C10L3QuNC1IiwzMX0sDQp7Miwi0J/QvtC70LXQodC40L3RhdGA
0L7QvdC40LfQsNGG0LjQuNCi0LjQv9CX0L3QsNGH0LXQvdC40Y8iLA0KeyJQYXR0
ZXJuIiwNCnsiIyIsZjVjNjUwNTAtM2JiYi0xMWQ1LWI5ODgtMDA1MGJhZTBhOTVk
fQ0KfSwi0KLQuNC/INC30L3QsNGH0LXQvdC40Y8iLDIxfSwNCnszLCLQndC+0LzQ
tdGA0JrQvtC70L7QvdC60LjQntGC0LHQvtGA0LAiLA0KeyJQYXR0ZXJuIiwNCnsi
TiIsMTAsMCwxfQ0KfSwi0J3QvtC80LXRgCDQutC+0LvQvtC90LrQuCDRgtCw0LHQ
u9C40YbRiyDQvtGC0LHQvtGA0LAiLDI2fQ0KfSwNCnsyLDQsMCwwLDEsMSwyLDIs
MywzLA0KezEsMSwNCnsyLDAsNCwNCnsiUyIsItGF0LvQndC+0LzQtdGA0JTQvtCz
0L7QstC+0YDQsCJ9LA0KeyJTIiwi0JTQvtCz0L7QstC+0YDQm9C40LfQuNC90LPQ
sC7QndC+0LzQtdGAINC00L7Qs9C+0LLQvtGA0LAifSwNCnsiIyIsZjVjNjUwNTAt
M2JiYi0xMWQ1LWI5ODgtMDA1MGJhZTBhOTVkLA0KeyJQYXR0ZXJuIiwNCnsiUyIs
MTAwLDF9DQp9DQp9LA0KeyJOIiwxfSwwfQ0KfSwzLDB9LA0KezAsMH0NCn0NCn0N
Cn0sDQp7DQp7IlMiLCLQotCw0LHQu9C40YfQvdGL0LnQlNC+0LrRg9C80LXQvdGC
0J7RgtCx0L7RgNCwIn0sDQp7IiMiLGU2MDMxMDNlLWEzMTgtNGVkYy1hMDE0LWIx
YzZjZjk0ZDQ5ZiwNCns4LDEsMTEsDQp7IiMiLCIiLDEsMSwiIyIsItCv0LfRi9C6
INC/0L4g0YPQvNC+0LvRh9Cw0L3QuNGOIiwi0K/Qt9GL0Log0L/QviDRg9C80L7Q
u9GH0LDQvdC40Y4iLDB9LA0KezEyOCw3Mn0sDQp7MH0sMCwNCnswLDB9LA0KezAs
MH0sDQp7MCwwfSwNCnswLDB9LA0KezAsMH0sDQp7MCwwfSwwLDIsMTYsMCwwLDEs
MCwNCnsxNiwxLA0KezEsMSwNCnsiIyIsItCQ0JsgMjUwNzIvMDEtMTQg0JrQl9Cd
In0NCn0sMH0sMSwwLDEsMCwNCnsxNiwwLA0KezEsMSwNCnsiIyIsItCQ0JsgMjY2
MDkvMDEtMTQg0KPQm9CdIn0NCn0sMH0sMiwwLDEsMCwNCnsxNiwwLA0KezEsMSwN
CnsiIyIsItCQ0JsgMjU1MDUvMDItMTQg0JLQoNCWIn0NCn0sMH0sMywwLDEsMCwN
CnsxNiwwLA0KezEsMSwNCnsiIyIsItCQ0JsgMjQxNDQvMDQtMTQg0JrQl9CdIn0N
Cn0sMH0sNCwwLDEsMCwNCnsxNiwwLA0KezEsMSwNCnsiIyIsItCQ0JsgMjYxMDcv
MDItMTQg0J/QndCXIn0NCn0sMH0sNSwwLDEsMCwNCnsxNiwwLA0KezEsMSwNCnsi
IyIsItCQ0JsgMjQ2ODUvMDItMTQg0JXQmtCRIn0NCn0sMH0sNiwwLDEsMCwNCnsx
NiwwLA0KezEsMSwNCnsiIyIsItCQ0JsgMzA5NTkvMDEtMTQg0J3QkdCnIn0NCn0s
MH0sNywwLDEsMCwNCnsxNiwwLA0KezEsMSwNCnsiIyIsItCQ0JsgNzQyNzgvMDEt
MTYg0KHQoNCiIn0NCn0sMH0sOCwwLDEsMCwNCnsxNiwwLA0KezEsMSwNCnsiIyIs
ItCQ0JsgOTI1MDAvMDEtMTcg0KHQnNCgIn0NCn0sMH0sOSwwLDEsMCwNCnsxNiww
LA0KezEsMSwNCnsiIyIsItCQ0JsgOTg3MDgvMDEtMTcg0KLQrtCcIn0NCn0sMH0s
MTAsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDExMTE2OC8wMS0x
OCDQntCg0JEifQ0KfSwwfSwxMSwwLDEsMCwNCnsxNiwwLA0KezEsMSwNCnsiIyIs
ItCQ0JsgMjE3MC8xNC0xOSDQmtCg0KEifQ0KfSwwfSwxMiwwLDEsMCwNCnsxNiww
LA0KezEsMSwNCnsiIyIsItCQ0JsgMTAzODE4LzAyLTE4In0NCn0sMH0sMTMsMCwx
LDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDEwMzgxOC8wMy0xOCJ9DQp9
LDB9LDE0LDAsMSwwLA0KezE2LDAsDQp7MSwxLA0KeyIjIiwi0JDQmyA5Mzk0My8w
Mi0xOCDQotCb0KIifQ0KfSwwfSwxNSwwLDEsMCwNCnsxNiwwLA0KezEsMSwNCnsi
IyIsItCQ0JsgNjY5ODgvMDItMTYg0JHQk9CUIn0NCn0sMH0sDQp7MSwwLDAwMDAw
MDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMCwxLDAsMn0sMTYsMCwwLDAs
MCwwLDAsMCwwLA0KezB9LA0KezB9LA0KezB9LA0KezB9LCIiLA0Kew0KezAsNiw2
LA0KeyJOIiwxMDAwfSw3LA0KeyJOIiwxMDAwfSw4LA0KeyJOIiwxMDAwfSw5LA0K
eyJOIiwxMDAwfSwxMCwNCnsiTiIsMTAwMH0sMTEsDQp7Ik4iLDEwMDB9DQp9DQp9
LA0KezAsLTEsLTEsLTEsLTEsMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAw
MDAwMDAwfSwwLDAsMCwwLDAsMCwwLDEsMCwxLDIsDQp7MjE3NiwyMDEsMn0sDQp7
MTI4LDIxN30sMCwwLDAsMCwzLA0KezMsMywNCnstMX0NCn0sDQp7MywzLA0Key0z
fQ0KfSwNCnszLDMsDQp7LTd9DQp9LDAsMCwwLCIiLDAsDQp7MywwLDAsMTAwLDEs
MSwwLDEsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwiIiwwLDAsMCwwLDAsMCww
fSwNCnswfSwwLDAsMCwxLDAsMH0NCn0NCn0NCn0NCn0NCn0sDQp7DQp7IlMiLCLR
hdC70J3QvtC80LXRgNCU0L7Qs9C+0LLQvtGA0LAifSwNCnsiIyIsNDIzODAxOWQt
N2U0OS00ZmM5LTkxZGItYjZiOTUxZDVjZjhlLA0KezUsDQp7DQp7IlMiLCLQndCw
0YfQsNC70YzQvdCw0Y/QodGC0YDQvtC60LAifSwNCnsiTiIsMH0NCn0sDQp7DQp7
IlMiLCLQmtC+0L3QtdGH0L3QsNGP0KHRgtGA0L7QutCwIn0sDQp7Ik4iLDB9DQp9
LA0Kew0KeyJTIiwi0KLQuNC/0JfQvdCw0YfQtdC90LjRj9Ce0LHRitC10LrRgtCw
In0sDQp7IlUifQ0KfSwNCnsNCnsiUyIsItCf0L7Qu9GP0KHQuNC90YXRgNC+0L3Q
uNC30LDRhtC40LgifSwNCnsiIyIsYWNmNjE5MmUtODFjYS00NmVmLTkzYTYtNWE2
OTY4Yjc4NjYzLA0KezksDQp7NCwNCnswLCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC9
0LjQt9Cw0YbQuNC4IiwNCnsiUGF0dGVybiIsDQp7IlMifQ0KfSwi0J/QvtC70LUg
0YHQuNC90YXRgNC+0L3QuNC30LDRhtC40LgiLDMxfSwNCnsxLCLQn9C+0LvQtdCh
0LjQvdGF0YDQvtC90LjQt9Cw0YbQuNC40J/RgNC10LTRgdGC0LDQstC70LXQvdC4
0LUiLA0KeyJQYXR0ZXJuIiwNCnsiUyJ9DQp9LCLQn9GA0LXQtNGB0YLQsNCy0LvQ
tdC90LjQtSIsMzF9LA0KezIsItCf0L7Qu9C10KHQuNC90YXRgNC+0L3QuNC30LDR
htC40LjQotC40L/Ql9C90LDRh9C10L3QuNGPIiwNCnsiUGF0dGVybiIsDQp7IiMi
LGY1YzY1MDUwLTNiYmItMTFkNS1iOTg4LTAwNTBiYWUwYTk1ZH0NCn0sItCi0LjQ
vyDQt9C90LDRh9C10L3QuNGPIiwyMX0sDQp7Mywi0J3QvtC80LXRgNCa0L7Qu9C+
0L3QutC40J7RgtCx0L7RgNCwIiwNCnsiUGF0dGVybiIsDQp7Ik4iLDEwLDAsMX0N
Cn0sItCd0L7QvNC10YAg0LrQvtC70L7QvdC60Lgg0YLQsNCx0LvQuNGG0Ysg0L7R
gtCx0L7RgNCwIiwyNn0NCn0sDQp7Miw0LDAsMCwxLDEsMiwyLDMsMywNCnsxLDB9
LDMsLTF9LA0KezAsMH0NCn0NCn0NCn0sDQp7DQp7IlMiLCLQotCw0LHQu9C40YfQ
vdGL0LnQlNC+0LrRg9C80LXQvdGC0J7RgtCx0L7RgNCwIn0sDQp7IiMiLGU2MDMx
MDNlLWEzMTgtNGVkYy1hMDE0LWIxYzZjZjk0ZDQ5ZiwNCns4LDEsMTEsDQp7IiMi
LCIiLDEsMSwiIyIsItCv0LfRi9C6INC/0L4g0YPQvNC+0LvRh9Cw0L3QuNGOIiwi
0K/Qt9GL0Log0L/QviDRg9C80L7Qu9GH0LDQvdC40Y4iLDB9LA0KezEyOCw3Mn0s
DQp7MH0sMCwNCnswLDB9LA0KezAsMH0sDQp7MCwwfSwNCnswLDB9LA0KezAsMH0s
DQp7MCwwfSwwLDIsMCwNCnswLDAsMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAw
MDAwMDAwMDAwLDB9LDAsMCwwLDAsMCwwLDAsMCwwLA0KezB9LA0KezB9LA0KezB9
LA0KezB9LCIiLA0Kew0KezAsNiw2LA0KeyJOIiwxMDAwfSw3LA0KeyJOIiwxMDAw
fSw4LA0KeyJOIiwxMDAwfSw5LA0KeyJOIiwxMDAwfSwxMCwNCnsiTiIsMTAwMH0s
MTEsDQp7Ik4iLDEwMDB9DQp9DQp9LA0KezAsLTEsLTEsLTEsLTEsMDAwMDAwMDAt
MDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAwfSwwLDAsMCwwLDAsMCwwLDEsMCwx
LDAsMCwwLDAsMCwyLA0KezMsMywNCnstMX0NCn0sDQp7MywzLA0Key0zfQ0KfSww
LDAsMCwiIiwwLA0KezMsMCwwLDEwMCwxLDEsMCwxLDEsMCwwLDAsMCwwLDAsMCww
LDAsMCwwLDAsIiIsMCwwLDAsMCwwLDAsMH0sDQp7MH0sMCwwLDAsMSwwLDB9DQp9
DQp9DQp9DQp9DQp9DQp9DQp9}
},0},
{2,3,6,
{"S","есть ли просрочка на конец месяца"},
{"S","ВЫБРАТЬ
	хлПриложениеКДоговоруЛизинга.ДоговорЛизинга КАК ДоговорЛизинга,
	хлПриложениеКДоговоруЛизинга.ДоговорЛизинга.ДоговорКонтрагента КАК ДоговорКонтрагента,
	хлПриложениеКДоговоруЛизинга.Номер КАК НомерПриложения
ПОМЕСТИТЬ ВтВсеДоговоры
ИЗ
	Документ.хлПриложениеКДоговоруЛизинга КАК хлПриложениеКДоговоруЛизинга
ГДЕ
	хлПриложениеКДоговоруЛизинга.хлпДоговорКонтрагента.хлНомерДоговора ПОДОБНО ""АЛ %""
	И НЕ хлПриложениеКДоговоруЛизинга.ПометкаУдаления
	И НЕ хлПриложениеКДоговоруЛизинга.хлпДоговорКонтрагента.ПометкаУдаления
	И НЕ хлПриложениеКДоговоруЛизинга.ДоговорЛизинга.ДоговорКонтрагента.Код ЕСТЬ NULL
	И хлПриложениеКДоговоруЛизинга.ДоговорЛизинга.ДоговорКонтрагента = &ДоговорЛизинга
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПроизводственныеКалендариСтранМира.Дата КАК Дата,
	ВЫБОР
		КОГДА ПроизводственныеКалендариСтранМира.ВидДня = ЗНАЧЕНИЕ(Перечисление.ВидыДнейПроизводственногоКалендаря.Рабочий)
			ТОГДА ИСТИНА
		КОГДА ПроизводственныеКалендариСтранМира.ВидДня = ЗНАЧЕНИЕ(Перечисление.ВидыДнейПроизводственногоКалендаря.Предпраздничный)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоРабочийДень
ПОМЕСТИТЬ КалендарьПолный
ИЗ
	РегистрСведений.хлПроизводственныеКалендариСтранМира КАК ПроизводственныеКалендариСтранМира
ГДЕ
	ПроизводственныеКалендариСтранМира.Страна = &Страна
	И ПроизводственныеКалендариСтранМира.Дата <= &КонецПериода

ИНДЕКСИРОВАТЬ ПО
	Дата
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	КалендарьПолный.Дата КАК Дата
ПОМЕСТИТЬ КалендарьРабочиеДни
ИЗ
	КалендарьПолный КАК КалендарьПолный
ГДЕ
	КалендарьПолный.ЭтоРабочийДень

ИНДЕКСИРОВАТЬ ПО
	Дата
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	КалендарьПолный.Дата КАК Дата,
	МИНИМУМ(ЕСТЬNULL(КалендарьРабочиеДни.Дата, КалендарьПолный.Дата)) КАК ПервыйРабочийДень
ПОМЕСТИТЬ ПроизводственныйКалендарь
ИЗ
	КалендарьПолный КАК КалендарьПолный
		ЛЕВОЕ СОЕДИНЕНИЕ КалендарьРабочиеДни КАК КалендарьРабочиеДни
		ПО (ВЫБОР
				КОГДА КалендарьПолный.ЭтоРабочийДень
					ТОГДА ЛОЖЬ
				ИНАЧЕ КалендарьПолный.Дата <= КалендарьРабочиеДни.Дата
			КОНЕЦ)

СГРУППИРОВАТЬ ПО
	КалендарьПолный.Дата

ИНДЕКСИРОВАТЬ ПО
	Дата
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга.Владелец КАК Контрагент,
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга КАК ДоговорЛизинга,
	МИНИМУМ(ВЫБОР
			КОГДА ПредметыЛизингаВЛизингеОбороты.КоличествоПриход > 0
				ТОГДА ПредметыЛизингаВЛизингеОбороты.Период
		КОНЕЦ) КАК ДатаПередачи
ПОМЕСТИТЬ ТаблицаПередач
ИЗ
	РегистрНакопления.хлПредметыЛизингаВЛизинге.Обороты(
			&НачалоВеденияУчета,
			&КонецПериода,
			День,
			ДоговорЛизинга В
				(ВЫБРАТЬ
					ВтВсеДоговоры.ДоговорКонтрагента
				ИЗ
					ВтВсеДоговоры)) КАК ПредметыЛизингаВЛизингеОбороты

СГРУППИРОВАТЬ ПО
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга,
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга.Владелец

ИНДЕКСИРОВАТЬ ПО
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ КАК ЭтоФакт,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга.Владелец КАК Контрагент,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга КАК ДоговорЛизинга,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Приложение КАК Приложение,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Статья КАК СтатьяГрафика,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Валюта КАК Валюта,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Дата КАК ПлановаяДатаОплаты,
	ЕСТЬNULL(ТаблицаПередач.ДатаПередачи, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаПередачи,
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
		ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
	КОНЕЦ КАК ДатаОплаты,
	СУММА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Сумма) КАК Сумма,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	МАКСИМУМ(ВЫБОР
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
					И (хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика
						ИЛИ хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Регистратор = ТаблицаАктуальныхУтверждений.Регистратор)
				ТОГДА ИСТИНА
			ИНАЧЕ ЛОЖЬ
		КОНЕЦ) КАК ЭтоПлатежПоТекущемуГрафику
ПОМЕСТИТЬ ВзаиморасчетыВесьПериод
ИЗ
	ВтВсеДоговоры КАК ВтВсеДоговоры
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику КАК хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику
			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.хлДанныеУтвержденийГрафиков.СрезПоследних(
					&КонецПериода,
					ВидГрафика = ЗНАЧЕНИЕ(Справочник.хлВидыГрафиков.ГрафикПлатежейПоДоговоруЛизинга)
						И Договор В
							(ВЫБРАТЬ
								ВтВсеДоговоры.ДоговорКонтрагента
							ИЗ
								ВтВсеДоговоры)) КАК ТаблицаАктуальныхУтверждений
			ПО хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга = ТаблицаАктуальныхУтверждений.Договор
				И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Приложение = ТаблицаАктуальныхУтверждений.Приложение
				И (хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход))
			ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаПередач КАК ТаблицаПередач
			ПО хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга = ТаблицаПередач.ДоговорЛизинга
		ПО ВтВсеДоговоры.ДоговорКонтрагента = хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга
ГДЕ
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Активность
	И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период <= &КонецПериода
	И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Дата <= &ДатаСреза
	И ВЫБОР
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
					И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
				ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
			ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
		КОНЕЦ <= &КонецПериода
	И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Статья = &Статья
	И ВЫБОР
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
				ТОГДА ДАТАВРЕМЯ(1, 1, 1)
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
				ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
			ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
		КОНЕЦ <= &ДатаСреза

СГРУППИРОВАТЬ ПО
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Валюта,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга.Владелец,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Статья,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Приложение,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Дата,
	ЕСТЬNULL(ТаблицаПередач.ДатаПередачи, ДАТАВРЕМЯ(1, 1, 1)),
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
		ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
	КОНЕЦ

ИМЕЮЩИЕ
	СУММА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Сумма) <> 0

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика,
	ДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение КАК Приложение,
	ВзаиморасчетыВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ВзаиморасчетыВесьПериод.Валюта КАК Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.Сумма КАК Сумма,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ВзаиморасчетыВесьПериод.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику
ПОМЕСТИТЬ ТаблицаНачисленийВесьПериод
ИЗ
	ВзаиморасчетыВесьПериод КАК ВзаиморасчетыВесьПериод
ГДЕ
	ВзаиморасчетыВесьПериод.ЭтоФакт = ЛОЖЬ

ИНДЕКСИРОВАТЬ ПО
	ВзаиморасчетыВесьПериод.ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение,
	ВзаиморасчетыВесьПериод.СтатьяГрафика,
	ВзаиморасчетыВесьПериод.Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение КАК Приложение,
	ВзаиморасчетыВесьПериод.Валюта КАК Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.ДатаПередачи КАК ДатаПередачи,
	ВзаиморасчетыВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ВзаиморасчетыВесьПериод.ДатаОплаты КАК ДатаОплаты,
	ВзаиморасчетыВесьПериод.Сумма КАК СуммаОплаты,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика
ПОМЕСТИТЬ ТаблицаОплатВесьПериод
ИЗ
	ВзаиморасчетыВесьПериод КАК ВзаиморасчетыВесьПериод
ГДЕ
	ВзаиморасчетыВесьПериод.ЭтоФакт = ИСТИНА

ИНДЕКСИРОВАТЬ ПО
	ВзаиморасчетыВесьПериод.ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение,
	ВзаиморасчетыВесьПериод.СтатьяГрафика,
	ВзаиморасчетыВесьПериод.Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика,
	ВзаиморасчетыВесьПериод.ДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаОплатВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение КАК Приложение,
	ТаблицаОплатВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаОплатВесьПериод.Валюта КАК Валюта,
	ТаблицаОплатВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаОплатВесьПериод.ДатаПередачи КАК ДатаПередачи,
	ТаблицаОплатВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	МАКСИМУМ(ВЫБОР
			КОГДА ТаблицаОплатВесьПериодДляОстатков.ДатаОплаты >= ТаблицаОплатВесьПериод.ДатаОплаты
				ТОГДА ТаблицаОплатВесьПериод.ПлановаяДатаОплаты
			ИНАЧЕ ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.ДатаОплаты, ТаблицаОплатВесьПериод.ПлановаяДатаОплаты)
		КОНЕЦ) КАК НачалоИнтервалаРасчета,
	ТаблицаОплатВесьПериод.ДатаОплаты КАК ДатаОплаты,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.ЭтоФакт, ЛОЖЬ) = ЛОЖЬ
				ТОГДА 1
			ИНАЧЕ -1
		КОНЕЦ * ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.Сумма, 0)) + ТаблицаОплатВесьПериод.СуммаОплаты КАК СуммаНачальныйОстаток,
	ТаблицаОплатВесьПериод.СуммаОплаты КАК СуммаОплаты,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.ЭтоФакт, ЛОЖЬ) = ЛОЖЬ
				ТОГДА 1
			ИНАЧЕ -1
		КОНЕЦ * ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.Сумма, 0)) КАК СуммаКонечныйОстаток
ПОМЕСТИТЬ ТаблицаОплатСОстаткамиВесьПериод
ИЗ
	ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ ВзаиморасчетыВесьПериод КАК ТаблицаОплатВесьПериодДляОстатков
		ПО ТаблицаОплатВесьПериод.ДоговорЛизинга = ТаблицаОплатВесьПериодДляОстатков.ДоговорЛизинга
			И ТаблицаОплатВесьПериод.Приложение = ТаблицаОплатВесьПериодДляОстатков.Приложение
			И ТаблицаОплатВесьПериод.СтатьяГрафика = ТаблицаОплатВесьПериодДляОстатков.СтатьяГрафика
			И ТаблицаОплатВесьПериод.Валюта = ТаблицаОплатВесьПериодДляОстатков.Валюта
			И ТаблицаОплатВесьПериод.ПлановаяДатаОплаты = ТаблицаОплатВесьПериодДляОстатков.ПлановаяДатаОплаты
			И ТаблицаОплатВесьПериод.НачислениеВнеГрафика = ТаблицаОплатВесьПериодДляОстатков.НачислениеВнеГрафика
			И ТаблицаОплатВесьПериод.ДатаОплаты >= ТаблицаОплатВесьПериодДляОстатков.ДатаОплаты

СГРУППИРОВАТЬ ПО
	ТаблицаОплатВесьПериод.Валюта,
	ТаблицаОплатВесьПериод.СтатьяГрафика,
	ТаблицаОплатВесьПериод.ПлановаяДатаОплаты,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.СуммаОплаты,
	ТаблицаОплатВесьПериод.ДатаОплаты,
	ТаблицаОплатВесьПериод.ДатаПередачи,
	ТаблицаОплатВесьПериод.НачислениеВнеГрафика

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика,
	ДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыВесьПериодОстатки.ДоговорЛизинга КАК ДоговорЛизинга,
	ВзаиморасчетыВесьПериодОстатки.Приложение КАК Приложение,
	ВзаиморасчетыВесьПериодОстатки.СтатьяГрафика КАК СтатьяГрафика,
	ВзаиморасчетыВесьПериодОстатки.Валюта КАК Валюта,
	ВзаиморасчетыВесьПериодОстатки.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериодОстатки.ДатаПередачи КАК ДатаПередачи,
	ВзаиморасчетыВесьПериодОстатки.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) КАК СуммаОстаток,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) КАК СуммаОстаток1,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) КАК СуммаОстаток2
ПОМЕСТИТЬ ТаблицаОстатков
ИЗ
	ВзаиморасчетыВесьПериод КАК ВзаиморасчетыВесьПериодОстатки

СГРУППИРОВАТЬ ПО
	ВзаиморасчетыВесьПериодОстатки.ДоговорЛизинга,
	ВзаиморасчетыВесьПериодОстатки.Приложение,
	ВзаиморасчетыВесьПериодОстатки.СтатьяГрафика,
	ВзаиморасчетыВесьПериодОстатки.Валюта,
	ВзаиморасчетыВесьПериодОстатки.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериодОстатки.ДатаПередачи,
	ВзаиморасчетыВесьПериодОстатки.НачислениеВнеГрафика

ИМЕЮЩИЕ
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) <> 0

ИНДЕКСИРОВАТЬ ПО
	ВзаиморасчетыВесьПериодОстатки.ДоговорЛизинга,
	ВзаиморасчетыВесьПериодОстатки.Приложение,
	ВзаиморасчетыВесьПериодОстатки.СтатьяГрафика,
	ВзаиморасчетыВесьПериодОстатки.Валюта,
	ВзаиморасчетыВесьПериодОстатки.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериодОстатки.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ ПЕРВЫЕ 1
	НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья КАК СтатьяКомпенсация
ПОМЕСТИТЬ врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях
ИЗ
	Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ИсключаемыеСтатьи КАК НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи
ГДЕ
	ВЫБОР
			КОГДА &НаборСтатейИсключаемыхИзБазыРасчетаПени = ЗНАЧЕНИЕ(Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ПустаяСсылка)
				ТОГДА ИСТИНА
			ИНАЧЕ НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Ссылка = &НаборСтатейИсключаемыхИзБазыРасчетаПени
		КОНЕЦ
	И НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья = &СтатьяКомпенсацияСтрахования
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаОплатВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение КАК Приложение,
	ТаблицаОплатВесьПериод.Валюта КАК Валюта,
	СУММА(ТаблицаОплатВесьПериод.СуммаОплаты) КАК СуммаОплаты,
	1 КАК РазделительСтатейПоОплатеПеней
ПОМЕСТИТЬ ТаблицаОплатПенейВесьПериод
ИЗ
	ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.хлНазначенияОбъектов КАК НазначенияОбъектов
		ПО ТаблицаОплатВесьПериод.СтатьяГрафика = НазначенияОбъектов.Объект
			И (НазначенияОбъектов.Назначение = &НазначениеПени)
ГДЕ
	НазначенияОбъектов.Назначение = &НазначениеПени

СГРУППИРОВАТЬ ПО
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.Валюта

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.Валюта,
	СУММА(ТаблицаОплатВесьПериод.СуммаОплаты),
	2
ИЗ
	ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях КАК врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях
		ПО (ИСТИНА)
ГДЕ
	ТаблицаОплатВесьПериод.СтатьяГрафика = &ШтрафыЗаСтрахование
	И врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях.СтатьяКомпенсация ЕСТЬ NULL

СГРУППИРОВАТЬ ПО
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.Валюта
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение КАК Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта КАК Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.Сумма КАК Сумма,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику,
	СУММА(ТаблицаОплатВесьПериод.СуммаОплаты) КАК СуммаОплаты,
	МАКСИМУМ(ТаблицаОплатВесьПериод.ДатаОплаты) КАК ДатаОплаты,
	ВЫБОР
		КОГДА МАКСИМУМ(ТаблицаОплатВесьПериод.ДатаОплаты) ЕСТЬ NULL
				ИЛИ ТаблицаНачисленийВесьПериод.Сумма - ЕСТЬNULL(СУММА(ТаблицаОплатВесьПериод.СуммаОплаты), 0) > 0
				ИЛИ РАЗНОСТЬДАТ(ПроизводственныйКалендарь.ПервыйРабочийДень, МАКСИМУМ(ТаблицаОплатВесьПериод.ДатаОплаты), ДЕНЬ) > 0
			ТОГДА 1
		ИНАЧЕ 0
	КОНЕЦ КАК ПросроченныйПлатеж
ПОМЕСТИТЬ ТаблицаВзаиморасчетовВесьПериод
ИЗ
	ТаблицаНачисленийВесьПериод КАК ТаблицаНачисленийВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ПО ТаблицаНачисленийВесьПериод.ДоговорЛизинга = ТаблицаОплатВесьПериод.ДоговорЛизинга
			И ТаблицаНачисленийВесьПериод.Приложение = ТаблицаОплатВесьПериод.Приложение
			И ТаблицаНачисленийВесьПериод.СтатьяГрафика = ТаблицаОплатВесьПериод.СтатьяГрафика
			И ТаблицаНачисленийВесьПериод.Валюта = ТаблицаОплатВесьПериод.Валюта
			И ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты = ТаблицаОплатВесьПериод.ПлановаяДатаОплаты
			И ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика = ТаблицаОплатВесьПериод.НачислениеВнеГрафика
		ЛЕВОЕ СОЕДИНЕНИЕ ПроизводственныйКалендарь КАК ПроизводственныйКалендарь
		ПО ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты = ПроизводственныйКалендарь.Дата

СГРУППИРОВАТЬ ПО
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.Сумма,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику,
	ПроизводственныйКалендарь.ПервыйРабочийДень

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение КАК Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта КАК Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.Сумма КАК Сумма,
	КОЛИЧЕСТВО(ТаблицаНачисленийВесьПериодДляНомераПлатежа.ПлановаяДатаОплаты) КАК НомерПлатежа,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику
ПОМЕСТИТЬ ТаблицаНачислений
ИЗ
	ТаблицаНачисленийВесьПериод КАК ТаблицаНачисленийВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаНачисленийВесьПериод КАК ТаблицаНачисленийВесьПериодДляНомераПлатежа
		ПО ТаблицаНачисленийВесьПериод.ДоговорЛизинга = ТаблицаНачисленийВесьПериодДляНомераПлатежа.ДоговорЛизинга
			И ТаблицаНачисленийВесьПериод.Приложение = ТаблицаНачисленийВесьПериодДляНомераПлатежа.Приложение
			И ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты >= ТаблицаНачисленийВесьПериодДляНомераПлатежа.ПлановаяДатаОплаты
			И ТаблицаНачисленийВесьПериод.СтатьяГрафика = ТаблицаНачисленийВесьПериодДляНомераПлатежа.СтатьяГрафика
			И ТаблицаНачисленийВесьПериод.Валюта = ТаблицаНачисленийВесьПериодДляНомераПлатежа.Валюта
			И (НЕ ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика
				ИЛИ ТаблицаНачисленийВесьПериод.СтатьяГрафика = &СтатьяЛП)

СГРУППИРОВАТЬ ПО
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.Сумма,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОплатыИОстатки.ДоговорЛизинга КАК ДоговорЛизинга,
	ОплатыИОстатки.Приложение КАК Приложение,
	ОплатыИОстатки.СтатьяГрафика КАК СтатьяГрафика,
	ОплатыИОстатки.Валюта КАК Валюта,
	ОплатыИОстатки.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ОплатыИОстатки.ДатаПередачи КАК ДатаПередачи,
	ОплатыИОстатки.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ОплатыИОстатки.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	КОНЕЦПЕРИОДА(ОплатыИОстатки.КонецИнтервалаРасчета, ДЕНЬ) КАК КонецИнтервалаРасчета,
	ЕСТЬNULL(ОплатыИОстатки.ДатаОплаты, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаОплаты,
	ОплатыИОстатки.БазаРасчетаПеней КАК БазаРасчетаПеней,
	ОплатыИОстатки.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
	ОплатыИОстатки.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток,
	ОплатыИОстатки.СуммаОплаты КАК СуммаОплаты
ПОМЕСТИТЬ ТаблицаДляРасчетаПеней
ИЗ
	(ВЫБРАТЬ
		Оплаты.ДоговорЛизинга КАК ДоговорЛизинга,
		Оплаты.Приложение КАК Приложение,
		Оплаты.СтатьяГрафика КАК СтатьяГрафика,
		Оплаты.Валюта КАК Валюта,
		Оплаты.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
		Оплаты.ДатаПередачи КАК ДатаПередачи,
		Оплаты.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
		Оплаты.ДатаОплаты КАК КонецИнтервалаРасчета,
		Оплаты.ДатаОплаты КАК ДатаОплаты,
		Оплаты.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
		Оплаты.СуммаНачальныйОстаток КАК БазаРасчетаПеней,
		Оплаты.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
		Оплаты.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток,
		Оплаты.СуммаОплаты КАК СуммаОплаты
	ИЗ
		ТаблицаОплатСОстаткамиВесьПериод КАК Оплаты
	ГДЕ
		Оплаты.ДатаОплаты <= &КонецПериода
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		Остатки.ДоговорЛизинга,
		Остатки.Приложение,
		Остатки.СтатьяГрафика,
		Остатки.Валюта,
		Остатки.ПлановаяДатаОплаты,
		Остатки.ДатаПередачи,
		ЕСТЬNULL(МАКСИМУМ(Оплаты.ДатаОплаты), Остатки.ПлановаяДатаОплаты),
		&КонецПериода,
		NULL,
		Остатки.НачислениеВнеГрафика,
		Остатки.СуммаОстаток,
		Остатки.СуммаОстаток1,
		Остатки.СуммаОстаток2,
		0
	ИЗ
		ТаблицаОстатков КАК Остатки
			ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОплатВесьПериод КАК Оплаты
			ПО (Оплаты.ДоговорЛизинга = Остатки.ДоговорЛизинга)
				И (Оплаты.Приложение = Остатки.Приложение)
				И (Оплаты.СтатьяГрафика = Остатки.СтатьяГрафика)
				И (Оплаты.Валюта = Остатки.Валюта)
				И (Оплаты.ПлановаяДатаОплаты = Остатки.ПлановаяДатаОплаты)
				И (Оплаты.НачислениеВнеГрафика = Остатки.НачислениеВнеГрафика)
				И (Оплаты.ДатаОплаты <= &КонецПериода)
	ГДЕ
		Остатки.СуммаОстаток > 0
	
	СГРУППИРОВАТЬ ПО
		Остатки.ДоговорЛизинга,
		Остатки.Приложение,
		Остатки.СтатьяГрафика,
		Остатки.Валюта,
		Остатки.ПлановаяДатаОплаты,
		Остатки.ДатаПередачи,
		Остатки.НачислениеВнеГрафика,
		Остатки.СуммаОстаток,
		Остатки.СуммаОстаток1,
		Остатки.СуммаОстаток2) КАК ОплатыИОстатки

СГРУППИРОВАТЬ ПО
	ОплатыИОстатки.Приложение,
	ОплатыИОстатки.Валюта,
	ОплатыИОстатки.ПлановаяДатаОплаты,
	ОплатыИОстатки.ДатаПередачи,
	ОплатыИОстатки.НачалоИнтервалаРасчета,
	ОплатыИОстатки.НачислениеВнеГрафика,
	ОплатыИОстатки.ДоговорЛизинга,
	ОплатыИОстатки.СтатьяГрафика,
	ОплатыИОстатки.КонецИнтервалаРасчета,
	ОплатыИОстатки.ДатаОплаты,
	ОплатыИОстатки.СуммаНачальныйОстаток,
	ОплатыИОстатки.СуммаКонечныйОстаток,
	ОплатыИОстатки.СуммаОплаты,
	ОплатыИОстатки.БазаРасчетаПеней

ИНДЕКСИРОВАТЬ ПО
	ОплатыИОстатки.ДоговорЛизинга,
	ОплатыИОстатки.Приложение,
	ОплатыИОстатки.СтатьяГрафика,
	ОплатыИОстатки.Валюта,
	ОплатыИОстатки.ПлановаяДатаОплаты,
	ОплатыИОстатки.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПараметрыНачисленияПениПоДоговорамЛизинга.Период КАК Период,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ДоговорКонтрагента КАК ДоговорКонтрагента,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ПараметрыНачисленияПениПоДоговорамЛизинга.НаборИсключаемыхСтатей КАК НаборИсключаемыхСтатей,
	ПараметрыНачисленияПениПоДоговорамЛизинга.СтавкаПени КАК СтавкаПени,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ЛьготныйПериод КАК ЛьготныйПериод
ПОМЕСТИТЬ ПараметрыНачисленияПени
ИЗ
	РегистрСведений.хлПараметрыНачисленияПениПоДоговорамЛизинга КАК ПараметрыНачисленияПениПоДоговорамЛизинга
ГДЕ
	ПараметрыНачисленияПениПоДоговорамЛизинга.ДоговорКонтрагента В
			(ВЫБРАТЬ
				ВтВсеДоговоры.ДоговорКонтрагента
			ИЗ
				ВтВсеДоговоры)

ИНДЕКСИРОВАТЬ ПО
	ПараметрыНачисленияПениПоДоговорамЛизинга.Период,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ДоговорКонтрагента,
	НаборИсключаемыхСтатей,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ПлановаяДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	ПараметрыНачисленияПени.ДоговорКонтрагента КАК ДоговорКонтрагента,
	ПараметрыНачисленияПени.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты
ПОМЕСТИТЬ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
ИЗ
	ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
ГДЕ
	ПараметрыНачисленияПени.ПлановаяДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)

ИНДЕКСИРОВАТЬ ПО
	ПараметрыНачисленияПени.ПлановаяДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета КАК ДатаПараметров,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение КАК Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта КАК Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика
ПОМЕСТИТЬ ДатыПараметровНачисленияПени
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
ГДЕ
	ТаблицаДляРасчетаПеней.ДатаПередачи <> ДАТАВРЕМЯ(1, 1, 1)
	И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты >= ТаблицаДляРасчетаПеней.ДатаПередачи

ОБЪЕДИНИТЬ

ВЫБРАТЬ
	НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ),
	ТаблицаДляРасчетаПеней.ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
ГДЕ
	ТаблицаДляРасчетаПеней.ДатаПередачи <> ДАТАВРЕМЯ(1, 1, 1)
	И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты >= ТаблицаДляРасчетаПеней.ДатаПередачи

ОБЪЕДИНИТЬ

ВЫБРАТЬ
	ПараметрыНачисленияПени.Период,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты КАК ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
		ПО ТаблицаДляРасчетаПеней.ДоговорЛизинга = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ДоговорКонтрагента
			И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
		ПО (ПараметрыНачисленияПени.Период <= ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			И (ПараметрыНачисленияПени.Период >= ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета)
			И (ПараметрыНачисленияПени.ДоговорКонтрагента = ТаблицаДляРасчетаПеней.ДоговорЛизинга)
			И (ВЫБОР
				КОГДА ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты ЕСТЬ NULL
					ТОГДА ПараметрыНачисленияПени.ПлановаяДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ПараметрыНачисленияПени.ПлановаяДатаОплаты = ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты
			КОНЕЦ)
			И (ТаблицаДляРасчетаПеней.ДатаПередачи <> ДАТАВРЕМЯ(1, 1, 1))
			И (ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты >= ТаблицаДляРасчетаПеней.ДатаПередачи)

ИНДЕКСИРОВАТЬ ПО
	ДатаПараметров,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение КАК Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта КАК Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ДатыПараметровНачисленияПени.ДатаПараметров КАК ДатаПараметров
ПОМЕСТИТЬ ИнтервалыРасчетаПенейСДатамиИзмененияПараметровНачисленияПени
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДатыПараметровНачисленияПени КАК ДатыПараметровНачисленияПени
		ПО (ВЫБОР
				КОГДА ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета > ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета
					ТОГДА ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета = ДатыПараметровНачисленияПени.ДатаПараметров
				ИНАЧЕ ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета <= ДатыПараметровНачисленияПени.ДатаПараметров
						И ДатыПараметровНачисленияПени.ДатаПараметров <= ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета
			КОНЕЦ)
			И ТаблицаДляРасчетаПеней.ДоговорЛизинга = ДатыПараметровНачисленияПени.ДоговорЛизинга
			И ТаблицаДляРасчетаПеней.Приложение = ДатыПараметровНачисленияПени.Приложение
			И ТаблицаДляРасчетаПеней.СтатьяГрафика = ДатыПараметровНачисленияПени.СтатьяГрафика
			И ТаблицаДляРасчетаПеней.Валюта = ДатыПараметровНачисленияПени.Валюта
			И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты = ДатыПараметровНачисленияПени.ПлановаяДатаОплаты
			И ТаблицаДляРасчетаПеней.НачислениеВнеГрафика = ДатыПараметровНачисленияПени.НачислениеВнеГрафика

ИНДЕКСИРОВАТЬ ПО
	НачалоИнтервалаРасчета,
	КонецИнтервалаРасчета,
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика,
	ДатаПараметров
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Приложение КАК Приложение,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Валюта КАК Валюта,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров КАК НачалоИнтервалаПараметров,
	МИНИМУМ(ВЫБОР
			КОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета <= КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров, ДЕНЬ)
				ТОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета
			ИНАЧЕ КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров, ДЕНЬ)
		КОНЕЦ) КАК КонецИнтервалаПараметров
ПОМЕСТИТЬ ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПени
ИЗ
	ИнтервалыРасчетаПенейСДатамиИзмененияПараметровНачисленияПени КАК ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ИнтервалыРасчетаПенейСДатамиИзмененияПараметровНачисленияПени КАК ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1
		ПО ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.НачалоИнтервалаРасчета
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.КонецИнтервалаРасчета
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДоговорЛизинга = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДоговорЛизинга
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Приложение = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.Приложение
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.СтатьяГрафика = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.СтатьяГрафика
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Валюта = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.Валюта
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ПлановаяДатаОплаты
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачислениеВнеГрафика = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.НачислениеВнеГрафика
			И (ВЫБОР
				КОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета >= НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета, ДЕНЬ)
					ТОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров
				ИНАЧЕ ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров < ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров
			КОНЕЦ)
ГДЕ
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты <= ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров

СГРУППИРОВАТЬ ПО
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДоговорЛизинга,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Приложение,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.СтатьяГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Валюта,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров

ИНДЕКСИРОВАТЬ ПО
	НачалоИнтервалаРасчета,
	ДоговорЛизинга
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Приложение КАК Приложение,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Валюта КАК Валюта,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаПараметров КАК НачалоИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаПараметров КАК КонецИнтервалаПараметров,
	МАКСИМУМ(ПараметрыНачисленияПени.Период) КАК ПериодПараметров
ПОМЕСТИТЬ ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПениСДатамиПараметров
ИЗ
	ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПени КАК ТаблицаДляРасчетаПенейПоИнтерваламПараметров
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты КАК ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ДоговорКонтрагента
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаПараметров >= ПараметрыНачисленияПени.Период
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга = ПараметрыНачисленияПени.ДоговорКонтрагента
			И (ВЫБОР
				КОГДА ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты ЕСТЬ NULL
					ТОГДА ПараметрыНачисленияПени.ПлановаяДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПени.ПлановаяДатаОплаты
			КОНЕЦ)

СГРУППИРОВАТЬ ПО
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Приложение,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.СтатьяГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Валюта,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаПараметров

ИНДЕКСИРОВАТЬ ПО
	ПериодПараметров,
	ДоговорЛизинга,
	СтатьяГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.Приложение КАК Приложение,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.Валюта КАК Валюта,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.НачалоИнтервалаПараметров КАК НачалоИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.КонецИнтервалаПараметров КАК КонецИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПериодПараметров КАК ПериодПараметров,
	ЕСТЬNULL(ПараметрыНачисленияПени.СтавкаПени, 0) КАК СтавкаПени,
	ЕСТЬNULL(ПараметрыНачисленияПени.ЛьготныйПериод, 0) КАК ЛьготныйПериод
ПОМЕСТИТЬ ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени
ИЗ
	ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПениСДатамиПараметров КАК ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты КАК ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ДоговорЛизинга = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ДоговорКонтрагента
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПериодПараметров = ПараметрыНачисленияПени.Период
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ДоговорЛизинга = ПараметрыНачисленияПени.ДоговорКонтрагента
			И (ВЫБОР
				КОГДА ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты ЕСТЬ NULL
					ТОГДА ПараметрыНачисленияПени.ПлановаяДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПени.ПлановаяДатаОплаты
			КОНЕЦ)
		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ИсключаемыеСтатьи КАК НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи
		ПО (ВЫБОР
				КОГДА &НаборСтатейИсключаемыхИзБазыРасчетаПени = ЗНАЧЕНИЕ(Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ПустаяСсылка)
					ТОГДА ПараметрыНачисленияПени.НаборИсключаемыхСтатей = НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Ссылка
				ИНАЧЕ НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Ссылка = &НаборСтатейИсключаемыхИзБазыРасчетаПени
			КОНЕЦ)
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.СтатьяГрафика = НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья
ГДЕ
	НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья ЕСТЬ NULL

ИНДЕКСИРОВАТЬ ПО
	НачалоИнтервалаРасчета,
	КонецИнтервалаРасчета,
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение КАК Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта КАК Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.НачалоИнтервалаПараметров, ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета) КАК НачалоИнтервалаРасчета,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета) КАК КонецИнтервалаРасчета,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ТаблицаДляРасчетаПеней.ДатаОплаты
		ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1)
	КОНЕЦ КАК ДатаОплаты,
	ТаблицаДляРасчетаПеней.БазаРасчетаПеней КАК БазаРасчетаПеней,
	ТаблицаДляРасчетаПеней.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ТаблицаДляРасчетаПеней.СуммаКонечныйОстаток
		ИНАЧЕ ТаблицаДляРасчетаПеней.СуммаНачальныйОстаток
	КОНЕЦ КАК СуммаКонечныйОстаток,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ТаблицаДляРасчетаПеней.СуммаОплаты
		ИНАЧЕ 0
	КОНЕЦ КАК СуммаОплаты,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.СтавкаПени, 0) КАК СтавкаПени,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.ЛьготныйПериод, 0) КАК ЛьготныйПериод,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		ИНАЧЕ ВЫБОР
				КОГДА ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета) = &КонецПериода
					ТОГДА ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			КОНЕЦ
	КОНЕЦ КАК ДатаИзмененияПараметров
ПОМЕСТИТЬ ТаблицаДляРасчетаПенейСПараметрамиНачисленияПени
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
		ЛЕВОЕ СОЕДИНЕНИЕ ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени КАК ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени
		ПО ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.НачалоИнтервалаРасчета
			И ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаРасчета
			И ТаблицаДляРасчетаПеней.ДоговорЛизинга = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.ДоговорЛизинга
			И ТаблицаДляРасчетаПеней.Приложение = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.Приложение
			И ТаблицаДляРасчетаПеней.СтатьяГрафика = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.СтатьяГрафика
			И ТаблицаДляРасчетаПеней.Валюта = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.Валюта
			И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.ПлановаяДатаОплаты
			И ТаблицаДляРасчетаПеней.НачислениеВнеГрафика = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.НачислениеВнеГрафика

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика,
	НачалоИнтервалаРасчета
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ЕСТЬNULL(ТаблицаВзаиморасчетов.ДоговорЛизинга, ТаблицаДляРасчетаПеней.ДоговорЛизинга) КАК ДоговорЛизинга,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.Приложение, ТаблицаДляРасчетаПеней.Приложение) КАК Приложение,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.СтатьяГрафика, ТаблицаДляРасчетаПеней.СтатьяГрафика) КАК СтатьяГрафика,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.Валюта, ТаблицаДляРасчетаПеней.Валюта) КАК Валюта,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.ПлановаяДатаОплаты, ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты) КАК ПлановаяДатаОплаты,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.НачислениеВнеГрафика, ТаблицаДляРасчетаПеней.НачислениеВнеГрафика) КАК НачислениеВнеГрафика,
	ЕСТЬNULL(ТаблицаДляРасчетаПеней.СуммаНачальныйОстаток, ТаблицаВзаиморасчетов.Сумма) КАК СуммаКОплате,
	ТаблицаВзаиморасчетов.Сумма КАК СуммаНачисленная,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.ЭтоПлатежПоТекущемуГрафику, ИСТИНА) КАК ЭтоПлатежПоТекущемуГрафику,
	ВЫБОР
		КОГДА ТаблицаВзаиморасчетов.ПлановаяДатаОплаты > ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
			ТОГДА ТаблицаВзаиморасчетов.ПлановаяДатаОплаты
		ИНАЧЕ ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
	КОНЕЦ КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.ДатаОплаты КАК ДатаОплаты,
	ТаблицаДляРасчетаПеней.СуммаОплаты КАК СуммаОплаты,
	ТаблицаДляРасчетаПеней.СуммаКонечныйОстаток КАК СуммаОстаток,
	ТаблицаВзаиморасчетов.НомерПлатежа КАК НомерПлатежа,
	ПроизводственныйКалендарь.ПервыйРабочийДень КАК ПервыйРабочийДень,
	ТаблицаПередач.ДатаПередачи КАК ДатаПередачи,
	ВЫБОР
		КОГДА ПроизводственныйКалендарь.ПервыйРабочийДень < ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
			ТОГДА РАЗНОСТЬДАТ(ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
		КОГДА ПроизводственныйКалендарь.ПервыйРабочийДень < ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета
			ТОГДА РАЗНОСТЬДАТ(ПроизводственныйКалендарь.ПервыйРабочийДень, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
		ИНАЧЕ 0
	КОНЕЦ КАК ДнейСкорректированных,
	ВЫБОР
		КОГДА НАЧАЛОПЕРИОДА(ПроизводственныйКалендарь.ПервыйРабочийДень, ДЕНЬ) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоПросроченныйПлатеж,
	ВЫБОР
		КОГДА НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты, ДЕНЬ) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоПросроченныйПлатежПоКалендарнымДням,
	ВЫБОР
		КОГДА НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты, МЕСЯЦ) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, МЕСЯЦ)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоПросроченныйПлатежПереходящийМесяц,
	ТаблицаДляРасчетаПеней.СтавкаПени КАК СтавкаПени,
	ТаблицаДляРасчетаПеней.ЛьготныйПериод КАК ЛьготныйПериод,
	ТаблицаДляРасчетаПеней.БазаРасчетаПеней КАК БазаРасчетаПеней,
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА ДОБАВИТЬКДАТЕ(ПроизводственныйКалендарь.ПервыйРабочийДень, ДЕНЬ, ТаблицаДляРасчетаПеней.ЛьготныйПериод) < ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
				ТОГДА РАЗНОСТЬДАТ(ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			КОГДА ДОБАВИТЬКДАТЕ(ПроизводственныйКалендарь.ПервыйРабочийДень, ДЕНЬ, ТаблицаДляРасчетаПеней.ЛьготныйПериод) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
				ТОГДА РАЗНОСТЬДАТ(ПроизводственныйКалендарь.ПервыйРабочийДень, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			ИНАЧЕ 0
		КОНЕЦ * ВЫБОР
			КОГДА ЕСТЬNULL(ТаблицаДляРасчетаПеней.БазаРасчетаПеней, 0) < 0
				ТОГДА 0
			ИНАЧЕ ЕСТЬNULL(ТаблицаДляРасчетаПеней.БазаРасчетаПеней, 0)
		КОНЕЦ * ТаблицаДляРасчетаПеней.СтавкаПени * 0.01 КАК ЧИСЛО(15, 2)) КАК СуммаПеней,
	ТаблицаДляРасчетаПеней.ДатаИзмененияПараметров КАК ДатаИзмененияПараметров,
	ВЫБОР
		КОГДА ЕСТЬNULL(ТаблицаВзаиморасчетов.СтатьяГрафика, ТаблицаДляРасчетаПеней.СтатьяГрафика) = &СтатьяЛП
			ТОГДА 1
		ИНАЧЕ 2
	КОНЕЦ КАК РазделительСтатейПоОплатеПеней
ПОМЕСТИТЬ ТаблицаРассчитанныхПеней
ИЗ
	ТаблицаНачислений КАК ТаблицаВзаиморасчетов
		ПОЛНОЕ СОЕДИНЕНИЕ ТаблицаДляРасчетаПенейСПараметрамиНачисленияПени КАК ТаблицаДляРасчетаПеней
		ПО ТаблицаВзаиморасчетов.ДоговорЛизинга = ТаблицаДляРасчетаПеней.ДоговорЛизинга
			И ТаблицаВзаиморасчетов.Приложение = ТаблицаДляРасчетаПеней.Приложение
			И ТаблицаВзаиморасчетов.СтатьяГрафика = ТаблицаДляРасчетаПеней.СтатьяГрафика
			И ТаблицаВзаиморасчетов.Валюта = ТаблицаДляРасчетаПеней.Валюта
			И ТаблицаВзаиморасчетов.ПлановаяДатаОплаты = ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты
			И ТаблицаВзаиморасчетов.НачислениеВнеГрафика = ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
		ЛЕВОЕ СОЕДИНЕНИЕ ПроизводственныйКалендарь КАК ПроизводственныйКалендарь
		ПО ТаблицаВзаиморасчетов.ПлановаяДатаОплаты = ПроизводственныйКалендарь.Дата
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаПередач КАК ТаблицаПередач
		ПО ТаблицаВзаиморасчетов.ДоговорЛизинга = ТаблицаПередач.ДоговорЛизинга

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	Валюта,
	КонецИнтервалаРасчета,
	НомерПлатежа
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаРассчитанныхПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаРассчитанныхПеней.Приложение КАК Приложение,
	ТаблицаРассчитанныхПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаРассчитанныхПеней.Валюта КАК Валюта,
	ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаРассчитанныхПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаРассчитанныхПеней.СуммаКОплате КАК СуммаКОплате,
	ТаблицаРассчитанныхПеней.СуммаНачисленная КАК СуммаНачисленная,
	ТаблицаРассчитанныхПеней.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику,
	ТаблицаРассчитанныхПеней.ДатаПередачи КАК ДатаПередачи,
	ТаблицаРассчитанныхПеней.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.ДатаОплаты КАК ДатаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОплаты КАК СуммаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОстаток КАК СуммаОстаток,
	ТаблицаРассчитанныхПеней.НомерПлатежа КАК НомерПлатежа,
	ТаблицаРассчитанныхПеней.ПервыйРабочийДень КАК ПервыйРабочийДень,
	ТаблицаРассчитанныхПеней.ДнейСкорректированных КАК ДнейСкорректированных,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатеж КАК ЭтоПросроченныйПлатеж,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатежПоКалендарнымДням КАК ЭтоПросроченныйПлатежПоКалендарнымДням,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатежПереходящийМесяц КАК ЭтоПросроченныйПлатежПереходящийМесяц,
	ТаблицаРассчитанныхПеней.ДатаИзмененияПараметров КАК ДатаИзмененияПараметров,
	ТаблицаРассчитанныхПеней.СтавкаПени КАК СтавкаПени,
	ТаблицаРассчитанныхПеней.ЛьготныйПериод КАК ЛьготныйПериод,
	ТаблицаРассчитанныхПеней.СуммаПеней КАК СуммаПеней,
	ТаблицаРассчитанныхПеней.РазделительСтатейПоОплатеПеней КАК РазделительСтатейПоОплатеПеней,
	СУММА(ЕСТЬNULL(ТаблицаРассчитанныхПеней1.СуммаПеней, 0)) КАК СуммаПенейНарастающийИтог
ПОМЕСТИТЬ ТаблицаРассчитанныхПенейСНарастающимИтогом
ИЗ
	ТаблицаРассчитанныхПеней КАК ТаблицаРассчитанныхПеней
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаРассчитанныхПеней КАК ТаблицаРассчитанныхПеней1
		ПО ТаблицаРассчитанныхПеней.ДоговорЛизинга = ТаблицаРассчитанныхПеней1.ДоговорЛизинга
			И ТаблицаРассчитанныхПеней.Приложение = ТаблицаРассчитанныхПеней1.Приложение
			И ТаблицаРассчитанныхПеней.Валюта = ТаблицаРассчитанныхПеней1.Валюта
			И (ВЫБОР
				КОГДА ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета = ТаблицаРассчитанныхПеней1.КонецИнтервалаРасчета
					ТОГДА ВЫБОР
							КОГДА ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты = ТаблицаРассчитанныхПеней1.ПлановаяДатаОплаты
								ТОГДА ВЫБОР
										КОГДА ТаблицаРассчитанныхПеней.НачислениеВнеГрафика = ТаблицаРассчитанныхПеней1.НачислениеВнеГрафика
											ТОГДА ТаблицаРассчитанныхПеней.СтатьяГрафика >= ТаблицаРассчитанныхПеней1.СтатьяГрафика
										ИНАЧЕ ТаблицаРассчитанныхПеней.НачислениеВнеГрафика >= ТаблицаРассчитанныхПеней1.НачислениеВнеГрафика
									КОНЕЦ
							ИНАЧЕ ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты >= ТаблицаРассчитанныхПеней1.ПлановаяДатаОплаты
						КОНЕЦ
				ИНАЧЕ ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета >= ТаблицаРассчитанныхПеней1.КонецИнтервалаРасчета
			КОНЕЦ)
			И ТаблицаРассчитанныхПеней.РазделительСтатейПоОплатеПеней = ТаблицаРассчитанныхПеней1.РазделительСтатейПоОплатеПеней

СГРУППИРОВАТЬ ПО
	ТаблицаРассчитанныхПеней.ДоговорЛизинга,
	ТаблицаРассчитанныхПеней.Приложение,
	ТаблицаРассчитанныхПеней.СтатьяГрафика,
	ТаблицаРассчитанныхПеней.Валюта,
	ТаблицаРассчитанныхПеней.НачислениеВнеГрафика,
	ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты,
	ТаблицаРассчитанныхПеней.СуммаКОплате,
	ТаблицаРассчитанныхПеней.СуммаНачисленная,
	ТаблицаРассчитанныхПеней.ЭтоПлатежПоТекущемуГрафику,
	ТаблицаРассчитанныхПеней.ДатаПередачи,
	ТаблицаРассчитанныхПеней.НачалоИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.ДатаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОстаток,
	ТаблицаРассчитанныхПеней.НомерПлатежа,
	ТаблицаРассчитанныхПеней.ПервыйРабочийДень,
	ТаблицаРассчитанныхПеней.ДнейСкорректированных,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатеж,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатежПоКалендарнымДням,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатежПереходящийМесяц,
	ТаблицаРассчитанныхПеней.СтавкаПени,
	ТаблицаРассчитанныхПеней.ЛьготныйПериод,
	ТаблицаРассчитанныхПеней.СуммаПеней,
	ТаблицаРассчитанныхПеней.ДатаИзмененияПараметров,
	ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.РазделительСтатейПоОплатеПеней

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОсновнаяТаблица.ДоговорЛизинга.Владелец КАК Контрагент,
	ОсновнаяТаблица.ДоговорЛизинга КАК ДоговорЛизинга,
	ОсновнаяТаблица.Приложение КАК Приложение,
	ОсновнаяТаблица.СтатьяГрафика КАК Статья,
	ОсновнаяТаблица.Валюта КАК Валюта,
	ОсновнаяТаблица.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ОсновнаяТаблица.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ОсновнаяТаблица.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ОсновнаяТаблица.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ОсновнаяТаблица.ПервыйРабочийДень КАК ПервыйРабочийДень,
	ОсновнаяТаблица.СуммаКОплате КАК СуммаКОплате,
	ОсновнаяТаблица.СуммаНачисленная КАК СуммаНачисленная,
	ОсновнаяТаблица.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафикуПлатежей,
	ОсновнаяТаблица.НомерПлатежа КАК НомерПлатежа,
	ОсновнаяТаблица.ДатаОплаты КАК ДатаОплаты,
	ОсновнаяТаблица.СуммаОплаты КАК СуммаОплаты,
	ОсновнаяТаблица.СуммаОстаток КАК СуммаОстаток,
	ОсновнаяТаблица.ДатаПередачи КАК ДатаПередачи,
	ОсновнаяТаблица.ДнейСкорректированных КАК ДнейСкорректированных,
	ОсновнаяТаблица.ЭтоПросроченныйПлатеж КАК ЭтоПросроченныйПлатеж,
	ОсновнаяТаблица.ЭтоПросроченныйПлатежПоКалендарнымДням КАК ЭтоПросроченныйПлатежПоКалендарнымДням,
	ОсновнаяТаблица.ЭтоПросроченныйПлатежПереходящийМесяц КАК ЭтоПросроченныйПлатежПереходящийМесяц,
	ОсновнаяТаблица.ДатаИзмененияПараметров КАК ДатаИзмененияПараметров,
	ОсновнаяТаблица.СтавкаПени КАК СтавкаПени,
	ОсновнаяТаблица.ЛьготныйПериод КАК ЛьготныйПериод,
	ОсновнаяТаблица.СуммаПеней КАК СуммаПеней,
	ОсновнаяТаблица.СуммаПенейНарастающийИтог КАК СуммаПенейНарастающийИтог,
	МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0)) КАК ОбщаяСуммаОплаченныхПеней,
	ВЫБОР
		КОГДА МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0)) > ОсновнаяТаблица.СуммаПенейНарастающийИтог
			ТОГДА ОсновнаяТаблица.СуммаПеней
		КОГДА ОсновнаяТаблица.СуммаПенейНарастающийИтог - ОсновнаяТаблица.СуммаПеней > МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0))
			ТОГДА 0
		ИНАЧЕ МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0)) - ОсновнаяТаблица.СуммаПенейНарастающийИтог + ОсновнаяТаблица.СуммаПеней
	КОНЕЦ КАК ПениОплачено,
	ВЫБОР
		КОГДА ОсновнаяТаблица.ЭтоПросроченныйПлатеж
			ТОГДА ЕСТЬNULL(СУММА(ТаблицаВзаиморасчетовВесьПериод.ПросроченныйПлатеж), 0) + 1
		ИНАЧЕ 0
	КОНЕЦ КАК ПовторениеПросрочки,
	ОсновнаяТаблица.РазделительСтатейПоОплатеПеней КАК РазделительСтатейПоОплатеПеней
ПОМЕСТИТЬ ВтИтог
ИЗ
	ТаблицаРассчитанныхПенейСНарастающимИтогом КАК ОсновнаяТаблица
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаВзаиморасчетовВесьПериод КАК ТаблицаВзаиморасчетовВесьПериод
		ПО ОсновнаяТаблица.ДоговорЛизинга = ТаблицаВзаиморасчетовВесьПериод.ДоговорЛизинга
			И ОсновнаяТаблица.Приложение = ТаблицаВзаиморасчетовВесьПериод.Приложение
			И ОсновнаяТаблица.СтатьяГрафика = ТаблицаВзаиморасчетовВесьПериод.СтатьяГрафика
			И ОсновнаяТаблица.Валюта = ТаблицаВзаиморасчетовВесьПериод.Валюта
			И ОсновнаяТаблица.ПлановаяДатаОплаты > ТаблицаВзаиморасчетовВесьПериод.ПлановаяДатаОплаты
			И ОсновнаяТаблица.НачислениеВнеГрафика = ТаблицаВзаиморасчетовВесьПериод.НачислениеВнеГрафика
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОплатПенейВесьПериод КАК ОплатыПеней
		ПО ОсновнаяТаблица.ДоговорЛизинга = ОплатыПеней.ДоговорЛизинга
			И ОсновнаяТаблица.Приложение = ОплатыПеней.Приложение
			И ОсновнаяТаблица.Валюта = ОплатыПеней.Валюта
			И ОсновнаяТаблица.РазделительСтатейПоОплатеПеней = ОплатыПеней.РазделительСтатейПоОплатеПеней
ГДЕ
	ОсновнаяТаблица.ПлановаяДатаОплаты МЕЖДУ &НачалоПериода И &КонецПериода

СГРУППИРОВАТЬ ПО
	ОсновнаяТаблица.ДоговорЛизинга.Владелец,
	ОсновнаяТаблица.ДоговорЛизинга,
	ОсновнаяТаблица.Приложение,
	ОсновнаяТаблица.СтатьяГрафика,
	ОсновнаяТаблица.Валюта,
	ОсновнаяТаблица.ДатаПередачи,
	ОсновнаяТаблица.НачислениеВнеГрафика,
	ОсновнаяТаблица.ПлановаяДатаОплаты,
	ОсновнаяТаблица.ЭтоПросроченныйПлатеж,
	ОсновнаяТаблица.ЭтоПросроченныйПлатежПоКалендарнымДням,
	ОсновнаяТаблица.ЭтоПросроченныйПлатежПереходящийМесяц,
	ОсновнаяТаблица.НомерПлатежа,
	ОсновнаяТаблица.ПервыйРабочийДень,
	ОсновнаяТаблица.ДатаОплаты,
	ОсновнаяТаблица.НачалоИнтервалаРасчета,
	ОсновнаяТаблица.СуммаКОплате,
	ОсновнаяТаблица.СуммаНачисленная,
	ОсновнаяТаблица.СуммаПенейНарастающийИтог,
	ОсновнаяТаблица.ЭтоПлатежПоТекущемуГрафику,
	ОсновнаяТаблица.СуммаОплаты,
	ОсновнаяТаблица.СуммаОстаток,
	ОсновнаяТаблица.ДнейСкорректированных,
	ОсновнаяТаблица.СтавкаПени,
	ОсновнаяТаблица.ЛьготныйПериод,
	ОсновнаяТаблица.СуммаПеней,
	ОсновнаяТаблица.ДатаИзмененияПараметров,
	ОсновнаяТаблица.КонецИнтервалаРасчета,
	ОсновнаяТаблица.РазделительСтатейПоОплатеПеней
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	МАКСИМУМ(&ДатаСреза) КАК ДатаАктуальности,
	ВтИтог.Контрагент КАК Контрагент,
	ВтИтог.ДоговорЛизинга.Код КАК ДоговорКод,
	ВтИтог.ДоговорЛизинга.хлНомерДоговора КАК НомерДоговора,
	МАКСИМУМ(ВтИтог.ДатаПередачи) КАК ДатаПередачи
ИЗ
	ВтИтог КАК ВтИтог
ГДЕ
	(ВтИтог.ЭтоПросроченныйПлатежПереходящийМесяц = ИСТИНА
			ИЛИ ВтИтог.ЭтоПросроченныйПлатежПоКалендарнымДням = ИСТИНА
				И НАЧАЛОПЕРИОДА(ВтИтог.КонецИнтервалаРасчета, ДЕНЬ) = НАЧАЛОПЕРИОДА(&КонецПериода, ДЕНЬ)
			ИЛИ ВтИтог.КонецИнтервалаРасчета >= ДОБАВИТЬКДАТЕ(&ДатаСреза, ДЕНЬ, -3))
	И ВтИтог.ПервыйРабочийДень ЕСТЬ НЕ NULL 
	И ВтИтог.СуммаКОплате > 0

СГРУППИРОВАТЬ ПО
	ВтИтог.Контрагент,
	ВтИтог.ДоговорЛизинга.Код,
	ВтИтог.ДоговорЛизинга.хлНомерДоговора"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",24},
{1,"ЭтоВыражение",
{"Pattern"},"В",10},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"#",5a49abd5-936d-4f46-8499-9cb204efe378},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",24}
},
{2,3,0,0,1,1,2,2,
{1,12,
{2,108,3,
{"S","ДоговорЛизинга"},
{"B",0},
{"#",376807bc-0d88-4c06-9eb2-42b72b970afb,25:835194049cc883ef11ec6c91a4bcae3d},0},
{2,109,3,
{"S","НачалоПериода"},
{"B",0},
{"D",20010101000000},0},
{2,110,3,
{"S","КонецПериода"},
{"B",0},
{"D",20230604235959},0},
{2,111,3,
{"S","ДатаСреза"},
{"B",0},
{"D",20230605000000},0},
{2,112,3,
{"S","НаборСтатейИсключаемыхИзБазыРасчетаПени"},
{"B",0},
{"#",c3ec4375-8577-46d5-be3b-185e29cc8b67,17853:00000000000000000000000000000000},0},
{2,113,3,
{"S","НазначениеПени"},
{"B",0},
{"#",6bcdbfc3-84d1-4e5c-8ca9-d8e2b284449a,10672:ab6d3182f5ebc532496b0dcec964ddde},0},
{2,114,3,
{"S","НачалоВеденияУчета"},
{"B",0},
{"D",20010101000000},0},
{2,115,3,
{"S","СтатьяКомпенсацияСтрахования"},
{"B",0},
{"#",6bcdbfc3-84d1-4e5c-8ca9-d8e2b284449a,10672:86c101a9072f8a0e40fec391bb9e00a9},0},
{2,116,3,
{"S","СтатьяЛП"},
{"B",0},
{"#",46acbd87-b2d2-42f3-a9cc-ae9d20da8355,531:b6f2001b78e1182a11de1aad5fa16558},0},
{2,117,3,
{"S","Страна"},
{"B",0},
{"#",4ee4f6c6-683e-4abc-8890-ed6cde5a53cb,33:8ce4d57185730a3b4108effa215d0c81},0},
{2,118,3,
{"S","ШтрафыЗаСтрахование"},
{"B",0},
{"#",46acbd87-b2d2-42f3-a9cc-ae9d20da8355,531:816494049cc883ef11e5523c750d54c3},0},
{2,119,3,
{"S","Статья"},
{"B",0},
{"#",46acbd87-b2d2-42f3-a9cc-ae9d20da8355,531:b6f2001b78e1182a11de1aad5fa16558},0}
},2,119},
{0,0}
}
},
{"N",1},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{2,
{0,"ИмяВарианта",
{"Pattern",
{"S"}
},"Имя варианта",16},
{1,"ТекстКода",
{"Pattern",
{"S"}
},"Текст кода",95}
},
{2,2,0,0,1,1,
{1,0},1,-1},
{0,0}
}
},
{"#",e199ca70-93cf-46ce-a54b-6edc88c3a296,
{#base64:AQE4EgAAAAAAAO+7v3siIyIsM2Q0OGZlYWUtYTljNi00YzVhLWEwOTktOWViNjQ3
NzYzMGM2LA0KezIsDQp7DQp7IlMiLCLQlNC+0LPQvtCy0L7RgNCb0LjQt9C40L3Q
s9CwIn0sDQp7IiMiLDQyMzgwMTlkLTdlNDktNGZjOS05MWRiLWI2Yjk1MWQ1Y2Y4
ZSwNCns1LA0Kew0KeyJTIiwi0J3QsNGH0LDQu9GM0L3QsNGP0KHRgtGA0L7QutCw
In0sDQp7Ik4iLDF9DQp9LA0Kew0KeyJTIiwi0JrQvtC90LXRh9C90LDRj9Ch0YLR
gNC+0LrQsCJ9LA0KeyJOIiwxfQ0KfSwNCnsNCnsiUyIsItCi0LjQv9CX0L3QsNGH
0LXQvdC40Y/QntCx0YrQtdC60YLQsCJ9LA0KeyJUIiwzNzY4MDdiYy0wZDg4LTRj
MDYtOWViMi00MmI3MmI5NzBhZmJ9DQp9LA0Kew0KeyJTIiwi0J/QvtC70Y/QodC4
0L3RhdGA0L7QvdC40LfQsNGG0LjQuCJ9LA0KeyIjIixhY2Y2MTkyZS04MWNhLTQ2
ZWYtOTNhNi01YTY5NjhiNzg2NjMsDQp7OSwNCns0LA0KezAsItCf0L7Qu9C10KHQ
uNC90YXRgNC+0L3QuNC30LDRhtC40LgiLA0KeyJQYXR0ZXJuIiwNCnsiUyJ9DQp9
LCLQn9C+0LvQtSDRgdC40L3RhdGA0L7QvdC40LfQsNGG0LjQuCIsMzF9LA0KezEs
ItCf0L7Qu9C10KHQuNC90YXRgNC+0L3QuNC30LDRhtC40LjQn9GA0LXQtNGB0YLQ
sNCy0LvQtdC90LjQtSIsDQp7IlBhdHRlcm4iLA0KeyJTIn0NCn0sItCf0YDQtdC0
0YHRgtCw0LLQu9C10L3QuNC1IiwzMX0sDQp7Miwi0J/QvtC70LXQodC40L3RhdGA
0L7QvdC40LfQsNGG0LjQuNCi0LjQv9CX0L3QsNGH0LXQvdC40Y8iLA0KeyJQYXR0
ZXJuIiwNCnsiIyIsZjVjNjUwNTAtM2JiYi0xMWQ1LWI5ODgtMDA1MGJhZTBhOTVk
fQ0KfSwi0KLQuNC/INC30L3QsNGH0LXQvdC40Y8iLDIxfSwNCnszLCLQndC+0LzQ
tdGA0JrQvtC70L7QvdC60LjQntGC0LHQvtGA0LAiLA0KeyJQYXR0ZXJuIiwNCnsi
TiIsMTAsMCwxfQ0KfSwi0J3QvtC80LXRgCDQutC+0LvQvtC90LrQuCDRgtCw0LHQ
u9C40YbRiyDQvtGC0LHQvtGA0LAiLDI2fQ0KfSwNCnsyLDQsMCwwLDEsMSwyLDIs
MywzLA0KezEsMSwNCnsyLDAsNCwNCnsiUyIsItGF0LvQndC+0LzQtdGA0JTQvtCz
0L7QstC+0YDQsCJ9LA0KeyJTIiwi0JTQvtCz0L7QstC+0YDQm9C40LfQuNC90LPQ
sC7QndC+0LzQtdGAINC00L7Qs9C+0LLQvtGA0LAifSwNCnsiIyIsZjVjNjUwNTAt
M2JiYi0xMWQ1LWI5ODgtMDA1MGJhZTBhOTVkLA0KeyJQYXR0ZXJuIiwNCnsiUyIs
MTAwLDF9DQp9DQp9LA0KeyJOIiwxfSwwfQ0KfSwzLDB9LA0KezAsMH0NCn0NCn0N
Cn0sDQp7DQp7IlMiLCLQotCw0LHQu9C40YfQvdGL0LnQlNC+0LrRg9C80LXQvdGC
0J7RgtCx0L7RgNCwIn0sDQp7IiMiLGU2MDMxMDNlLWEzMTgtNGVkYy1hMDE0LWIx
YzZjZjk0ZDQ5ZiwNCns4LDEsMTEsDQp7IiMiLCIiLDEsMSwiIyIsItCv0LfRi9C6
INC/0L4g0YPQvNC+0LvRh9Cw0L3QuNGOIiwi0K/Qt9GL0Log0L/QviDRg9C80L7Q
u9GH0LDQvdC40Y4iLDB9LA0KezEyOCw3Mn0sDQp7MH0sMCwNCnswLDB9LA0KezAs
MH0sDQp7MCwwfSwNCnswLDB9LA0KezAsMH0sDQp7MCwwfSwwLDIsMTYsMCwwLDEs
MCwNCnsxNiwxLA0KezEsMSwNCnsiIyIsItCQ0JsgMjUwNzIvMDEtMTQg0JrQl9Cd
In0NCn0sMH0sMSwwLDEsMCwNCnsxNiwwLA0KezEsMSwNCnsiIyIsItCQ0JsgMjY2
MDkvMDEtMTQg0KPQm9CdIn0NCn0sMH0sMiwwLDEsMCwNCnsxNiwwLA0KezEsMSwN
CnsiIyIsItCQ0JsgMjU1MDUvMDItMTQg0JLQoNCWIn0NCn0sMH0sMywwLDEsMCwN
CnsxNiwwLA0KezEsMSwNCnsiIyIsItCQ0JsgMjQxNDQvMDQtMTQg0JrQl9CdIn0N
Cn0sMH0sNCwwLDEsMCwNCnsxNiwwLA0KezEsMSwNCnsiIyIsItCQ0JsgMjYxMDcv
MDItMTQg0J/QndCXIn0NCn0sMH0sNSwwLDEsMCwNCnsxNiwwLA0KezEsMSwNCnsi
IyIsItCQ0JsgMjQ2ODUvMDItMTQg0JXQmtCRIn0NCn0sMH0sNiwwLDEsMCwNCnsx
NiwwLA0KezEsMSwNCnsiIyIsItCQ0JsgMzA5NTkvMDEtMTQg0J3QkdCnIn0NCn0s
MH0sNywwLDEsMCwNCnsxNiwwLA0KezEsMSwNCnsiIyIsItCQ0JsgNzQyNzgvMDEt
MTYg0KHQoNCiIn0NCn0sMH0sOCwwLDEsMCwNCnsxNiwwLA0KezEsMSwNCnsiIyIs
ItCQ0JsgOTI1MDAvMDEtMTcg0KHQnNCgIn0NCn0sMH0sOSwwLDEsMCwNCnsxNiww
LA0KezEsMSwNCnsiIyIsItCQ0JsgOTg3MDgvMDEtMTcg0KLQrtCcIn0NCn0sMH0s
MTAsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDExMTE2OC8wMS0x
OCDQntCg0JEifQ0KfSwwfSwxMSwwLDEsMCwNCnsxNiwwLA0KezEsMSwNCnsiIyIs
ItCQ0JsgMjE3MC8xNC0xOSDQmtCg0KEifQ0KfSwwfSwxMiwwLDEsMCwNCnsxNiww
LA0KezEsMSwNCnsiIyIsItCQ0JsgMTAzODE4LzAyLTE4In0NCn0sMH0sMTMsMCwx
LDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDEwMzgxOC8wMy0xOCJ9DQp9
LDB9LDE0LDAsMSwwLA0KezE2LDAsDQp7MSwxLA0KeyIjIiwi0JDQmyA5Mzk0My8w
Mi0xOCDQotCb0KIifQ0KfSwwfSwxNSwwLDEsMCwNCnsxNiwwLA0KezEsMSwNCnsi
IyIsItCQ0JsgNjY5ODgvMDItMTYg0JHQk9CUIn0NCn0sMH0sDQp7MSwwLDAwMDAw
MDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMCwxLDAsMn0sMTYsMCwwLDAs
MCwwLDAsMCwwLA0KezB9LA0KezB9LA0KezB9LA0KezB9LCIiLA0Kew0KezAsNiw2
LA0KeyJOIiwxMDAwfSw3LA0KeyJOIiwxMDAwfSw4LA0KeyJOIiwxMDAwfSw5LA0K
eyJOIiwxMDAwfSwxMCwNCnsiTiIsMTAwMH0sMTEsDQp7Ik4iLDEwMDB9DQp9DQp9
LA0KezAsLTEsLTEsLTEsLTEsMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAw
MDAwMDAwfSwwLDAsMCwwLDAsMCwwLDEsMCwxLDIsDQp7MjE3NiwyMDEsMn0sDQp7
MTI4LDIxN30sMCwwLDAsMCwzLA0KezMsMywNCnstMX0NCn0sDQp7MywzLA0Key0z
fQ0KfSwNCnszLDMsDQp7LTd9DQp9LDAsMCwwLCIiLDAsDQp7MywwLDAsMTAwLDEs
MSwwLDEsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwiIiwwLDAsMCwwLDAsMCww
fSwNCnswfSwwLDAsMCwxLDAsMH0NCn0NCn0NCn0NCn0NCn0sDQp7DQp7IlMiLCLR
hdC70J3QvtC80LXRgNCU0L7Qs9C+0LLQvtGA0LAifSwNCnsiIyIsNDIzODAxOWQt
N2U0OS00ZmM5LTkxZGItYjZiOTUxZDVjZjhlLA0KezUsDQp7DQp7IlMiLCLQndCw
0YfQsNC70YzQvdCw0Y/QodGC0YDQvtC60LAifSwNCnsiTiIsMH0NCn0sDQp7DQp7
IlMiLCLQmtC+0L3QtdGH0L3QsNGP0KHRgtGA0L7QutCwIn0sDQp7Ik4iLDB9DQp9
LA0Kew0KeyJTIiwi0KLQuNC/0JfQvdCw0YfQtdC90LjRj9Ce0LHRitC10LrRgtCw
In0sDQp7IlUifQ0KfSwNCnsNCnsiUyIsItCf0L7Qu9GP0KHQuNC90YXRgNC+0L3Q
uNC30LDRhtC40LgifSwNCnsiIyIsYWNmNjE5MmUtODFjYS00NmVmLTkzYTYtNWE2
OTY4Yjc4NjYzLA0KezksDQp7NCwNCnswLCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC9
0LjQt9Cw0YbQuNC4IiwNCnsiUGF0dGVybiIsDQp7IlMifQ0KfSwi0J/QvtC70LUg
0YHQuNC90YXRgNC+0L3QuNC30LDRhtC40LgiLDMxfSwNCnsxLCLQn9C+0LvQtdCh
0LjQvdGF0YDQvtC90LjQt9Cw0YbQuNC40J/RgNC10LTRgdGC0LDQstC70LXQvdC4
0LUiLA0KeyJQYXR0ZXJuIiwNCnsiUyJ9DQp9LCLQn9GA0LXQtNGB0YLQsNCy0LvQ
tdC90LjQtSIsMzF9LA0KezIsItCf0L7Qu9C10KHQuNC90YXRgNC+0L3QuNC30LDR
htC40LjQotC40L/Ql9C90LDRh9C10L3QuNGPIiwNCnsiUGF0dGVybiIsDQp7IiMi
LGY1YzY1MDUwLTNiYmItMTFkNS1iOTg4LTAwNTBiYWUwYTk1ZH0NCn0sItCi0LjQ
vyDQt9C90LDRh9C10L3QuNGPIiwyMX0sDQp7Mywi0J3QvtC80LXRgNCa0L7Qu9C+
0L3QutC40J7RgtCx0L7RgNCwIiwNCnsiUGF0dGVybiIsDQp7Ik4iLDEwLDAsMX0N
Cn0sItCd0L7QvNC10YAg0LrQvtC70L7QvdC60Lgg0YLQsNCx0LvQuNGG0Ysg0L7R
gtCx0L7RgNCwIiwyNn0NCn0sDQp7Miw0LDAsMCwxLDEsMiwyLDMsMywNCnsxLDB9
LDMsLTF9LA0KezAsMH0NCn0NCn0NCn0sDQp7DQp7IlMiLCLQotCw0LHQu9C40YfQ
vdGL0LnQlNC+0LrRg9C80LXQvdGC0J7RgtCx0L7RgNCwIn0sDQp7IiMiLGU2MDMx
MDNlLWEzMTgtNGVkYy1hMDE0LWIxYzZjZjk0ZDQ5ZiwNCns4LDEsMTEsDQp7IiMi
LCIiLDEsMSwiIyIsItCv0LfRi9C6INC/0L4g0YPQvNC+0LvRh9Cw0L3QuNGOIiwi
0K/Qt9GL0Log0L/QviDRg9C80L7Qu9GH0LDQvdC40Y4iLDB9LA0KezEyOCw3Mn0s
DQp7MH0sMCwNCnswLDB9LA0KezAsMH0sDQp7MCwwfSwNCnswLDB9LA0KezAsMH0s
DQp7MCwwfSwwLDIsMCwNCnswLDAsMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAw
MDAwMDAwMDAwLDB9LDAsMCwwLDAsMCwwLDAsMCwwLA0KezB9LA0KezB9LA0KezB9
LA0KezB9LCIiLA0Kew0KezAsNiw2LA0KeyJOIiwxMDAwfSw3LA0KeyJOIiwxMDAw
fSw4LA0KeyJOIiwxMDAwfSw5LA0KeyJOIiwxMDAwfSwxMCwNCnsiTiIsMTAwMH0s
MTEsDQp7Ik4iLDEwMDB9DQp9DQp9LA0KezAsLTEsLTEsLTEsLTEsMDAwMDAwMDAt
MDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAwfSwwLDAsMCwwLDAsMCwwLDEsMCwx
LDAsMCwwLDAsMCwyLA0KezMsMywNCnstMX0NCn0sDQp7MywzLA0Key0zfQ0KfSww
LDAsMCwiIiwwLA0KezMsMCwwLDEwMCwxLDEsMCwxLDEsMCwwLDAsMCwwLDAsMCww
LDAsMCwwLDAsIiIsMCwwLDAsMCwwLDAsMH0sDQp7MH0sMCwwLDAsMSwwLDB9DQp9
DQp9DQp9DQp9DQp9DQp9DQp9}
},0},
{2,4,6,
{"S","есть ли просрочка на конец месяца ntcn"},
{"S","ВЫБРАТЬ
	хлПриложениеКДоговоруЛизинга.ДоговорЛизинга КАК ДоговорЛизинга,
	хлПриложениеКДоговоруЛизинга.ДоговорЛизинга.ДоговорКонтрагента КАК ДоговорКонтрагента,
	хлПриложениеКДоговоруЛизинга.Номер КАК НомерПриложения
ПОМЕСТИТЬ ВтВсеДоговоры
ИЗ
	Документ.хлПриложениеКДоговоруЛизинга КАК хлПриложениеКДоговоруЛизинга
ГДЕ
	хлПриложениеКДоговоруЛизинга.хлпДоговорКонтрагента.хлНомерДоговора ПОДОБНО ""АЛ %""
	И НЕ хлПриложениеКДоговоруЛизинга.ПометкаУдаления
	И НЕ хлПриложениеКДоговоруЛизинга.хлпДоговорКонтрагента.ПометкаУдаления
	И НЕ хлПриложениеКДоговоруЛизинга.ДоговорЛизинга.ДоговорКонтрагента.Код ЕСТЬ NULL
	И хлПриложениеКДоговоруЛизинга.ДоговорЛизинга.ДоговорКонтрагента = &ДоговорЛизинга
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПроизводственныеКалендариСтранМира.Дата КАК Дата,
	ВЫБОР
		КОГДА ПроизводственныеКалендариСтранМира.ВидДня = ЗНАЧЕНИЕ(Перечисление.ВидыДнейПроизводственногоКалендаря.Рабочий)
			ТОГДА ИСТИНА
		КОГДА ПроизводственныеКалендариСтранМира.ВидДня = ЗНАЧЕНИЕ(Перечисление.ВидыДнейПроизводственногоКалендаря.Предпраздничный)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоРабочийДень
ПОМЕСТИТЬ КалендарьПолный
ИЗ
	РегистрСведений.хлПроизводственныеКалендариСтранМира КАК ПроизводственныеКалендариСтранМира
ГДЕ
	ПроизводственныеКалендариСтранМира.Страна = &Страна
	И ПроизводственныеКалендариСтранМира.Дата <= &КонецПериода

ИНДЕКСИРОВАТЬ ПО
	Дата
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	КалендарьПолный.Дата КАК Дата
ПОМЕСТИТЬ КалендарьРабочиеДни
ИЗ
	КалендарьПолный КАК КалендарьПолный
ГДЕ
	КалендарьПолный.ЭтоРабочийДень

ИНДЕКСИРОВАТЬ ПО
	Дата
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	КалендарьПолный.Дата КАК Дата,
	МИНИМУМ(ЕСТЬNULL(КалендарьРабочиеДни.Дата, КалендарьПолный.Дата)) КАК ПервыйРабочийДень
ПОМЕСТИТЬ ПроизводственныйКалендарь
ИЗ
	КалендарьПолный КАК КалендарьПолный
		ЛЕВОЕ СОЕДИНЕНИЕ КалендарьРабочиеДни КАК КалендарьРабочиеДни
		ПО (ВЫБОР
				КОГДА КалендарьПолный.ЭтоРабочийДень
					ТОГДА ЛОЖЬ
				ИНАЧЕ КалендарьПолный.Дата <= КалендарьРабочиеДни.Дата
			КОНЕЦ)

СГРУППИРОВАТЬ ПО
	КалендарьПолный.Дата

ИНДЕКСИРОВАТЬ ПО
	Дата
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга.Владелец КАК Контрагент,
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга КАК ДоговорЛизинга,
	МИНИМУМ(ВЫБОР
			КОГДА ПредметыЛизингаВЛизингеОбороты.КоличествоПриход > 0
				ТОГДА ПредметыЛизингаВЛизингеОбороты.Период
		КОНЕЦ) КАК ДатаПередачи
ПОМЕСТИТЬ ТаблицаПередач
ИЗ
	РегистрНакопления.хлПредметыЛизингаВЛизинге.Обороты(
			&НачалоВеденияУчета,
			&КонецПериода,
			День,
			ДоговорЛизинга В
				(ВЫБРАТЬ
					ВтВсеДоговоры.ДоговорКонтрагента
				ИЗ
					ВтВсеДоговоры)) КАК ПредметыЛизингаВЛизингеОбороты

СГРУППИРОВАТЬ ПО
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга,
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга.Владелец

ИНДЕКСИРОВАТЬ ПО
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ КАК ЭтоФакт,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга.Владелец КАК Контрагент,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга КАК ДоговорЛизинга,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Приложение КАК Приложение,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Статья КАК СтатьяГрафика,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Валюта КАК Валюта,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Дата КАК ПлановаяДатаОплаты,
	ЕСТЬNULL(ТаблицаПередач.ДатаПередачи, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаПередачи,
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
		ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
	КОНЕЦ КАК ДатаОплаты,
	СУММА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Сумма) КАК Сумма,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	МАКСИМУМ(ВЫБОР
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
					И (хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика
						ИЛИ хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Регистратор = ТаблицаАктуальныхУтверждений.Регистратор)
				ТОГДА ИСТИНА
			ИНАЧЕ ЛОЖЬ
		КОНЕЦ) КАК ЭтоПлатежПоТекущемуГрафику
ПОМЕСТИТЬ ВзаиморасчетыВесьПериод
ИЗ
	ВтВсеДоговоры КАК ВтВсеДоговоры
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику КАК хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику
			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.хлДанныеУтвержденийГрафиков.СрезПоследних(
					&КонецПериода,
					ВидГрафика = ЗНАЧЕНИЕ(Справочник.хлВидыГрафиков.ГрафикПлатежейПоДоговоруЛизинга)
						И Договор В
							(ВЫБРАТЬ
								ВтВсеДоговоры.ДоговорКонтрагента
							ИЗ
								ВтВсеДоговоры)) КАК ТаблицаАктуальныхУтверждений
			ПО хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга = ТаблицаАктуальныхУтверждений.Договор
				И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Приложение = ТаблицаАктуальныхУтверждений.Приложение
				И (хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход))
			ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаПередач КАК ТаблицаПередач
			ПО хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга = ТаблицаПередач.ДоговорЛизинга
		ПО ВтВсеДоговоры.ДоговорКонтрагента = хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга
ГДЕ
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Активность
	И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период <= &КонецПериода
	И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Дата <= &ДатаСреза
	И ВЫБОР
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
					И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
				ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
			ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
		КОНЕЦ <= &КонецПериода
	И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Статья = &Статья
	И ВЫБОР
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
				ТОГДА ДАТАВРЕМЯ(1, 1, 1)
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
				ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
			ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
		КОНЕЦ <= &ДатаСреза

СГРУППИРОВАТЬ ПО
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Валюта,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга.Владелец,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Статья,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Приложение,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Дата,
	ЕСТЬNULL(ТаблицаПередач.ДатаПередачи, ДАТАВРЕМЯ(1, 1, 1)),
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
		ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
	КОНЕЦ

ИМЕЮЩИЕ
	СУММА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Сумма) <> 0

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика,
	ДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение КАК Приложение,
	ВзаиморасчетыВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ВзаиморасчетыВесьПериод.Валюта КАК Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.Сумма КАК Сумма,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ВзаиморасчетыВесьПериод.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику
ПОМЕСТИТЬ ТаблицаНачисленийВесьПериод
ИЗ
	ВзаиморасчетыВесьПериод КАК ВзаиморасчетыВесьПериод
ГДЕ
	ВзаиморасчетыВесьПериод.ЭтоФакт = ЛОЖЬ

ИНДЕКСИРОВАТЬ ПО
	ВзаиморасчетыВесьПериод.ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение,
	ВзаиморасчетыВесьПериод.СтатьяГрафика,
	ВзаиморасчетыВесьПериод.Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение КАК Приложение,
	ВзаиморасчетыВесьПериод.Валюта КАК Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.ДатаПередачи КАК ДатаПередачи,
	ВзаиморасчетыВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ВзаиморасчетыВесьПериод.ДатаОплаты КАК ДатаОплаты,
	ВзаиморасчетыВесьПериод.Сумма КАК СуммаОплаты,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика
ПОМЕСТИТЬ ТаблицаОплатВесьПериод
ИЗ
	ВзаиморасчетыВесьПериод КАК ВзаиморасчетыВесьПериод
ГДЕ
	ВзаиморасчетыВесьПериод.ЭтоФакт = ИСТИНА

ИНДЕКСИРОВАТЬ ПО
	ВзаиморасчетыВесьПериод.ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение,
	ВзаиморасчетыВесьПериод.СтатьяГрафика,
	ВзаиморасчетыВесьПериод.Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика,
	ВзаиморасчетыВесьПериод.ДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаОплатВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение КАК Приложение,
	ТаблицаОплатВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаОплатВесьПериод.Валюта КАК Валюта,
	ТаблицаОплатВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаОплатВесьПериод.ДатаПередачи КАК ДатаПередачи,
	ТаблицаОплатВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	МАКСИМУМ(ВЫБОР
			КОГДА ТаблицаОплатВесьПериодДляОстатков.ДатаОплаты >= ТаблицаОплатВесьПериод.ДатаОплаты
				ТОГДА ТаблицаОплатВесьПериод.ПлановаяДатаОплаты
			ИНАЧЕ ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.ДатаОплаты, ТаблицаОплатВесьПериод.ПлановаяДатаОплаты)
		КОНЕЦ) КАК НачалоИнтервалаРасчета,
	ТаблицаОплатВесьПериод.ДатаОплаты КАК ДатаОплаты,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.ЭтоФакт, ЛОЖЬ) = ЛОЖЬ
				ТОГДА 1
			ИНАЧЕ -1
		КОНЕЦ * ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.Сумма, 0)) + ТаблицаОплатВесьПериод.СуммаОплаты КАК СуммаНачальныйОстаток,
	ТаблицаОплатВесьПериод.СуммаОплаты КАК СуммаОплаты,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.ЭтоФакт, ЛОЖЬ) = ЛОЖЬ
				ТОГДА 1
			ИНАЧЕ -1
		КОНЕЦ * ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.Сумма, 0)) КАК СуммаКонечныйОстаток
ПОМЕСТИТЬ ТаблицаОплатСОстаткамиВесьПериод
ИЗ
	ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ ВзаиморасчетыВесьПериод КАК ТаблицаОплатВесьПериодДляОстатков
		ПО ТаблицаОплатВесьПериод.ДоговорЛизинга = ТаблицаОплатВесьПериодДляОстатков.ДоговорЛизинга
			И ТаблицаОплатВесьПериод.Приложение = ТаблицаОплатВесьПериодДляОстатков.Приложение
			И ТаблицаОплатВесьПериод.СтатьяГрафика = ТаблицаОплатВесьПериодДляОстатков.СтатьяГрафика
			И ТаблицаОплатВесьПериод.Валюта = ТаблицаОплатВесьПериодДляОстатков.Валюта
			И ТаблицаОплатВесьПериод.ПлановаяДатаОплаты = ТаблицаОплатВесьПериодДляОстатков.ПлановаяДатаОплаты
			И ТаблицаОплатВесьПериод.НачислениеВнеГрафика = ТаблицаОплатВесьПериодДляОстатков.НачислениеВнеГрафика
			И ТаблицаОплатВесьПериод.ДатаОплаты >= ТаблицаОплатВесьПериодДляОстатков.ДатаОплаты

СГРУППИРОВАТЬ ПО
	ТаблицаОплатВесьПериод.Валюта,
	ТаблицаОплатВесьПериод.СтатьяГрафика,
	ТаблицаОплатВесьПериод.ПлановаяДатаОплаты,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.СуммаОплаты,
	ТаблицаОплатВесьПериод.ДатаОплаты,
	ТаблицаОплатВесьПериод.ДатаПередачи,
	ТаблицаОплатВесьПериод.НачислениеВнеГрафика

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика,
	ДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыВесьПериодОстатки.ДоговорЛизинга КАК ДоговорЛизинга,
	ВзаиморасчетыВесьПериодОстатки.Приложение КАК Приложение,
	ВзаиморасчетыВесьПериодОстатки.СтатьяГрафика КАК СтатьяГрафика,
	ВзаиморасчетыВесьПериодОстатки.Валюта КАК Валюта,
	ВзаиморасчетыВесьПериодОстатки.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериодОстатки.ДатаПередачи КАК ДатаПередачи,
	ВзаиморасчетыВесьПериодОстатки.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) КАК СуммаОстаток,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) КАК СуммаОстаток1,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) КАК СуммаОстаток2
ПОМЕСТИТЬ ТаблицаОстатков
ИЗ
	ВзаиморасчетыВесьПериод КАК ВзаиморасчетыВесьПериодОстатки

СГРУППИРОВАТЬ ПО
	ВзаиморасчетыВесьПериодОстатки.ДоговорЛизинга,
	ВзаиморасчетыВесьПериодОстатки.Приложение,
	ВзаиморасчетыВесьПериодОстатки.СтатьяГрафика,
	ВзаиморасчетыВесьПериодОстатки.Валюта,
	ВзаиморасчетыВесьПериодОстатки.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериодОстатки.ДатаПередачи,
	ВзаиморасчетыВесьПериодОстатки.НачислениеВнеГрафика

ИМЕЮЩИЕ
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) <> 0

ИНДЕКСИРОВАТЬ ПО
	ВзаиморасчетыВесьПериодОстатки.ДоговорЛизинга,
	ВзаиморасчетыВесьПериодОстатки.Приложение,
	ВзаиморасчетыВесьПериодОстатки.СтатьяГрафика,
	ВзаиморасчетыВесьПериодОстатки.Валюта,
	ВзаиморасчетыВесьПериодОстатки.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериодОстатки.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ ПЕРВЫЕ 1
	НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья КАК СтатьяКомпенсация
ПОМЕСТИТЬ врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях
ИЗ
	Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ИсключаемыеСтатьи КАК НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи
ГДЕ
	ВЫБОР
			КОГДА &НаборСтатейИсключаемыхИзБазыРасчетаПени = ЗНАЧЕНИЕ(Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ПустаяСсылка)
				ТОГДА ИСТИНА
			ИНАЧЕ НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Ссылка = &НаборСтатейИсключаемыхИзБазыРасчетаПени
		КОНЕЦ
	И НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья = &СтатьяКомпенсацияСтрахования
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаОплатВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение КАК Приложение,
	ТаблицаОплатВесьПериод.Валюта КАК Валюта,
	СУММА(ТаблицаОплатВесьПериод.СуммаОплаты) КАК СуммаОплаты,
	1 КАК РазделительСтатейПоОплатеПеней
ПОМЕСТИТЬ ТаблицаОплатПенейВесьПериод
ИЗ
	ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.хлНазначенияОбъектов КАК НазначенияОбъектов
		ПО ТаблицаОплатВесьПериод.СтатьяГрафика = НазначенияОбъектов.Объект
			И (НазначенияОбъектов.Назначение = &НазначениеПени)
ГДЕ
	НазначенияОбъектов.Назначение = &НазначениеПени

СГРУППИРОВАТЬ ПО
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.Валюта

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.Валюта,
	СУММА(ТаблицаОплатВесьПериод.СуммаОплаты),
	2
ИЗ
	ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях КАК врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях
		ПО (ИСТИНА)
ГДЕ
	ТаблицаОплатВесьПериод.СтатьяГрафика = &ШтрафыЗаСтрахование
	И врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях.СтатьяКомпенсация ЕСТЬ NULL

СГРУППИРОВАТЬ ПО
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.Валюта
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение КАК Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта КАК Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.Сумма КАК Сумма,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику,
	СУММА(ТаблицаОплатВесьПериод.СуммаОплаты) КАК СуммаОплаты,
	МАКСИМУМ(ТаблицаОплатВесьПериод.ДатаОплаты) КАК ДатаОплаты,
	ВЫБОР
		КОГДА МАКСИМУМ(ТаблицаОплатВесьПериод.ДатаОплаты) ЕСТЬ NULL
				ИЛИ ТаблицаНачисленийВесьПериод.Сумма - ЕСТЬNULL(СУММА(ТаблицаОплатВесьПериод.СуммаОплаты), 0) > 0
				ИЛИ РАЗНОСТЬДАТ(ПроизводственныйКалендарь.ПервыйРабочийДень, МАКСИМУМ(ТаблицаОплатВесьПериод.ДатаОплаты), ДЕНЬ) > 0
			ТОГДА 1
		ИНАЧЕ 0
	КОНЕЦ КАК ПросроченныйПлатеж
ПОМЕСТИТЬ ТаблицаВзаиморасчетовВесьПериод
ИЗ
	ТаблицаНачисленийВесьПериод КАК ТаблицаНачисленийВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ПО ТаблицаНачисленийВесьПериод.ДоговорЛизинга = ТаблицаОплатВесьПериод.ДоговорЛизинга
			И ТаблицаНачисленийВесьПериод.Приложение = ТаблицаОплатВесьПериод.Приложение
			И ТаблицаНачисленийВесьПериод.СтатьяГрафика = ТаблицаОплатВесьПериод.СтатьяГрафика
			И ТаблицаНачисленийВесьПериод.Валюта = ТаблицаОплатВесьПериод.Валюта
			И ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты = ТаблицаОплатВесьПериод.ПлановаяДатаОплаты
			И ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика = ТаблицаОплатВесьПериод.НачислениеВнеГрафика
		ЛЕВОЕ СОЕДИНЕНИЕ ПроизводственныйКалендарь КАК ПроизводственныйКалендарь
		ПО ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты = ПроизводственныйКалендарь.Дата

СГРУППИРОВАТЬ ПО
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.Сумма,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику,
	ПроизводственныйКалендарь.ПервыйРабочийДень

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение КАК Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта КАК Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.Сумма КАК Сумма,
	КОЛИЧЕСТВО(ТаблицаНачисленийВесьПериодДляНомераПлатежа.ПлановаяДатаОплаты) КАК НомерПлатежа,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику
ПОМЕСТИТЬ ТаблицаНачислений
ИЗ
	ТаблицаНачисленийВесьПериод КАК ТаблицаНачисленийВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаНачисленийВесьПериод КАК ТаблицаНачисленийВесьПериодДляНомераПлатежа
		ПО ТаблицаНачисленийВесьПериод.ДоговорЛизинга = ТаблицаНачисленийВесьПериодДляНомераПлатежа.ДоговорЛизинга
			И ТаблицаНачисленийВесьПериод.Приложение = ТаблицаНачисленийВесьПериодДляНомераПлатежа.Приложение
			И ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты >= ТаблицаНачисленийВесьПериодДляНомераПлатежа.ПлановаяДатаОплаты
			И ТаблицаНачисленийВесьПериод.СтатьяГрафика = ТаблицаНачисленийВесьПериодДляНомераПлатежа.СтатьяГрафика
			И ТаблицаНачисленийВесьПериод.Валюта = ТаблицаНачисленийВесьПериодДляНомераПлатежа.Валюта
			И (НЕ ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика
				ИЛИ ТаблицаНачисленийВесьПериод.СтатьяГрафика = &СтатьяЛП)

СГРУППИРОВАТЬ ПО
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.Сумма,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОплатыИОстатки.ДоговорЛизинга КАК ДоговорЛизинга,
	ОплатыИОстатки.Приложение КАК Приложение,
	ОплатыИОстатки.СтатьяГрафика КАК СтатьяГрафика,
	ОплатыИОстатки.Валюта КАК Валюта,
	ОплатыИОстатки.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ОплатыИОстатки.ДатаПередачи КАК ДатаПередачи,
	ОплатыИОстатки.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ОплатыИОстатки.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	КОНЕЦПЕРИОДА(ОплатыИОстатки.КонецИнтервалаРасчета, ДЕНЬ) КАК КонецИнтервалаРасчета,
	ЕСТЬNULL(ОплатыИОстатки.ДатаОплаты, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаОплаты,
	ОплатыИОстатки.БазаРасчетаПеней КАК БазаРасчетаПеней,
	ОплатыИОстатки.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
	ОплатыИОстатки.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток,
	ОплатыИОстатки.СуммаОплаты КАК СуммаОплаты
ПОМЕСТИТЬ ТаблицаДляРасчетаПеней
ИЗ
	(ВЫБРАТЬ
		Оплаты.ДоговорЛизинга КАК ДоговорЛизинга,
		Оплаты.Приложение КАК Приложение,
		Оплаты.СтатьяГрафика КАК СтатьяГрафика,
		Оплаты.Валюта КАК Валюта,
		Оплаты.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
		Оплаты.ДатаПередачи КАК ДатаПередачи,
		Оплаты.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
		Оплаты.ДатаОплаты КАК КонецИнтервалаРасчета,
		Оплаты.ДатаОплаты КАК ДатаОплаты,
		Оплаты.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
		Оплаты.СуммаНачальныйОстаток КАК БазаРасчетаПеней,
		Оплаты.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
		Оплаты.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток,
		Оплаты.СуммаОплаты КАК СуммаОплаты
	ИЗ
		ТаблицаОплатСОстаткамиВесьПериод КАК Оплаты
	ГДЕ
		Оплаты.ДатаОплаты <= &КонецПериода
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		Остатки.ДоговорЛизинга,
		Остатки.Приложение,
		Остатки.СтатьяГрафика,
		Остатки.Валюта,
		Остатки.ПлановаяДатаОплаты,
		Остатки.ДатаПередачи,
		ЕСТЬNULL(МАКСИМУМ(Оплаты.ДатаОплаты), Остатки.ПлановаяДатаОплаты),
		&КонецПериода,
		NULL,
		Остатки.НачислениеВнеГрафика,
		Остатки.СуммаОстаток,
		Остатки.СуммаОстаток1,
		Остатки.СуммаОстаток2,
		0
	ИЗ
		ТаблицаОстатков КАК Остатки
			ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОплатВесьПериод КАК Оплаты
			ПО (Оплаты.ДоговорЛизинга = Остатки.ДоговорЛизинга)
				И (Оплаты.Приложение = Остатки.Приложение)
				И (Оплаты.СтатьяГрафика = Остатки.СтатьяГрафика)
				И (Оплаты.Валюта = Остатки.Валюта)
				И (Оплаты.ПлановаяДатаОплаты = Остатки.ПлановаяДатаОплаты)
				И (Оплаты.НачислениеВнеГрафика = Остатки.НачислениеВнеГрафика)
				И (Оплаты.ДатаОплаты <= &КонецПериода)
	ГДЕ
		Остатки.СуммаОстаток > 0
	
	СГРУППИРОВАТЬ ПО
		Остатки.ДоговорЛизинга,
		Остатки.Приложение,
		Остатки.СтатьяГрафика,
		Остатки.Валюта,
		Остатки.ПлановаяДатаОплаты,
		Остатки.ДатаПередачи,
		Остатки.НачислениеВнеГрафика,
		Остатки.СуммаОстаток,
		Остатки.СуммаОстаток1,
		Остатки.СуммаОстаток2) КАК ОплатыИОстатки

СГРУППИРОВАТЬ ПО
	ОплатыИОстатки.Приложение,
	ОплатыИОстатки.Валюта,
	ОплатыИОстатки.ПлановаяДатаОплаты,
	ОплатыИОстатки.ДатаПередачи,
	ОплатыИОстатки.НачалоИнтервалаРасчета,
	ОплатыИОстатки.НачислениеВнеГрафика,
	ОплатыИОстатки.ДоговорЛизинга,
	ОплатыИОстатки.СтатьяГрафика,
	ОплатыИОстатки.КонецИнтервалаРасчета,
	ОплатыИОстатки.ДатаОплаты,
	ОплатыИОстатки.СуммаНачальныйОстаток,
	ОплатыИОстатки.СуммаКонечныйОстаток,
	ОплатыИОстатки.СуммаОплаты,
	ОплатыИОстатки.БазаРасчетаПеней

ИНДЕКСИРОВАТЬ ПО
	ОплатыИОстатки.ДоговорЛизинга,
	ОплатыИОстатки.Приложение,
	ОплатыИОстатки.СтатьяГрафика,
	ОплатыИОстатки.Валюта,
	ОплатыИОстатки.ПлановаяДатаОплаты,
	ОплатыИОстатки.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПараметрыНачисленияПениПоДоговорамЛизинга.Период КАК Период,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ДоговорКонтрагента КАК ДоговорКонтрагента,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ПараметрыНачисленияПениПоДоговорамЛизинга.НаборИсключаемыхСтатей КАК НаборИсключаемыхСтатей,
	ПараметрыНачисленияПениПоДоговорамЛизинга.СтавкаПени КАК СтавкаПени,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ЛьготныйПериод КАК ЛьготныйПериод
ПОМЕСТИТЬ ПараметрыНачисленияПени
ИЗ
	РегистрСведений.хлПараметрыНачисленияПениПоДоговорамЛизинга КАК ПараметрыНачисленияПениПоДоговорамЛизинга
ГДЕ
	ПараметрыНачисленияПениПоДоговорамЛизинга.ДоговорКонтрагента В
			(ВЫБРАТЬ
				ВтВсеДоговоры.ДоговорКонтрагента
			ИЗ
				ВтВсеДоговоры)

ИНДЕКСИРОВАТЬ ПО
	ПараметрыНачисленияПениПоДоговорамЛизинга.Период,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ДоговорКонтрагента,
	НаборИсключаемыхСтатей,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ПлановаяДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	ПараметрыНачисленияПени.ДоговорКонтрагента КАК ДоговорКонтрагента,
	ПараметрыНачисленияПени.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты
ПОМЕСТИТЬ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
ИЗ
	ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
ГДЕ
	ПараметрыНачисленияПени.ПлановаяДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)

ИНДЕКСИРОВАТЬ ПО
	ПараметрыНачисленияПени.ПлановаяДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета КАК ДатаПараметров,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение КАК Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта КАК Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика
ПОМЕСТИТЬ ДатыПараметровНачисленияПени
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
ГДЕ
	ТаблицаДляРасчетаПеней.ДатаПередачи <> ДАТАВРЕМЯ(1, 1, 1)
	И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты >= ТаблицаДляРасчетаПеней.ДатаПередачи

ОБЪЕДИНИТЬ

ВЫБРАТЬ
	НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ),
	ТаблицаДляРасчетаПеней.ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
ГДЕ
	ТаблицаДляРасчетаПеней.ДатаПередачи <> ДАТАВРЕМЯ(1, 1, 1)
	И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты >= ТаблицаДляРасчетаПеней.ДатаПередачи

ОБЪЕДИНИТЬ

ВЫБРАТЬ
	ПараметрыНачисленияПени.Период,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты КАК ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
		ПО ТаблицаДляРасчетаПеней.ДоговорЛизинга = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ДоговорКонтрагента
			И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
		ПО (ПараметрыНачисленияПени.Период <= ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			И (ПараметрыНачисленияПени.Период >= ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета)
			И (ПараметрыНачисленияПени.ДоговорКонтрагента = ТаблицаДляРасчетаПеней.ДоговорЛизинга)
			И (ВЫБОР
				КОГДА ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты ЕСТЬ NULL
					ТОГДА ПараметрыНачисленияПени.ПлановаяДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ПараметрыНачисленияПени.ПлановаяДатаОплаты = ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты
			КОНЕЦ)
			И (ТаблицаДляРасчетаПеней.ДатаПередачи <> ДАТАВРЕМЯ(1, 1, 1))
			И (ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты >= ТаблицаДляРасчетаПеней.ДатаПередачи)

ИНДЕКСИРОВАТЬ ПО
	ДатаПараметров,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение КАК Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта КАК Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ДатыПараметровНачисленияПени.ДатаПараметров КАК ДатаПараметров
ПОМЕСТИТЬ ИнтервалыРасчетаПенейСДатамиИзмененияПараметровНачисленияПени
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДатыПараметровНачисленияПени КАК ДатыПараметровНачисленияПени
		ПО (ВЫБОР
				КОГДА ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета > ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета
					ТОГДА ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета = ДатыПараметровНачисленияПени.ДатаПараметров
				ИНАЧЕ ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета <= ДатыПараметровНачисленияПени.ДатаПараметров
						И ДатыПараметровНачисленияПени.ДатаПараметров <= ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета
			КОНЕЦ)
			И ТаблицаДляРасчетаПеней.ДоговорЛизинга = ДатыПараметровНачисленияПени.ДоговорЛизинга
			И ТаблицаДляРасчетаПеней.Приложение = ДатыПараметровНачисленияПени.Приложение
			И ТаблицаДляРасчетаПеней.СтатьяГрафика = ДатыПараметровНачисленияПени.СтатьяГрафика
			И ТаблицаДляРасчетаПеней.Валюта = ДатыПараметровНачисленияПени.Валюта
			И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты = ДатыПараметровНачисленияПени.ПлановаяДатаОплаты
			И ТаблицаДляРасчетаПеней.НачислениеВнеГрафика = ДатыПараметровНачисленияПени.НачислениеВнеГрафика

ИНДЕКСИРОВАТЬ ПО
	НачалоИнтервалаРасчета,
	КонецИнтервалаРасчета,
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика,
	ДатаПараметров
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Приложение КАК Приложение,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Валюта КАК Валюта,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров КАК НачалоИнтервалаПараметров,
	МИНИМУМ(ВЫБОР
			КОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета <= КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров, ДЕНЬ)
				ТОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета
			ИНАЧЕ КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров, ДЕНЬ)
		КОНЕЦ) КАК КонецИнтервалаПараметров
ПОМЕСТИТЬ ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПени
ИЗ
	ИнтервалыРасчетаПенейСДатамиИзмененияПараметровНачисленияПени КАК ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ИнтервалыРасчетаПенейСДатамиИзмененияПараметровНачисленияПени КАК ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1
		ПО ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.НачалоИнтервалаРасчета
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.КонецИнтервалаРасчета
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДоговорЛизинга = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДоговорЛизинга
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Приложение = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.Приложение
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.СтатьяГрафика = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.СтатьяГрафика
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Валюта = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.Валюта
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ПлановаяДатаОплаты
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачислениеВнеГрафика = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.НачислениеВнеГрафика
			И (ВЫБОР
				КОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета >= НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета, ДЕНЬ)
					ТОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров
				ИНАЧЕ ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров < ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров
			КОНЕЦ)
ГДЕ
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты <= ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров

СГРУППИРОВАТЬ ПО
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДоговорЛизинга,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Приложение,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.СтатьяГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Валюта,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров

ИНДЕКСИРОВАТЬ ПО
	НачалоИнтервалаРасчета,
	ДоговорЛизинга
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Приложение КАК Приложение,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Валюта КАК Валюта,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаПараметров КАК НачалоИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаПараметров КАК КонецИнтервалаПараметров,
	МАКСИМУМ(ПараметрыНачисленияПени.Период) КАК ПериодПараметров
ПОМЕСТИТЬ ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПениСДатамиПараметров
ИЗ
	ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПени КАК ТаблицаДляРасчетаПенейПоИнтерваламПараметров
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты КАК ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ДоговорКонтрагента
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаПараметров >= ПараметрыНачисленияПени.Период
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга = ПараметрыНачисленияПени.ДоговорКонтрагента
			И (ВЫБОР
				КОГДА ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты ЕСТЬ NULL
					ТОГДА ПараметрыНачисленияПени.ПлановаяДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПени.ПлановаяДатаОплаты
			КОНЕЦ)

СГРУППИРОВАТЬ ПО
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Приложение,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.СтатьяГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Валюта,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаПараметров

ИНДЕКСИРОВАТЬ ПО
	ПериодПараметров,
	ДоговорЛизинга,
	СтатьяГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.Приложение КАК Приложение,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.Валюта КАК Валюта,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.НачалоИнтервалаПараметров КАК НачалоИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.КонецИнтервалаПараметров КАК КонецИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПериодПараметров КАК ПериодПараметров,
	ЕСТЬNULL(ПараметрыНачисленияПени.СтавкаПени, 0) КАК СтавкаПени,
	ЕСТЬNULL(ПараметрыНачисленияПени.ЛьготныйПериод, 0) КАК ЛьготныйПериод
ПОМЕСТИТЬ ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени
ИЗ
	ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПениСДатамиПараметров КАК ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты КАК ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ДоговорЛизинга = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ДоговорКонтрагента
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПериодПараметров = ПараметрыНачисленияПени.Период
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ДоговорЛизинга = ПараметрыНачисленияПени.ДоговорКонтрагента
			И (ВЫБОР
				КОГДА ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты ЕСТЬ NULL
					ТОГДА ПараметрыНачисленияПени.ПлановаяДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПени.ПлановаяДатаОплаты
			КОНЕЦ)
		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ИсключаемыеСтатьи КАК НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи
		ПО (ВЫБОР
				КОГДА &НаборСтатейИсключаемыхИзБазыРасчетаПени = ЗНАЧЕНИЕ(Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ПустаяСсылка)
					ТОГДА ПараметрыНачисленияПени.НаборИсключаемыхСтатей = НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Ссылка
				ИНАЧЕ НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Ссылка = &НаборСтатейИсключаемыхИзБазыРасчетаПени
			КОНЕЦ)
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.СтатьяГрафика = НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья
ГДЕ
	НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья ЕСТЬ NULL

ИНДЕКСИРОВАТЬ ПО
	НачалоИнтервалаРасчета,
	КонецИнтервалаРасчета,
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение КАК Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта КАК Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.НачалоИнтервалаПараметров, ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета) КАК НачалоИнтервалаРасчета,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета) КАК КонецИнтервалаРасчета,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ТаблицаДляРасчетаПеней.ДатаОплаты
		ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1)
	КОНЕЦ КАК ДатаОплаты,
	ТаблицаДляРасчетаПеней.БазаРасчетаПеней КАК БазаРасчетаПеней,
	ТаблицаДляРасчетаПеней.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ТаблицаДляРасчетаПеней.СуммаКонечныйОстаток
		ИНАЧЕ ТаблицаДляРасчетаПеней.СуммаНачальныйОстаток
	КОНЕЦ КАК СуммаКонечныйОстаток,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ТаблицаДляРасчетаПеней.СуммаОплаты
		ИНАЧЕ 0
	КОНЕЦ КАК СуммаОплаты,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.СтавкаПени, 0) КАК СтавкаПени,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.ЛьготныйПериод, 0) КАК ЛьготныйПериод,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		ИНАЧЕ ВЫБОР
				КОГДА ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета) = &КонецПериода
					ТОГДА ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			КОНЕЦ
	КОНЕЦ КАК ДатаИзмененияПараметров
ПОМЕСТИТЬ ТаблицаДляРасчетаПенейСПараметрамиНачисленияПени
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
		ЛЕВОЕ СОЕДИНЕНИЕ ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени КАК ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени
		ПО ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.НачалоИнтервалаРасчета
			И ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаРасчета
			И ТаблицаДляРасчетаПеней.ДоговорЛизинга = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.ДоговорЛизинга
			И ТаблицаДляРасчетаПеней.Приложение = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.Приложение
			И ТаблицаДляРасчетаПеней.СтатьяГрафика = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.СтатьяГрафика
			И ТаблицаДляРасчетаПеней.Валюта = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.Валюта
			И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.ПлановаяДатаОплаты
			И ТаблицаДляРасчетаПеней.НачислениеВнеГрафика = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.НачислениеВнеГрафика

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика,
	НачалоИнтервалаРасчета
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ЕСТЬNULL(ТаблицаВзаиморасчетов.ДоговорЛизинга, ТаблицаДляРасчетаПеней.ДоговорЛизинга) КАК ДоговорЛизинга,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.Приложение, ТаблицаДляРасчетаПеней.Приложение) КАК Приложение,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.СтатьяГрафика, ТаблицаДляРасчетаПеней.СтатьяГрафика) КАК СтатьяГрафика,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.Валюта, ТаблицаДляРасчетаПеней.Валюта) КАК Валюта,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.ПлановаяДатаОплаты, ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты) КАК ПлановаяДатаОплаты,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.НачислениеВнеГрафика, ТаблицаДляРасчетаПеней.НачислениеВнеГрафика) КАК НачислениеВнеГрафика,
	ЕСТЬNULL(ТаблицаДляРасчетаПеней.СуммаНачальныйОстаток, ТаблицаВзаиморасчетов.Сумма) КАК СуммаКОплате,
	ТаблицаВзаиморасчетов.Сумма КАК СуммаНачисленная,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.ЭтоПлатежПоТекущемуГрафику, ИСТИНА) КАК ЭтоПлатежПоТекущемуГрафику,
	ВЫБОР
		КОГДА ТаблицаВзаиморасчетов.ПлановаяДатаОплаты > ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
			ТОГДА ТаблицаВзаиморасчетов.ПлановаяДатаОплаты
		ИНАЧЕ ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
	КОНЕЦ КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.ДатаОплаты КАК ДатаОплаты,
	ТаблицаДляРасчетаПеней.СуммаОплаты КАК СуммаОплаты,
	ТаблицаДляРасчетаПеней.СуммаКонечныйОстаток КАК СуммаОстаток,
	ТаблицаВзаиморасчетов.НомерПлатежа КАК НомерПлатежа,
	ПроизводственныйКалендарь.ПервыйРабочийДень КАК ПервыйРабочийДень,
	ТаблицаПередач.ДатаПередачи КАК ДатаПередачи,
	ВЫБОР
		КОГДА ПроизводственныйКалендарь.ПервыйРабочийДень < ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
			ТОГДА РАЗНОСТЬДАТ(ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
		КОГДА ПроизводственныйКалендарь.ПервыйРабочийДень < ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета
			ТОГДА РАЗНОСТЬДАТ(ПроизводственныйКалендарь.ПервыйРабочийДень, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
		ИНАЧЕ 0
	КОНЕЦ КАК ДнейСкорректированных,
	ВЫБОР
		КОГДА НАЧАЛОПЕРИОДА(ПроизводственныйКалендарь.ПервыйРабочийДень, ДЕНЬ) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоПросроченныйПлатеж,
	ВЫБОР
		КОГДА НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты, ДЕНЬ) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоПросроченныйПлатежПоКалендарнымДням,
	ВЫБОР
		КОГДА НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты, МЕСЯЦ) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, МЕСЯЦ)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоПросроченныйПлатежПереходящийМесяц,
	ТаблицаДляРасчетаПеней.СтавкаПени КАК СтавкаПени,
	ТаблицаДляРасчетаПеней.ЛьготныйПериод КАК ЛьготныйПериод,
	ТаблицаДляРасчетаПеней.БазаРасчетаПеней КАК БазаРасчетаПеней,
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА ДОБАВИТЬКДАТЕ(ПроизводственныйКалендарь.ПервыйРабочийДень, ДЕНЬ, ТаблицаДляРасчетаПеней.ЛьготныйПериод) < ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
				ТОГДА РАЗНОСТЬДАТ(ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			КОГДА ДОБАВИТЬКДАТЕ(ПроизводственныйКалендарь.ПервыйРабочийДень, ДЕНЬ, ТаблицаДляРасчетаПеней.ЛьготныйПериод) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
				ТОГДА РАЗНОСТЬДАТ(ПроизводственныйКалендарь.ПервыйРабочийДень, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			ИНАЧЕ 0
		КОНЕЦ * ВЫБОР
			КОГДА ЕСТЬNULL(ТаблицаДляРасчетаПеней.БазаРасчетаПеней, 0) < 0
				ТОГДА 0
			ИНАЧЕ ЕСТЬNULL(ТаблицаДляРасчетаПеней.БазаРасчетаПеней, 0)
		КОНЕЦ * ТаблицаДляРасчетаПеней.СтавкаПени * 0.01 КАК ЧИСЛО(15, 2)) КАК СуммаПеней,
	ТаблицаДляРасчетаПеней.ДатаИзмененияПараметров КАК ДатаИзмененияПараметров,
	ВЫБОР
		КОГДА ЕСТЬNULL(ТаблицаВзаиморасчетов.СтатьяГрафика, ТаблицаДляРасчетаПеней.СтатьяГрафика) = &СтатьяЛП
			ТОГДА 1
		ИНАЧЕ 2
	КОНЕЦ КАК РазделительСтатейПоОплатеПеней
ПОМЕСТИТЬ ТаблицаРассчитанныхПеней
ИЗ
	ТаблицаНачислений КАК ТаблицаВзаиморасчетов
		ПОЛНОЕ СОЕДИНЕНИЕ ТаблицаДляРасчетаПенейСПараметрамиНачисленияПени КАК ТаблицаДляРасчетаПеней
		ПО ТаблицаВзаиморасчетов.ДоговорЛизинга = ТаблицаДляРасчетаПеней.ДоговорЛизинга
			И ТаблицаВзаиморасчетов.Приложение = ТаблицаДляРасчетаПеней.Приложение
			И ТаблицаВзаиморасчетов.СтатьяГрафика = ТаблицаДляРасчетаПеней.СтатьяГрафика
			И ТаблицаВзаиморасчетов.Валюта = ТаблицаДляРасчетаПеней.Валюта
			И ТаблицаВзаиморасчетов.ПлановаяДатаОплаты = ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты
			И ТаблицаВзаиморасчетов.НачислениеВнеГрафика = ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
		ЛЕВОЕ СОЕДИНЕНИЕ ПроизводственныйКалендарь КАК ПроизводственныйКалендарь
		ПО ТаблицаВзаиморасчетов.ПлановаяДатаОплаты = ПроизводственныйКалендарь.Дата
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаПередач КАК ТаблицаПередач
		ПО ТаблицаВзаиморасчетов.ДоговорЛизинга = ТаблицаПередач.ДоговорЛизинга

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	Валюта,
	КонецИнтервалаРасчета,
	НомерПлатежа
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаРассчитанныхПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаРассчитанныхПеней.Приложение КАК Приложение,
	ТаблицаРассчитанныхПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаРассчитанныхПеней.Валюта КАК Валюта,
	ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаРассчитанныхПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаРассчитанныхПеней.СуммаКОплате КАК СуммаКОплате,
	ТаблицаРассчитанныхПеней.СуммаНачисленная КАК СуммаНачисленная,
	ТаблицаРассчитанныхПеней.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику,
	ТаблицаРассчитанныхПеней.ДатаПередачи КАК ДатаПередачи,
	ТаблицаРассчитанныхПеней.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.ДатаОплаты КАК ДатаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОплаты КАК СуммаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОстаток КАК СуммаОстаток,
	ТаблицаРассчитанныхПеней.НомерПлатежа КАК НомерПлатежа,
	ТаблицаРассчитанныхПеней.ПервыйРабочийДень КАК ПервыйРабочийДень,
	ТаблицаРассчитанныхПеней.ДнейСкорректированных КАК ДнейСкорректированных,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатеж КАК ЭтоПросроченныйПлатеж,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатежПоКалендарнымДням КАК ЭтоПросроченныйПлатежПоКалендарнымДням,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатежПереходящийМесяц КАК ЭтоПросроченныйПлатежПереходящийМесяц,
	ТаблицаРассчитанныхПеней.ДатаИзмененияПараметров КАК ДатаИзмененияПараметров,
	ТаблицаРассчитанныхПеней.СтавкаПени КАК СтавкаПени,
	ТаблицаРассчитанныхПеней.ЛьготныйПериод КАК ЛьготныйПериод,
	ТаблицаРассчитанныхПеней.СуммаПеней КАК СуммаПеней,
	ТаблицаРассчитанныхПеней.РазделительСтатейПоОплатеПеней КАК РазделительСтатейПоОплатеПеней,
	СУММА(ЕСТЬNULL(ТаблицаРассчитанныхПеней1.СуммаПеней, 0)) КАК СуммаПенейНарастающийИтог
ПОМЕСТИТЬ ТаблицаРассчитанныхПенейСНарастающимИтогом
ИЗ
	ТаблицаРассчитанныхПеней КАК ТаблицаРассчитанныхПеней
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаРассчитанныхПеней КАК ТаблицаРассчитанныхПеней1
		ПО ТаблицаРассчитанныхПеней.ДоговорЛизинга = ТаблицаРассчитанныхПеней1.ДоговорЛизинга
			И ТаблицаРассчитанныхПеней.Приложение = ТаблицаРассчитанныхПеней1.Приложение
			И ТаблицаРассчитанныхПеней.Валюта = ТаблицаРассчитанныхПеней1.Валюта
			И (ВЫБОР
				КОГДА ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета = ТаблицаРассчитанныхПеней1.КонецИнтервалаРасчета
					ТОГДА ВЫБОР
							КОГДА ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты = ТаблицаРассчитанныхПеней1.ПлановаяДатаОплаты
								ТОГДА ВЫБОР
										КОГДА ТаблицаРассчитанныхПеней.НачислениеВнеГрафика = ТаблицаРассчитанныхПеней1.НачислениеВнеГрафика
											ТОГДА ТаблицаРассчитанныхПеней.СтатьяГрафика >= ТаблицаРассчитанныхПеней1.СтатьяГрафика
										ИНАЧЕ ТаблицаРассчитанныхПеней.НачислениеВнеГрафика >= ТаблицаРассчитанныхПеней1.НачислениеВнеГрафика
									КОНЕЦ
							ИНАЧЕ ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты >= ТаблицаРассчитанныхПеней1.ПлановаяДатаОплаты
						КОНЕЦ
				ИНАЧЕ ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета >= ТаблицаРассчитанныхПеней1.КонецИнтервалаРасчета
			КОНЕЦ)
			И ТаблицаРассчитанныхПеней.РазделительСтатейПоОплатеПеней = ТаблицаРассчитанныхПеней1.РазделительСтатейПоОплатеПеней

СГРУППИРОВАТЬ ПО
	ТаблицаРассчитанныхПеней.ДоговорЛизинга,
	ТаблицаРассчитанныхПеней.Приложение,
	ТаблицаРассчитанныхПеней.СтатьяГрафика,
	ТаблицаРассчитанныхПеней.Валюта,
	ТаблицаРассчитанныхПеней.НачислениеВнеГрафика,
	ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты,
	ТаблицаРассчитанныхПеней.СуммаКОплате,
	ТаблицаРассчитанныхПеней.СуммаНачисленная,
	ТаблицаРассчитанныхПеней.ЭтоПлатежПоТекущемуГрафику,
	ТаблицаРассчитанныхПеней.ДатаПередачи,
	ТаблицаРассчитанныхПеней.НачалоИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.ДатаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОстаток,
	ТаблицаРассчитанныхПеней.НомерПлатежа,
	ТаблицаРассчитанныхПеней.ПервыйРабочийДень,
	ТаблицаРассчитанныхПеней.ДнейСкорректированных,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатеж,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатежПоКалендарнымДням,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатежПереходящийМесяц,
	ТаблицаРассчитанныхПеней.СтавкаПени,
	ТаблицаРассчитанныхПеней.ЛьготныйПериод,
	ТаблицаРассчитанныхПеней.СуммаПеней,
	ТаблицаРассчитанныхПеней.ДатаИзмененияПараметров,
	ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.РазделительСтатейПоОплатеПеней

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОсновнаяТаблица.ДоговорЛизинга.Владелец КАК Контрагент,
	ОсновнаяТаблица.ДоговорЛизинга КАК ДоговорЛизинга,
	ОсновнаяТаблица.Приложение КАК Приложение,
	ОсновнаяТаблица.СтатьяГрафика КАК Статья,
	ОсновнаяТаблица.Валюта КАК Валюта,
	ОсновнаяТаблица.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ОсновнаяТаблица.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ОсновнаяТаблица.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ОсновнаяТаблица.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ОсновнаяТаблица.ПервыйРабочийДень КАК ПервыйРабочийДень,
	ОсновнаяТаблица.СуммаКОплате КАК СуммаКОплате,
	ОсновнаяТаблица.СуммаНачисленная КАК СуммаНачисленная,
	ОсновнаяТаблица.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафикуПлатежей,
	ОсновнаяТаблица.НомерПлатежа КАК НомерПлатежа,
	ОсновнаяТаблица.ДатаОплаты КАК ДатаОплаты,
	ОсновнаяТаблица.СуммаОплаты КАК СуммаОплаты,
	ОсновнаяТаблица.СуммаОстаток КАК СуммаОстаток,
	ОсновнаяТаблица.ДатаПередачи КАК ДатаПередачи,
	ОсновнаяТаблица.ДнейСкорректированных КАК ДнейСкорректированных,
	ОсновнаяТаблица.ЭтоПросроченныйПлатеж КАК ЭтоПросроченныйПлатеж,
	ОсновнаяТаблица.ЭтоПросроченныйПлатежПоКалендарнымДням КАК ЭтоПросроченныйПлатежПоКалендарнымДням,
	ОсновнаяТаблица.ЭтоПросроченныйПлатежПереходящийМесяц КАК ЭтоПросроченныйПлатежПереходящийМесяц,
	ОсновнаяТаблица.ДатаИзмененияПараметров КАК ДатаИзмененияПараметров,
	ОсновнаяТаблица.СтавкаПени КАК СтавкаПени,
	ОсновнаяТаблица.ЛьготныйПериод КАК ЛьготныйПериод,
	ОсновнаяТаблица.СуммаПеней КАК СуммаПеней,
	ОсновнаяТаблица.СуммаПенейНарастающийИтог КАК СуммаПенейНарастающийИтог,
	МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0)) КАК ОбщаяСуммаОплаченныхПеней,
	ВЫБОР
		КОГДА МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0)) > ОсновнаяТаблица.СуммаПенейНарастающийИтог
			ТОГДА ОсновнаяТаблица.СуммаПеней
		КОГДА ОсновнаяТаблица.СуммаПенейНарастающийИтог - ОсновнаяТаблица.СуммаПеней > МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0))
			ТОГДА 0
		ИНАЧЕ МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0)) - ОсновнаяТаблица.СуммаПенейНарастающийИтог + ОсновнаяТаблица.СуммаПеней
	КОНЕЦ КАК ПениОплачено,
	ВЫБОР
		КОГДА ОсновнаяТаблица.ЭтоПросроченныйПлатеж
			ТОГДА ЕСТЬNULL(СУММА(ТаблицаВзаиморасчетовВесьПериод.ПросроченныйПлатеж), 0) + 1
		ИНАЧЕ 0
	КОНЕЦ КАК ПовторениеПросрочки,
	ОсновнаяТаблица.РазделительСтатейПоОплатеПеней КАК РазделительСтатейПоОплатеПеней
ПОМЕСТИТЬ ВтИтог
ИЗ
	ТаблицаРассчитанныхПенейСНарастающимИтогом КАК ОсновнаяТаблица
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаВзаиморасчетовВесьПериод КАК ТаблицаВзаиморасчетовВесьПериод
		ПО ОсновнаяТаблица.ДоговорЛизинга = ТаблицаВзаиморасчетовВесьПериод.ДоговорЛизинга
			И ОсновнаяТаблица.Приложение = ТаблицаВзаиморасчетовВесьПериод.Приложение
			И ОсновнаяТаблица.СтатьяГрафика = ТаблицаВзаиморасчетовВесьПериод.СтатьяГрафика
			И ОсновнаяТаблица.Валюта = ТаблицаВзаиморасчетовВесьПериод.Валюта
			И ОсновнаяТаблица.ПлановаяДатаОплаты > ТаблицаВзаиморасчетовВесьПериод.ПлановаяДатаОплаты
			И ОсновнаяТаблица.НачислениеВнеГрафика = ТаблицаВзаиморасчетовВесьПериод.НачислениеВнеГрафика
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОплатПенейВесьПериод КАК ОплатыПеней
		ПО ОсновнаяТаблица.ДоговорЛизинга = ОплатыПеней.ДоговорЛизинга
			И ОсновнаяТаблица.Приложение = ОплатыПеней.Приложение
			И ОсновнаяТаблица.Валюта = ОплатыПеней.Валюта
			И ОсновнаяТаблица.РазделительСтатейПоОплатеПеней = ОплатыПеней.РазделительСтатейПоОплатеПеней
ГДЕ
	ОсновнаяТаблица.ПлановаяДатаОплаты МЕЖДУ &НачалоПериода И &КонецПериода

СГРУППИРОВАТЬ ПО
	ОсновнаяТаблица.ДоговорЛизинга.Владелец,
	ОсновнаяТаблица.ДоговорЛизинга,
	ОсновнаяТаблица.Приложение,
	ОсновнаяТаблица.СтатьяГрафика,
	ОсновнаяТаблица.Валюта,
	ОсновнаяТаблица.ДатаПередачи,
	ОсновнаяТаблица.НачислениеВнеГрафика,
	ОсновнаяТаблица.ПлановаяДатаОплаты,
	ОсновнаяТаблица.ЭтоПросроченныйПлатеж,
	ОсновнаяТаблица.ЭтоПросроченныйПлатежПоКалендарнымДням,
	ОсновнаяТаблица.ЭтоПросроченныйПлатежПереходящийМесяц,
	ОсновнаяТаблица.НомерПлатежа,
	ОсновнаяТаблица.ПервыйРабочийДень,
	ОсновнаяТаблица.ДатаОплаты,
	ОсновнаяТаблица.НачалоИнтервалаРасчета,
	ОсновнаяТаблица.СуммаКОплате,
	ОсновнаяТаблица.СуммаНачисленная,
	ОсновнаяТаблица.СуммаПенейНарастающийИтог,
	ОсновнаяТаблица.ЭтоПлатежПоТекущемуГрафику,
	ОсновнаяТаблица.СуммаОплаты,
	ОсновнаяТаблица.СуммаОстаток,
	ОсновнаяТаблица.ДнейСкорректированных,
	ОсновнаяТаблица.СтавкаПени,
	ОсновнаяТаблица.ЛьготныйПериод,
	ОсновнаяТаблица.СуммаПеней,
	ОсновнаяТаблица.ДатаИзмененияПараметров,
	ОсновнаяТаблица.КонецИнтервалаРасчета,
	ОсновнаяТаблица.РазделительСтатейПоОплатеПеней
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	МАКСИМУМ(&ДатаСреза) КАК ДатаАктуальности,
	ВтИтог.Контрагент КАК Контрагент,
	ВтИтог.ДоговорЛизинга.Код КАК ДоговорКод,
	ВтИтог.ДоговорЛизинга.хлНомерДоговора КАК НомерДоговора,
	МАКСИМУМ(ВтИтог.ДатаПередачи) КАК ДатаПередачи
ИЗ
	ВтИтог КАК ВтИтог
ГДЕ
	(ВтИтог.ЭтоПросроченныйПлатежПереходящийМесяц = ИСТИНА
			ИЛИ ВтИтог.ЭтоПросроченныйПлатежПоКалендарнымДням = ИСТИНА
				И НАЧАЛОПЕРИОДА(ВтИтог.КонецИнтервалаРасчета, ДЕНЬ) = НАЧАЛОПЕРИОДА(&КонецПериода, ДЕНЬ))
	И ВтИтог.ПервыйРабочийДень ЕСТЬ НЕ NULL 
	И ВтИтог.СуммаКОплате > 0

СГРУППИРОВАТЬ ПО
	ВтИтог.Контрагент,
	ВтИтог.ДоговорЛизинга.Код,
	ВтИтог.ДоговорЛизинга.хлНомерДоговора"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",24},
{1,"ЭтоВыражение",
{"Pattern"},"В",10},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"#",5a49abd5-936d-4f46-8499-9cb204efe378},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",24}
},
{2,3,0,0,1,1,2,2,
{1,12,
{2,72,3,
{"S","ДоговорЛизинга"},
{"B",0},
{"#",376807bc-0d88-4c06-9eb2-42b72b970afb,25:837194049cc883ef11edd2be696265bb},0},
{2,73,3,
{"S","НачалоПериода"},
{"B",0},
{"D",20010101000000},0},
{2,74,3,
{"S","КонецПериода"},
{"B",0},
{"D",20230523000000},0},
{2,75,3,
{"S","ДатаСреза"},
{"B",0},
{"D",20230523000000},0},
{2,76,3,
{"S","НаборСтатейИсключаемыхИзБазыРасчетаПени"},
{"B",0},
{"#",c3ec4375-8577-46d5-be3b-185e29cc8b67,17853:00000000000000000000000000000000},0},
{2,77,3,
{"S","НазначениеПени"},
{"B",0},
{"#",6bcdbfc3-84d1-4e5c-8ca9-d8e2b284449a,10672:ab6d3182f5ebc532496b0dcec964ddde},0},
{2,78,3,
{"S","НачалоВеденияУчета"},
{"B",0},
{"D",20010101000000},0},
{2,79,3,
{"S","СтатьяКомпенсацияСтрахования"},
{"B",0},
{"#",6bcdbfc3-84d1-4e5c-8ca9-d8e2b284449a,10672:86c101a9072f8a0e40fec391bb9e00a9},0},
{2,80,3,
{"S","СтатьяЛП"},
{"B",0},
{"#",46acbd87-b2d2-42f3-a9cc-ae9d20da8355,531:b6f2001b78e1182a11de1aad5fa16558},0},
{2,81,3,
{"S","Страна"},
{"B",0},
{"#",4ee4f6c6-683e-4abc-8890-ed6cde5a53cb,33:8ce4d57185730a3b4108effa215d0c81},0},
{2,82,3,
{"S","ШтрафыЗаСтрахование"},
{"B",0},
{"#",46acbd87-b2d2-42f3-a9cc-ae9d20da8355,531:816494049cc883ef11e5523c750d54c3},0},
{2,83,3,
{"S","Статья"},
{"B",0},
{"#",46acbd87-b2d2-42f3-a9cc-ae9d20da8355,531:b6f2001b78e1182a11de1aad5fa16558},0}
},2,83},
{0,0}
}
},
{"N",1},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{2,
{0,"ИмяВарианта",
{"Pattern",
{"S"}
},"Имя варианта",16},
{1,"ТекстКода",
{"Pattern",
{"S"}
},"Текст кода",95}
},
{2,2,0,0,1,1,
{1,0},1,-1},
{0,0}
}
},
{"#",e199ca70-93cf-46ce-a54b-6edc88c3a296,
{#base64:AQE4EgAAAAAAAO+7v3siIyIsM2Q0OGZlYWUtYTljNi00YzVhLWEwOTktOWViNjQ3
NzYzMGM2LA0KezIsDQp7DQp7IlMiLCLRhdC70J3QvtC80LXRgNCU0L7Qs9C+0LLQ
vtGA0LAifSwNCnsiIyIsNDIzODAxOWQtN2U0OS00ZmM5LTkxZGItYjZiOTUxZDVj
ZjhlLA0KezUsDQp7DQp7IlMiLCLQndCw0YfQsNC70YzQvdCw0Y/QodGC0YDQvtC6
0LAifSwNCnsiTiIsMH0NCn0sDQp7DQp7IlMiLCLQmtC+0L3QtdGH0L3QsNGP0KHR
gtGA0L7QutCwIn0sDQp7Ik4iLDB9DQp9LA0Kew0KeyJTIiwi0KLQuNC/0JfQvdCw
0YfQtdC90LjRj9Ce0LHRitC10LrRgtCwIn0sDQp7IlUifQ0KfSwNCnsNCnsiUyIs
ItCf0L7Qu9GP0KHQuNC90YXRgNC+0L3QuNC30LDRhtC40LgifSwNCnsiIyIsYWNm
NjE5MmUtODFjYS00NmVmLTkzYTYtNWE2OTY4Yjc4NjYzLA0KezksDQp7NCwNCnsw
LCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC90LjQt9Cw0YbQuNC4IiwNCnsiUGF0dGVy
biIsDQp7IlMifQ0KfSwi0J/QvtC70LUg0YHQuNC90YXRgNC+0L3QuNC30LDRhtC4
0LgiLDMxfSwNCnsxLCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC90LjQt9Cw0YbQuNC4
0J/RgNC10LTRgdGC0LDQstC70LXQvdC40LUiLA0KeyJQYXR0ZXJuIiwNCnsiUyJ9
DQp9LCLQn9GA0LXQtNGB0YLQsNCy0LvQtdC90LjQtSIsMzF9LA0KezIsItCf0L7Q
u9C10KHQuNC90YXRgNC+0L3QuNC30LDRhtC40LjQotC40L/Ql9C90LDRh9C10L3Q
uNGPIiwNCnsiUGF0dGVybiIsDQp7IiMiLGY1YzY1MDUwLTNiYmItMTFkNS1iOTg4
LTAwNTBiYWUwYTk1ZH0NCn0sItCi0LjQvyDQt9C90LDRh9C10L3QuNGPIiwyMX0s
DQp7Mywi0J3QvtC80LXRgNCa0L7Qu9C+0L3QutC40J7RgtCx0L7RgNCwIiwNCnsi
UGF0dGVybiIsDQp7Ik4iLDEwLDAsMX0NCn0sItCd0L7QvNC10YAg0LrQvtC70L7Q
vdC60Lgg0YLQsNCx0LvQuNGG0Ysg0L7RgtCx0L7RgNCwIiwyNn0NCn0sDQp7Miw0
LDAsMCwxLDEsMiwyLDMsMywNCnsxLDB9LDMsLTF9LA0KezAsMH0NCn0NCn0NCn0s
DQp7DQp7IlMiLCLQotCw0LHQu9C40YfQvdGL0LnQlNC+0LrRg9C80LXQvdGC0J7R
gtCx0L7RgNCwIn0sDQp7IiMiLGU2MDMxMDNlLWEzMTgtNGVkYy1hMDE0LWIxYzZj
Zjk0ZDQ5ZiwNCns4LDEsMTEsDQp7IiMiLCIiLDEsMSwiIyIsItCv0LfRi9C6INC/
0L4g0YPQvNC+0LvRh9Cw0L3QuNGOIiwi0K/Qt9GL0Log0L/QviDRg9C80L7Qu9GH
0LDQvdC40Y4iLDB9LA0KezEyOCw3Mn0sDQp7MH0sMCwNCnswLDB9LA0KezAsMH0s
DQp7MCwwfSwNCnswLDB9LA0KezAsMH0sDQp7MCwwfSwwLDIsMCwNCnswLDAsMDAw
MDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAwLDB9LDAsMCwwLDAsMCww
LDAsMCwwLA0KezB9LA0KezB9LA0KezB9LA0KezB9LCIiLA0Kew0KezAsNiw2LA0K
eyJOIiwxMDAwfSw3LA0KeyJOIiwxMDAwfSw4LA0KeyJOIiwxMDAwfSw5LA0KeyJO
IiwxMDAwfSwxMCwNCnsiTiIsMTAwMH0sMTEsDQp7Ik4iLDEwMDB9DQp9DQp9LA0K
ezAsLTEsLTEsLTEsLTEsMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAw
MDAwfSwwLDAsMCwwLDAsMCwwLDEsMCwxLDAsMCwwLDAsMCwyLA0KezMsMywNCnst
MX0NCn0sDQp7MywzLA0Key0zfQ0KfSwwLDAsMCwiIiwwLA0KezMsMCwwLDEwMCwx
LDEsMCwxLDEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsIiIsMCwwLDAsMCwwLDAs
MH0sDQp7MH0sMCwwLDAsMSwwLDB9DQp9DQp9DQp9DQp9DQp9LA0Kew0KeyJTIiwi
0JTQvtCz0L7QstC+0YDQm9C40LfQuNC90LPQsCJ9LA0KeyIjIiw0MjM4MDE5ZC03
ZTQ5LTRmYzktOTFkYi1iNmI5NTFkNWNmOGUsDQp7NSwNCnsNCnsiUyIsItCd0LDR
h9Cw0LvRjNC90LDRj9Ch0YLRgNC+0LrQsCJ9LA0KeyJOIiwxfQ0KfSwNCnsNCnsi
UyIsItCa0L7QvdC10YfQvdCw0Y/QodGC0YDQvtC60LAifSwNCnsiTiIsMX0NCn0s
DQp7DQp7IlMiLCLQotC40L/Ql9C90LDRh9C10L3QuNGP0J7QsdGK0LXQutGC0LAi
fSwNCnsiVCIsMzc2ODA3YmMtMGQ4OC00YzA2LTllYjItNDJiNzJiOTcwYWZifQ0K
fSwNCnsNCnsiUyIsItCf0L7Qu9GP0KHQuNC90YXRgNC+0L3QuNC30LDRhtC40Lgi
fSwNCnsiIyIsYWNmNjE5MmUtODFjYS00NmVmLTkzYTYtNWE2OTY4Yjc4NjYzLA0K
ezksDQp7NCwNCnswLCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC90LjQt9Cw0YbQuNC4
IiwNCnsiUGF0dGVybiIsDQp7IlMifQ0KfSwi0J/QvtC70LUg0YHQuNC90YXRgNC+
0L3QuNC30LDRhtC40LgiLDMxfSwNCnsxLCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC9
0LjQt9Cw0YbQuNC40J/RgNC10LTRgdGC0LDQstC70LXQvdC40LUiLA0KeyJQYXR0
ZXJuIiwNCnsiUyJ9DQp9LCLQn9GA0LXQtNGB0YLQsNCy0LvQtdC90LjQtSIsMzF9
LA0KezIsItCf0L7Qu9C10KHQuNC90YXRgNC+0L3QuNC30LDRhtC40LjQotC40L/Q
l9C90LDRh9C10L3QuNGPIiwNCnsiUGF0dGVybiIsDQp7IiMiLGY1YzY1MDUwLTNi
YmItMTFkNS1iOTg4LTAwNTBiYWUwYTk1ZH0NCn0sItCi0LjQvyDQt9C90LDRh9C1
0L3QuNGPIiwyMX0sDQp7Mywi0J3QvtC80LXRgNCa0L7Qu9C+0L3QutC40J7RgtCx
0L7RgNCwIiwNCnsiUGF0dGVybiIsDQp7Ik4iLDEwLDAsMX0NCn0sItCd0L7QvNC1
0YAg0LrQvtC70L7QvdC60Lgg0YLQsNCx0LvQuNGG0Ysg0L7RgtCx0L7RgNCwIiwy
Nn0NCn0sDQp7Miw0LDAsMCwxLDEsMiwyLDMsMywNCnsxLDEsDQp7MiwwLDQsDQp7
IlMiLCLRhdC70J3QvtC80LXRgNCU0L7Qs9C+0LLQvtGA0LAifSwNCnsiUyIsItCU
0L7Qs9C+0LLQvtGA0JvQuNC30LjQvdCz0LAu0J3QvtC80LXRgCDQtNC+0LPQvtCy
0L7RgNCwIn0sDQp7IiMiLGY1YzY1MDUwLTNiYmItMTFkNS1iOTg4LTAwNTBiYWUw
YTk1ZCwNCnsiUGF0dGVybiIsDQp7IlMiLDEwMCwxfQ0KfQ0KfSwNCnsiTiIsMX0s
MH0NCn0sMywwfSwNCnswLDB9DQp9DQp9DQp9LA0Kew0KeyJTIiwi0KLQsNCx0LvQ
uNGH0L3Ri9C50JTQvtC60YPQvNC10L3RgtCe0YLQsdC+0YDQsCJ9LA0KeyIjIixl
NjAzMTAzZS1hMzE4LTRlZGMtYTAxNC1iMWM2Y2Y5NGQ0OWYsDQp7OCwxLDExLA0K
eyIjIiwiIiwxLDEsIiMiLCLQr9C30YvQuiDQv9C+INGD0LzQvtC70YfQsNC90LjR
jiIsItCv0LfRi9C6INC/0L4g0YPQvNC+0LvRh9Cw0L3QuNGOIiwwfSwNCnsxMjgs
NzJ9LA0KezB9LDAsDQp7MCwwfSwNCnswLDB9LA0KezAsMH0sDQp7MCwwfSwNCnsw
LDB9LA0KezAsMH0sMCwyLDE2LDAsMCwxLDAsDQp7MTYsMSwNCnsxLDEsDQp7IiMi
LCLQkNCbIDI1MDcyLzAxLTE0INCa0JfQnSJ9DQp9LDB9LDEsMCwxLDAsDQp7MTYs
MCwNCnsxLDEsDQp7IiMiLCLQkNCbIDI2NjA5LzAxLTE0INCj0JvQnSJ9DQp9LDB9
LDIsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDI1NTA1LzAyLTE0
INCS0KDQliJ9DQp9LDB9LDMsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQ
kNCbIDI0MTQ0LzA0LTE0INCa0JfQnSJ9DQp9LDB9LDQsMCwxLDAsDQp7MTYsMCwN
CnsxLDEsDQp7IiMiLCLQkNCbIDI2MTA3LzAyLTE0INCf0J3QlyJ9DQp9LDB9LDUs
MCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDI0Njg1LzAyLTE0INCV
0JrQkSJ9DQp9LDB9LDYsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCb
IDMwOTU5LzAxLTE0INCd0JHQpyJ9DQp9LDB9LDcsMCwxLDAsDQp7MTYsMCwNCnsx
LDEsDQp7IiMiLCLQkNCbIDc0Mjc4LzAxLTE2INCh0KDQoiJ9DQp9LDB9LDgsMCwx
LDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDkyNTAwLzAxLTE3INCh0JzQ
oCJ9DQp9LDB9LDksMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDk4
NzA4LzAxLTE3INCi0K7QnCJ9DQp9LDB9LDEwLDAsMSwwLA0KezE2LDAsDQp7MSwx
LA0KeyIjIiwi0JDQmyAxMTExNjgvMDEtMTgg0J7QoNCRIn0NCn0sMH0sMTEsMCwx
LDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDIxNzAvMTQtMTkg0JrQoNCh
In0NCn0sMH0sMTIsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDEw
MzgxOC8wMi0xOCJ9DQp9LDB9LDEzLDAsMSwwLA0KezE2LDAsDQp7MSwxLA0KeyIj
Iiwi0JDQmyAxMDM4MTgvMDMtMTgifQ0KfSwwfSwxNCwwLDEsMCwNCnsxNiwwLA0K
ezEsMSwNCnsiIyIsItCQ0JsgOTM5NDMvMDItMTgg0KLQm9CiIn0NCn0sMH0sMTUs
MCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDY2OTg4LzAyLTE2INCR
0JPQlCJ9DQp9LDB9LA0KezEsMCwwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAw
MDAwMDAwMDAsMSwwLDJ9LDE2LDAsMCwwLDAsMCwwLDAsMCwNCnswfSwNCnswfSwN
CnswfSwNCnswfSwiIiwNCnsNCnswLDYsNiwNCnsiTiIsMTAwMH0sNywNCnsiTiIs
MTAwMH0sOCwNCnsiTiIsMTAwMH0sOSwNCnsiTiIsMTAwMH0sMTAsDQp7Ik4iLDEw
MDB9LDExLA0KeyJOIiwxMDAwfQ0KfQ0KfSwNCnswLC0xLC0xLC0xLC0xLDAwMDAw
MDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMH0sMCwwLDAsMCwwLDAsMCwx
LDAsMSwyLA0KezIxNzYsMjAxLDJ9LA0KezEyOCwyMTd9LDAsMCwwLDAsMywNCnsz
LDMsDQp7LTF9DQp9LA0KezMsMywNCnstM30NCn0sDQp7MywzLA0Key03fQ0KfSww
LDAsMCwiIiwwLA0KezMsMCwwLDEwMCwxLDEsMCwxLDEsMCwwLDAsMCwwLDAsMCww
LDAsMCwwLDAsIiIsMCwwLDAsMCwwLDAsMH0sDQp7MH0sMCwwLDAsMSwwLDB9DQp9
DQp9DQp9DQp9DQp9DQp9DQp9}
},0},
{2,5,6,
{"S","есть ли просрочка на конец месяца все с флагом"},
{"S","ВЫБРАТЬ
	хлПриложениеКДоговоруЛизинга.ДоговорЛизинга КАК ДоговорЛизинга,
	хлПриложениеКДоговоруЛизинга.ДоговорЛизинга.ДоговорКонтрагента КАК ДоговорКонтрагента,
	хлПриложениеКДоговоруЛизинга.Номер КАК НомерПриложения
ПОМЕСТИТЬ ВтВсеДоговоры
ИЗ
	Документ.хлПриложениеКДоговоруЛизинга КАК хлПриложениеКДоговоруЛизинга
ГДЕ
	хлПриложениеКДоговоруЛизинга.хлпДоговорКонтрагента.хлНомерДоговора ПОДОБНО ""АЛ %""
	И НЕ хлПриложениеКДоговоруЛизинга.ПометкаУдаления
	И НЕ хлПриложениеКДоговоруЛизинга.хлпДоговорКонтрагента.ПометкаУдаления
	И НЕ хлПриложениеКДоговоруЛизинга.ДоговорЛизинга.ДоговорКонтрагента.Код ЕСТЬ NULL
	И хлПриложениеКДоговоруЛизинга.ДоговорЛизинга.ДоговорКонтрагента = &ДоговорЛизинга
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПроизводственныеКалендариСтранМира.Дата КАК Дата,
	ВЫБОР
		КОГДА ПроизводственныеКалендариСтранМира.ВидДня = ЗНАЧЕНИЕ(Перечисление.ВидыДнейПроизводственногоКалендаря.Рабочий)
			ТОГДА ИСТИНА
		КОГДА ПроизводственныеКалендариСтранМира.ВидДня = ЗНАЧЕНИЕ(Перечисление.ВидыДнейПроизводственногоКалендаря.Предпраздничный)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоРабочийДень
ПОМЕСТИТЬ КалендарьПолный
ИЗ
	РегистрСведений.хлПроизводственныеКалендариСтранМира КАК ПроизводственныеКалендариСтранМира
ГДЕ
	ПроизводственныеКалендариСтранМира.Страна = &Страна
	И ПроизводственныеКалендариСтранМира.Дата <= &КонецПериода

ИНДЕКСИРОВАТЬ ПО
	Дата
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	КалендарьПолный.Дата КАК Дата
ПОМЕСТИТЬ КалендарьРабочиеДни
ИЗ
	КалендарьПолный КАК КалендарьПолный
ГДЕ
	КалендарьПолный.ЭтоРабочийДень

ИНДЕКСИРОВАТЬ ПО
	Дата
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	КалендарьПолный.Дата КАК Дата,
	МИНИМУМ(ЕСТЬNULL(КалендарьРабочиеДни.Дата, КалендарьПолный.Дата)) КАК ПервыйРабочийДень
ПОМЕСТИТЬ ПроизводственныйКалендарь
ИЗ
	КалендарьПолный КАК КалендарьПолный
		ЛЕВОЕ СОЕДИНЕНИЕ КалендарьРабочиеДни КАК КалендарьРабочиеДни
		ПО (ВЫБОР
				КОГДА КалендарьПолный.ЭтоРабочийДень
					ТОГДА ЛОЖЬ
				ИНАЧЕ КалендарьПолный.Дата <= КалендарьРабочиеДни.Дата
			КОНЕЦ)

СГРУППИРОВАТЬ ПО
	КалендарьПолный.Дата

ИНДЕКСИРОВАТЬ ПО
	Дата
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга.Владелец КАК Контрагент,
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга КАК ДоговорЛизинга,
	МИНИМУМ(ВЫБОР
			КОГДА ПредметыЛизингаВЛизингеОбороты.КоличествоПриход > 0
				ТОГДА ПредметыЛизингаВЛизингеОбороты.Период
		КОНЕЦ) КАК ДатаПередачи
ПОМЕСТИТЬ ТаблицаПередач
ИЗ
	РегистрНакопления.хлПредметыЛизингаВЛизинге.Обороты(
			&НачалоВеденияУчета,
			&КонецПериода,
			День,
			ДоговорЛизинга В
				(ВЫБРАТЬ
					ВтВсеДоговоры.ДоговорКонтрагента
				ИЗ
					ВтВсеДоговоры)) КАК ПредметыЛизингаВЛизингеОбороты

СГРУППИРОВАТЬ ПО
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга,
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга.Владелец

ИНДЕКСИРОВАТЬ ПО
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ КАК ЭтоФакт,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга.Владелец КАК Контрагент,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга КАК ДоговорЛизинга,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Приложение КАК Приложение,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Статья КАК СтатьяГрафика,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Валюта КАК Валюта,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Дата КАК ПлановаяДатаОплаты,
	ЕСТЬNULL(ТаблицаПередач.ДатаПередачи, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаПередачи,
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
		ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
	КОНЕЦ КАК ДатаОплаты,
	СУММА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Сумма) КАК Сумма,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	МАКСИМУМ(ВЫБОР
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
					И (хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика
						ИЛИ хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Регистратор = ТаблицаАктуальныхУтверждений.Регистратор)
				ТОГДА ИСТИНА
			ИНАЧЕ ЛОЖЬ
		КОНЕЦ) КАК ЭтоПлатежПоТекущемуГрафику
ПОМЕСТИТЬ ВзаиморасчетыВесьПериод
ИЗ
	ВтВсеДоговоры КАК ВтВсеДоговоры
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику КАК хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику
			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.хлДанныеУтвержденийГрафиков.СрезПоследних(
					&КонецПериода,
					ВидГрафика = ЗНАЧЕНИЕ(Справочник.хлВидыГрафиков.ГрафикПлатежейПоДоговоруЛизинга)
						И Договор В
							(ВЫБРАТЬ
								ВтВсеДоговоры.ДоговорКонтрагента
							ИЗ
								ВтВсеДоговоры)) КАК ТаблицаАктуальныхУтверждений
			ПО хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга = ТаблицаАктуальныхУтверждений.Договор
				И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Приложение = ТаблицаАктуальныхУтверждений.Приложение
				И (хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход))
			ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаПередач КАК ТаблицаПередач
			ПО хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга = ТаблицаПередач.ДоговорЛизинга
		ПО ВтВсеДоговоры.ДоговорКонтрагента = хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга
ГДЕ
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Активность
	И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период <= &КонецПериода
	И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Дата <= &ДатаСреза
	И ВЫБОР
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
					И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
				ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
			ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
		КОНЕЦ <= &КонецПериода
	И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Статья = &Статья
	И ВЫБОР
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
				ТОГДА ДАТАВРЕМЯ(1, 1, 1)
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
				ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
			ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
		КОНЕЦ <= &ДатаСреза

СГРУППИРОВАТЬ ПО
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Валюта,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга.Владелец,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Статья,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Приложение,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Дата,
	ЕСТЬNULL(ТаблицаПередач.ДатаПередачи, ДАТАВРЕМЯ(1, 1, 1)),
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
		ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
	КОНЕЦ

ИМЕЮЩИЕ
	СУММА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Сумма) <> 0

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика,
	ДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение КАК Приложение,
	ВзаиморасчетыВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ВзаиморасчетыВесьПериод.Валюта КАК Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.Сумма КАК Сумма,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ВзаиморасчетыВесьПериод.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику
ПОМЕСТИТЬ ТаблицаНачисленийВесьПериод
ИЗ
	ВзаиморасчетыВесьПериод КАК ВзаиморасчетыВесьПериод
ГДЕ
	ВзаиморасчетыВесьПериод.ЭтоФакт = ЛОЖЬ

ИНДЕКСИРОВАТЬ ПО
	ВзаиморасчетыВесьПериод.ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение,
	ВзаиморасчетыВесьПериод.СтатьяГрафика,
	ВзаиморасчетыВесьПериод.Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение КАК Приложение,
	ВзаиморасчетыВесьПериод.Валюта КАК Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.ДатаПередачи КАК ДатаПередачи,
	ВзаиморасчетыВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ВзаиморасчетыВесьПериод.ДатаОплаты КАК ДатаОплаты,
	ВзаиморасчетыВесьПериод.Сумма КАК СуммаОплаты,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика
ПОМЕСТИТЬ ТаблицаОплатВесьПериод
ИЗ
	ВзаиморасчетыВесьПериод КАК ВзаиморасчетыВесьПериод
ГДЕ
	ВзаиморасчетыВесьПериод.ЭтоФакт = ИСТИНА

ИНДЕКСИРОВАТЬ ПО
	ВзаиморасчетыВесьПериод.ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение,
	ВзаиморасчетыВесьПериод.СтатьяГрафика,
	ВзаиморасчетыВесьПериод.Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика,
	ВзаиморасчетыВесьПериод.ДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаОплатВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение КАК Приложение,
	ТаблицаОплатВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаОплатВесьПериод.Валюта КАК Валюта,
	ТаблицаОплатВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаОплатВесьПериод.ДатаПередачи КАК ДатаПередачи,
	ТаблицаОплатВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	МАКСИМУМ(ВЫБОР
			КОГДА ТаблицаОплатВесьПериодДляОстатков.ДатаОплаты >= ТаблицаОплатВесьПериод.ДатаОплаты
				ТОГДА ТаблицаОплатВесьПериод.ПлановаяДатаОплаты
			ИНАЧЕ ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.ДатаОплаты, ТаблицаОплатВесьПериод.ПлановаяДатаОплаты)
		КОНЕЦ) КАК НачалоИнтервалаРасчета,
	ТаблицаОплатВесьПериод.ДатаОплаты КАК ДатаОплаты,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.ЭтоФакт, ЛОЖЬ) = ЛОЖЬ
				ТОГДА 1
			ИНАЧЕ -1
		КОНЕЦ * ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.Сумма, 0)) + ТаблицаОплатВесьПериод.СуммаОплаты КАК СуммаНачальныйОстаток,
	ТаблицаОплатВесьПериод.СуммаОплаты КАК СуммаОплаты,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.ЭтоФакт, ЛОЖЬ) = ЛОЖЬ
				ТОГДА 1
			ИНАЧЕ -1
		КОНЕЦ * ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.Сумма, 0)) КАК СуммаКонечныйОстаток
ПОМЕСТИТЬ ТаблицаОплатСОстаткамиВесьПериод
ИЗ
	ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ ВзаиморасчетыВесьПериод КАК ТаблицаОплатВесьПериодДляОстатков
		ПО ТаблицаОплатВесьПериод.ДоговорЛизинга = ТаблицаОплатВесьПериодДляОстатков.ДоговорЛизинга
			И ТаблицаОплатВесьПериод.Приложение = ТаблицаОплатВесьПериодДляОстатков.Приложение
			И ТаблицаОплатВесьПериод.СтатьяГрафика = ТаблицаОплатВесьПериодДляОстатков.СтатьяГрафика
			И ТаблицаОплатВесьПериод.Валюта = ТаблицаОплатВесьПериодДляОстатков.Валюта
			И ТаблицаОплатВесьПериод.ПлановаяДатаОплаты = ТаблицаОплатВесьПериодДляОстатков.ПлановаяДатаОплаты
			И ТаблицаОплатВесьПериод.НачислениеВнеГрафика = ТаблицаОплатВесьПериодДляОстатков.НачислениеВнеГрафика
			И ТаблицаОплатВесьПериод.ДатаОплаты >= ТаблицаОплатВесьПериодДляОстатков.ДатаОплаты

СГРУППИРОВАТЬ ПО
	ТаблицаОплатВесьПериод.Валюта,
	ТаблицаОплатВесьПериод.СтатьяГрафика,
	ТаблицаОплатВесьПериод.ПлановаяДатаОплаты,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.СуммаОплаты,
	ТаблицаОплатВесьПериод.ДатаОплаты,
	ТаблицаОплатВесьПериод.ДатаПередачи,
	ТаблицаОплатВесьПериод.НачислениеВнеГрафика

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика,
	ДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыВесьПериодОстатки.ДоговорЛизинга КАК ДоговорЛизинга,
	ВзаиморасчетыВесьПериодОстатки.Приложение КАК Приложение,
	ВзаиморасчетыВесьПериодОстатки.СтатьяГрафика КАК СтатьяГрафика,
	ВзаиморасчетыВесьПериодОстатки.Валюта КАК Валюта,
	ВзаиморасчетыВесьПериодОстатки.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериодОстатки.ДатаПередачи КАК ДатаПередачи,
	ВзаиморасчетыВесьПериодОстатки.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) КАК СуммаОстаток,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) КАК СуммаОстаток1,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) КАК СуммаОстаток2
ПОМЕСТИТЬ ТаблицаОстатков
ИЗ
	ВзаиморасчетыВесьПериод КАК ВзаиморасчетыВесьПериодОстатки

СГРУППИРОВАТЬ ПО
	ВзаиморасчетыВесьПериодОстатки.ДоговорЛизинга,
	ВзаиморасчетыВесьПериодОстатки.Приложение,
	ВзаиморасчетыВесьПериодОстатки.СтатьяГрафика,
	ВзаиморасчетыВесьПериодОстатки.Валюта,
	ВзаиморасчетыВесьПериодОстатки.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериодОстатки.ДатаПередачи,
	ВзаиморасчетыВесьПериодОстатки.НачислениеВнеГрафика

ИМЕЮЩИЕ
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) <> 0

ИНДЕКСИРОВАТЬ ПО
	ВзаиморасчетыВесьПериодОстатки.ДоговорЛизинга,
	ВзаиморасчетыВесьПериодОстатки.Приложение,
	ВзаиморасчетыВесьПериодОстатки.СтатьяГрафика,
	ВзаиморасчетыВесьПериодОстатки.Валюта,
	ВзаиморасчетыВесьПериодОстатки.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериодОстатки.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ ПЕРВЫЕ 1
	НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья КАК СтатьяКомпенсация
ПОМЕСТИТЬ врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях
ИЗ
	Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ИсключаемыеСтатьи КАК НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи
ГДЕ
	ВЫБОР
			КОГДА &НаборСтатейИсключаемыхИзБазыРасчетаПени = ЗНАЧЕНИЕ(Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ПустаяСсылка)
				ТОГДА ИСТИНА
			ИНАЧЕ НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Ссылка = &НаборСтатейИсключаемыхИзБазыРасчетаПени
		КОНЕЦ
	И НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья = &СтатьяКомпенсацияСтрахования
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаОплатВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение КАК Приложение,
	ТаблицаОплатВесьПериод.Валюта КАК Валюта,
	СУММА(ТаблицаОплатВесьПериод.СуммаОплаты) КАК СуммаОплаты,
	1 КАК РазделительСтатейПоОплатеПеней
ПОМЕСТИТЬ ТаблицаОплатПенейВесьПериод
ИЗ
	ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.хлНазначенияОбъектов КАК НазначенияОбъектов
		ПО ТаблицаОплатВесьПериод.СтатьяГрафика = НазначенияОбъектов.Объект
			И (НазначенияОбъектов.Назначение = &НазначениеПени)
ГДЕ
	НазначенияОбъектов.Назначение = &НазначениеПени

СГРУППИРОВАТЬ ПО
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.Валюта

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.Валюта,
	СУММА(ТаблицаОплатВесьПериод.СуммаОплаты),
	2
ИЗ
	ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях КАК врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях
		ПО (ИСТИНА)
ГДЕ
	ТаблицаОплатВесьПериод.СтатьяГрафика = &ШтрафыЗаСтрахование
	И врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях.СтатьяКомпенсация ЕСТЬ NULL

СГРУППИРОВАТЬ ПО
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.Валюта
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение КАК Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта КАК Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.Сумма КАК Сумма,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику,
	СУММА(ТаблицаОплатВесьПериод.СуммаОплаты) КАК СуммаОплаты,
	МАКСИМУМ(ТаблицаОплатВесьПериод.ДатаОплаты) КАК ДатаОплаты,
	ВЫБОР
		КОГДА МАКСИМУМ(ТаблицаОплатВесьПериод.ДатаОплаты) ЕСТЬ NULL
				ИЛИ ТаблицаНачисленийВесьПериод.Сумма - ЕСТЬNULL(СУММА(ТаблицаОплатВесьПериод.СуммаОплаты), 0) > 0
				ИЛИ РАЗНОСТЬДАТ(ПроизводственныйКалендарь.ПервыйРабочийДень, МАКСИМУМ(ТаблицаОплатВесьПериод.ДатаОплаты), ДЕНЬ) > 0
			ТОГДА 1
		ИНАЧЕ 0
	КОНЕЦ КАК ПросроченныйПлатеж
ПОМЕСТИТЬ ТаблицаВзаиморасчетовВесьПериод
ИЗ
	ТаблицаНачисленийВесьПериод КАК ТаблицаНачисленийВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ПО ТаблицаНачисленийВесьПериод.ДоговорЛизинга = ТаблицаОплатВесьПериод.ДоговорЛизинга
			И ТаблицаНачисленийВесьПериод.Приложение = ТаблицаОплатВесьПериод.Приложение
			И ТаблицаНачисленийВесьПериод.СтатьяГрафика = ТаблицаОплатВесьПериод.СтатьяГрафика
			И ТаблицаНачисленийВесьПериод.Валюта = ТаблицаОплатВесьПериод.Валюта
			И ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты = ТаблицаОплатВесьПериод.ПлановаяДатаОплаты
			И ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика = ТаблицаОплатВесьПериод.НачислениеВнеГрафика
		ЛЕВОЕ СОЕДИНЕНИЕ ПроизводственныйКалендарь КАК ПроизводственныйКалендарь
		ПО ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты = ПроизводственныйКалендарь.Дата

СГРУППИРОВАТЬ ПО
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.Сумма,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику,
	ПроизводственныйКалендарь.ПервыйРабочийДень

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение КАК Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта КАК Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.Сумма КАК Сумма,
	КОЛИЧЕСТВО(ТаблицаНачисленийВесьПериодДляНомераПлатежа.ПлановаяДатаОплаты) КАК НомерПлатежа,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику
ПОМЕСТИТЬ ТаблицаНачислений
ИЗ
	ТаблицаНачисленийВесьПериод КАК ТаблицаНачисленийВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаНачисленийВесьПериод КАК ТаблицаНачисленийВесьПериодДляНомераПлатежа
		ПО ТаблицаНачисленийВесьПериод.ДоговорЛизинга = ТаблицаНачисленийВесьПериодДляНомераПлатежа.ДоговорЛизинга
			И ТаблицаНачисленийВесьПериод.Приложение = ТаблицаНачисленийВесьПериодДляНомераПлатежа.Приложение
			И ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты >= ТаблицаНачисленийВесьПериодДляНомераПлатежа.ПлановаяДатаОплаты
			И ТаблицаНачисленийВесьПериод.СтатьяГрафика = ТаблицаНачисленийВесьПериодДляНомераПлатежа.СтатьяГрафика
			И ТаблицаНачисленийВесьПериод.Валюта = ТаблицаНачисленийВесьПериодДляНомераПлатежа.Валюта
			И (НЕ ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика
				ИЛИ ТаблицаНачисленийВесьПериод.СтатьяГрафика = &СтатьяЛП)

СГРУППИРОВАТЬ ПО
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.Сумма,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОплатыИОстатки.ДоговорЛизинга КАК ДоговорЛизинга,
	ОплатыИОстатки.Приложение КАК Приложение,
	ОплатыИОстатки.СтатьяГрафика КАК СтатьяГрафика,
	ОплатыИОстатки.Валюта КАК Валюта,
	ОплатыИОстатки.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ОплатыИОстатки.ДатаПередачи КАК ДатаПередачи,
	ОплатыИОстатки.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ОплатыИОстатки.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	КОНЕЦПЕРИОДА(ОплатыИОстатки.КонецИнтервалаРасчета, ДЕНЬ) КАК КонецИнтервалаРасчета,
	ЕСТЬNULL(ОплатыИОстатки.ДатаОплаты, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаОплаты,
	ОплатыИОстатки.БазаРасчетаПеней КАК БазаРасчетаПеней,
	ОплатыИОстатки.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
	ОплатыИОстатки.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток,
	ОплатыИОстатки.СуммаОплаты КАК СуммаОплаты
ПОМЕСТИТЬ ТаблицаДляРасчетаПеней
ИЗ
	(ВЫБРАТЬ
		Оплаты.ДоговорЛизинга КАК ДоговорЛизинга,
		Оплаты.Приложение КАК Приложение,
		Оплаты.СтатьяГрафика КАК СтатьяГрафика,
		Оплаты.Валюта КАК Валюта,
		Оплаты.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
		Оплаты.ДатаПередачи КАК ДатаПередачи,
		Оплаты.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
		Оплаты.ДатаОплаты КАК КонецИнтервалаРасчета,
		Оплаты.ДатаОплаты КАК ДатаОплаты,
		Оплаты.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
		Оплаты.СуммаНачальныйОстаток КАК БазаРасчетаПеней,
		Оплаты.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
		Оплаты.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток,
		Оплаты.СуммаОплаты КАК СуммаОплаты
	ИЗ
		ТаблицаОплатСОстаткамиВесьПериод КАК Оплаты
	ГДЕ
		Оплаты.ДатаОплаты <= &КонецПериода
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		Остатки.ДоговорЛизинга,
		Остатки.Приложение,
		Остатки.СтатьяГрафика,
		Остатки.Валюта,
		Остатки.ПлановаяДатаОплаты,
		Остатки.ДатаПередачи,
		ЕСТЬNULL(МАКСИМУМ(Оплаты.ДатаОплаты), Остатки.ПлановаяДатаОплаты),
		&КонецПериода,
		NULL,
		Остатки.НачислениеВнеГрафика,
		Остатки.СуммаОстаток,
		Остатки.СуммаОстаток1,
		Остатки.СуммаОстаток2,
		0
	ИЗ
		ТаблицаОстатков КАК Остатки
			ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОплатВесьПериод КАК Оплаты
			ПО (Оплаты.ДоговорЛизинга = Остатки.ДоговорЛизинга)
				И (Оплаты.Приложение = Остатки.Приложение)
				И (Оплаты.СтатьяГрафика = Остатки.СтатьяГрафика)
				И (Оплаты.Валюта = Остатки.Валюта)
				И (Оплаты.ПлановаяДатаОплаты = Остатки.ПлановаяДатаОплаты)
				И (Оплаты.НачислениеВнеГрафика = Остатки.НачислениеВнеГрафика)
				И (Оплаты.ДатаОплаты <= &КонецПериода)
	ГДЕ
		Остатки.СуммаОстаток > 0
	
	СГРУППИРОВАТЬ ПО
		Остатки.ДоговорЛизинга,
		Остатки.Приложение,
		Остатки.СтатьяГрафика,
		Остатки.Валюта,
		Остатки.ПлановаяДатаОплаты,
		Остатки.ДатаПередачи,
		Остатки.НачислениеВнеГрафика,
		Остатки.СуммаОстаток,
		Остатки.СуммаОстаток1,
		Остатки.СуммаОстаток2) КАК ОплатыИОстатки

СГРУППИРОВАТЬ ПО
	ОплатыИОстатки.Приложение,
	ОплатыИОстатки.Валюта,
	ОплатыИОстатки.ПлановаяДатаОплаты,
	ОплатыИОстатки.ДатаПередачи,
	ОплатыИОстатки.НачалоИнтервалаРасчета,
	ОплатыИОстатки.НачислениеВнеГрафика,
	ОплатыИОстатки.ДоговорЛизинга,
	ОплатыИОстатки.СтатьяГрафика,
	ОплатыИОстатки.КонецИнтервалаРасчета,
	ОплатыИОстатки.ДатаОплаты,
	ОплатыИОстатки.СуммаНачальныйОстаток,
	ОплатыИОстатки.СуммаКонечныйОстаток,
	ОплатыИОстатки.СуммаОплаты,
	ОплатыИОстатки.БазаРасчетаПеней

ИНДЕКСИРОВАТЬ ПО
	ОплатыИОстатки.ДоговорЛизинга,
	ОплатыИОстатки.Приложение,
	ОплатыИОстатки.СтатьяГрафика,
	ОплатыИОстатки.Валюта,
	ОплатыИОстатки.ПлановаяДатаОплаты,
	ОплатыИОстатки.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПараметрыНачисленияПениПоДоговорамЛизинга.Период КАК Период,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ДоговорКонтрагента КАК ДоговорКонтрагента,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ПараметрыНачисленияПениПоДоговорамЛизинга.НаборИсключаемыхСтатей КАК НаборИсключаемыхСтатей,
	ПараметрыНачисленияПениПоДоговорамЛизинга.СтавкаПени КАК СтавкаПени,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ЛьготныйПериод КАК ЛьготныйПериод
ПОМЕСТИТЬ ПараметрыНачисленияПени
ИЗ
	РегистрСведений.хлПараметрыНачисленияПениПоДоговорамЛизинга КАК ПараметрыНачисленияПениПоДоговорамЛизинга
ГДЕ
	ПараметрыНачисленияПениПоДоговорамЛизинга.ДоговорКонтрагента В
			(ВЫБРАТЬ
				ВтВсеДоговоры.ДоговорКонтрагента
			ИЗ
				ВтВсеДоговоры)

ИНДЕКСИРОВАТЬ ПО
	ПараметрыНачисленияПениПоДоговорамЛизинга.Период,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ДоговорКонтрагента,
	НаборИсключаемыхСтатей,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ПлановаяДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	ПараметрыНачисленияПени.ДоговорКонтрагента КАК ДоговорКонтрагента,
	ПараметрыНачисленияПени.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты
ПОМЕСТИТЬ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
ИЗ
	ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
ГДЕ
	ПараметрыНачисленияПени.ПлановаяДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)

ИНДЕКСИРОВАТЬ ПО
	ПараметрыНачисленияПени.ПлановаяДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета КАК ДатаПараметров,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение КАК Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта КАК Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика
ПОМЕСТИТЬ ДатыПараметровНачисленияПени
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
ГДЕ
	ТаблицаДляРасчетаПеней.ДатаПередачи <> ДАТАВРЕМЯ(1, 1, 1)
	И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты >= ТаблицаДляРасчетаПеней.ДатаПередачи

ОБЪЕДИНИТЬ

ВЫБРАТЬ
	НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ),
	ТаблицаДляРасчетаПеней.ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
ГДЕ
	ТаблицаДляРасчетаПеней.ДатаПередачи <> ДАТАВРЕМЯ(1, 1, 1)
	И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты >= ТаблицаДляРасчетаПеней.ДатаПередачи

ОБЪЕДИНИТЬ

ВЫБРАТЬ
	ПараметрыНачисленияПени.Период,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты КАК ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
		ПО ТаблицаДляРасчетаПеней.ДоговорЛизинга = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ДоговорКонтрагента
			И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
		ПО (ПараметрыНачисленияПени.Период <= ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			И (ПараметрыНачисленияПени.Период >= ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета)
			И (ПараметрыНачисленияПени.ДоговорКонтрагента = ТаблицаДляРасчетаПеней.ДоговорЛизинга)
			И (ВЫБОР
				КОГДА ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты ЕСТЬ NULL
					ТОГДА ПараметрыНачисленияПени.ПлановаяДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ПараметрыНачисленияПени.ПлановаяДатаОплаты = ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты
			КОНЕЦ)
			И (ТаблицаДляРасчетаПеней.ДатаПередачи <> ДАТАВРЕМЯ(1, 1, 1))
			И (ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты >= ТаблицаДляРасчетаПеней.ДатаПередачи)

ИНДЕКСИРОВАТЬ ПО
	ДатаПараметров,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение КАК Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта КАК Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ДатыПараметровНачисленияПени.ДатаПараметров КАК ДатаПараметров
ПОМЕСТИТЬ ИнтервалыРасчетаПенейСДатамиИзмененияПараметровНачисленияПени
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДатыПараметровНачисленияПени КАК ДатыПараметровНачисленияПени
		ПО (ВЫБОР
				КОГДА ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета > ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета
					ТОГДА ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета = ДатыПараметровНачисленияПени.ДатаПараметров
				ИНАЧЕ ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета <= ДатыПараметровНачисленияПени.ДатаПараметров
						И ДатыПараметровНачисленияПени.ДатаПараметров <= ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета
			КОНЕЦ)
			И ТаблицаДляРасчетаПеней.ДоговорЛизинга = ДатыПараметровНачисленияПени.ДоговорЛизинга
			И ТаблицаДляРасчетаПеней.Приложение = ДатыПараметровНачисленияПени.Приложение
			И ТаблицаДляРасчетаПеней.СтатьяГрафика = ДатыПараметровНачисленияПени.СтатьяГрафика
			И ТаблицаДляРасчетаПеней.Валюта = ДатыПараметровНачисленияПени.Валюта
			И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты = ДатыПараметровНачисленияПени.ПлановаяДатаОплаты
			И ТаблицаДляРасчетаПеней.НачислениеВнеГрафика = ДатыПараметровНачисленияПени.НачислениеВнеГрафика

ИНДЕКСИРОВАТЬ ПО
	НачалоИнтервалаРасчета,
	КонецИнтервалаРасчета,
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика,
	ДатаПараметров
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Приложение КАК Приложение,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Валюта КАК Валюта,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров КАК НачалоИнтервалаПараметров,
	МИНИМУМ(ВЫБОР
			КОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета <= КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров, ДЕНЬ)
				ТОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета
			ИНАЧЕ КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров, ДЕНЬ)
		КОНЕЦ) КАК КонецИнтервалаПараметров
ПОМЕСТИТЬ ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПени
ИЗ
	ИнтервалыРасчетаПенейСДатамиИзмененияПараметровНачисленияПени КАК ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ИнтервалыРасчетаПенейСДатамиИзмененияПараметровНачисленияПени КАК ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1
		ПО ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.НачалоИнтервалаРасчета
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.КонецИнтервалаРасчета
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДоговорЛизинга = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДоговорЛизинга
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Приложение = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.Приложение
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.СтатьяГрафика = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.СтатьяГрафика
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Валюта = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.Валюта
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ПлановаяДатаОплаты
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачислениеВнеГрафика = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.НачислениеВнеГрафика
			И (ВЫБОР
				КОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета >= НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета, ДЕНЬ)
					ТОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров
				ИНАЧЕ ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров < ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров
			КОНЕЦ)
ГДЕ
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты <= ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров

СГРУППИРОВАТЬ ПО
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДоговорЛизинга,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Приложение,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.СтатьяГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Валюта,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров

ИНДЕКСИРОВАТЬ ПО
	НачалоИнтервалаРасчета,
	ДоговорЛизинга
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Приложение КАК Приложение,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Валюта КАК Валюта,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаПараметров КАК НачалоИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаПараметров КАК КонецИнтервалаПараметров,
	МАКСИМУМ(ПараметрыНачисленияПени.Период) КАК ПериодПараметров
ПОМЕСТИТЬ ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПениСДатамиПараметров
ИЗ
	ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПени КАК ТаблицаДляРасчетаПенейПоИнтерваламПараметров
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты КАК ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ДоговорКонтрагента
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаПараметров >= ПараметрыНачисленияПени.Период
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга = ПараметрыНачисленияПени.ДоговорКонтрагента
			И (ВЫБОР
				КОГДА ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты ЕСТЬ NULL
					ТОГДА ПараметрыНачисленияПени.ПлановаяДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПени.ПлановаяДатаОплаты
			КОНЕЦ)

СГРУППИРОВАТЬ ПО
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Приложение,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.СтатьяГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Валюта,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаПараметров

ИНДЕКСИРОВАТЬ ПО
	ПериодПараметров,
	ДоговорЛизинга,
	СтатьяГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.Приложение КАК Приложение,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.Валюта КАК Валюта,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.НачалоИнтервалаПараметров КАК НачалоИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.КонецИнтервалаПараметров КАК КонецИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПериодПараметров КАК ПериодПараметров,
	ЕСТЬNULL(ПараметрыНачисленияПени.СтавкаПени, 0) КАК СтавкаПени,
	ЕСТЬNULL(ПараметрыНачисленияПени.ЛьготныйПериод, 0) КАК ЛьготныйПериод
ПОМЕСТИТЬ ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени
ИЗ
	ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПениСДатамиПараметров КАК ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты КАК ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ДоговорЛизинга = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ДоговорКонтрагента
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПериодПараметров = ПараметрыНачисленияПени.Период
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ДоговорЛизинга = ПараметрыНачисленияПени.ДоговорКонтрагента
			И (ВЫБОР
				КОГДА ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты ЕСТЬ NULL
					ТОГДА ПараметрыНачисленияПени.ПлановаяДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПени.ПлановаяДатаОплаты
			КОНЕЦ)
		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ИсключаемыеСтатьи КАК НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи
		ПО (ВЫБОР
				КОГДА &НаборСтатейИсключаемыхИзБазыРасчетаПени = ЗНАЧЕНИЕ(Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ПустаяСсылка)
					ТОГДА ПараметрыНачисленияПени.НаборИсключаемыхСтатей = НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Ссылка
				ИНАЧЕ НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Ссылка = &НаборСтатейИсключаемыхИзБазыРасчетаПени
			КОНЕЦ)
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.СтатьяГрафика = НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья
ГДЕ
	НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья ЕСТЬ NULL

ИНДЕКСИРОВАТЬ ПО
	НачалоИнтервалаРасчета,
	КонецИнтервалаРасчета,
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение КАК Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта КАК Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.НачалоИнтервалаПараметров, ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета) КАК НачалоИнтервалаРасчета,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета) КАК КонецИнтервалаРасчета,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ТаблицаДляРасчетаПеней.ДатаОплаты
		ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1)
	КОНЕЦ КАК ДатаОплаты,
	ТаблицаДляРасчетаПеней.БазаРасчетаПеней КАК БазаРасчетаПеней,
	ТаблицаДляРасчетаПеней.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ТаблицаДляРасчетаПеней.СуммаКонечныйОстаток
		ИНАЧЕ ТаблицаДляРасчетаПеней.СуммаНачальныйОстаток
	КОНЕЦ КАК СуммаКонечныйОстаток,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ТаблицаДляРасчетаПеней.СуммаОплаты
		ИНАЧЕ 0
	КОНЕЦ КАК СуммаОплаты,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.СтавкаПени, 0) КАК СтавкаПени,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.ЛьготныйПериод, 0) КАК ЛьготныйПериод,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		ИНАЧЕ ВЫБОР
				КОГДА ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета) = &КонецПериода
					ТОГДА ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			КОНЕЦ
	КОНЕЦ КАК ДатаИзмененияПараметров
ПОМЕСТИТЬ ТаблицаДляРасчетаПенейСПараметрамиНачисленияПени
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
		ЛЕВОЕ СОЕДИНЕНИЕ ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени КАК ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени
		ПО ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.НачалоИнтервалаРасчета
			И ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаРасчета
			И ТаблицаДляРасчетаПеней.ДоговорЛизинга = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.ДоговорЛизинга
			И ТаблицаДляРасчетаПеней.Приложение = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.Приложение
			И ТаблицаДляРасчетаПеней.СтатьяГрафика = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.СтатьяГрафика
			И ТаблицаДляРасчетаПеней.Валюта = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.Валюта
			И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.ПлановаяДатаОплаты
			И ТаблицаДляРасчетаПеней.НачислениеВнеГрафика = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.НачислениеВнеГрафика

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика,
	НачалоИнтервалаРасчета
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ЕСТЬNULL(ТаблицаВзаиморасчетов.ДоговорЛизинга, ТаблицаДляРасчетаПеней.ДоговорЛизинга) КАК ДоговорЛизинга,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.Приложение, ТаблицаДляРасчетаПеней.Приложение) КАК Приложение,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.СтатьяГрафика, ТаблицаДляРасчетаПеней.СтатьяГрафика) КАК СтатьяГрафика,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.Валюта, ТаблицаДляРасчетаПеней.Валюта) КАК Валюта,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.ПлановаяДатаОплаты, ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты) КАК ПлановаяДатаОплаты,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.НачислениеВнеГрафика, ТаблицаДляРасчетаПеней.НачислениеВнеГрафика) КАК НачислениеВнеГрафика,
	ЕСТЬNULL(ТаблицаДляРасчетаПеней.СуммаНачальныйОстаток, ТаблицаВзаиморасчетов.Сумма) КАК СуммаКОплате,
	ТаблицаВзаиморасчетов.Сумма КАК СуммаНачисленная,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.ЭтоПлатежПоТекущемуГрафику, ИСТИНА) КАК ЭтоПлатежПоТекущемуГрафику,
	ВЫБОР
		КОГДА ТаблицаВзаиморасчетов.ПлановаяДатаОплаты > ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
			ТОГДА ТаблицаВзаиморасчетов.ПлановаяДатаОплаты
		ИНАЧЕ ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
	КОНЕЦ КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.ДатаОплаты КАК ДатаОплаты,
	ТаблицаДляРасчетаПеней.СуммаОплаты КАК СуммаОплаты,
	ТаблицаДляРасчетаПеней.СуммаКонечныйОстаток КАК СуммаОстаток,
	ТаблицаВзаиморасчетов.НомерПлатежа КАК НомерПлатежа,
	ПроизводственныйКалендарь.ПервыйРабочийДень КАК ПервыйРабочийДень,
	ТаблицаПередач.ДатаПередачи КАК ДатаПередачи,
	ВЫБОР
		КОГДА ПроизводственныйКалендарь.ПервыйРабочийДень < ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
			ТОГДА РАЗНОСТЬДАТ(ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
		КОГДА ПроизводственныйКалендарь.ПервыйРабочийДень < ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета
			ТОГДА РАЗНОСТЬДАТ(ПроизводственныйКалендарь.ПервыйРабочийДень, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
		ИНАЧЕ 0
	КОНЕЦ КАК ДнейСкорректированных,
	ВЫБОР
		КОГДА НАЧАЛОПЕРИОДА(ПроизводственныйКалендарь.ПервыйРабочийДень, ДЕНЬ) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоПросроченныйПлатеж,
	ВЫБОР
		КОГДА НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты, ДЕНЬ) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоПросроченныйПлатежПоКалендарнымДням,
	ВЫБОР
		КОГДА НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты, МЕСЯЦ) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, МЕСЯЦ)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоПросроченныйПлатежПереходящийМесяц,
	ТаблицаДляРасчетаПеней.СтавкаПени КАК СтавкаПени,
	ТаблицаДляРасчетаПеней.ЛьготныйПериод КАК ЛьготныйПериод,
	ТаблицаДляРасчетаПеней.БазаРасчетаПеней КАК БазаРасчетаПеней,
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА ДОБАВИТЬКДАТЕ(ПроизводственныйКалендарь.ПервыйРабочийДень, ДЕНЬ, ТаблицаДляРасчетаПеней.ЛьготныйПериод) < ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
				ТОГДА РАЗНОСТЬДАТ(ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			КОГДА ДОБАВИТЬКДАТЕ(ПроизводственныйКалендарь.ПервыйРабочийДень, ДЕНЬ, ТаблицаДляРасчетаПеней.ЛьготныйПериод) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
				ТОГДА РАЗНОСТЬДАТ(ПроизводственныйКалендарь.ПервыйРабочийДень, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			ИНАЧЕ 0
		КОНЕЦ * ВЫБОР
			КОГДА ЕСТЬNULL(ТаблицаДляРасчетаПеней.БазаРасчетаПеней, 0) < 0
				ТОГДА 0
			ИНАЧЕ ЕСТЬNULL(ТаблицаДляРасчетаПеней.БазаРасчетаПеней, 0)
		КОНЕЦ * ТаблицаДляРасчетаПеней.СтавкаПени * 0.01 КАК ЧИСЛО(15, 2)) КАК СуммаПеней,
	ТаблицаДляРасчетаПеней.ДатаИзмененияПараметров КАК ДатаИзмененияПараметров,
	ВЫБОР
		КОГДА ЕСТЬNULL(ТаблицаВзаиморасчетов.СтатьяГрафика, ТаблицаДляРасчетаПеней.СтатьяГрафика) = &СтатьяЛП
			ТОГДА 1
		ИНАЧЕ 2
	КОНЕЦ КАК РазделительСтатейПоОплатеПеней
ПОМЕСТИТЬ ТаблицаРассчитанныхПеней
ИЗ
	ТаблицаНачислений КАК ТаблицаВзаиморасчетов
		ПОЛНОЕ СОЕДИНЕНИЕ ТаблицаДляРасчетаПенейСПараметрамиНачисленияПени КАК ТаблицаДляРасчетаПеней
		ПО ТаблицаВзаиморасчетов.ДоговорЛизинга = ТаблицаДляРасчетаПеней.ДоговорЛизинга
			И ТаблицаВзаиморасчетов.Приложение = ТаблицаДляРасчетаПеней.Приложение
			И ТаблицаВзаиморасчетов.СтатьяГрафика = ТаблицаДляРасчетаПеней.СтатьяГрафика
			И ТаблицаВзаиморасчетов.Валюта = ТаблицаДляРасчетаПеней.Валюта
			И ТаблицаВзаиморасчетов.ПлановаяДатаОплаты = ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты
			И ТаблицаВзаиморасчетов.НачислениеВнеГрафика = ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
		ЛЕВОЕ СОЕДИНЕНИЕ ПроизводственныйКалендарь КАК ПроизводственныйКалендарь
		ПО ТаблицаВзаиморасчетов.ПлановаяДатаОплаты = ПроизводственныйКалендарь.Дата
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаПередач КАК ТаблицаПередач
		ПО ТаблицаВзаиморасчетов.ДоговорЛизинга = ТаблицаПередач.ДоговорЛизинга

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	Валюта,
	КонецИнтервалаРасчета,
	НомерПлатежа
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаРассчитанныхПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаРассчитанныхПеней.Приложение КАК Приложение,
	ТаблицаРассчитанныхПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаРассчитанныхПеней.Валюта КАК Валюта,
	ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаРассчитанныхПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаРассчитанныхПеней.СуммаКОплате КАК СуммаКОплате,
	ТаблицаРассчитанныхПеней.СуммаНачисленная КАК СуммаНачисленная,
	ТаблицаРассчитанныхПеней.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику,
	ТаблицаРассчитанныхПеней.ДатаПередачи КАК ДатаПередачи,
	ТаблицаРассчитанныхПеней.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.ДатаОплаты КАК ДатаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОплаты КАК СуммаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОстаток КАК СуммаОстаток,
	ТаблицаРассчитанныхПеней.НомерПлатежа КАК НомерПлатежа,
	ТаблицаРассчитанныхПеней.ПервыйРабочийДень КАК ПервыйРабочийДень,
	ТаблицаРассчитанныхПеней.ДнейСкорректированных КАК ДнейСкорректированных,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатеж КАК ЭтоПросроченныйПлатеж,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатежПоКалендарнымДням КАК ЭтоПросроченныйПлатежПоКалендарнымДням,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатежПереходящийМесяц КАК ЭтоПросроченныйПлатежПереходящийМесяц,
	ТаблицаРассчитанныхПеней.ДатаИзмененияПараметров КАК ДатаИзмененияПараметров,
	ТаблицаРассчитанныхПеней.СтавкаПени КАК СтавкаПени,
	ТаблицаРассчитанныхПеней.ЛьготныйПериод КАК ЛьготныйПериод,
	ТаблицаРассчитанныхПеней.СуммаПеней КАК СуммаПеней,
	ТаблицаРассчитанныхПеней.РазделительСтатейПоОплатеПеней КАК РазделительСтатейПоОплатеПеней,
	СУММА(ЕСТЬNULL(ТаблицаРассчитанныхПеней1.СуммаПеней, 0)) КАК СуммаПенейНарастающийИтог
ПОМЕСТИТЬ ТаблицаРассчитанныхПенейСНарастающимИтогом
ИЗ
	ТаблицаРассчитанныхПеней КАК ТаблицаРассчитанныхПеней
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаРассчитанныхПеней КАК ТаблицаРассчитанныхПеней1
		ПО ТаблицаРассчитанныхПеней.ДоговорЛизинга = ТаблицаРассчитанныхПеней1.ДоговорЛизинга
			И ТаблицаРассчитанныхПеней.Приложение = ТаблицаРассчитанныхПеней1.Приложение
			И ТаблицаРассчитанныхПеней.Валюта = ТаблицаРассчитанныхПеней1.Валюта
			И (ВЫБОР
				КОГДА ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета = ТаблицаРассчитанныхПеней1.КонецИнтервалаРасчета
					ТОГДА ВЫБОР
							КОГДА ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты = ТаблицаРассчитанныхПеней1.ПлановаяДатаОплаты
								ТОГДА ВЫБОР
										КОГДА ТаблицаРассчитанныхПеней.НачислениеВнеГрафика = ТаблицаРассчитанныхПеней1.НачислениеВнеГрафика
											ТОГДА ТаблицаРассчитанныхПеней.СтатьяГрафика >= ТаблицаРассчитанныхПеней1.СтатьяГрафика
										ИНАЧЕ ТаблицаРассчитанныхПеней.НачислениеВнеГрафика >= ТаблицаРассчитанныхПеней1.НачислениеВнеГрафика
									КОНЕЦ
							ИНАЧЕ ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты >= ТаблицаРассчитанныхПеней1.ПлановаяДатаОплаты
						КОНЕЦ
				ИНАЧЕ ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета >= ТаблицаРассчитанныхПеней1.КонецИнтервалаРасчета
			КОНЕЦ)
			И ТаблицаРассчитанныхПеней.РазделительСтатейПоОплатеПеней = ТаблицаРассчитанныхПеней1.РазделительСтатейПоОплатеПеней

СГРУППИРОВАТЬ ПО
	ТаблицаРассчитанныхПеней.ДоговорЛизинга,
	ТаблицаРассчитанныхПеней.Приложение,
	ТаблицаРассчитанныхПеней.СтатьяГрафика,
	ТаблицаРассчитанныхПеней.Валюта,
	ТаблицаРассчитанныхПеней.НачислениеВнеГрафика,
	ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты,
	ТаблицаРассчитанныхПеней.СуммаКОплате,
	ТаблицаРассчитанныхПеней.СуммаНачисленная,
	ТаблицаРассчитанныхПеней.ЭтоПлатежПоТекущемуГрафику,
	ТаблицаРассчитанныхПеней.ДатаПередачи,
	ТаблицаРассчитанныхПеней.НачалоИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.ДатаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОстаток,
	ТаблицаРассчитанныхПеней.НомерПлатежа,
	ТаблицаРассчитанныхПеней.ПервыйРабочийДень,
	ТаблицаРассчитанныхПеней.ДнейСкорректированных,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатеж,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатежПоКалендарнымДням,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатежПереходящийМесяц,
	ТаблицаРассчитанныхПеней.СтавкаПени,
	ТаблицаРассчитанныхПеней.ЛьготныйПериод,
	ТаблицаРассчитанныхПеней.СуммаПеней,
	ТаблицаРассчитанныхПеней.ДатаИзмененияПараметров,
	ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.РазделительСтатейПоОплатеПеней

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОсновнаяТаблица.ДоговорЛизинга.Владелец КАК Контрагент,
	ОсновнаяТаблица.ДоговорЛизинга КАК ДоговорЛизинга,
	ОсновнаяТаблица.Приложение КАК Приложение,
	ОсновнаяТаблица.СтатьяГрафика КАК Статья,
	ОсновнаяТаблица.Валюта КАК Валюта,
	ОсновнаяТаблица.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ОсновнаяТаблица.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ОсновнаяТаблица.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ОсновнаяТаблица.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ОсновнаяТаблица.ПервыйРабочийДень КАК ПервыйРабочийДень,
	ОсновнаяТаблица.СуммаКОплате КАК СуммаКОплате,
	ОсновнаяТаблица.СуммаНачисленная КАК СуммаНачисленная,
	ОсновнаяТаблица.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафикуПлатежей,
	ОсновнаяТаблица.НомерПлатежа КАК НомерПлатежа,
	ОсновнаяТаблица.ДатаОплаты КАК ДатаОплаты,
	ОсновнаяТаблица.СуммаОплаты КАК СуммаОплаты,
	ОсновнаяТаблица.СуммаОстаток КАК СуммаОстаток,
	ОсновнаяТаблица.ДатаПередачи КАК ДатаПередачи,
	ОсновнаяТаблица.ДнейСкорректированных КАК ДнейСкорректированных,
	ОсновнаяТаблица.ЭтоПросроченныйПлатеж КАК ЭтоПросроченныйПлатеж,
	ОсновнаяТаблица.ЭтоПросроченныйПлатежПоКалендарнымДням КАК ЭтоПросроченныйПлатежПоКалендарнымДням,
	ОсновнаяТаблица.ЭтоПросроченныйПлатежПереходящийМесяц КАК ЭтоПросроченныйПлатежПереходящийМесяц,
	ОсновнаяТаблица.ДатаИзмененияПараметров КАК ДатаИзмененияПараметров,
	ОсновнаяТаблица.СтавкаПени КАК СтавкаПени,
	ОсновнаяТаблица.ЛьготныйПериод КАК ЛьготныйПериод,
	ОсновнаяТаблица.СуммаПеней КАК СуммаПеней,
	ОсновнаяТаблица.СуммаПенейНарастающийИтог КАК СуммаПенейНарастающийИтог,
	МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0)) КАК ОбщаяСуммаОплаченныхПеней,
	ВЫБОР
		КОГДА МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0)) > ОсновнаяТаблица.СуммаПенейНарастающийИтог
			ТОГДА ОсновнаяТаблица.СуммаПеней
		КОГДА ОсновнаяТаблица.СуммаПенейНарастающийИтог - ОсновнаяТаблица.СуммаПеней > МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0))
			ТОГДА 0
		ИНАЧЕ МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0)) - ОсновнаяТаблица.СуммаПенейНарастающийИтог + ОсновнаяТаблица.СуммаПеней
	КОНЕЦ КАК ПениОплачено,
	ВЫБОР
		КОГДА ОсновнаяТаблица.ЭтоПросроченныйПлатеж
			ТОГДА ЕСТЬNULL(СУММА(ТаблицаВзаиморасчетовВесьПериод.ПросроченныйПлатеж), 0) + 1
		ИНАЧЕ 0
	КОНЕЦ КАК ПовторениеПросрочки,
	ОсновнаяТаблица.РазделительСтатейПоОплатеПеней КАК РазделительСтатейПоОплатеПеней
ПОМЕСТИТЬ ВтИтог
ИЗ
	ТаблицаРассчитанныхПенейСНарастающимИтогом КАК ОсновнаяТаблица
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаВзаиморасчетовВесьПериод КАК ТаблицаВзаиморасчетовВесьПериод
		ПО ОсновнаяТаблица.ДоговорЛизинга = ТаблицаВзаиморасчетовВесьПериод.ДоговорЛизинга
			И ОсновнаяТаблица.Приложение = ТаблицаВзаиморасчетовВесьПериод.Приложение
			И ОсновнаяТаблица.СтатьяГрафика = ТаблицаВзаиморасчетовВесьПериод.СтатьяГрафика
			И ОсновнаяТаблица.Валюта = ТаблицаВзаиморасчетовВесьПериод.Валюта
			И ОсновнаяТаблица.ПлановаяДатаОплаты > ТаблицаВзаиморасчетовВесьПериод.ПлановаяДатаОплаты
			И ОсновнаяТаблица.НачислениеВнеГрафика = ТаблицаВзаиморасчетовВесьПериод.НачислениеВнеГрафика
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОплатПенейВесьПериод КАК ОплатыПеней
		ПО ОсновнаяТаблица.ДоговорЛизинга = ОплатыПеней.ДоговорЛизинга
			И ОсновнаяТаблица.Приложение = ОплатыПеней.Приложение
			И ОсновнаяТаблица.Валюта = ОплатыПеней.Валюта
			И ОсновнаяТаблица.РазделительСтатейПоОплатеПеней = ОплатыПеней.РазделительСтатейПоОплатеПеней
ГДЕ
	ОсновнаяТаблица.ПлановаяДатаОплаты МЕЖДУ &НачалоПериода И &КонецПериода

СГРУППИРОВАТЬ ПО
	ОсновнаяТаблица.ДоговорЛизинга.Владелец,
	ОсновнаяТаблица.ДоговорЛизинга,
	ОсновнаяТаблица.Приложение,
	ОсновнаяТаблица.СтатьяГрафика,
	ОсновнаяТаблица.Валюта,
	ОсновнаяТаблица.ДатаПередачи,
	ОсновнаяТаблица.НачислениеВнеГрафика,
	ОсновнаяТаблица.ПлановаяДатаОплаты,
	ОсновнаяТаблица.ЭтоПросроченныйПлатеж,
	ОсновнаяТаблица.ЭтоПросроченныйПлатежПоКалендарнымДням,
	ОсновнаяТаблица.ЭтоПросроченныйПлатежПереходящийМесяц,
	ОсновнаяТаблица.НомерПлатежа,
	ОсновнаяТаблица.ПервыйРабочийДень,
	ОсновнаяТаблица.ДатаОплаты,
	ОсновнаяТаблица.НачалоИнтервалаРасчета,
	ОсновнаяТаблица.СуммаКОплате,
	ОсновнаяТаблица.СуммаНачисленная,
	ОсновнаяТаблица.СуммаПенейНарастающийИтог,
	ОсновнаяТаблица.ЭтоПлатежПоТекущемуГрафику,
	ОсновнаяТаблица.СуммаОплаты,
	ОсновнаяТаблица.СуммаОстаток,
	ОсновнаяТаблица.ДнейСкорректированных,
	ОсновнаяТаблица.СтавкаПени,
	ОсновнаяТаблица.ЛьготныйПериод,
	ОсновнаяТаблица.СуммаПеней,
	ОсновнаяТаблица.ДатаИзмененияПараметров,
	ОсновнаяТаблица.КонецИнтервалаРасчета,
	ОсновнаяТаблица.РазделительСтатейПоОплатеПеней
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	МАКСИМУМ(&ДатаСреза) КАК ДатаАктуальности,
	ВтИтог.Контрагент КАК Контрагент,
	ВтИтог.ДоговорЛизинга.Код КАК ДоговорКод,
	ВтИтог.ДоговорЛизинга.хлНомерДоговора КАК НомерДоговора,
	МАКСИМУМ(ВтИтог.ДатаПередачи) КАК ДатаПередачи,
	МАКСИМУМ(ВЫБОР
			КОГДА (ВтИтог.ЭтоПросроченныйПлатежПереходящийМесяц = ИСТИНА
					ИЛИ ВтИтог.ЭтоПросроченныйПлатежПоКалендарнымДням = ИСТИНА
						И НАЧАЛОПЕРИОДА(ВтИтог.КонецИнтервалаРасчета, ДЕНЬ) = НАЧАЛОПЕРИОДА(&КонецПериода, ДЕНЬ)
					И ВтИтог.КонецИнтервалаРасчета >= ДОБАВИТЬКДАТЕ(&ДатаСреза, ДЕНЬ, -3))
					И ВтИтог.ПервыйРабочийДень ЕСТЬ НЕ NULL 
					И ВтИтог.СуммаКОплате > 0
				ТОГДА 1
			ИНАЧЕ 0
		КОНЕЦ) КАК OVERDUE_FLG_1с,
	МАКСИМУМ(ВтИтог.КонецИнтервалаРасчета) КАК КонецИнтервалаРасчета,
	МАКСИМУМ(ВтИтог.ПлановаяДатаОплаты) КАК ПлановаяДатаОплаты,
	МАКСИМУМ(ВтИтог.ПервыйРабочийДень) КАК ПервыйРабочийДень,
	МАКСИМУМ(ВтИтог.ДатаОплаты) КАК ДатаОплаты
ИЗ
	ВтИтог КАК ВтИтог

СГРУППИРОВАТЬ ПО
	ВтИтог.Контрагент,
	ВтИтог.ДоговорЛизинга.Код,
	ВтИтог.ДоговорЛизинга.хлНомерДоговора"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",24},
{1,"ЭтоВыражение",
{"Pattern"},"В",10},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"#",5a49abd5-936d-4f46-8499-9cb204efe378},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",24}
},
{2,3,0,0,1,1,2,2,
{1,12,
{2,89,3,
{"S","ДоговорЛизинга"},
{"B",0},
{"#",376807bc-0d88-4c06-9eb2-42b72b970afb,25:836b94049cc883ef11ed82c1ce4f875a},0},
{2,90,3,
{"S","НачалоПериода"},
{"B",0},
{"D",20010101000000},0},
{2,91,3,
{"S","КонецПериода"},
{"B",0},
{"D",20230704235959},0},
{2,92,3,
{"S","ДатаСреза"},
{"B",0},
{"D",20230705000000},0},
{2,93,3,
{"S","НаборСтатейИсключаемыхИзБазыРасчетаПени"},
{"B",0},
{"#",c3ec4375-8577-46d5-be3b-185e29cc8b67,17853:00000000000000000000000000000000},0},
{2,94,3,
{"S","НазначениеПени"},
{"B",0},
{"#",6bcdbfc3-84d1-4e5c-8ca9-d8e2b284449a,10672:ab6d3182f5ebc532496b0dcec964ddde},0},
{2,95,3,
{"S","НачалоВеденияУчета"},
{"B",0},
{"D",20010101000000},0},
{2,96,3,
{"S","СтатьяКомпенсацияСтрахования"},
{"B",0},
{"#",6bcdbfc3-84d1-4e5c-8ca9-d8e2b284449a,10672:86c101a9072f8a0e40fec391bb9e00a9},0},
{2,97,3,
{"S","СтатьяЛП"},
{"B",0},
{"#",46acbd87-b2d2-42f3-a9cc-ae9d20da8355,531:b6f2001b78e1182a11de1aad5fa16558},0},
{2,98,3,
{"S","Страна"},
{"B",0},
{"#",4ee4f6c6-683e-4abc-8890-ed6cde5a53cb,33:8ce4d57185730a3b4108effa215d0c81},0},
{2,99,3,
{"S","ШтрафыЗаСтрахование"},
{"B",0},
{"#",46acbd87-b2d2-42f3-a9cc-ae9d20da8355,531:816494049cc883ef11e5523c750d54c3},0},
{2,100,3,
{"S","Статья"},
{"B",0},
{"#",46acbd87-b2d2-42f3-a9cc-ae9d20da8355,531:b6f2001b78e1182a11de1aad5fa16558},0}
},2,100},
{0,0}
}
},
{"N",1},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{2,
{0,"ИмяВарианта",
{"Pattern",
{"S"}
},"Имя варианта",16},
{1,"ТекстКода",
{"Pattern",
{"S"}
},"Текст кода",95}
},
{2,2,0,0,1,1,
{1,0},1,-1},
{0,0}
}
},
{"#",e199ca70-93cf-46ce-a54b-6edc88c3a296,
{#base64:AQE4EgAAAAAAAO+7v3siIyIsM2Q0OGZlYWUtYTljNi00YzVhLWEwOTktOWViNjQ3
NzYzMGM2LA0KezIsDQp7DQp7IlMiLCLRhdC70J3QvtC80LXRgNCU0L7Qs9C+0LLQ
vtGA0LAifSwNCnsiIyIsNDIzODAxOWQtN2U0OS00ZmM5LTkxZGItYjZiOTUxZDVj
ZjhlLA0KezUsDQp7DQp7IlMiLCLQndCw0YfQsNC70YzQvdCw0Y/QodGC0YDQvtC6
0LAifSwNCnsiTiIsMH0NCn0sDQp7DQp7IlMiLCLQmtC+0L3QtdGH0L3QsNGP0KHR
gtGA0L7QutCwIn0sDQp7Ik4iLDB9DQp9LA0Kew0KeyJTIiwi0KLQuNC/0JfQvdCw
0YfQtdC90LjRj9Ce0LHRitC10LrRgtCwIn0sDQp7IlUifQ0KfSwNCnsNCnsiUyIs
ItCf0L7Qu9GP0KHQuNC90YXRgNC+0L3QuNC30LDRhtC40LgifSwNCnsiIyIsYWNm
NjE5MmUtODFjYS00NmVmLTkzYTYtNWE2OTY4Yjc4NjYzLA0KezksDQp7NCwNCnsw
LCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC90LjQt9Cw0YbQuNC4IiwNCnsiUGF0dGVy
biIsDQp7IlMifQ0KfSwi0J/QvtC70LUg0YHQuNC90YXRgNC+0L3QuNC30LDRhtC4
0LgiLDMxfSwNCnsxLCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC90LjQt9Cw0YbQuNC4
0J/RgNC10LTRgdGC0LDQstC70LXQvdC40LUiLA0KeyJQYXR0ZXJuIiwNCnsiUyJ9
DQp9LCLQn9GA0LXQtNGB0YLQsNCy0LvQtdC90LjQtSIsMzF9LA0KezIsItCf0L7Q
u9C10KHQuNC90YXRgNC+0L3QuNC30LDRhtC40LjQotC40L/Ql9C90LDRh9C10L3Q
uNGPIiwNCnsiUGF0dGVybiIsDQp7IiMiLGY1YzY1MDUwLTNiYmItMTFkNS1iOTg4
LTAwNTBiYWUwYTk1ZH0NCn0sItCi0LjQvyDQt9C90LDRh9C10L3QuNGPIiwyMX0s
DQp7Mywi0J3QvtC80LXRgNCa0L7Qu9C+0L3QutC40J7RgtCx0L7RgNCwIiwNCnsi
UGF0dGVybiIsDQp7Ik4iLDEwLDAsMX0NCn0sItCd0L7QvNC10YAg0LrQvtC70L7Q
vdC60Lgg0YLQsNCx0LvQuNGG0Ysg0L7RgtCx0L7RgNCwIiwyNn0NCn0sDQp7Miw0
LDAsMCwxLDEsMiwyLDMsMywNCnsxLDB9LDMsLTF9LA0KezAsMH0NCn0NCn0NCn0s
DQp7DQp7IlMiLCLQotCw0LHQu9C40YfQvdGL0LnQlNC+0LrRg9C80LXQvdGC0J7R
gtCx0L7RgNCwIn0sDQp7IiMiLGU2MDMxMDNlLWEzMTgtNGVkYy1hMDE0LWIxYzZj
Zjk0ZDQ5ZiwNCns4LDEsMTEsDQp7IiMiLCIiLDEsMSwiIyIsItCv0LfRi9C6INC/
0L4g0YPQvNC+0LvRh9Cw0L3QuNGOIiwi0K/Qt9GL0Log0L/QviDRg9C80L7Qu9GH
0LDQvdC40Y4iLDB9LA0KezEyOCw3Mn0sDQp7MH0sMCwNCnswLDB9LA0KezAsMH0s
DQp7MCwwfSwNCnswLDB9LA0KezAsMH0sDQp7MCwwfSwwLDIsMCwNCnswLDAsMDAw
MDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAwLDB9LDAsMCwwLDAsMCww
LDAsMCwwLA0KezB9LA0KezB9LA0KezB9LA0KezB9LCIiLA0Kew0KezAsNiw2LA0K
eyJOIiwxMDAwfSw3LA0KeyJOIiwxMDAwfSw4LA0KeyJOIiwxMDAwfSw5LA0KeyJO
IiwxMDAwfSwxMCwNCnsiTiIsMTAwMH0sMTEsDQp7Ik4iLDEwMDB9DQp9DQp9LA0K
ezAsLTEsLTEsLTEsLTEsMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAw
MDAwfSwwLDAsMCwwLDAsMCwwLDEsMCwxLDAsMCwwLDAsMCwyLA0KezMsMywNCnst
MX0NCn0sDQp7MywzLA0Key0zfQ0KfSwwLDAsMCwiIiwwLA0KezMsMCwwLDEwMCwx
LDEsMCwxLDEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsIiIsMCwwLDAsMCwwLDAs
MH0sDQp7MH0sMCwwLDAsMSwwLDB9DQp9DQp9DQp9DQp9DQp9LA0Kew0KeyJTIiwi
0JTQvtCz0L7QstC+0YDQm9C40LfQuNC90LPQsCJ9LA0KeyIjIiw0MjM4MDE5ZC03
ZTQ5LTRmYzktOTFkYi1iNmI5NTFkNWNmOGUsDQp7NSwNCnsNCnsiUyIsItCd0LDR
h9Cw0LvRjNC90LDRj9Ch0YLRgNC+0LrQsCJ9LA0KeyJOIiwxfQ0KfSwNCnsNCnsi
UyIsItCa0L7QvdC10YfQvdCw0Y/QodGC0YDQvtC60LAifSwNCnsiTiIsMX0NCn0s
DQp7DQp7IlMiLCLQotC40L/Ql9C90LDRh9C10L3QuNGP0J7QsdGK0LXQutGC0LAi
fSwNCnsiVCIsMzc2ODA3YmMtMGQ4OC00YzA2LTllYjItNDJiNzJiOTcwYWZifQ0K
fSwNCnsNCnsiUyIsItCf0L7Qu9GP0KHQuNC90YXRgNC+0L3QuNC30LDRhtC40Lgi
fSwNCnsiIyIsYWNmNjE5MmUtODFjYS00NmVmLTkzYTYtNWE2OTY4Yjc4NjYzLA0K
ezksDQp7NCwNCnswLCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC90LjQt9Cw0YbQuNC4
IiwNCnsiUGF0dGVybiIsDQp7IlMifQ0KfSwi0J/QvtC70LUg0YHQuNC90YXRgNC+
0L3QuNC30LDRhtC40LgiLDMxfSwNCnsxLCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC9
0LjQt9Cw0YbQuNC40J/RgNC10LTRgdGC0LDQstC70LXQvdC40LUiLA0KeyJQYXR0
ZXJuIiwNCnsiUyJ9DQp9LCLQn9GA0LXQtNGB0YLQsNCy0LvQtdC90LjQtSIsMzF9
LA0KezIsItCf0L7Qu9C10KHQuNC90YXRgNC+0L3QuNC30LDRhtC40LjQotC40L/Q
l9C90LDRh9C10L3QuNGPIiwNCnsiUGF0dGVybiIsDQp7IiMiLGY1YzY1MDUwLTNi
YmItMTFkNS1iOTg4LTAwNTBiYWUwYTk1ZH0NCn0sItCi0LjQvyDQt9C90LDRh9C1
0L3QuNGPIiwyMX0sDQp7Mywi0J3QvtC80LXRgNCa0L7Qu9C+0L3QutC40J7RgtCx
0L7RgNCwIiwNCnsiUGF0dGVybiIsDQp7Ik4iLDEwLDAsMX0NCn0sItCd0L7QvNC1
0YAg0LrQvtC70L7QvdC60Lgg0YLQsNCx0LvQuNGG0Ysg0L7RgtCx0L7RgNCwIiwy
Nn0NCn0sDQp7Miw0LDAsMCwxLDEsMiwyLDMsMywNCnsxLDEsDQp7MiwwLDQsDQp7
IlMiLCLRhdC70J3QvtC80LXRgNCU0L7Qs9C+0LLQvtGA0LAifSwNCnsiUyIsItCU
0L7Qs9C+0LLQvtGA0JvQuNC30LjQvdCz0LAu0J3QvtC80LXRgCDQtNC+0LPQvtCy
0L7RgNCwIn0sDQp7IiMiLGY1YzY1MDUwLTNiYmItMTFkNS1iOTg4LTAwNTBiYWUw
YTk1ZCwNCnsiUGF0dGVybiIsDQp7IlMiLDEwMCwxfQ0KfQ0KfSwNCnsiTiIsMX0s
MH0NCn0sMywwfSwNCnswLDB9DQp9DQp9DQp9LA0Kew0KeyJTIiwi0KLQsNCx0LvQ
uNGH0L3Ri9C50JTQvtC60YPQvNC10L3RgtCe0YLQsdC+0YDQsCJ9LA0KeyIjIixl
NjAzMTAzZS1hMzE4LTRlZGMtYTAxNC1iMWM2Y2Y5NGQ0OWYsDQp7OCwxLDExLA0K
eyIjIiwiIiwxLDEsIiMiLCLQr9C30YvQuiDQv9C+INGD0LzQvtC70YfQsNC90LjR
jiIsItCv0LfRi9C6INC/0L4g0YPQvNC+0LvRh9Cw0L3QuNGOIiwwfSwNCnsxMjgs
NzJ9LA0KezB9LDAsDQp7MCwwfSwNCnswLDB9LA0KezAsMH0sDQp7MCwwfSwNCnsw
LDB9LA0KezAsMH0sMCwyLDE2LDAsMCwxLDAsDQp7MTYsMSwNCnsxLDEsDQp7IiMi
LCLQkNCbIDI1MDcyLzAxLTE0INCa0JfQnSJ9DQp9LDB9LDEsMCwxLDAsDQp7MTYs
MCwNCnsxLDEsDQp7IiMiLCLQkNCbIDI2NjA5LzAxLTE0INCj0JvQnSJ9DQp9LDB9
LDIsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDI1NTA1LzAyLTE0
INCS0KDQliJ9DQp9LDB9LDMsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQ
kNCbIDI0MTQ0LzA0LTE0INCa0JfQnSJ9DQp9LDB9LDQsMCwxLDAsDQp7MTYsMCwN
CnsxLDEsDQp7IiMiLCLQkNCbIDI2MTA3LzAyLTE0INCf0J3QlyJ9DQp9LDB9LDUs
MCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDI0Njg1LzAyLTE0INCV
0JrQkSJ9DQp9LDB9LDYsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCb
IDMwOTU5LzAxLTE0INCd0JHQpyJ9DQp9LDB9LDcsMCwxLDAsDQp7MTYsMCwNCnsx
LDEsDQp7IiMiLCLQkNCbIDc0Mjc4LzAxLTE2INCh0KDQoiJ9DQp9LDB9LDgsMCwx
LDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDkyNTAwLzAxLTE3INCh0JzQ
oCJ9DQp9LDB9LDksMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDk4
NzA4LzAxLTE3INCi0K7QnCJ9DQp9LDB9LDEwLDAsMSwwLA0KezE2LDAsDQp7MSwx
LA0KeyIjIiwi0JDQmyAxMTExNjgvMDEtMTgg0J7QoNCRIn0NCn0sMH0sMTEsMCwx
LDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDIxNzAvMTQtMTkg0JrQoNCh
In0NCn0sMH0sMTIsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDEw
MzgxOC8wMi0xOCJ9DQp9LDB9LDEzLDAsMSwwLA0KezE2LDAsDQp7MSwxLA0KeyIj
Iiwi0JDQmyAxMDM4MTgvMDMtMTgifQ0KfSwwfSwxNCwwLDEsMCwNCnsxNiwwLA0K
ezEsMSwNCnsiIyIsItCQ0JsgOTM5NDMvMDItMTgg0KLQm9CiIn0NCn0sMH0sMTUs
MCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDY2OTg4LzAyLTE2INCR
0JPQlCJ9DQp9LDB9LA0KezEsMCwwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAw
MDAwMDAwMDAsMSwwLDJ9LDE2LDAsMCwwLDAsMCwwLDAsMCwNCnswfSwNCnswfSwN
CnswfSwNCnswfSwiIiwNCnsNCnswLDYsNiwNCnsiTiIsMTAwMH0sNywNCnsiTiIs
MTAwMH0sOCwNCnsiTiIsMTAwMH0sOSwNCnsiTiIsMTAwMH0sMTAsDQp7Ik4iLDEw
MDB9LDExLA0KeyJOIiwxMDAwfQ0KfQ0KfSwNCnswLC0xLC0xLC0xLC0xLDAwMDAw
MDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMH0sMCwwLDAsMCwwLDAsMCwx
LDAsMSwyLA0KezIxNzYsMjAxLDJ9LA0KezEyOCwyMTd9LDAsMCwwLDAsMywNCnsz
LDMsDQp7LTF9DQp9LA0KezMsMywNCnstM30NCn0sDQp7MywzLA0Key03fQ0KfSww
LDAsMCwiIiwwLA0KezMsMCwwLDEwMCwxLDEsMCwxLDEsMCwwLDAsMCwwLDAsMCww
LDAsMCwwLDAsIiIsMCwwLDAsMCwwLDAsMH0sDQp7MH0sMCwwLDAsMSwwLDB9DQp9
DQp9DQp9DQp9DQp9DQp9DQp9}
},0},
{2,6,6,
{"S","есть ли просрочка на конец месяца все с флагом для inn"},
{"S","ВЫБРАТЬ
	хлПриложениеКДоговоруЛизинга.ДоговорЛизинга КАК ДоговорЛизинга,
	хлПриложениеКДоговоруЛизинга.ДоговорЛизинга.ДоговорКонтрагента КАК ДоговорКонтрагента,
	хлПриложениеКДоговоруЛизинга.Номер КАК НомерПриложения,
	хлПриложениеКДоговоруЛизинга.хлпДоговорКонтрагента.Владелец КАК Владелец,
	хлПриложениеКДоговоруЛизинга.хлпДоговорКонтрагента.Владелец.ИНН КАК ИНН
ПОМЕСТИТЬ ВтВсеДоговоры
ИЗ
	Документ.хлПриложениеКДоговоруЛизинга КАК хлПриложениеКДоговоруЛизинга
ГДЕ
	хлПриложениеКДоговоруЛизинга.хлпДоговорКонтрагента.хлНомерДоговора ПОДОБНО ""АЛ %""
	И НЕ хлПриложениеКДоговоруЛизинга.ПометкаУдаления
	И НЕ хлПриложениеКДоговоруЛизинга.хлпДоговорКонтрагента.ПометкаУдаления
	И НЕ хлПриложениеКДоговоруЛизинга.ДоговорЛизинга.ДоговорКонтрагента.Код ЕСТЬ NULL
	И хлПриложениеКДоговоруЛизинга.хлпДоговорКонтрагента.Владелец.ИНН В(&ИНН)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПроизводственныеКалендариСтранМира.Дата КАК Дата,
	ВЫБОР
		КОГДА ПроизводственныеКалендариСтранМира.ВидДня = ЗНАЧЕНИЕ(Перечисление.ВидыДнейПроизводственногоКалендаря.Рабочий)
			ТОГДА ИСТИНА
		КОГДА ПроизводственныеКалендариСтранМира.ВидДня = ЗНАЧЕНИЕ(Перечисление.ВидыДнейПроизводственногоКалендаря.Предпраздничный)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоРабочийДень
ПОМЕСТИТЬ КалендарьПолный
ИЗ
	РегистрСведений.хлПроизводственныеКалендариСтранМира КАК ПроизводственныеКалендариСтранМира
ГДЕ
	ПроизводственныеКалендариСтранМира.Страна = &Страна
	И ПроизводственныеКалендариСтранМира.Дата <= &КонецПериода

ИНДЕКСИРОВАТЬ ПО
	Дата
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	КалендарьПолный.Дата КАК Дата
ПОМЕСТИТЬ КалендарьРабочиеДни
ИЗ
	КалендарьПолный КАК КалендарьПолный
ГДЕ
	КалендарьПолный.ЭтоРабочийДень

ИНДЕКСИРОВАТЬ ПО
	Дата
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	КалендарьПолный.Дата КАК Дата,
	МИНИМУМ(ЕСТЬNULL(КалендарьРабочиеДни.Дата, КалендарьПолный.Дата)) КАК ПервыйРабочийДень
ПОМЕСТИТЬ ПроизводственныйКалендарь
ИЗ
	КалендарьПолный КАК КалендарьПолный
		ЛЕВОЕ СОЕДИНЕНИЕ КалендарьРабочиеДни КАК КалендарьРабочиеДни
		ПО (ВЫБОР
				КОГДА КалендарьПолный.ЭтоРабочийДень
					ТОГДА ЛОЖЬ
				ИНАЧЕ КалендарьПолный.Дата <= КалендарьРабочиеДни.Дата
			КОНЕЦ)

СГРУППИРОВАТЬ ПО
	КалендарьПолный.Дата

ИНДЕКСИРОВАТЬ ПО
	Дата
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга.Владелец КАК Контрагент,
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга КАК ДоговорЛизинга,
	МИНИМУМ(ВЫБОР
			КОГДА ПредметыЛизингаВЛизингеОбороты.КоличествоПриход > 0
				ТОГДА ПредметыЛизингаВЛизингеОбороты.Период
		КОНЕЦ) КАК ДатаПередачи
ПОМЕСТИТЬ ТаблицаПередач
ИЗ
	РегистрНакопления.хлПредметыЛизингаВЛизинге.Обороты(
			&НачалоВеденияУчета,
			&КонецПериода,
			День,
			ДоговорЛизинга В
				(ВЫБРАТЬ
					ВтВсеДоговоры.ДоговорКонтрагента
				ИЗ
					ВтВсеДоговоры)) КАК ПредметыЛизингаВЛизингеОбороты

СГРУППИРОВАТЬ ПО
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга,
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга.Владелец

ИНДЕКСИРОВАТЬ ПО
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ КАК ЭтоФакт,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга.Владелец КАК Контрагент,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга КАК ДоговорЛизинга,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Приложение КАК Приложение,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Статья КАК СтатьяГрафика,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Валюта КАК Валюта,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Дата КАК ПлановаяДатаОплаты,
	ЕСТЬNULL(ТаблицаПередач.ДатаПередачи, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаПередачи,
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
		ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
	КОНЕЦ КАК ДатаОплаты,
	СУММА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Сумма) КАК Сумма,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	МАКСИМУМ(ВЫБОР
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
					И (хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика
						ИЛИ хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Регистратор = ТаблицаАктуальныхУтверждений.Регистратор)
				ТОГДА ИСТИНА
			ИНАЧЕ ЛОЖЬ
		КОНЕЦ) КАК ЭтоПлатежПоТекущемуГрафику
ПОМЕСТИТЬ ВзаиморасчетыВесьПериод
ИЗ
	ВтВсеДоговоры КАК ВтВсеДоговоры
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику КАК хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику
			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.хлДанныеУтвержденийГрафиков.СрезПоследних(
					&КонецПериода,
					ВидГрафика = ЗНАЧЕНИЕ(Справочник.хлВидыГрафиков.ГрафикПлатежейПоДоговоруЛизинга)
						И Договор В
							(ВЫБРАТЬ
								ВтВсеДоговоры.ДоговорКонтрагента
							ИЗ
								ВтВсеДоговоры)) КАК ТаблицаАктуальныхУтверждений
			ПО хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга = ТаблицаАктуальныхУтверждений.Договор
				И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Приложение = ТаблицаАктуальныхУтверждений.Приложение
				И (хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход))
			ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаПередач КАК ТаблицаПередач
			ПО хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга = ТаблицаПередач.ДоговорЛизинга
		ПО ВтВсеДоговоры.ДоговорКонтрагента = хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга
ГДЕ
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Активность
	И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период <= &КонецПериода
	И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Дата <= &ДатаСреза
	И ВЫБОР
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
					И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
				ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
			ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
		КОНЕЦ <= &КонецПериода
	И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Статья = &Статья
	И ВЫБОР
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
				ТОГДА ДАТАВРЕМЯ(1, 1, 1)
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
				ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
			ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
		КОНЕЦ <= &ДатаСреза

СГРУППИРОВАТЬ ПО
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Валюта,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга.Владелец,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Статья,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Приложение,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Дата,
	ЕСТЬNULL(ТаблицаПередач.ДатаПередачи, ДАТАВРЕМЯ(1, 1, 1)),
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
		ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
	КОНЕЦ

ИМЕЮЩИЕ
	СУММА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Сумма) <> 0

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика,
	ДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение КАК Приложение,
	ВзаиморасчетыВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ВзаиморасчетыВесьПериод.Валюта КАК Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.Сумма КАК Сумма,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ВзаиморасчетыВесьПериод.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику
ПОМЕСТИТЬ ТаблицаНачисленийВесьПериод
ИЗ
	ВзаиморасчетыВесьПериод КАК ВзаиморасчетыВесьПериод
ГДЕ
	ВзаиморасчетыВесьПериод.ЭтоФакт = ЛОЖЬ

ИНДЕКСИРОВАТЬ ПО
	ВзаиморасчетыВесьПериод.ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение,
	ВзаиморасчетыВесьПериод.СтатьяГрафика,
	ВзаиморасчетыВесьПериод.Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение КАК Приложение,
	ВзаиморасчетыВесьПериод.Валюта КАК Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.ДатаПередачи КАК ДатаПередачи,
	ВзаиморасчетыВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ВзаиморасчетыВесьПериод.ДатаОплаты КАК ДатаОплаты,
	ВзаиморасчетыВесьПериод.Сумма КАК СуммаОплаты,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика
ПОМЕСТИТЬ ТаблицаОплатВесьПериод
ИЗ
	ВзаиморасчетыВесьПериод КАК ВзаиморасчетыВесьПериод
ГДЕ
	ВзаиморасчетыВесьПериод.ЭтоФакт = ИСТИНА

ИНДЕКСИРОВАТЬ ПО
	ВзаиморасчетыВесьПериод.ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение,
	ВзаиморасчетыВесьПериод.СтатьяГрафика,
	ВзаиморасчетыВесьПериод.Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика,
	ВзаиморасчетыВесьПериод.ДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаОплатВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение КАК Приложение,
	ТаблицаОплатВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаОплатВесьПериод.Валюта КАК Валюта,
	ТаблицаОплатВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаОплатВесьПериод.ДатаПередачи КАК ДатаПередачи,
	ТаблицаОплатВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	МАКСИМУМ(ВЫБОР
			КОГДА ТаблицаОплатВесьПериодДляОстатков.ДатаОплаты >= ТаблицаОплатВесьПериод.ДатаОплаты
				ТОГДА ТаблицаОплатВесьПериод.ПлановаяДатаОплаты
			ИНАЧЕ ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.ДатаОплаты, ТаблицаОплатВесьПериод.ПлановаяДатаОплаты)
		КОНЕЦ) КАК НачалоИнтервалаРасчета,
	ТаблицаОплатВесьПериод.ДатаОплаты КАК ДатаОплаты,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.ЭтоФакт, ЛОЖЬ) = ЛОЖЬ
				ТОГДА 1
			ИНАЧЕ -1
		КОНЕЦ * ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.Сумма, 0)) + ТаблицаОплатВесьПериод.СуммаОплаты КАК СуммаНачальныйОстаток,
	ТаблицаОплатВесьПериод.СуммаОплаты КАК СуммаОплаты,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.ЭтоФакт, ЛОЖЬ) = ЛОЖЬ
				ТОГДА 1
			ИНАЧЕ -1
		КОНЕЦ * ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.Сумма, 0)) КАК СуммаКонечныйОстаток
ПОМЕСТИТЬ ТаблицаОплатСОстаткамиВесьПериод
ИЗ
	ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ ВзаиморасчетыВесьПериод КАК ТаблицаОплатВесьПериодДляОстатков
		ПО ТаблицаОплатВесьПериод.ДоговорЛизинга = ТаблицаОплатВесьПериодДляОстатков.ДоговорЛизинга
			И ТаблицаОплатВесьПериод.Приложение = ТаблицаОплатВесьПериодДляОстатков.Приложение
			И ТаблицаОплатВесьПериод.СтатьяГрафика = ТаблицаОплатВесьПериодДляОстатков.СтатьяГрафика
			И ТаблицаОплатВесьПериод.Валюта = ТаблицаОплатВесьПериодДляОстатков.Валюта
			И ТаблицаОплатВесьПериод.ПлановаяДатаОплаты = ТаблицаОплатВесьПериодДляОстатков.ПлановаяДатаОплаты
			И ТаблицаОплатВесьПериод.НачислениеВнеГрафика = ТаблицаОплатВесьПериодДляОстатков.НачислениеВнеГрафика
			И ТаблицаОплатВесьПериод.ДатаОплаты >= ТаблицаОплатВесьПериодДляОстатков.ДатаОплаты

СГРУППИРОВАТЬ ПО
	ТаблицаОплатВесьПериод.Валюта,
	ТаблицаОплатВесьПериод.СтатьяГрафика,
	ТаблицаОплатВесьПериод.ПлановаяДатаОплаты,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.СуммаОплаты,
	ТаблицаОплатВесьПериод.ДатаОплаты,
	ТаблицаОплатВесьПериод.ДатаПередачи,
	ТаблицаОплатВесьПериод.НачислениеВнеГрафика

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика,
	ДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыВесьПериодОстатки.ДоговорЛизинга КАК ДоговорЛизинга,
	ВзаиморасчетыВесьПериодОстатки.Приложение КАК Приложение,
	ВзаиморасчетыВесьПериодОстатки.СтатьяГрафика КАК СтатьяГрафика,
	ВзаиморасчетыВесьПериодОстатки.Валюта КАК Валюта,
	ВзаиморасчетыВесьПериодОстатки.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериодОстатки.ДатаПередачи КАК ДатаПередачи,
	ВзаиморасчетыВесьПериодОстатки.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) КАК СуммаОстаток,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) КАК СуммаОстаток1,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) КАК СуммаОстаток2
ПОМЕСТИТЬ ТаблицаОстатков
ИЗ
	ВзаиморасчетыВесьПериод КАК ВзаиморасчетыВесьПериодОстатки

СГРУППИРОВАТЬ ПО
	ВзаиморасчетыВесьПериодОстатки.ДоговорЛизинга,
	ВзаиморасчетыВесьПериодОстатки.Приложение,
	ВзаиморасчетыВесьПериодОстатки.СтатьяГрафика,
	ВзаиморасчетыВесьПериодОстатки.Валюта,
	ВзаиморасчетыВесьПериодОстатки.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериодОстатки.ДатаПередачи,
	ВзаиморасчетыВесьПериодОстатки.НачислениеВнеГрафика

ИМЕЮЩИЕ
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) <> 0

ИНДЕКСИРОВАТЬ ПО
	ВзаиморасчетыВесьПериодОстатки.ДоговорЛизинга,
	ВзаиморасчетыВесьПериодОстатки.Приложение,
	ВзаиморасчетыВесьПериодОстатки.СтатьяГрафика,
	ВзаиморасчетыВесьПериодОстатки.Валюта,
	ВзаиморасчетыВесьПериодОстатки.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериодОстатки.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ ПЕРВЫЕ 1
	НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья КАК СтатьяКомпенсация
ПОМЕСТИТЬ врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях
ИЗ
	Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ИсключаемыеСтатьи КАК НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи
ГДЕ
	ВЫБОР
			КОГДА &НаборСтатейИсключаемыхИзБазыРасчетаПени = ЗНАЧЕНИЕ(Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ПустаяСсылка)
				ТОГДА ИСТИНА
			ИНАЧЕ НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Ссылка = &НаборСтатейИсключаемыхИзБазыРасчетаПени
		КОНЕЦ
	И НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья = &СтатьяКомпенсацияСтрахования
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаОплатВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение КАК Приложение,
	ТаблицаОплатВесьПериод.Валюта КАК Валюта,
	СУММА(ТаблицаОплатВесьПериод.СуммаОплаты) КАК СуммаОплаты,
	1 КАК РазделительСтатейПоОплатеПеней
ПОМЕСТИТЬ ТаблицаОплатПенейВесьПериод
ИЗ
	ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.хлНазначенияОбъектов КАК НазначенияОбъектов
		ПО ТаблицаОплатВесьПериод.СтатьяГрафика = НазначенияОбъектов.Объект
			И (НазначенияОбъектов.Назначение = &НазначениеПени)
ГДЕ
	НазначенияОбъектов.Назначение = &НазначениеПени

СГРУППИРОВАТЬ ПО
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.Валюта

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.Валюта,
	СУММА(ТаблицаОплатВесьПериод.СуммаОплаты),
	2
ИЗ
	ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях КАК врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях
		ПО (ИСТИНА)
ГДЕ
	ТаблицаОплатВесьПериод.СтатьяГрафика = &ШтрафыЗаСтрахование
	И врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях.СтатьяКомпенсация ЕСТЬ NULL

СГРУППИРОВАТЬ ПО
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.Валюта
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение КАК Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта КАК Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.Сумма КАК Сумма,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику,
	СУММА(ТаблицаОплатВесьПериод.СуммаОплаты) КАК СуммаОплаты,
	МАКСИМУМ(ТаблицаОплатВесьПериод.ДатаОплаты) КАК ДатаОплаты,
	ВЫБОР
		КОГДА МАКСИМУМ(ТаблицаОплатВесьПериод.ДатаОплаты) ЕСТЬ NULL
				ИЛИ ТаблицаНачисленийВесьПериод.Сумма - ЕСТЬNULL(СУММА(ТаблицаОплатВесьПериод.СуммаОплаты), 0) > 0
				ИЛИ РАЗНОСТЬДАТ(ПроизводственныйКалендарь.ПервыйРабочийДень, МАКСИМУМ(ТаблицаОплатВесьПериод.ДатаОплаты), ДЕНЬ) > 0
			ТОГДА 1
		ИНАЧЕ 0
	КОНЕЦ КАК ПросроченныйПлатеж
ПОМЕСТИТЬ ТаблицаВзаиморасчетовВесьПериод
ИЗ
	ТаблицаНачисленийВесьПериод КАК ТаблицаНачисленийВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ПО ТаблицаНачисленийВесьПериод.ДоговорЛизинга = ТаблицаОплатВесьПериод.ДоговорЛизинга
			И ТаблицаНачисленийВесьПериод.Приложение = ТаблицаОплатВесьПериод.Приложение
			И ТаблицаНачисленийВесьПериод.СтатьяГрафика = ТаблицаОплатВесьПериод.СтатьяГрафика
			И ТаблицаНачисленийВесьПериод.Валюта = ТаблицаОплатВесьПериод.Валюта
			И ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты = ТаблицаОплатВесьПериод.ПлановаяДатаОплаты
			И ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика = ТаблицаОплатВесьПериод.НачислениеВнеГрафика
		ЛЕВОЕ СОЕДИНЕНИЕ ПроизводственныйКалендарь КАК ПроизводственныйКалендарь
		ПО ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты = ПроизводственныйКалендарь.Дата

СГРУППИРОВАТЬ ПО
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.Сумма,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику,
	ПроизводственныйКалендарь.ПервыйРабочийДень

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение КАК Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта КАК Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.Сумма КАК Сумма,
	КОЛИЧЕСТВО(ТаблицаНачисленийВесьПериодДляНомераПлатежа.ПлановаяДатаОплаты) КАК НомерПлатежа,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику
ПОМЕСТИТЬ ТаблицаНачислений
ИЗ
	ТаблицаНачисленийВесьПериод КАК ТаблицаНачисленийВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаНачисленийВесьПериод КАК ТаблицаНачисленийВесьПериодДляНомераПлатежа
		ПО ТаблицаНачисленийВесьПериод.ДоговорЛизинга = ТаблицаНачисленийВесьПериодДляНомераПлатежа.ДоговорЛизинга
			И ТаблицаНачисленийВесьПериод.Приложение = ТаблицаНачисленийВесьПериодДляНомераПлатежа.Приложение
			И ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты >= ТаблицаНачисленийВесьПериодДляНомераПлатежа.ПлановаяДатаОплаты
			И ТаблицаНачисленийВесьПериод.СтатьяГрафика = ТаблицаНачисленийВесьПериодДляНомераПлатежа.СтатьяГрафика
			И ТаблицаНачисленийВесьПериод.Валюта = ТаблицаНачисленийВесьПериодДляНомераПлатежа.Валюта
			И (НЕ ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика
				ИЛИ ТаблицаНачисленийВесьПериод.СтатьяГрафика = &СтатьяЛП)

СГРУППИРОВАТЬ ПО
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.Сумма,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОплатыИОстатки.ДоговорЛизинга КАК ДоговорЛизинга,
	ОплатыИОстатки.Приложение КАК Приложение,
	ОплатыИОстатки.СтатьяГрафика КАК СтатьяГрафика,
	ОплатыИОстатки.Валюта КАК Валюта,
	ОплатыИОстатки.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ОплатыИОстатки.ДатаПередачи КАК ДатаПередачи,
	ОплатыИОстатки.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ОплатыИОстатки.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	КОНЕЦПЕРИОДА(ОплатыИОстатки.КонецИнтервалаРасчета, ДЕНЬ) КАК КонецИнтервалаРасчета,
	ЕСТЬNULL(ОплатыИОстатки.ДатаОплаты, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаОплаты,
	ОплатыИОстатки.БазаРасчетаПеней КАК БазаРасчетаПеней,
	ОплатыИОстатки.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
	ОплатыИОстатки.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток,
	ОплатыИОстатки.СуммаОплаты КАК СуммаОплаты
ПОМЕСТИТЬ ТаблицаДляРасчетаПеней
ИЗ
	(ВЫБРАТЬ
		Оплаты.ДоговорЛизинга КАК ДоговорЛизинга,
		Оплаты.Приложение КАК Приложение,
		Оплаты.СтатьяГрафика КАК СтатьяГрафика,
		Оплаты.Валюта КАК Валюта,
		Оплаты.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
		Оплаты.ДатаПередачи КАК ДатаПередачи,
		Оплаты.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
		Оплаты.ДатаОплаты КАК КонецИнтервалаРасчета,
		Оплаты.ДатаОплаты КАК ДатаОплаты,
		Оплаты.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
		Оплаты.СуммаНачальныйОстаток КАК БазаРасчетаПеней,
		Оплаты.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
		Оплаты.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток,
		Оплаты.СуммаОплаты КАК СуммаОплаты
	ИЗ
		ТаблицаОплатСОстаткамиВесьПериод КАК Оплаты
	ГДЕ
		Оплаты.ДатаОплаты <= &КонецПериода
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		Остатки.ДоговорЛизинга,
		Остатки.Приложение,
		Остатки.СтатьяГрафика,
		Остатки.Валюта,
		Остатки.ПлановаяДатаОплаты,
		Остатки.ДатаПередачи,
		ЕСТЬNULL(МАКСИМУМ(Оплаты.ДатаОплаты), Остатки.ПлановаяДатаОплаты),
		&КонецПериода,
		NULL,
		Остатки.НачислениеВнеГрафика,
		Остатки.СуммаОстаток,
		Остатки.СуммаОстаток1,
		Остатки.СуммаОстаток2,
		0
	ИЗ
		ТаблицаОстатков КАК Остатки
			ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОплатВесьПериод КАК Оплаты
			ПО (Оплаты.ДоговорЛизинга = Остатки.ДоговорЛизинга)
				И (Оплаты.Приложение = Остатки.Приложение)
				И (Оплаты.СтатьяГрафика = Остатки.СтатьяГрафика)
				И (Оплаты.Валюта = Остатки.Валюта)
				И (Оплаты.ПлановаяДатаОплаты = Остатки.ПлановаяДатаОплаты)
				И (Оплаты.НачислениеВнеГрафика = Остатки.НачислениеВнеГрафика)
				И (Оплаты.ДатаОплаты <= &КонецПериода)
	ГДЕ
		Остатки.СуммаОстаток > 0
	
	СГРУППИРОВАТЬ ПО
		Остатки.ДоговорЛизинга,
		Остатки.Приложение,
		Остатки.СтатьяГрафика,
		Остатки.Валюта,
		Остатки.ПлановаяДатаОплаты,
		Остатки.ДатаПередачи,
		Остатки.НачислениеВнеГрафика,
		Остатки.СуммаОстаток,
		Остатки.СуммаОстаток1,
		Остатки.СуммаОстаток2) КАК ОплатыИОстатки

СГРУППИРОВАТЬ ПО
	ОплатыИОстатки.Приложение,
	ОплатыИОстатки.Валюта,
	ОплатыИОстатки.ПлановаяДатаОплаты,
	ОплатыИОстатки.ДатаПередачи,
	ОплатыИОстатки.НачалоИнтервалаРасчета,
	ОплатыИОстатки.НачислениеВнеГрафика,
	ОплатыИОстатки.ДоговорЛизинга,
	ОплатыИОстатки.СтатьяГрафика,
	ОплатыИОстатки.КонецИнтервалаРасчета,
	ОплатыИОстатки.ДатаОплаты,
	ОплатыИОстатки.СуммаНачальныйОстаток,
	ОплатыИОстатки.СуммаКонечныйОстаток,
	ОплатыИОстатки.СуммаОплаты,
	ОплатыИОстатки.БазаРасчетаПеней

ИНДЕКСИРОВАТЬ ПО
	ОплатыИОстатки.ДоговорЛизинга,
	ОплатыИОстатки.Приложение,
	ОплатыИОстатки.СтатьяГрафика,
	ОплатыИОстатки.Валюта,
	ОплатыИОстатки.ПлановаяДатаОплаты,
	ОплатыИОстатки.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПараметрыНачисленияПениПоДоговорамЛизинга.Период КАК Период,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ДоговорКонтрагента КАК ДоговорКонтрагента,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ПараметрыНачисленияПениПоДоговорамЛизинга.НаборИсключаемыхСтатей КАК НаборИсключаемыхСтатей,
	ПараметрыНачисленияПениПоДоговорамЛизинга.СтавкаПени КАК СтавкаПени,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ЛьготныйПериод КАК ЛьготныйПериод
ПОМЕСТИТЬ ПараметрыНачисленияПени
ИЗ
	РегистрСведений.хлПараметрыНачисленияПениПоДоговорамЛизинга КАК ПараметрыНачисленияПениПоДоговорамЛизинга
ГДЕ
	ПараметрыНачисленияПениПоДоговорамЛизинга.ДоговорКонтрагента В
			(ВЫБРАТЬ
				ВтВсеДоговоры.ДоговорКонтрагента
			ИЗ
				ВтВсеДоговоры)

ИНДЕКСИРОВАТЬ ПО
	ПараметрыНачисленияПениПоДоговорамЛизинга.Период,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ДоговорКонтрагента,
	НаборИсключаемыхСтатей,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ПлановаяДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	ПараметрыНачисленияПени.ДоговорКонтрагента КАК ДоговорКонтрагента,
	ПараметрыНачисленияПени.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты
ПОМЕСТИТЬ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
ИЗ
	ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
ГДЕ
	ПараметрыНачисленияПени.ПлановаяДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)

ИНДЕКСИРОВАТЬ ПО
	ПараметрыНачисленияПени.ПлановаяДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета КАК ДатаПараметров,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение КАК Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта КАК Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика
ПОМЕСТИТЬ ДатыПараметровНачисленияПени
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
ГДЕ
	ТаблицаДляРасчетаПеней.ДатаПередачи <> ДАТАВРЕМЯ(1, 1, 1)
	И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты >= ТаблицаДляРасчетаПеней.ДатаПередачи

ОБЪЕДИНИТЬ

ВЫБРАТЬ
	НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ),
	ТаблицаДляРасчетаПеней.ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
ГДЕ
	ТаблицаДляРасчетаПеней.ДатаПередачи <> ДАТАВРЕМЯ(1, 1, 1)
	И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты >= ТаблицаДляРасчетаПеней.ДатаПередачи

ОБЪЕДИНИТЬ

ВЫБРАТЬ
	ПараметрыНачисленияПени.Период,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты КАК ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
		ПО ТаблицаДляРасчетаПеней.ДоговорЛизинга = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ДоговорКонтрагента
			И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
		ПО (ПараметрыНачисленияПени.Период <= ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			И (ПараметрыНачисленияПени.Период >= ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета)
			И (ПараметрыНачисленияПени.ДоговорКонтрагента = ТаблицаДляРасчетаПеней.ДоговорЛизинга)
			И (ВЫБОР
				КОГДА ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты ЕСТЬ NULL
					ТОГДА ПараметрыНачисленияПени.ПлановаяДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ПараметрыНачисленияПени.ПлановаяДатаОплаты = ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты
			КОНЕЦ)
			И (ТаблицаДляРасчетаПеней.ДатаПередачи <> ДАТАВРЕМЯ(1, 1, 1))
			И (ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты >= ТаблицаДляРасчетаПеней.ДатаПередачи)

ИНДЕКСИРОВАТЬ ПО
	ДатаПараметров,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение КАК Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта КАК Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ДатыПараметровНачисленияПени.ДатаПараметров КАК ДатаПараметров
ПОМЕСТИТЬ ИнтервалыРасчетаПенейСДатамиИзмененияПараметровНачисленияПени
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДатыПараметровНачисленияПени КАК ДатыПараметровНачисленияПени
		ПО (ВЫБОР
				КОГДА ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета > ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета
					ТОГДА ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета = ДатыПараметровНачисленияПени.ДатаПараметров
				ИНАЧЕ ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета <= ДатыПараметровНачисленияПени.ДатаПараметров
						И ДатыПараметровНачисленияПени.ДатаПараметров <= ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета
			КОНЕЦ)
			И ТаблицаДляРасчетаПеней.ДоговорЛизинга = ДатыПараметровНачисленияПени.ДоговорЛизинга
			И ТаблицаДляРасчетаПеней.Приложение = ДатыПараметровНачисленияПени.Приложение
			И ТаблицаДляРасчетаПеней.СтатьяГрафика = ДатыПараметровНачисленияПени.СтатьяГрафика
			И ТаблицаДляРасчетаПеней.Валюта = ДатыПараметровНачисленияПени.Валюта
			И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты = ДатыПараметровНачисленияПени.ПлановаяДатаОплаты
			И ТаблицаДляРасчетаПеней.НачислениеВнеГрафика = ДатыПараметровНачисленияПени.НачислениеВнеГрафика

ИНДЕКСИРОВАТЬ ПО
	НачалоИнтервалаРасчета,
	КонецИнтервалаРасчета,
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика,
	ДатаПараметров
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Приложение КАК Приложение,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Валюта КАК Валюта,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров КАК НачалоИнтервалаПараметров,
	МИНИМУМ(ВЫБОР
			КОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета <= КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров, ДЕНЬ)
				ТОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета
			ИНАЧЕ КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров, ДЕНЬ)
		КОНЕЦ) КАК КонецИнтервалаПараметров
ПОМЕСТИТЬ ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПени
ИЗ
	ИнтервалыРасчетаПенейСДатамиИзмененияПараметровНачисленияПени КАК ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ИнтервалыРасчетаПенейСДатамиИзмененияПараметровНачисленияПени КАК ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1
		ПО ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.НачалоИнтервалаРасчета
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.КонецИнтервалаРасчета
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДоговорЛизинга = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДоговорЛизинга
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Приложение = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.Приложение
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.СтатьяГрафика = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.СтатьяГрафика
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Валюта = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.Валюта
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ПлановаяДатаОплаты
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачислениеВнеГрафика = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.НачислениеВнеГрафика
			И (ВЫБОР
				КОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета >= НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета, ДЕНЬ)
					ТОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров
				ИНАЧЕ ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров < ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров
			КОНЕЦ)
ГДЕ
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты <= ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров

СГРУППИРОВАТЬ ПО
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДоговорЛизинга,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Приложение,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.СтатьяГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Валюта,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров

ИНДЕКСИРОВАТЬ ПО
	НачалоИнтервалаРасчета,
	ДоговорЛизинга
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Приложение КАК Приложение,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Валюта КАК Валюта,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаПараметров КАК НачалоИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаПараметров КАК КонецИнтервалаПараметров,
	МАКСИМУМ(ПараметрыНачисленияПени.Период) КАК ПериодПараметров
ПОМЕСТИТЬ ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПениСДатамиПараметров
ИЗ
	ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПени КАК ТаблицаДляРасчетаПенейПоИнтерваламПараметров
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты КАК ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ДоговорКонтрагента
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаПараметров >= ПараметрыНачисленияПени.Период
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга = ПараметрыНачисленияПени.ДоговорКонтрагента
			И (ВЫБОР
				КОГДА ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты ЕСТЬ NULL
					ТОГДА ПараметрыНачисленияПени.ПлановаяДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПени.ПлановаяДатаОплаты
			КОНЕЦ)

СГРУППИРОВАТЬ ПО
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Приложение,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.СтатьяГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Валюта,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаПараметров

ИНДЕКСИРОВАТЬ ПО
	ПериодПараметров,
	ДоговорЛизинга,
	СтатьяГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.Приложение КАК Приложение,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.Валюта КАК Валюта,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.НачалоИнтервалаПараметров КАК НачалоИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.КонецИнтервалаПараметров КАК КонецИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПериодПараметров КАК ПериодПараметров,
	ЕСТЬNULL(ПараметрыНачисленияПени.СтавкаПени, 0) КАК СтавкаПени,
	ЕСТЬNULL(ПараметрыНачисленияПени.ЛьготныйПериод, 0) КАК ЛьготныйПериод
ПОМЕСТИТЬ ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени
ИЗ
	ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПениСДатамиПараметров КАК ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты КАК ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ДоговорЛизинга = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ДоговорКонтрагента
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПериодПараметров = ПараметрыНачисленияПени.Период
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ДоговорЛизинга = ПараметрыНачисленияПени.ДоговорКонтрагента
			И (ВЫБОР
				КОГДА ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты ЕСТЬ NULL
					ТОГДА ПараметрыНачисленияПени.ПлановаяДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПени.ПлановаяДатаОплаты
			КОНЕЦ)
		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ИсключаемыеСтатьи КАК НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи
		ПО (ВЫБОР
				КОГДА &НаборСтатейИсключаемыхИзБазыРасчетаПени = ЗНАЧЕНИЕ(Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ПустаяСсылка)
					ТОГДА ПараметрыНачисленияПени.НаборИсключаемыхСтатей = НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Ссылка
				ИНАЧЕ НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Ссылка = &НаборСтатейИсключаемыхИзБазыРасчетаПени
			КОНЕЦ)
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.СтатьяГрафика = НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья
ГДЕ
	НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья ЕСТЬ NULL

ИНДЕКСИРОВАТЬ ПО
	НачалоИнтервалаРасчета,
	КонецИнтервалаРасчета,
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение КАК Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта КАК Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.НачалоИнтервалаПараметров, ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета) КАК НачалоИнтервалаРасчета,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета) КАК КонецИнтервалаРасчета,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ТаблицаДляРасчетаПеней.ДатаОплаты
		ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1)
	КОНЕЦ КАК ДатаОплаты,
	ТаблицаДляРасчетаПеней.БазаРасчетаПеней КАК БазаРасчетаПеней,
	ТаблицаДляРасчетаПеней.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ТаблицаДляРасчетаПеней.СуммаКонечныйОстаток
		ИНАЧЕ ТаблицаДляРасчетаПеней.СуммаНачальныйОстаток
	КОНЕЦ КАК СуммаКонечныйОстаток,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ТаблицаДляРасчетаПеней.СуммаОплаты
		ИНАЧЕ 0
	КОНЕЦ КАК СуммаОплаты,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.СтавкаПени, 0) КАК СтавкаПени,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.ЛьготныйПериод, 0) КАК ЛьготныйПериод,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		ИНАЧЕ ВЫБОР
				КОГДА ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета) = &КонецПериода
					ТОГДА ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			КОНЕЦ
	КОНЕЦ КАК ДатаИзмененияПараметров
ПОМЕСТИТЬ ТаблицаДляРасчетаПенейСПараметрамиНачисленияПени
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
		ЛЕВОЕ СОЕДИНЕНИЕ ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени КАК ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени
		ПО ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.НачалоИнтервалаРасчета
			И ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаРасчета
			И ТаблицаДляРасчетаПеней.ДоговорЛизинга = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.ДоговорЛизинга
			И ТаблицаДляРасчетаПеней.Приложение = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.Приложение
			И ТаблицаДляРасчетаПеней.СтатьяГрафика = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.СтатьяГрафика
			И ТаблицаДляРасчетаПеней.Валюта = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.Валюта
			И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.ПлановаяДатаОплаты
			И ТаблицаДляРасчетаПеней.НачислениеВнеГрафика = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.НачислениеВнеГрафика

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика,
	НачалоИнтервалаРасчета
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ЕСТЬNULL(ТаблицаВзаиморасчетов.ДоговорЛизинга, ТаблицаДляРасчетаПеней.ДоговорЛизинга) КАК ДоговорЛизинга,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.Приложение, ТаблицаДляРасчетаПеней.Приложение) КАК Приложение,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.СтатьяГрафика, ТаблицаДляРасчетаПеней.СтатьяГрафика) КАК СтатьяГрафика,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.Валюта, ТаблицаДляРасчетаПеней.Валюта) КАК Валюта,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.ПлановаяДатаОплаты, ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты) КАК ПлановаяДатаОплаты,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.НачислениеВнеГрафика, ТаблицаДляРасчетаПеней.НачислениеВнеГрафика) КАК НачислениеВнеГрафика,
	ЕСТЬNULL(ТаблицаДляРасчетаПеней.СуммаНачальныйОстаток, ТаблицаВзаиморасчетов.Сумма) КАК СуммаКОплате,
	ТаблицаВзаиморасчетов.Сумма КАК СуммаНачисленная,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.ЭтоПлатежПоТекущемуГрафику, ИСТИНА) КАК ЭтоПлатежПоТекущемуГрафику,
	ВЫБОР
		КОГДА ТаблицаВзаиморасчетов.ПлановаяДатаОплаты > ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
			ТОГДА ТаблицаВзаиморасчетов.ПлановаяДатаОплаты
		ИНАЧЕ ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
	КОНЕЦ КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.ДатаОплаты КАК ДатаОплаты,
	ТаблицаДляРасчетаПеней.СуммаОплаты КАК СуммаОплаты,
	ТаблицаДляРасчетаПеней.СуммаКонечныйОстаток КАК СуммаОстаток,
	ТаблицаВзаиморасчетов.НомерПлатежа КАК НомерПлатежа,
	ПроизводственныйКалендарь.ПервыйРабочийДень КАК ПервыйРабочийДень,
	ТаблицаПередач.ДатаПередачи КАК ДатаПередачи,
	ВЫБОР
		КОГДА ПроизводственныйКалендарь.ПервыйРабочийДень < ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
			ТОГДА РАЗНОСТЬДАТ(ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
		КОГДА ПроизводственныйКалендарь.ПервыйРабочийДень < ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета
			ТОГДА РАЗНОСТЬДАТ(ПроизводственныйКалендарь.ПервыйРабочийДень, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
		ИНАЧЕ 0
	КОНЕЦ КАК ДнейСкорректированных,
	ВЫБОР
		КОГДА НАЧАЛОПЕРИОДА(ПроизводственныйКалендарь.ПервыйРабочийДень, ДЕНЬ) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоПросроченныйПлатеж,
	ВЫБОР
		КОГДА НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты, ДЕНЬ) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоПросроченныйПлатежПоКалендарнымДням,
	ВЫБОР
		КОГДА НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты, МЕСЯЦ) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, МЕСЯЦ)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоПросроченныйПлатежПереходящийМесяц,
	ТаблицаДляРасчетаПеней.СтавкаПени КАК СтавкаПени,
	ТаблицаДляРасчетаПеней.ЛьготныйПериод КАК ЛьготныйПериод,
	ТаблицаДляРасчетаПеней.БазаРасчетаПеней КАК БазаРасчетаПеней,
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА ДОБАВИТЬКДАТЕ(ПроизводственныйКалендарь.ПервыйРабочийДень, ДЕНЬ, ТаблицаДляРасчетаПеней.ЛьготныйПериод) < ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
				ТОГДА РАЗНОСТЬДАТ(ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			КОГДА ДОБАВИТЬКДАТЕ(ПроизводственныйКалендарь.ПервыйРабочийДень, ДЕНЬ, ТаблицаДляРасчетаПеней.ЛьготныйПериод) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
				ТОГДА РАЗНОСТЬДАТ(ПроизводственныйКалендарь.ПервыйРабочийДень, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			ИНАЧЕ 0
		КОНЕЦ * ВЫБОР
			КОГДА ЕСТЬNULL(ТаблицаДляРасчетаПеней.БазаРасчетаПеней, 0) < 0
				ТОГДА 0
			ИНАЧЕ ЕСТЬNULL(ТаблицаДляРасчетаПеней.БазаРасчетаПеней, 0)
		КОНЕЦ * ТаблицаДляРасчетаПеней.СтавкаПени * 0.01 КАК ЧИСЛО(15, 2)) КАК СуммаПеней,
	ТаблицаДляРасчетаПеней.ДатаИзмененияПараметров КАК ДатаИзмененияПараметров,
	ВЫБОР
		КОГДА ЕСТЬNULL(ТаблицаВзаиморасчетов.СтатьяГрафика, ТаблицаДляРасчетаПеней.СтатьяГрафика) = &СтатьяЛП
			ТОГДА 1
		ИНАЧЕ 2
	КОНЕЦ КАК РазделительСтатейПоОплатеПеней
ПОМЕСТИТЬ ТаблицаРассчитанныхПеней
ИЗ
	ТаблицаНачислений КАК ТаблицаВзаиморасчетов
		ПОЛНОЕ СОЕДИНЕНИЕ ТаблицаДляРасчетаПенейСПараметрамиНачисленияПени КАК ТаблицаДляРасчетаПеней
		ПО ТаблицаВзаиморасчетов.ДоговорЛизинга = ТаблицаДляРасчетаПеней.ДоговорЛизинга
			И ТаблицаВзаиморасчетов.Приложение = ТаблицаДляРасчетаПеней.Приложение
			И ТаблицаВзаиморасчетов.СтатьяГрафика = ТаблицаДляРасчетаПеней.СтатьяГрафика
			И ТаблицаВзаиморасчетов.Валюта = ТаблицаДляРасчетаПеней.Валюта
			И ТаблицаВзаиморасчетов.ПлановаяДатаОплаты = ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты
			И ТаблицаВзаиморасчетов.НачислениеВнеГрафика = ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
		ЛЕВОЕ СОЕДИНЕНИЕ ПроизводственныйКалендарь КАК ПроизводственныйКалендарь
		ПО ТаблицаВзаиморасчетов.ПлановаяДатаОплаты = ПроизводственныйКалендарь.Дата
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаПередач КАК ТаблицаПередач
		ПО ТаблицаВзаиморасчетов.ДоговорЛизинга = ТаблицаПередач.ДоговорЛизинга

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	Валюта,
	КонецИнтервалаРасчета,
	НомерПлатежа
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаРассчитанныхПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаРассчитанныхПеней.Приложение КАК Приложение,
	ТаблицаРассчитанныхПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаРассчитанныхПеней.Валюта КАК Валюта,
	ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаРассчитанныхПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаРассчитанныхПеней.СуммаКОплате КАК СуммаКОплате,
	ТаблицаРассчитанныхПеней.СуммаНачисленная КАК СуммаНачисленная,
	ТаблицаРассчитанныхПеней.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику,
	ТаблицаРассчитанныхПеней.ДатаПередачи КАК ДатаПередачи,
	ТаблицаРассчитанныхПеней.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.ДатаОплаты КАК ДатаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОплаты КАК СуммаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОстаток КАК СуммаОстаток,
	ТаблицаРассчитанныхПеней.НомерПлатежа КАК НомерПлатежа,
	ТаблицаРассчитанныхПеней.ПервыйРабочийДень КАК ПервыйРабочийДень,
	ТаблицаРассчитанныхПеней.ДнейСкорректированных КАК ДнейСкорректированных,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатеж КАК ЭтоПросроченныйПлатеж,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатежПоКалендарнымДням КАК ЭтоПросроченныйПлатежПоКалендарнымДням,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатежПереходящийМесяц КАК ЭтоПросроченныйПлатежПереходящийМесяц,
	ТаблицаРассчитанныхПеней.ДатаИзмененияПараметров КАК ДатаИзмененияПараметров,
	ТаблицаРассчитанныхПеней.СтавкаПени КАК СтавкаПени,
	ТаблицаРассчитанныхПеней.ЛьготныйПериод КАК ЛьготныйПериод,
	ТаблицаРассчитанныхПеней.СуммаПеней КАК СуммаПеней,
	ТаблицаРассчитанныхПеней.РазделительСтатейПоОплатеПеней КАК РазделительСтатейПоОплатеПеней,
	СУММА(ЕСТЬNULL(ТаблицаРассчитанныхПеней1.СуммаПеней, 0)) КАК СуммаПенейНарастающийИтог
ПОМЕСТИТЬ ТаблицаРассчитанныхПенейСНарастающимИтогом
ИЗ
	ТаблицаРассчитанныхПеней КАК ТаблицаРассчитанныхПеней
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаРассчитанныхПеней КАК ТаблицаРассчитанныхПеней1
		ПО ТаблицаРассчитанныхПеней.ДоговорЛизинга = ТаблицаРассчитанныхПеней1.ДоговорЛизинга
			И ТаблицаРассчитанныхПеней.Приложение = ТаблицаРассчитанныхПеней1.Приложение
			И ТаблицаРассчитанныхПеней.Валюта = ТаблицаРассчитанныхПеней1.Валюта
			И (ВЫБОР
				КОГДА ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета = ТаблицаРассчитанныхПеней1.КонецИнтервалаРасчета
					ТОГДА ВЫБОР
							КОГДА ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты = ТаблицаРассчитанныхПеней1.ПлановаяДатаОплаты
								ТОГДА ВЫБОР
										КОГДА ТаблицаРассчитанныхПеней.НачислениеВнеГрафика = ТаблицаРассчитанныхПеней1.НачислениеВнеГрафика
											ТОГДА ТаблицаРассчитанныхПеней.СтатьяГрафика >= ТаблицаРассчитанныхПеней1.СтатьяГрафика
										ИНАЧЕ ТаблицаРассчитанныхПеней.НачислениеВнеГрафика >= ТаблицаРассчитанныхПеней1.НачислениеВнеГрафика
									КОНЕЦ
							ИНАЧЕ ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты >= ТаблицаРассчитанныхПеней1.ПлановаяДатаОплаты
						КОНЕЦ
				ИНАЧЕ ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета >= ТаблицаРассчитанныхПеней1.КонецИнтервалаРасчета
			КОНЕЦ)
			И ТаблицаРассчитанныхПеней.РазделительСтатейПоОплатеПеней = ТаблицаРассчитанныхПеней1.РазделительСтатейПоОплатеПеней

СГРУППИРОВАТЬ ПО
	ТаблицаРассчитанныхПеней.ДоговорЛизинга,
	ТаблицаРассчитанныхПеней.Приложение,
	ТаблицаРассчитанныхПеней.СтатьяГрафика,
	ТаблицаРассчитанныхПеней.Валюта,
	ТаблицаРассчитанныхПеней.НачислениеВнеГрафика,
	ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты,
	ТаблицаРассчитанныхПеней.СуммаКОплате,
	ТаблицаРассчитанныхПеней.СуммаНачисленная,
	ТаблицаРассчитанныхПеней.ЭтоПлатежПоТекущемуГрафику,
	ТаблицаРассчитанныхПеней.ДатаПередачи,
	ТаблицаРассчитанныхПеней.НачалоИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.ДатаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОстаток,
	ТаблицаРассчитанныхПеней.НомерПлатежа,
	ТаблицаРассчитанныхПеней.ПервыйРабочийДень,
	ТаблицаРассчитанныхПеней.ДнейСкорректированных,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатеж,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатежПоКалендарнымДням,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатежПереходящийМесяц,
	ТаблицаРассчитанныхПеней.СтавкаПени,
	ТаблицаРассчитанныхПеней.ЛьготныйПериод,
	ТаблицаРассчитанныхПеней.СуммаПеней,
	ТаблицаРассчитанныхПеней.ДатаИзмененияПараметров,
	ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.РазделительСтатейПоОплатеПеней

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОсновнаяТаблица.ДоговорЛизинга.Владелец КАК Контрагент,
	ОсновнаяТаблица.ДоговорЛизинга КАК ДоговорЛизинга,
	ОсновнаяТаблица.Приложение КАК Приложение,
	ОсновнаяТаблица.СтатьяГрафика КАК Статья,
	ОсновнаяТаблица.Валюта КАК Валюта,
	ОсновнаяТаблица.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ОсновнаяТаблица.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ОсновнаяТаблица.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ОсновнаяТаблица.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ОсновнаяТаблица.ПервыйРабочийДень КАК ПервыйРабочийДень,
	ОсновнаяТаблица.СуммаКОплате КАК СуммаКОплате,
	ОсновнаяТаблица.СуммаНачисленная КАК СуммаНачисленная,
	ОсновнаяТаблица.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафикуПлатежей,
	ОсновнаяТаблица.НомерПлатежа КАК НомерПлатежа,
	ОсновнаяТаблица.ДатаОплаты КАК ДатаОплаты,
	ОсновнаяТаблица.СуммаОплаты КАК СуммаОплаты,
	ОсновнаяТаблица.СуммаОстаток КАК СуммаОстаток,
	ОсновнаяТаблица.ДатаПередачи КАК ДатаПередачи,
	ОсновнаяТаблица.ДнейСкорректированных КАК ДнейСкорректированных,
	ОсновнаяТаблица.ЭтоПросроченныйПлатеж КАК ЭтоПросроченныйПлатеж,
	ОсновнаяТаблица.ЭтоПросроченныйПлатежПоКалендарнымДням КАК ЭтоПросроченныйПлатежПоКалендарнымДням,
	ОсновнаяТаблица.ЭтоПросроченныйПлатежПереходящийМесяц КАК ЭтоПросроченныйПлатежПереходящийМесяц,
	ОсновнаяТаблица.ДатаИзмененияПараметров КАК ДатаИзмененияПараметров,
	ОсновнаяТаблица.СтавкаПени КАК СтавкаПени,
	ОсновнаяТаблица.ЛьготныйПериод КАК ЛьготныйПериод,
	ОсновнаяТаблица.СуммаПеней КАК СуммаПеней,
	ОсновнаяТаблица.СуммаПенейНарастающийИтог КАК СуммаПенейНарастающийИтог,
	МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0)) КАК ОбщаяСуммаОплаченныхПеней,
	ВЫБОР
		КОГДА МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0)) > ОсновнаяТаблица.СуммаПенейНарастающийИтог
			ТОГДА ОсновнаяТаблица.СуммаПеней
		КОГДА ОсновнаяТаблица.СуммаПенейНарастающийИтог - ОсновнаяТаблица.СуммаПеней > МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0))
			ТОГДА 0
		ИНАЧЕ МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0)) - ОсновнаяТаблица.СуммаПенейНарастающийИтог + ОсновнаяТаблица.СуммаПеней
	КОНЕЦ КАК ПениОплачено,
	ВЫБОР
		КОГДА ОсновнаяТаблица.ЭтоПросроченныйПлатеж
			ТОГДА ЕСТЬNULL(СУММА(ТаблицаВзаиморасчетовВесьПериод.ПросроченныйПлатеж), 0) + 1
		ИНАЧЕ 0
	КОНЕЦ КАК ПовторениеПросрочки,
	ОсновнаяТаблица.РазделительСтатейПоОплатеПеней КАК РазделительСтатейПоОплатеПеней
ПОМЕСТИТЬ ВтИтог
ИЗ
	ТаблицаРассчитанныхПенейСНарастающимИтогом КАК ОсновнаяТаблица
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаВзаиморасчетовВесьПериод КАК ТаблицаВзаиморасчетовВесьПериод
		ПО ОсновнаяТаблица.ДоговорЛизинга = ТаблицаВзаиморасчетовВесьПериод.ДоговорЛизинга
			И ОсновнаяТаблица.Приложение = ТаблицаВзаиморасчетовВесьПериод.Приложение
			И ОсновнаяТаблица.СтатьяГрафика = ТаблицаВзаиморасчетовВесьПериод.СтатьяГрафика
			И ОсновнаяТаблица.Валюта = ТаблицаВзаиморасчетовВесьПериод.Валюта
			И ОсновнаяТаблица.ПлановаяДатаОплаты > ТаблицаВзаиморасчетовВесьПериод.ПлановаяДатаОплаты
			И ОсновнаяТаблица.НачислениеВнеГрафика = ТаблицаВзаиморасчетовВесьПериод.НачислениеВнеГрафика
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОплатПенейВесьПериод КАК ОплатыПеней
		ПО ОсновнаяТаблица.ДоговорЛизинга = ОплатыПеней.ДоговорЛизинга
			И ОсновнаяТаблица.Приложение = ОплатыПеней.Приложение
			И ОсновнаяТаблица.Валюта = ОплатыПеней.Валюта
			И ОсновнаяТаблица.РазделительСтатейПоОплатеПеней = ОплатыПеней.РазделительСтатейПоОплатеПеней
ГДЕ
	ОсновнаяТаблица.ПлановаяДатаОплаты МЕЖДУ &НачалоПериода И &КонецПериода

СГРУППИРОВАТЬ ПО
	ОсновнаяТаблица.ДоговорЛизинга.Владелец,
	ОсновнаяТаблица.ДоговорЛизинга,
	ОсновнаяТаблица.Приложение,
	ОсновнаяТаблица.СтатьяГрафика,
	ОсновнаяТаблица.Валюта,
	ОсновнаяТаблица.ДатаПередачи,
	ОсновнаяТаблица.НачислениеВнеГрафика,
	ОсновнаяТаблица.ПлановаяДатаОплаты,
	ОсновнаяТаблица.ЭтоПросроченныйПлатеж,
	ОсновнаяТаблица.ЭтоПросроченныйПлатежПоКалендарнымДням,
	ОсновнаяТаблица.ЭтоПросроченныйПлатежПереходящийМесяц,
	ОсновнаяТаблица.НомерПлатежа,
	ОсновнаяТаблица.ПервыйРабочийДень,
	ОсновнаяТаблица.ДатаОплаты,
	ОсновнаяТаблица.НачалоИнтервалаРасчета,
	ОсновнаяТаблица.СуммаКОплате,
	ОсновнаяТаблица.СуммаНачисленная,
	ОсновнаяТаблица.СуммаПенейНарастающийИтог,
	ОсновнаяТаблица.ЭтоПлатежПоТекущемуГрафику,
	ОсновнаяТаблица.СуммаОплаты,
	ОсновнаяТаблица.СуммаОстаток,
	ОсновнаяТаблица.ДнейСкорректированных,
	ОсновнаяТаблица.СтавкаПени,
	ОсновнаяТаблица.ЛьготныйПериод,
	ОсновнаяТаблица.СуммаПеней,
	ОсновнаяТаблица.ДатаИзмененияПараметров,
	ОсновнаяТаблица.КонецИнтервалаРасчета,
	ОсновнаяТаблица.РазделительСтатейПоОплатеПеней
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	МАКСИМУМ(&ДатаСреза) КАК ДатаАктуальности,
	МАКСИМУМ(&КонецПериода) КАК ДатаПринятияРешения,
	ВтИтог.Контрагент КАК Контрагент,
	ВтИтог.ДоговорЛизинга.Код КАК ДоговорКод,
	ВтИтог.ДоговорЛизинга.хлНомерДоговора КАК НомерДоговора,
	МАКСИМУМ(ВтИтог.ДатаПередачи) КАК ДатаПередачи,
	МАКСИМУМ(ВЫБОР
			КОГДА (ВтИтог.ЭтоПросроченныйПлатежПереходящийМесяц = ИСТИНА
					ИЛИ ВтИтог.ЭтоПросроченныйПлатежПоКалендарнымДням = ИСТИНА
						И НАЧАЛОПЕРИОДА(ВтИтог.КонецИнтервалаРасчета, ДЕНЬ) = НАЧАЛОПЕРИОДА(&КонецПериода, ДЕНЬ)
						И ВтИтог.КонецИнтервалаРасчета >= ДОБАВИТЬКДАТЕ(&ДатаСреза, ДЕНЬ, -3))
					И ВтИтог.ПервыйРабочийДень ЕСТЬ НЕ NULL 
					И ВтИтог.СуммаКОплате > 0
				ТОГДА 1
			ИНАЧЕ 0
		КОНЕЦ) КАК OVERDUE_FLG_1с,
	МАКСИМУМ(ВтИтог.КонецИнтервалаРасчета) КАК КонецИнтервалаРасчета,
	МАКСИМУМ(ВтИтог.ПлановаяДатаОплаты) КАК ПлановаяДатаОплаты,
	МАКСИМУМ(ВтИтог.ПервыйРабочийДень) КАК ПервыйРабочийДень,
	МАКСИМУМ(ВтИтог.ДатаОплаты) КАК ДатаОплаты,
	ВтИтог.Контрагент.ИНН КАК ИНН
ИЗ
	ВтИтог КАК ВтИтог

СГРУППИРОВАТЬ ПО
	ВтИтог.Контрагент,
	ВтИтог.ДоговорЛизинга.Код,
	ВтИтог.ДоговорЛизинга.хлНомерДоговора"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",22},
{1,"ЭтоВыражение",
{"Pattern"},"В",9},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"#",5a49abd5-936d-4f46-8499-9cb204efe378},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",22}
},
{2,3,0,0,1,1,2,2,
{1,15,
{2,145,3,
{"S","ДоговорЛизинга"},
{"B",0},
{"#",376807bc-0d88-4c06-9eb2-42b72b970afb,25:836b94049cc883ef11ed82c1ce4f875a},0},
{2,146,3,
{"S","НачалоПериода"},
{"B",0},
{"D",20010101000000},0},
{2,147,3,
{"S","КонецПериода"},
{"B",0},
{"D",20210605000000},0},
{2,148,3,
{"S","ДатаСреза"},
{"B",0},
{"D",20231004000000},0},
{2,149,3,
{"S","НаборСтатейИсключаемыхИзБазыРасчетаПени"},
{"B",0},
{"#",c3ec4375-8577-46d5-be3b-185e29cc8b67,17853:00000000000000000000000000000000},0},
{2,150,3,
{"S","НазначениеПени"},
{"B",0},
{"#",6bcdbfc3-84d1-4e5c-8ca9-d8e2b284449a,10672:ab6d3182f5ebc532496b0dcec964ddde},0},
{2,151,3,
{"S","НачалоВеденияУчета"},
{"B",0},
{"D",20010101000000},0},
{2,152,3,
{"S","СтатьяКомпенсацияСтрахования"},
{"B",0},
{"#",6bcdbfc3-84d1-4e5c-8ca9-d8e2b284449a,10672:86c101a9072f8a0e40fec391bb9e00a9},0},
{2,153,3,
{"S","СтатьяЛП"},
{"B",0},
{"#",46acbd87-b2d2-42f3-a9cc-ae9d20da8355,531:b6f2001b78e1182a11de1aad5fa16558},0},
{2,154,3,
{"S","Страна"},
{"B",0},
{"#",4ee4f6c6-683e-4abc-8890-ed6cde5a53cb,33:8ce4d57185730a3b4108effa215d0c81},0},
{2,155,3,
{"S","ШтрафыЗаСтрахование"},
{"B",0},
{"#",46acbd87-b2d2-42f3-a9cc-ae9d20da8355,531:816494049cc883ef11e5523c750d54c3},0},
{2,156,3,
{"S","Статья"},
{"B",0},
{"#",46acbd87-b2d2-42f3-a9cc-ae9d20da8355,531:b6f2001b78e1182a11de1aad5fa16558},0},
{2,157,3,
{"S","ИНН_20170801"},
{"B",0},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3,
{6,1e512aab-1b41-4ef6-9375-f0137be9dd91,0,0,
{11,
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7735558612"},
{4,0,
{0},"",-1,-1,0,0,""},0,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","6454070360"},
{4,0,
{0},"",-1,-1,0,0,""},1,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7107107609"},
{4,0,
{0},"",-1,-1,0,0,""},2,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","5257145871"},
{4,0,
{0},"",-1,-1,0,0,""},3,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7609027393"},
{4,0,
{0},"",-1,-1,0,0,""},4,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7708149339"},
{4,0,
{0},"",-1,-1,0,0,""},5,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","6725018567"},
{4,0,
{0},"",-1,-1,0,0,""},6,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","5075019819"},
{4,0,
{0},"",-1,-1,0,0,""},7,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7730582185"},
{4,0,
{0},"",-1,-1,0,0,""},8,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7806266760"},
{4,0,
{0},"",-1,-1,0,0,""},9,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","6671010368"},
{4,0,
{0},"",-1,-1,0,0,""},10,0,""}
}
},
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",5a49abd5-936d-4f46-8499-9cb204efe378},
{"B"},
{"S",10,1},
{"D","D"},
{"N",10,0,0}
},0,10}
},0},
{2,158,3,
{"S","ИНН"},
{"B",0},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3,
{6,1e512aab-1b41-4ef6-9375-f0137be9dd91,0,0,
{1,
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7415100164"},
{4,0,
{0},"",-1,-1,0,0,""},0,0,""}
}
},
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",5a49abd5-936d-4f46-8499-9cb204efe378},
{"B"},
{"S",10,1},
{"D","D"},
{"N",10,0,0}
},0,0}
},0},
{2,159,3,
{"S","ИНН_20200605"},
{"B",0},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3,
{6,1e512aab-1b41-4ef6-9375-f0137be9dd91,0,0,
{18,
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","3110009178"},
{4,0,
{0},"",-1,-1,0,0,""},0,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","2317072696"},
{4,0,
{0},"",-1,-1,0,0,""},1,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","3662245914"},
{4,0,
{0},"",-1,-1,0,0,""},2,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","6142021455"},
{4,0,
{0},"",-1,-1,0,0,""},3,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","5609093762"},
{4,0,
{0},"",-1,-1,0,0,""},4,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","5247050282"},
{4,0,
{0},"",-1,-1,0,0,""},5,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7814580515"},
{4,0,
{0},"",-1,-1,0,0,""},6,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","9701075522"},
{4,0,
{0},"",-1,-1,0,0,""},7,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","4202043639"},
{4,0,
{0},"",-1,-1,0,0,""},8,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","6732031946"},
{4,0,
{0},"",-1,-1,0,0,""},9,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","5401382243"},
{4,0,
{0},"",-1,-1,0,0,""},10,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","6164108822"},
{4,0,
{0},"",-1,-1,0,0,""},11,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7415100164"},
{4,0,
{0},"",-1,-1,0,0,""},12,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","3661038462"},
{4,0,
{0},"",-1,-1,0,0,""},13,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","4826077974"},
{4,0,
{0},"",-1,-1,0,0,""},14,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","5003455616"},
{4,0,
{0},"",-1,-1,0,0,""},15,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","6147020504"},
{4,0,
{0},"",-1,-1,0,0,""},16,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7723905371"},
{4,0,
{0},"",-1,-1,0,0,""},17,0,""}
}
},
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",5a49abd5-936d-4f46-8499-9cb204efe378},
{"B"},
{"S",10,1},
{"D","D"},
{"N",10,0,0}
},0,17}
},0}
},2,159},
{0,0}
}
},
{"N",1},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{2,
{0,"ИмяВарианта",
{"Pattern",
{"S"}
},"Имя варианта",15},
{1,"ТекстКода",
{"Pattern",
{"S"}
},"Текст кода",87}
},
{2,2,0,0,1,1,
{1,0},1,-1},
{0,0}
}
},
{"#",e199ca70-93cf-46ce-a54b-6edc88c3a296,
{#base64:AQE4EgAAAAAAAO+7v3siIyIsM2Q0OGZlYWUtYTljNi00YzVhLWEwOTktOWViNjQ3
NzYzMGM2LA0KezIsDQp7DQp7IlMiLCLRhdC70J3QvtC80LXRgNCU0L7Qs9C+0LLQ
vtGA0LAifSwNCnsiIyIsNDIzODAxOWQtN2U0OS00ZmM5LTkxZGItYjZiOTUxZDVj
ZjhlLA0KezUsDQp7DQp7IlMiLCLQndCw0YfQsNC70YzQvdCw0Y/QodGC0YDQvtC6
0LAifSwNCnsiTiIsMH0NCn0sDQp7DQp7IlMiLCLQmtC+0L3QtdGH0L3QsNGP0KHR
gtGA0L7QutCwIn0sDQp7Ik4iLDB9DQp9LA0Kew0KeyJTIiwi0KLQuNC/0JfQvdCw
0YfQtdC90LjRj9Ce0LHRitC10LrRgtCwIn0sDQp7IlUifQ0KfSwNCnsNCnsiUyIs
ItCf0L7Qu9GP0KHQuNC90YXRgNC+0L3QuNC30LDRhtC40LgifSwNCnsiIyIsYWNm
NjE5MmUtODFjYS00NmVmLTkzYTYtNWE2OTY4Yjc4NjYzLA0KezksDQp7NCwNCnsw
LCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC90LjQt9Cw0YbQuNC4IiwNCnsiUGF0dGVy
biIsDQp7IlMifQ0KfSwi0J/QvtC70LUg0YHQuNC90YXRgNC+0L3QuNC30LDRhtC4
0LgiLDMxfSwNCnsxLCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC90LjQt9Cw0YbQuNC4
0J/RgNC10LTRgdGC0LDQstC70LXQvdC40LUiLA0KeyJQYXR0ZXJuIiwNCnsiUyJ9
DQp9LCLQn9GA0LXQtNGB0YLQsNCy0LvQtdC90LjQtSIsMzF9LA0KezIsItCf0L7Q
u9C10KHQuNC90YXRgNC+0L3QuNC30LDRhtC40LjQotC40L/Ql9C90LDRh9C10L3Q
uNGPIiwNCnsiUGF0dGVybiIsDQp7IiMiLGY1YzY1MDUwLTNiYmItMTFkNS1iOTg4
LTAwNTBiYWUwYTk1ZH0NCn0sItCi0LjQvyDQt9C90LDRh9C10L3QuNGPIiwyMX0s
DQp7Mywi0J3QvtC80LXRgNCa0L7Qu9C+0L3QutC40J7RgtCx0L7RgNCwIiwNCnsi
UGF0dGVybiIsDQp7Ik4iLDEwLDAsMX0NCn0sItCd0L7QvNC10YAg0LrQvtC70L7Q
vdC60Lgg0YLQsNCx0LvQuNGG0Ysg0L7RgtCx0L7RgNCwIiwyNn0NCn0sDQp7Miw0
LDAsMCwxLDEsMiwyLDMsMywNCnsxLDB9LDMsLTF9LA0KezAsMH0NCn0NCn0NCn0s
DQp7DQp7IlMiLCLQotCw0LHQu9C40YfQvdGL0LnQlNC+0LrRg9C80LXQvdGC0J7R
gtCx0L7RgNCwIn0sDQp7IiMiLGU2MDMxMDNlLWEzMTgtNGVkYy1hMDE0LWIxYzZj
Zjk0ZDQ5ZiwNCns4LDEsMTEsDQp7IiMiLCIiLDEsMSwiIyIsItCv0LfRi9C6INC/
0L4g0YPQvNC+0LvRh9Cw0L3QuNGOIiwi0K/Qt9GL0Log0L/QviDRg9C80L7Qu9GH
0LDQvdC40Y4iLDB9LA0KezEyOCw3Mn0sDQp7MH0sMCwNCnswLDB9LA0KezAsMH0s
DQp7MCwwfSwNCnswLDB9LA0KezAsMH0sDQp7MCwwfSwwLDIsMCwNCnswLDAsMDAw
MDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAwLDB9LDAsMCwwLDAsMCww
LDAsMCwwLA0KezB9LA0KezB9LA0KezB9LA0KezB9LCIiLA0Kew0KezAsNiw2LA0K
eyJOIiwxMDAwfSw3LA0KeyJOIiwxMDAwfSw4LA0KeyJOIiwxMDAwfSw5LA0KeyJO
IiwxMDAwfSwxMCwNCnsiTiIsMTAwMH0sMTEsDQp7Ik4iLDEwMDB9DQp9DQp9LA0K
ezAsLTEsLTEsLTEsLTEsMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAw
MDAwfSwwLDAsMCwwLDAsMCwwLDEsMCwxLDAsMCwwLDAsMCwyLA0KezMsMywNCnst
MX0NCn0sDQp7MywzLA0Key0zfQ0KfSwwLDAsMCwiIiwwLA0KezMsMCwwLDEwMCwx
LDEsMCwxLDEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsIiIsMCwwLDAsMCwwLDAs
MH0sDQp7MH0sMCwwLDAsMSwwLDB9DQp9DQp9DQp9DQp9DQp9LA0Kew0KeyJTIiwi
0JTQvtCz0L7QstC+0YDQm9C40LfQuNC90LPQsCJ9LA0KeyIjIiw0MjM4MDE5ZC03
ZTQ5LTRmYzktOTFkYi1iNmI5NTFkNWNmOGUsDQp7NSwNCnsNCnsiUyIsItCd0LDR
h9Cw0LvRjNC90LDRj9Ch0YLRgNC+0LrQsCJ9LA0KeyJOIiwxfQ0KfSwNCnsNCnsi
UyIsItCa0L7QvdC10YfQvdCw0Y/QodGC0YDQvtC60LAifSwNCnsiTiIsMX0NCn0s
DQp7DQp7IlMiLCLQotC40L/Ql9C90LDRh9C10L3QuNGP0J7QsdGK0LXQutGC0LAi
fSwNCnsiVCIsMzc2ODA3YmMtMGQ4OC00YzA2LTllYjItNDJiNzJiOTcwYWZifQ0K
fSwNCnsNCnsiUyIsItCf0L7Qu9GP0KHQuNC90YXRgNC+0L3QuNC30LDRhtC40Lgi
fSwNCnsiIyIsYWNmNjE5MmUtODFjYS00NmVmLTkzYTYtNWE2OTY4Yjc4NjYzLA0K
ezksDQp7NCwNCnswLCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC90LjQt9Cw0YbQuNC4
IiwNCnsiUGF0dGVybiIsDQp7IlMifQ0KfSwi0J/QvtC70LUg0YHQuNC90YXRgNC+
0L3QuNC30LDRhtC40LgiLDMxfSwNCnsxLCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC9
0LjQt9Cw0YbQuNC40J/RgNC10LTRgdGC0LDQstC70LXQvdC40LUiLA0KeyJQYXR0
ZXJuIiwNCnsiUyJ9DQp9LCLQn9GA0LXQtNGB0YLQsNCy0LvQtdC90LjQtSIsMzF9
LA0KezIsItCf0L7Qu9C10KHQuNC90YXRgNC+0L3QuNC30LDRhtC40LjQotC40L/Q
l9C90LDRh9C10L3QuNGPIiwNCnsiUGF0dGVybiIsDQp7IiMiLGY1YzY1MDUwLTNi
YmItMTFkNS1iOTg4LTAwNTBiYWUwYTk1ZH0NCn0sItCi0LjQvyDQt9C90LDRh9C1
0L3QuNGPIiwyMX0sDQp7Mywi0J3QvtC80LXRgNCa0L7Qu9C+0L3QutC40J7RgtCx
0L7RgNCwIiwNCnsiUGF0dGVybiIsDQp7Ik4iLDEwLDAsMX0NCn0sItCd0L7QvNC1
0YAg0LrQvtC70L7QvdC60Lgg0YLQsNCx0LvQuNGG0Ysg0L7RgtCx0L7RgNCwIiwy
Nn0NCn0sDQp7Miw0LDAsMCwxLDEsMiwyLDMsMywNCnsxLDEsDQp7MiwwLDQsDQp7
IlMiLCLRhdC70J3QvtC80LXRgNCU0L7Qs9C+0LLQvtGA0LAifSwNCnsiUyIsItCU
0L7Qs9C+0LLQvtGA0JvQuNC30LjQvdCz0LAu0J3QvtC80LXRgCDQtNC+0LPQvtCy
0L7RgNCwIn0sDQp7IiMiLGY1YzY1MDUwLTNiYmItMTFkNS1iOTg4LTAwNTBiYWUw
YTk1ZCwNCnsiUGF0dGVybiIsDQp7IlMiLDEwMCwxfQ0KfQ0KfSwNCnsiTiIsMX0s
MH0NCn0sMywwfSwNCnswLDB9DQp9DQp9DQp9LA0Kew0KeyJTIiwi0KLQsNCx0LvQ
uNGH0L3Ri9C50JTQvtC60YPQvNC10L3RgtCe0YLQsdC+0YDQsCJ9LA0KeyIjIixl
NjAzMTAzZS1hMzE4LTRlZGMtYTAxNC1iMWM2Y2Y5NGQ0OWYsDQp7OCwxLDExLA0K
eyIjIiwiIiwxLDEsIiMiLCLQr9C30YvQuiDQv9C+INGD0LzQvtC70YfQsNC90LjR
jiIsItCv0LfRi9C6INC/0L4g0YPQvNC+0LvRh9Cw0L3QuNGOIiwwfSwNCnsxMjgs
NzJ9LA0KezB9LDAsDQp7MCwwfSwNCnswLDB9LA0KezAsMH0sDQp7MCwwfSwNCnsw
LDB9LA0KezAsMH0sMCwyLDE2LDAsMCwxLDAsDQp7MTYsMSwNCnsxLDEsDQp7IiMi
LCLQkNCbIDI1MDcyLzAxLTE0INCa0JfQnSJ9DQp9LDB9LDEsMCwxLDAsDQp7MTYs
MCwNCnsxLDEsDQp7IiMiLCLQkNCbIDI2NjA5LzAxLTE0INCj0JvQnSJ9DQp9LDB9
LDIsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDI1NTA1LzAyLTE0
INCS0KDQliJ9DQp9LDB9LDMsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQ
kNCbIDI0MTQ0LzA0LTE0INCa0JfQnSJ9DQp9LDB9LDQsMCwxLDAsDQp7MTYsMCwN
CnsxLDEsDQp7IiMiLCLQkNCbIDI2MTA3LzAyLTE0INCf0J3QlyJ9DQp9LDB9LDUs
MCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDI0Njg1LzAyLTE0INCV
0JrQkSJ9DQp9LDB9LDYsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCb
IDMwOTU5LzAxLTE0INCd0JHQpyJ9DQp9LDB9LDcsMCwxLDAsDQp7MTYsMCwNCnsx
LDEsDQp7IiMiLCLQkNCbIDc0Mjc4LzAxLTE2INCh0KDQoiJ9DQp9LDB9LDgsMCwx
LDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDkyNTAwLzAxLTE3INCh0JzQ
oCJ9DQp9LDB9LDksMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDk4
NzA4LzAxLTE3INCi0K7QnCJ9DQp9LDB9LDEwLDAsMSwwLA0KezE2LDAsDQp7MSwx
LA0KeyIjIiwi0JDQmyAxMTExNjgvMDEtMTgg0J7QoNCRIn0NCn0sMH0sMTEsMCwx
LDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDIxNzAvMTQtMTkg0JrQoNCh
In0NCn0sMH0sMTIsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDEw
MzgxOC8wMi0xOCJ9DQp9LDB9LDEzLDAsMSwwLA0KezE2LDAsDQp7MSwxLA0KeyIj
Iiwi0JDQmyAxMDM4MTgvMDMtMTgifQ0KfSwwfSwxNCwwLDEsMCwNCnsxNiwwLA0K
ezEsMSwNCnsiIyIsItCQ0JsgOTM5NDMvMDItMTgg0KLQm9CiIn0NCn0sMH0sMTUs
MCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDY2OTg4LzAyLTE2INCR
0JPQlCJ9DQp9LDB9LA0KezEsMCwwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAw
MDAwMDAwMDAsMSwwLDJ9LDE2LDAsMCwwLDAsMCwwLDAsMCwNCnswfSwNCnswfSwN
CnswfSwNCnswfSwiIiwNCnsNCnswLDYsNiwNCnsiTiIsMTAwMH0sNywNCnsiTiIs
MTAwMH0sOCwNCnsiTiIsMTAwMH0sOSwNCnsiTiIsMTAwMH0sMTAsDQp7Ik4iLDEw
MDB9LDExLA0KeyJOIiwxMDAwfQ0KfQ0KfSwNCnswLC0xLC0xLC0xLC0xLDAwMDAw
MDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMH0sMCwwLDAsMCwwLDAsMCwx
LDAsMSwyLA0KezIxNzYsMjAxLDJ9LA0KezEyOCwyMTd9LDAsMCwwLDAsMywNCnsz
LDMsDQp7LTF9DQp9LA0KezMsMywNCnstM30NCn0sDQp7MywzLA0Key03fQ0KfSww
LDAsMCwiIiwwLA0KezMsMCwwLDEwMCwxLDEsMCwxLDEsMCwwLDAsMCwwLDAsMCww
LDAsMCwwLDAsIiIsMCwwLDAsMCwwLDAsMH0sDQp7MH0sMCwwLDAsMSwwLDB9DQp9
DQp9DQp9DQp9DQp9DQp9DQp9}
},0},
{2,8,6,
{"S","день последней оплаты просрочки по всем договорам для inn"},
{"S","ВЫБРАТЬ
	хлПриложениеКДоговоруЛизинга.ДоговорЛизинга КАК ДоговорЛизинга,
	хлПриложениеКДоговоруЛизинга.ДоговорЛизинга.ДоговорКонтрагента КАК ДоговорКонтрагента,
	хлПриложениеКДоговоруЛизинга.Номер КАК НомерПриложения
ПОМЕСТИТЬ ВтВсеДоговоры
ИЗ
	Документ.хлПриложениеКДоговоруЛизинга КАК хлПриложениеКДоговоруЛизинга
ГДЕ
	хлПриложениеКДоговоруЛизинга.хлпДоговорКонтрагента.хлНомерДоговора ПОДОБНО ""АЛ %""
	И НЕ хлПриложениеКДоговоруЛизинга.ПометкаУдаления
	И НЕ хлПриложениеКДоговоруЛизинга.хлпДоговорКонтрагента.ПометкаУдаления
	И НЕ хлПриложениеКДоговоруЛизинга.ДоговорЛизинга.ДоговорКонтрагента.Код ЕСТЬ NULL
	И хлПриложениеКДоговоруЛизинга.хлпДоговорКонтрагента.Владелец.ИНН В(&ИНН_22042021)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПроизводственныеКалендариСтранМира.Дата КАК Дата,
	ВЫБОР
		КОГДА ПроизводственныеКалендариСтранМира.ВидДня = ЗНАЧЕНИЕ(Перечисление.ВидыДнейПроизводственногоКалендаря.Рабочий)
			ТОГДА ИСТИНА
		КОГДА ПроизводственныеКалендариСтранМира.ВидДня = ЗНАЧЕНИЕ(Перечисление.ВидыДнейПроизводственногоКалендаря.Предпраздничный)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоРабочийДень
ПОМЕСТИТЬ КалендарьПолный
ИЗ
	РегистрСведений.хлПроизводственныеКалендариСтранМира КАК ПроизводственныеКалендариСтранМира
ГДЕ
	ПроизводственныеКалендариСтранМира.Страна = &Страна
	И ПроизводственныеКалендариСтранМира.Дата <= &КонецПериода

ИНДЕКСИРОВАТЬ ПО
	Дата
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	КалендарьПолный.Дата КАК Дата
ПОМЕСТИТЬ КалендарьРабочиеДни
ИЗ
	КалендарьПолный КАК КалендарьПолный
ГДЕ
	КалендарьПолный.ЭтоРабочийДень

ИНДЕКСИРОВАТЬ ПО
	Дата
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	КалендарьПолный.Дата КАК Дата,
	МИНИМУМ(ЕСТЬNULL(КалендарьРабочиеДни.Дата, КалендарьПолный.Дата)) КАК ПервыйРабочийДень
ПОМЕСТИТЬ ПроизводственныйКалендарь
ИЗ
	КалендарьПолный КАК КалендарьПолный
		ЛЕВОЕ СОЕДИНЕНИЕ КалендарьРабочиеДни КАК КалендарьРабочиеДни
		ПО (ВЫБОР
				КОГДА КалендарьПолный.ЭтоРабочийДень
					ТОГДА ЛОЖЬ
				ИНАЧЕ КалендарьПолный.Дата <= КалендарьРабочиеДни.Дата
			КОНЕЦ)

СГРУППИРОВАТЬ ПО
	КалендарьПолный.Дата

ИНДЕКСИРОВАТЬ ПО
	Дата
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга.Владелец КАК Контрагент,
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга КАК ДоговорЛизинга,
	МИНИМУМ(ВЫБОР
			КОГДА ПредметыЛизингаВЛизингеОбороты.КоличествоПриход > 0
				ТОГДА ПредметыЛизингаВЛизингеОбороты.Период
		КОНЕЦ) КАК ДатаПередачи
ПОМЕСТИТЬ ТаблицаПередач
ИЗ
	РегистрНакопления.хлПредметыЛизингаВЛизинге.Обороты(
			&НачалоВеденияУчета,
			&КонецПериода,
			День,
			ДоговорЛизинга В
				(ВЫБРАТЬ
					ВтВсеДоговоры.ДоговорКонтрагента
				ИЗ
					ВтВсеДоговоры)) КАК ПредметыЛизингаВЛизингеОбороты

СГРУППИРОВАТЬ ПО
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга,
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга.Владелец

ИНДЕКСИРОВАТЬ ПО
	ПредметыЛизингаВЛизингеОбороты.ДоговорЛизинга
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ КАК ЭтоФакт,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга.Владелец КАК Контрагент,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга КАК ДоговорЛизинга,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Приложение КАК Приложение,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Статья КАК СтатьяГрафика,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Валюта КАК Валюта,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Дата КАК ПлановаяДатаОплаты,
	ЕСТЬNULL(ТаблицаПередач.ДатаПередачи, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаПередачи,
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
		ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
	КОНЕЦ КАК ДатаОплаты,
	СУММА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Сумма) КАК Сумма,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	МАКСИМУМ(ВЫБОР
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
					И (хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика
						ИЛИ хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Регистратор = ТаблицаАктуальныхУтверждений.Регистратор)
				ТОГДА ИСТИНА
			ИНАЧЕ ЛОЖЬ
		КОНЕЦ) КАК ЭтоПлатежПоТекущемуГрафику
ПОМЕСТИТЬ ВзаиморасчетыВесьПериод
ИЗ
	ВтВсеДоговоры КАК ВтВсеДоговоры
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику КАК хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику
			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.хлДанныеУтвержденийГрафиков.СрезПоследних(
					&КонецПериода,
					ВидГрафика = ЗНАЧЕНИЕ(Справочник.хлВидыГрафиков.ГрафикПлатежейПоДоговоруЛизинга)
						И Договор В
							(ВЫБРАТЬ
								ВтВсеДоговоры.ДоговорКонтрагента
							ИЗ
								ВтВсеДоговоры)) КАК ТаблицаАктуальныхУтверждений
			ПО хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга = ТаблицаАктуальныхУтверждений.Договор
				И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Приложение = ТаблицаАктуальныхУтверждений.Приложение
				И (хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход))
			ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаПередач КАК ТаблицаПередач
			ПО хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга = ТаблицаПередач.ДоговорЛизинга
		ПО ВтВсеДоговоры.ДоговорКонтрагента = хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга
ГДЕ
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Активность
	И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период <= &КонецПериода
	И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Дата <= &ДатаСреза
	И ВЫБОР
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
					И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
				ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
			ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
		КОНЕЦ <= &КонецПериода
	И хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Статья = &Статья
	И ВЫБОР
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
				ТОГДА ДАТАВРЕМЯ(1, 1, 1)
			КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
				ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
			ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
		КОНЕЦ <= &ДатаСреза

СГРУППИРОВАТЬ ПО
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ЛОЖЬ
		ИНАЧЕ ИСТИНА
	КОНЕЦ,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Валюта,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга.Владелец,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДоговорЛизинга,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Статья,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Приложение,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Дата,
	ЕСТЬNULL(ТаблицаПередач.ДатаПередачи, ДАТАВРЕМЯ(1, 1, 1)),
	ВЫБОР
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		КОГДА хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)
			ТОГДА НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.ДатаОплаты, ДЕНЬ)
		ИНАЧЕ НАЧАЛОПЕРИОДА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Период, ДЕНЬ)
	КОНЕЦ

ИМЕЮЩИЕ
	СУММА(хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.Сумма) <> 0

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	хлВзаиморасчетыПоДоговорамЛизингаПоТекущемуГрафику.НачислениеВнеГрафика,
	ДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение КАК Приложение,
	ВзаиморасчетыВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ВзаиморасчетыВесьПериод.Валюта КАК Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.Сумма КАК Сумма,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ВзаиморасчетыВесьПериод.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику
ПОМЕСТИТЬ ТаблицаНачисленийВесьПериод
ИЗ
	ВзаиморасчетыВесьПериод КАК ВзаиморасчетыВесьПериод
ГДЕ
	ВзаиморасчетыВесьПериод.ЭтоФакт = ЛОЖЬ

ИНДЕКСИРОВАТЬ ПО
	ВзаиморасчетыВесьПериод.ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение,
	ВзаиморасчетыВесьПериод.СтатьяГрафика,
	ВзаиморасчетыВесьПериод.Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение КАК Приложение,
	ВзаиморасчетыВесьПериод.Валюта КАК Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.ДатаПередачи КАК ДатаПередачи,
	ВзаиморасчетыВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ВзаиморасчетыВесьПериод.ДатаОплаты КАК ДатаОплаты,
	ВзаиморасчетыВесьПериод.Сумма КАК СуммаОплаты,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика
ПОМЕСТИТЬ ТаблицаОплатВесьПериод
ИЗ
	ВзаиморасчетыВесьПериод КАК ВзаиморасчетыВесьПериод
ГДЕ
	ВзаиморасчетыВесьПериод.ЭтоФакт = ИСТИНА

ИНДЕКСИРОВАТЬ ПО
	ВзаиморасчетыВесьПериод.ДоговорЛизинга,
	ВзаиморасчетыВесьПериод.Приложение,
	ВзаиморасчетыВесьПериод.СтатьяГрафика,
	ВзаиморасчетыВесьПериод.Валюта,
	ВзаиморасчетыВесьПериод.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериод.НачислениеВнеГрафика,
	ВзаиморасчетыВесьПериод.ДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаОплатВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение КАК Приложение,
	ТаблицаОплатВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаОплатВесьПериод.Валюта КАК Валюта,
	ТаблицаОплатВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаОплатВесьПериод.ДатаПередачи КАК ДатаПередачи,
	ТаблицаОплатВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	МАКСИМУМ(ВЫБОР
			КОГДА ТаблицаОплатВесьПериодДляОстатков.ДатаОплаты >= ТаблицаОплатВесьПериод.ДатаОплаты
				ТОГДА ТаблицаОплатВесьПериод.ПлановаяДатаОплаты
			ИНАЧЕ ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.ДатаОплаты, ТаблицаОплатВесьПериод.ПлановаяДатаОплаты)
		КОНЕЦ) КАК НачалоИнтервалаРасчета,
	ТаблицаОплатВесьПериод.ДатаОплаты КАК ДатаОплаты,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.ЭтоФакт, ЛОЖЬ) = ЛОЖЬ
				ТОГДА 1
			ИНАЧЕ -1
		КОНЕЦ * ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.Сумма, 0)) + ТаблицаОплатВесьПериод.СуммаОплаты КАК СуммаНачальныйОстаток,
	ТаблицаОплатВесьПериод.СуммаОплаты КАК СуммаОплаты,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.ЭтоФакт, ЛОЖЬ) = ЛОЖЬ
				ТОГДА 1
			ИНАЧЕ -1
		КОНЕЦ * ЕСТЬNULL(ТаблицаОплатВесьПериодДляОстатков.Сумма, 0)) КАК СуммаКонечныйОстаток
ПОМЕСТИТЬ ТаблицаОплатСОстаткамиВесьПериод
ИЗ
	ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ ВзаиморасчетыВесьПериод КАК ТаблицаОплатВесьПериодДляОстатков
		ПО ТаблицаОплатВесьПериод.ДоговорЛизинга = ТаблицаОплатВесьПериодДляОстатков.ДоговорЛизинга
			И ТаблицаОплатВесьПериод.Приложение = ТаблицаОплатВесьПериодДляОстатков.Приложение
			И ТаблицаОплатВесьПериод.СтатьяГрафика = ТаблицаОплатВесьПериодДляОстатков.СтатьяГрафика
			И ТаблицаОплатВесьПериод.Валюта = ТаблицаОплатВесьПериодДляОстатков.Валюта
			И ТаблицаОплатВесьПериод.ПлановаяДатаОплаты = ТаблицаОплатВесьПериодДляОстатков.ПлановаяДатаОплаты
			И ТаблицаОплатВесьПериод.НачислениеВнеГрафика = ТаблицаОплатВесьПериодДляОстатков.НачислениеВнеГрафика
			И ТаблицаОплатВесьПериод.ДатаОплаты >= ТаблицаОплатВесьПериодДляОстатков.ДатаОплаты

СГРУППИРОВАТЬ ПО
	ТаблицаОплатВесьПериод.Валюта,
	ТаблицаОплатВесьПериод.СтатьяГрафика,
	ТаблицаОплатВесьПериод.ПлановаяДатаОплаты,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.СуммаОплаты,
	ТаблицаОплатВесьПериод.ДатаОплаты,
	ТаблицаОплатВесьПериод.ДатаПередачи,
	ТаблицаОплатВесьПериод.НачислениеВнеГрафика

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика,
	ДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыВесьПериодОстатки.ДоговорЛизинга КАК ДоговорЛизинга,
	ВзаиморасчетыВесьПериодОстатки.Приложение КАК Приложение,
	ВзаиморасчетыВесьПериодОстатки.СтатьяГрафика КАК СтатьяГрафика,
	ВзаиморасчетыВесьПериодОстатки.Валюта КАК Валюта,
	ВзаиморасчетыВесьПериодОстатки.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериодОстатки.ДатаПередачи КАК ДатаПередачи,
	ВзаиморасчетыВесьПериодОстатки.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) КАК СуммаОстаток,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) КАК СуммаОстаток1,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) КАК СуммаОстаток2
ПОМЕСТИТЬ ТаблицаОстатков
ИЗ
	ВзаиморасчетыВесьПериод КАК ВзаиморасчетыВесьПериодОстатки

СГРУППИРОВАТЬ ПО
	ВзаиморасчетыВесьПериодОстатки.ДоговорЛизинга,
	ВзаиморасчетыВесьПериодОстатки.Приложение,
	ВзаиморасчетыВесьПериодОстатки.СтатьяГрафика,
	ВзаиморасчетыВесьПериодОстатки.Валюта,
	ВзаиморасчетыВесьПериодОстатки.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериодОстатки.ДатаПередачи,
	ВзаиморасчетыВесьПериодОстатки.НачислениеВнеГрафика

ИМЕЮЩИЕ
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыВесьПериодОстатки.ЭтоФакт
				ТОГДА -1
			ИНАЧЕ 1
		КОНЕЦ * ВзаиморасчетыВесьПериодОстатки.Сумма) <> 0

ИНДЕКСИРОВАТЬ ПО
	ВзаиморасчетыВесьПериодОстатки.ДоговорЛизинга,
	ВзаиморасчетыВесьПериодОстатки.Приложение,
	ВзаиморасчетыВесьПериодОстатки.СтатьяГрафика,
	ВзаиморасчетыВесьПериодОстатки.Валюта,
	ВзаиморасчетыВесьПериодОстатки.ПлановаяДатаОплаты,
	ВзаиморасчетыВесьПериодОстатки.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ ПЕРВЫЕ 1
	НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья КАК СтатьяКомпенсация
ПОМЕСТИТЬ врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях
ИЗ
	Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ИсключаемыеСтатьи КАК НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи
ГДЕ
	ВЫБОР
			КОГДА &НаборСтатейИсключаемыхИзБазыРасчетаПени = ЗНАЧЕНИЕ(Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ПустаяСсылка)
				ТОГДА ИСТИНА
			ИНАЧЕ НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Ссылка = &НаборСтатейИсключаемыхИзБазыРасчетаПени
		КОНЕЦ
	И НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья = &СтатьяКомпенсацияСтрахования
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаОплатВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение КАК Приложение,
	ТаблицаОплатВесьПериод.Валюта КАК Валюта,
	СУММА(ТаблицаОплатВесьПериод.СуммаОплаты) КАК СуммаОплаты,
	1 КАК РазделительСтатейПоОплатеПеней
ПОМЕСТИТЬ ТаблицаОплатПенейВесьПериод
ИЗ
	ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.хлНазначенияОбъектов КАК НазначенияОбъектов
		ПО ТаблицаОплатВесьПериод.СтатьяГрафика = НазначенияОбъектов.Объект
			И (НазначенияОбъектов.Назначение = &НазначениеПени)
ГДЕ
	НазначенияОбъектов.Назначение = &НазначениеПени

СГРУППИРОВАТЬ ПО
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.Валюта

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.Валюта,
	СУММА(ТаблицаОплатВесьПериод.СуммаОплаты),
	2
ИЗ
	ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях КАК врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях
		ПО (ИСТИНА)
ГДЕ
	ТаблицаОплатВесьПериод.СтатьяГрафика = &ШтрафыЗаСтрахование
	И врКомпенсацияСтрахованияОтсутствуетВИсключаемыхСтатьях.СтатьяКомпенсация ЕСТЬ NULL

СГРУППИРОВАТЬ ПО
	ТаблицаОплатВесьПериод.ДоговорЛизинга,
	ТаблицаОплатВесьПериод.Приложение,
	ТаблицаОплатВесьПериод.Валюта
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение КАК Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта КАК Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.Сумма КАК Сумма,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику,
	СУММА(ТаблицаОплатВесьПериод.СуммаОплаты) КАК СуммаОплаты,
	МАКСИМУМ(ТаблицаОплатВесьПериод.ДатаОплаты) КАК ДатаОплаты,
	ВЫБОР
		КОГДА МАКСИМУМ(ТаблицаОплатВесьПериод.ДатаОплаты) ЕСТЬ NULL
				ИЛИ ТаблицаНачисленийВесьПериод.Сумма - ЕСТЬNULL(СУММА(ТаблицаОплатВесьПериод.СуммаОплаты), 0) > 0
				ИЛИ РАЗНОСТЬДАТ(ПроизводственныйКалендарь.ПервыйРабочийДень, МАКСИМУМ(ТаблицаОплатВесьПериод.ДатаОплаты), ДЕНЬ) > 0
			ТОГДА 1
		ИНАЧЕ 0
	КОНЕЦ КАК ПросроченныйПлатеж
ПОМЕСТИТЬ ТаблицаВзаиморасчетовВесьПериод
ИЗ
	ТаблицаНачисленийВесьПериод КАК ТаблицаНачисленийВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОплатВесьПериод КАК ТаблицаОплатВесьПериод
		ПО ТаблицаНачисленийВесьПериод.ДоговорЛизинга = ТаблицаОплатВесьПериод.ДоговорЛизинга
			И ТаблицаНачисленийВесьПериод.Приложение = ТаблицаОплатВесьПериод.Приложение
			И ТаблицаНачисленийВесьПериод.СтатьяГрафика = ТаблицаОплатВесьПериод.СтатьяГрафика
			И ТаблицаНачисленийВесьПериод.Валюта = ТаблицаОплатВесьПериод.Валюта
			И ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты = ТаблицаОплатВесьПериод.ПлановаяДатаОплаты
			И ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика = ТаблицаОплатВесьПериод.НачислениеВнеГрафика
		ЛЕВОЕ СОЕДИНЕНИЕ ПроизводственныйКалендарь КАК ПроизводственныйКалендарь
		ПО ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты = ПроизводственныйКалендарь.Дата

СГРУППИРОВАТЬ ПО
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.Сумма,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику,
	ПроизводственныйКалендарь.ПервыйРабочийДень

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение КАК Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта КАК Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.Сумма КАК Сумма,
	КОЛИЧЕСТВО(ТаблицаНачисленийВесьПериодДляНомераПлатежа.ПлановаяДатаОплаты) КАК НомерПлатежа,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику
ПОМЕСТИТЬ ТаблицаНачислений
ИЗ
	ТаблицаНачисленийВесьПериод КАК ТаблицаНачисленийВесьПериод
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаНачисленийВесьПериод КАК ТаблицаНачисленийВесьПериодДляНомераПлатежа
		ПО ТаблицаНачисленийВесьПериод.ДоговорЛизинга = ТаблицаНачисленийВесьПериодДляНомераПлатежа.ДоговорЛизинга
			И ТаблицаНачисленийВесьПериод.Приложение = ТаблицаНачисленийВесьПериодДляНомераПлатежа.Приложение
			И ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты >= ТаблицаНачисленийВесьПериодДляНомераПлатежа.ПлановаяДатаОплаты
			И ТаблицаНачисленийВесьПериод.СтатьяГрафика = ТаблицаНачисленийВесьПериодДляНомераПлатежа.СтатьяГрафика
			И ТаблицаНачисленийВесьПериод.Валюта = ТаблицаНачисленийВесьПериодДляНомераПлатежа.Валюта
			И (НЕ ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика
				ИЛИ ТаблицаНачисленийВесьПериод.СтатьяГрафика = &СтатьяЛП)

СГРУППИРОВАТЬ ПО
	ТаблицаНачисленийВесьПериод.ДоговорЛизинга,
	ТаблицаНачисленийВесьПериод.Приложение,
	ТаблицаНачисленийВесьПериод.СтатьяГрафика,
	ТаблицаНачисленийВесьПериод.Валюта,
	ТаблицаНачисленийВесьПериод.ПлановаяДатаОплаты,
	ТаблицаНачисленийВесьПериод.НачислениеВнеГрафика,
	ТаблицаНачисленийВесьПериод.Сумма,
	ТаблицаНачисленийВесьПериод.ЭтоПлатежПоТекущемуГрафику

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОплатыИОстатки.ДоговорЛизинга КАК ДоговорЛизинга,
	ОплатыИОстатки.Приложение КАК Приложение,
	ОплатыИОстатки.СтатьяГрафика КАК СтатьяГрафика,
	ОплатыИОстатки.Валюта КАК Валюта,
	ОплатыИОстатки.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ОплатыИОстатки.ДатаПередачи КАК ДатаПередачи,
	ОплатыИОстатки.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ОплатыИОстатки.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	КОНЕЦПЕРИОДА(ОплатыИОстатки.КонецИнтервалаРасчета, ДЕНЬ) КАК КонецИнтервалаРасчета,
	ЕСТЬNULL(ОплатыИОстатки.ДатаОплаты, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаОплаты,
	ОплатыИОстатки.БазаРасчетаПеней КАК БазаРасчетаПеней,
	ОплатыИОстатки.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
	ОплатыИОстатки.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток,
	ОплатыИОстатки.СуммаОплаты КАК СуммаОплаты
ПОМЕСТИТЬ ТаблицаДляРасчетаПеней
ИЗ
	(ВЫБРАТЬ
		Оплаты.ДоговорЛизинга КАК ДоговорЛизинга,
		Оплаты.Приложение КАК Приложение,
		Оплаты.СтатьяГрафика КАК СтатьяГрафика,
		Оплаты.Валюта КАК Валюта,
		Оплаты.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
		Оплаты.ДатаПередачи КАК ДатаПередачи,
		Оплаты.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
		Оплаты.ДатаОплаты КАК КонецИнтервалаРасчета,
		Оплаты.ДатаОплаты КАК ДатаОплаты,
		Оплаты.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
		Оплаты.СуммаНачальныйОстаток КАК БазаРасчетаПеней,
		Оплаты.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
		Оплаты.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток,
		Оплаты.СуммаОплаты КАК СуммаОплаты
	ИЗ
		ТаблицаОплатСОстаткамиВесьПериод КАК Оплаты
	ГДЕ
		Оплаты.ДатаОплаты <= &КонецПериода
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		Остатки.ДоговорЛизинга,
		Остатки.Приложение,
		Остатки.СтатьяГрафика,
		Остатки.Валюта,
		Остатки.ПлановаяДатаОплаты,
		Остатки.ДатаПередачи,
		ЕСТЬNULL(МАКСИМУМ(Оплаты.ДатаОплаты), Остатки.ПлановаяДатаОплаты),
		&КонецПериода,
		NULL,
		Остатки.НачислениеВнеГрафика,
		Остатки.СуммаОстаток,
		Остатки.СуммаОстаток1,
		Остатки.СуммаОстаток2,
		0
	ИЗ
		ТаблицаОстатков КАК Остатки
			ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОплатВесьПериод КАК Оплаты
			ПО (Оплаты.ДоговорЛизинга = Остатки.ДоговорЛизинга)
				И (Оплаты.Приложение = Остатки.Приложение)
				И (Оплаты.СтатьяГрафика = Остатки.СтатьяГрафика)
				И (Оплаты.Валюта = Остатки.Валюта)
				И (Оплаты.ПлановаяДатаОплаты = Остатки.ПлановаяДатаОплаты)
				И (Оплаты.НачислениеВнеГрафика = Остатки.НачислениеВнеГрафика)
				И (Оплаты.ДатаОплаты <= &КонецПериода)
	ГДЕ
		Остатки.СуммаОстаток > 0
	
	СГРУППИРОВАТЬ ПО
		Остатки.ДоговорЛизинга,
		Остатки.Приложение,
		Остатки.СтатьяГрафика,
		Остатки.Валюта,
		Остатки.ПлановаяДатаОплаты,
		Остатки.ДатаПередачи,
		Остатки.НачислениеВнеГрафика,
		Остатки.СуммаОстаток,
		Остатки.СуммаОстаток1,
		Остатки.СуммаОстаток2) КАК ОплатыИОстатки

СГРУППИРОВАТЬ ПО
	ОплатыИОстатки.Приложение,
	ОплатыИОстатки.Валюта,
	ОплатыИОстатки.ПлановаяДатаОплаты,
	ОплатыИОстатки.ДатаПередачи,
	ОплатыИОстатки.НачалоИнтервалаРасчета,
	ОплатыИОстатки.НачислениеВнеГрафика,
	ОплатыИОстатки.ДоговорЛизинга,
	ОплатыИОстатки.СтатьяГрафика,
	ОплатыИОстатки.КонецИнтервалаРасчета,
	ОплатыИОстатки.ДатаОплаты,
	ОплатыИОстатки.СуммаНачальныйОстаток,
	ОплатыИОстатки.СуммаКонечныйОстаток,
	ОплатыИОстатки.СуммаОплаты,
	ОплатыИОстатки.БазаРасчетаПеней

ИНДЕКСИРОВАТЬ ПО
	ОплатыИОстатки.ДоговорЛизинга,
	ОплатыИОстатки.Приложение,
	ОплатыИОстатки.СтатьяГрафика,
	ОплатыИОстатки.Валюта,
	ОплатыИОстатки.ПлановаяДатаОплаты,
	ОплатыИОстатки.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПараметрыНачисленияПениПоДоговорамЛизинга.Период КАК Период,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ДоговорКонтрагента КАК ДоговорКонтрагента,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ПараметрыНачисленияПениПоДоговорамЛизинга.НаборИсключаемыхСтатей КАК НаборИсключаемыхСтатей,
	ПараметрыНачисленияПениПоДоговорамЛизинга.СтавкаПени КАК СтавкаПени,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ЛьготныйПериод КАК ЛьготныйПериод
ПОМЕСТИТЬ ПараметрыНачисленияПени
ИЗ
	РегистрСведений.хлПараметрыНачисленияПениПоДоговорамЛизинга КАК ПараметрыНачисленияПениПоДоговорамЛизинга
ГДЕ
	ПараметрыНачисленияПениПоДоговорамЛизинга.ДоговорКонтрагента В
			(ВЫБРАТЬ
				ВтВсеДоговоры.ДоговорКонтрагента
			ИЗ
				ВтВсеДоговоры)

ИНДЕКСИРОВАТЬ ПО
	ПараметрыНачисленияПениПоДоговорамЛизинга.Период,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ДоговорКонтрагента,
	НаборИсключаемыхСтатей,
	ПараметрыНачисленияПениПоДоговорамЛизинга.ПлановаяДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	ПараметрыНачисленияПени.ДоговорКонтрагента КАК ДоговорКонтрагента,
	ПараметрыНачисленияПени.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты
ПОМЕСТИТЬ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
ИЗ
	ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
ГДЕ
	ПараметрыНачисленияПени.ПлановаяДатаОплаты <> ДАТАВРЕМЯ(1, 1, 1)

ИНДЕКСИРОВАТЬ ПО
	ПараметрыНачисленияПени.ПлановаяДатаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета КАК ДатаПараметров,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение КАК Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта КАК Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика
ПОМЕСТИТЬ ДатыПараметровНачисленияПени
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
ГДЕ
	ТаблицаДляРасчетаПеней.ДатаПередачи <> ДАТАВРЕМЯ(1, 1, 1)
	И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты >= ТаблицаДляРасчетаПеней.ДатаПередачи

ОБЪЕДИНИТЬ

ВЫБРАТЬ
	НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ),
	ТаблицаДляРасчетаПеней.ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
ГДЕ
	ТаблицаДляРасчетаПеней.ДатаПередачи <> ДАТАВРЕМЯ(1, 1, 1)
	И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты >= ТаблицаДляРасчетаПеней.ДатаПередачи

ОБЪЕДИНИТЬ

ВЫБРАТЬ
	ПараметрыНачисленияПени.Период,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты КАК ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
		ПО ТаблицаДляРасчетаПеней.ДоговорЛизинга = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ДоговорКонтрагента
			И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
		ПО (ПараметрыНачисленияПени.Период <= ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			И (ПараметрыНачисленияПени.Период >= ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета)
			И (ПараметрыНачисленияПени.ДоговорКонтрагента = ТаблицаДляРасчетаПеней.ДоговорЛизинга)
			И (ВЫБОР
				КОГДА ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты ЕСТЬ NULL
					ТОГДА ПараметрыНачисленияПени.ПлановаяДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ПараметрыНачисленияПени.ПлановаяДатаОплаты = ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты
			КОНЕЦ)
			И (ТаблицаДляРасчетаПеней.ДатаПередачи <> ДАТАВРЕМЯ(1, 1, 1))
			И (ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты >= ТаблицаДляРасчетаПеней.ДатаПередачи)

ИНДЕКСИРОВАТЬ ПО
	ДатаПараметров,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение КАК Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта КАК Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ДатыПараметровНачисленияПени.ДатаПараметров КАК ДатаПараметров
ПОМЕСТИТЬ ИнтервалыРасчетаПенейСДатамиИзмененияПараметровНачисленияПени
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДатыПараметровНачисленияПени КАК ДатыПараметровНачисленияПени
		ПО (ВЫБОР
				КОГДА ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета > ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета
					ТОГДА ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета = ДатыПараметровНачисленияПени.ДатаПараметров
				ИНАЧЕ ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета <= ДатыПараметровНачисленияПени.ДатаПараметров
						И ДатыПараметровНачисленияПени.ДатаПараметров <= ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета
			КОНЕЦ)
			И ТаблицаДляРасчетаПеней.ДоговорЛизинга = ДатыПараметровНачисленияПени.ДоговорЛизинга
			И ТаблицаДляРасчетаПеней.Приложение = ДатыПараметровНачисленияПени.Приложение
			И ТаблицаДляРасчетаПеней.СтатьяГрафика = ДатыПараметровНачисленияПени.СтатьяГрафика
			И ТаблицаДляРасчетаПеней.Валюта = ДатыПараметровНачисленияПени.Валюта
			И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты = ДатыПараметровНачисленияПени.ПлановаяДатаОплаты
			И ТаблицаДляРасчетаПеней.НачислениеВнеГрафика = ДатыПараметровНачисленияПени.НачислениеВнеГрафика

ИНДЕКСИРОВАТЬ ПО
	НачалоИнтервалаРасчета,
	КонецИнтервалаРасчета,
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика,
	ДатаПараметров
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Приложение КАК Приложение,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Валюта КАК Валюта,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров КАК НачалоИнтервалаПараметров,
	МИНИМУМ(ВЫБОР
			КОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета <= КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров, ДЕНЬ)
				ТОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета
			ИНАЧЕ КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров, ДЕНЬ)
		КОНЕЦ) КАК КонецИнтервалаПараметров
ПОМЕСТИТЬ ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПени
ИЗ
	ИнтервалыРасчетаПенейСДатамиИзмененияПараметровНачисленияПени КАК ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ИнтервалыРасчетаПенейСДатамиИзмененияПараметровНачисленияПени КАК ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1
		ПО ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.НачалоИнтервалаРасчета
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.КонецИнтервалаРасчета
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДоговорЛизинга = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДоговорЛизинга
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Приложение = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.Приложение
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.СтатьяГрафика = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.СтатьяГрафика
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Валюта = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.Валюта
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ПлановаяДатаОплаты
			И ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачислениеВнеГрафика = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.НачислениеВнеГрафика
			И (ВЫБОР
				КОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета >= НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета, ДЕНЬ)
					ТОГДА ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров = ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров
				ИНАЧЕ ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров < ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени1.ДатаПараметров
			КОНЕЦ)
ГДЕ
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты <= ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров

СГРУППИРОВАТЬ ПО
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДоговорЛизинга,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Приложение,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.СтатьяГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.Валюта,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейСДатамиПараметровНачисленияПени.ДатаПараметров

ИНДЕКСИРОВАТЬ ПО
	НачалоИнтервалаРасчета,
	ДоговорЛизинга
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Приложение КАК Приложение,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Валюта КАК Валюта,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаПараметров КАК НачалоИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаПараметров КАК КонецИнтервалаПараметров,
	МАКСИМУМ(ПараметрыНачисленияПени.Период) КАК ПериодПараметров
ПОМЕСТИТЬ ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПениСДатамиПараметров
ИЗ
	ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПени КАК ТаблицаДляРасчетаПенейПоИнтерваламПараметров
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты КАК ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ДоговорКонтрагента
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаПараметров >= ПараметрыНачисленияПени.Период
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга = ПараметрыНачисленияПени.ДоговорКонтрагента
			И (ВЫБОР
				КОГДА ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты ЕСТЬ NULL
					ТОГДА ПараметрыНачисленияПени.ПлановаяДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПени.ПлановаяДатаОплаты
			КОНЕЦ)

СГРУППИРОВАТЬ ПО
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ДоговорЛизинга,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Приложение,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.СтатьяГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.Валюта,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.НачалоИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметров.КонецИнтервалаПараметров

ИНДЕКСИРОВАТЬ ПО
	ПериодПараметров,
	ДоговорЛизинга,
	СтатьяГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.Приложение КАК Приложение,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.Валюта КАК Валюта,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.НачалоИнтервалаПараметров КАК НачалоИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.КонецИнтервалаПараметров КАК КонецИнтервалаПараметров,
	ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПериодПараметров КАК ПериодПараметров,
	ЕСТЬNULL(ПараметрыНачисленияПени.СтавкаПени, 0) КАК СтавкаПени,
	ЕСТЬNULL(ПараметрыНачисленияПени.ЛьготныйПериод, 0) КАК ЛьготныйПериод
ПОМЕСТИТЬ ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени
ИЗ
	ИнтервалыРасчетаСУчетомПериодовДействияПараметровНачисленияПениСДатамиПараметров КАК ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты КАК ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ДоговорЛизинга = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ДоговорКонтрагента
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты
		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыНачисленияПени КАК ПараметрыНачисленияПени
		ПО ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПериодПараметров = ПараметрыНачисленияПени.Период
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ДоговорЛизинга = ПараметрыНачисленияПени.ДоговорКонтрагента
			И (ВЫБОР
				КОГДА ПараметрыНачисленияПениСЗаполненнойПлановойДатойОплаты.ПлановаяДатаОплаты ЕСТЬ NULL
					ТОГДА ПараметрыНачисленияПени.ПлановаяДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.ПлановаяДатаОплаты = ПараметрыНачисленияПени.ПлановаяДатаОплаты
			КОНЕЦ)
		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ИсключаемыеСтатьи КАК НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи
		ПО (ВЫБОР
				КОГДА &НаборСтатейИсключаемыхИзБазыРасчетаПени = ЗНАЧЕНИЕ(Справочник.хлНаборыСтатейИсключаемыхИзБазыРасчетаПени.ПустаяСсылка)
					ТОГДА ПараметрыНачисленияПени.НаборИсключаемыхСтатей = НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Ссылка
				ИНАЧЕ НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Ссылка = &НаборСтатейИсключаемыхИзБазыРасчетаПени
			КОНЕЦ)
			И ТаблицаДляРасчетаПенейПоИнтерваламПараметровСДатамиПараметров.СтатьяГрафика = НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья
ГДЕ
	НаборыСтатейИсключаемыхИзБазыРасчетаПениИсключаемыеСтатьи.Статья ЕСТЬ NULL

ИНДЕКСИРОВАТЬ ПО
	НачалоИнтервалаРасчета,
	КонецИнтервалаРасчета,
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДляРасчетаПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаДляРасчетаПеней.Приложение КАК Приложение,
	ТаблицаДляРасчетаПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаДляРасчетаПеней.Валюта КАК Валюта,
	ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаДляРасчетаПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.НачалоИнтервалаПараметров, ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета) КАК НачалоИнтервалаРасчета,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета) КАК КонецИнтервалаРасчета,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ТаблицаДляРасчетаПеней.ДатаОплаты
		ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1)
	КОНЕЦ КАК ДатаОплаты,
	ТаблицаДляРасчетаПеней.БазаРасчетаПеней КАК БазаРасчетаПеней,
	ТаблицаДляРасчетаПеней.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ТаблицаДляРасчетаПеней.СуммаКонечныйОстаток
		ИНАЧЕ ТаблицаДляРасчетаПеней.СуммаНачальныйОстаток
	КОНЕЦ КАК СуммаКонечныйОстаток,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ТаблицаДляРасчетаПеней.СуммаОплаты
		ИНАЧЕ 0
	КОНЕЦ КАК СуммаОплаты,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.СтавкаПени, 0) КАК СтавкаПени,
	ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.ЛьготныйПериод, 0) КАК ЛьготныйПериод,
	ВЫБОР
		КОГДА КОНЕЦПЕРИОДА(ТаблицаДляРасчетаПеней.ДатаОплаты, ДЕНЬ) = ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
		ИНАЧЕ ВЫБОР
				КОГДА ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета) = &КонецПериода
					ТОГДА ДАТАВРЕМЯ(1, 1, 1)
				ИНАЧЕ ЕСТЬNULL(ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаПараметров, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета)
			КОНЕЦ
	КОНЕЦ КАК ДатаИзмененияПараметров
ПОМЕСТИТЬ ТаблицаДляРасчетаПенейСПараметрамиНачисленияПени
ИЗ
	ТаблицаДляРасчетаПеней КАК ТаблицаДляРасчетаПеней
		ЛЕВОЕ СОЕДИНЕНИЕ ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени КАК ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени
		ПО ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.НачалоИнтервалаРасчета
			И ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.КонецИнтервалаРасчета
			И ТаблицаДляРасчетаПеней.ДоговорЛизинга = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.ДоговорЛизинга
			И ТаблицаДляРасчетаПеней.Приложение = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.Приложение
			И ТаблицаДляРасчетаПеней.СтатьяГрафика = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.СтатьяГрафика
			И ТаблицаДляРасчетаПеней.Валюта = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.Валюта
			И ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.ПлановаяДатаОплаты
			И ТаблицаДляРасчетаПеней.НачислениеВнеГрафика = ИнтервалыРасчетаСУчетомПериодовДействияПараметровСПараметрамиНачисленияПени.НачислениеВнеГрафика

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика,
	НачалоИнтервалаРасчета
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ЕСТЬNULL(ТаблицаВзаиморасчетов.ДоговорЛизинга, ТаблицаДляРасчетаПеней.ДоговорЛизинга) КАК ДоговорЛизинга,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.Приложение, ТаблицаДляРасчетаПеней.Приложение) КАК Приложение,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.СтатьяГрафика, ТаблицаДляРасчетаПеней.СтатьяГрафика) КАК СтатьяГрафика,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.Валюта, ТаблицаДляРасчетаПеней.Валюта) КАК Валюта,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.ПлановаяДатаОплаты, ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты) КАК ПлановаяДатаОплаты,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.НачислениеВнеГрафика, ТаблицаДляРасчетаПеней.НачислениеВнеГрафика) КАК НачислениеВнеГрафика,
	ЕСТЬNULL(ТаблицаДляРасчетаПеней.СуммаНачальныйОстаток, ТаблицаВзаиморасчетов.Сумма) КАК СуммаКОплате,
	ТаблицаВзаиморасчетов.Сумма КАК СуммаНачисленная,
	ЕСТЬNULL(ТаблицаВзаиморасчетов.ЭтоПлатежПоТекущемуГрафику, ИСТИНА) КАК ЭтоПлатежПоТекущемуГрафику,
	ВЫБОР
		КОГДА ТаблицаВзаиморасчетов.ПлановаяДатаОплаты > ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
			ТОГДА ТаблицаВзаиморасчетов.ПлановаяДатаОплаты
		ИНАЧЕ ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
	КОНЕЦ КАК НачалоИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаДляРасчетаПеней.ДатаОплаты КАК ДатаОплаты,
	ТаблицаДляРасчетаПеней.СуммаОплаты КАК СуммаОплаты,
	ТаблицаДляРасчетаПеней.СуммаКонечныйОстаток КАК СуммаОстаток,
	ТаблицаВзаиморасчетов.НомерПлатежа КАК НомерПлатежа,
	ПроизводственныйКалендарь.ПервыйРабочийДень КАК ПервыйРабочийДень,
	ТаблицаПередач.ДатаПередачи КАК ДатаПередачи,
	ВЫБОР
		КОГДА ПроизводственныйКалендарь.ПервыйРабочийДень < ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
			ТОГДА РАЗНОСТЬДАТ(ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
		КОГДА ПроизводственныйКалендарь.ПервыйРабочийДень < ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета
			ТОГДА РАЗНОСТЬДАТ(ПроизводственныйКалендарь.ПервыйРабочийДень, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
		ИНАЧЕ 0
	КОНЕЦ КАК ДнейСкорректированных,
	ВЫБОР
		КОГДА НАЧАЛОПЕРИОДА(ПроизводственныйКалендарь.ПервыйРабочийДень, ДЕНЬ) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоПросроченныйПлатеж,
	ВЫБОР
		КОГДА НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты, ДЕНЬ) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЭтоПросроченныйПлатежПоКалендарнымДням,
	ТаблицаДляРасчетаПеней.СтавкаПени КАК СтавкаПени,
	ТаблицаДляРасчетаПеней.ЛьготныйПериод КАК ЛьготныйПериод,
	ТаблицаДляРасчетаПеней.БазаРасчетаПеней КАК БазаРасчетаПеней,
	ВЫРАЗИТЬ(ВЫБОР
			КОГДА ДОБАВИТЬКДАТЕ(ПроизводственныйКалендарь.ПервыйРабочийДень, ДЕНЬ, ТаблицаДляРасчетаПеней.ЛьготныйПериод) < ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета
				ТОГДА РАЗНОСТЬДАТ(ТаблицаДляРасчетаПеней.НачалоИнтервалаРасчета, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			КОГДА ДОБАВИТЬКДАТЕ(ПроизводственныйКалендарь.ПервыйРабочийДень, ДЕНЬ, ТаблицаДляРасчетаПеней.ЛьготныйПериод) < НАЧАЛОПЕРИОДА(ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
				ТОГДА РАЗНОСТЬДАТ(ПроизводственныйКалендарь.ПервыйРабочийДень, ТаблицаДляРасчетаПеней.КонецИнтервалаРасчета, ДЕНЬ)
			ИНАЧЕ 0
		КОНЕЦ * ВЫБОР
			КОГДА ЕСТЬNULL(ТаблицаДляРасчетаПеней.БазаРасчетаПеней, 0) < 0
				ТОГДА 0
			ИНАЧЕ ЕСТЬNULL(ТаблицаДляРасчетаПеней.БазаРасчетаПеней, 0)
		КОНЕЦ * ТаблицаДляРасчетаПеней.СтавкаПени * 0.01 КАК ЧИСЛО(15, 2)) КАК СуммаПеней,
	ТаблицаДляРасчетаПеней.ДатаИзмененияПараметров КАК ДатаИзмененияПараметров,
	ВЫБОР
		КОГДА ЕСТЬNULL(ТаблицаВзаиморасчетов.СтатьяГрафика, ТаблицаДляРасчетаПеней.СтатьяГрафика) = &СтатьяЛП
			ТОГДА 1
		ИНАЧЕ 2
	КОНЕЦ КАК РазделительСтатейПоОплатеПеней
ПОМЕСТИТЬ ТаблицаРассчитанныхПеней
ИЗ
	ТаблицаНачислений КАК ТаблицаВзаиморасчетов
		ПОЛНОЕ СОЕДИНЕНИЕ ТаблицаДляРасчетаПенейСПараметрамиНачисленияПени КАК ТаблицаДляРасчетаПеней
		ПО ТаблицаВзаиморасчетов.ДоговорЛизинга = ТаблицаДляРасчетаПеней.ДоговорЛизинга
			И ТаблицаВзаиморасчетов.Приложение = ТаблицаДляРасчетаПеней.Приложение
			И ТаблицаВзаиморасчетов.СтатьяГрафика = ТаблицаДляРасчетаПеней.СтатьяГрафика
			И ТаблицаВзаиморасчетов.Валюта = ТаблицаДляРасчетаПеней.Валюта
			И ТаблицаВзаиморасчетов.ПлановаяДатаОплаты = ТаблицаДляРасчетаПеней.ПлановаяДатаОплаты
			И ТаблицаВзаиморасчетов.НачислениеВнеГрафика = ТаблицаДляРасчетаПеней.НачислениеВнеГрафика
		ЛЕВОЕ СОЕДИНЕНИЕ ПроизводственныйКалендарь КАК ПроизводственныйКалендарь
		ПО ТаблицаВзаиморасчетов.ПлановаяДатаОплаты = ПроизводственныйКалендарь.Дата
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаПередач КАК ТаблицаПередач
		ПО ТаблицаВзаиморасчетов.ДоговорЛизинга = ТаблицаПередач.ДоговорЛизинга

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	Валюта,
	КонецИнтервалаРасчета,
	НомерПлатежа
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаРассчитанныхПеней.ДоговорЛизинга КАК ДоговорЛизинга,
	ТаблицаРассчитанныхПеней.Приложение КАК Приложение,
	ТаблицаРассчитанныхПеней.СтатьяГрафика КАК СтатьяГрафика,
	ТаблицаРассчитанныхПеней.Валюта КАК Валюта,
	ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ТаблицаРассчитанныхПеней.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ТаблицаРассчитанныхПеней.СуммаКОплате КАК СуммаКОплате,
	ТаблицаРассчитанныхПеней.СуммаНачисленная КАК СуммаНачисленная,
	ТаблицаРассчитанныхПеней.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафику,
	ТаблицаРассчитанныхПеней.ДатаПередачи КАК ДатаПередачи,
	ТаблицаРассчитанныхПеней.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.ДатаОплаты КАК ДатаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОплаты КАК СуммаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОстаток КАК СуммаОстаток,
	ТаблицаРассчитанныхПеней.НомерПлатежа КАК НомерПлатежа,
	ТаблицаРассчитанныхПеней.ПервыйРабочийДень КАК ПервыйРабочийДень,
	ТаблицаРассчитанныхПеней.ДнейСкорректированных КАК ДнейСкорректированных,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатеж КАК ЭтоПросроченныйПлатеж,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатежПоКалендарнымДням КАК ЭтоПросроченныйПлатежПоКалендарнымДням,
	ТаблицаРассчитанныхПеней.ДатаИзмененияПараметров КАК ДатаИзмененияПараметров,
	ТаблицаРассчитанныхПеней.СтавкаПени КАК СтавкаПени,
	ТаблицаРассчитанныхПеней.ЛьготныйПериод КАК ЛьготныйПериод,
	ТаблицаРассчитанныхПеней.СуммаПеней КАК СуммаПеней,
	ТаблицаРассчитанныхПеней.РазделительСтатейПоОплатеПеней КАК РазделительСтатейПоОплатеПеней,
	СУММА(ЕСТЬNULL(ТаблицаРассчитанныхПеней1.СуммаПеней, 0)) КАК СуммаПенейНарастающийИтог
ПОМЕСТИТЬ ТаблицаРассчитанныхПенейСНарастающимИтогом
ИЗ
	ТаблицаРассчитанныхПеней КАК ТаблицаРассчитанныхПеней
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаРассчитанныхПеней КАК ТаблицаРассчитанныхПеней1
		ПО ТаблицаРассчитанныхПеней.ДоговорЛизинга = ТаблицаРассчитанныхПеней1.ДоговорЛизинга
			И ТаблицаРассчитанныхПеней.Приложение = ТаблицаРассчитанныхПеней1.Приложение
			И ТаблицаРассчитанныхПеней.Валюта = ТаблицаРассчитанныхПеней1.Валюта
			И (ВЫБОР
				КОГДА ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета = ТаблицаРассчитанныхПеней1.КонецИнтервалаРасчета
					ТОГДА ВЫБОР
							КОГДА ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты = ТаблицаРассчитанныхПеней1.ПлановаяДатаОплаты
								ТОГДА ВЫБОР
										КОГДА ТаблицаРассчитанныхПеней.НачислениеВнеГрафика = ТаблицаРассчитанныхПеней1.НачислениеВнеГрафика
											ТОГДА ТаблицаРассчитанныхПеней.СтатьяГрафика >= ТаблицаРассчитанныхПеней1.СтатьяГрафика
										ИНАЧЕ ТаблицаРассчитанныхПеней.НачислениеВнеГрафика >= ТаблицаРассчитанныхПеней1.НачислениеВнеГрафика
									КОНЕЦ
							ИНАЧЕ ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты >= ТаблицаРассчитанныхПеней1.ПлановаяДатаОплаты
						КОНЕЦ
				ИНАЧЕ ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета >= ТаблицаРассчитанныхПеней1.КонецИнтервалаРасчета
			КОНЕЦ)
			И ТаблицаРассчитанныхПеней.РазделительСтатейПоОплатеПеней = ТаблицаРассчитанныхПеней1.РазделительСтатейПоОплатеПеней

СГРУППИРОВАТЬ ПО
	ТаблицаРассчитанныхПеней.ДоговорЛизинга,
	ТаблицаРассчитанныхПеней.Приложение,
	ТаблицаРассчитанныхПеней.СтатьяГрафика,
	ТаблицаРассчитанныхПеней.Валюта,
	ТаблицаРассчитанныхПеней.НачислениеВнеГрафика,
	ТаблицаРассчитанныхПеней.ПлановаяДатаОплаты,
	ТаблицаРассчитанныхПеней.СуммаКОплате,
	ТаблицаРассчитанныхПеней.СуммаНачисленная,
	ТаблицаРассчитанныхПеней.ЭтоПлатежПоТекущемуГрафику,
	ТаблицаРассчитанныхПеней.ДатаПередачи,
	ТаблицаРассчитанныхПеней.НачалоИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.ДатаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОплаты,
	ТаблицаРассчитанныхПеней.СуммаОстаток,
	ТаблицаРассчитанныхПеней.НомерПлатежа,
	ТаблицаРассчитанныхПеней.ПервыйРабочийДень,
	ТаблицаРассчитанныхПеней.ДнейСкорректированных,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатеж,
	ТаблицаРассчитанныхПеней.ЭтоПросроченныйПлатежПоКалендарнымДням,
	ТаблицаРассчитанныхПеней.СтавкаПени,
	ТаблицаРассчитанныхПеней.ЛьготныйПериод,
	ТаблицаРассчитанныхПеней.СуммаПеней,
	ТаблицаРассчитанныхПеней.ДатаИзмененияПараметров,
	ТаблицаРассчитанныхПеней.КонецИнтервалаРасчета,
	ТаблицаРассчитанныхПеней.РазделительСтатейПоОплатеПеней

ИНДЕКСИРОВАТЬ ПО
	ДоговорЛизинга,
	Приложение,
	СтатьяГрафика,
	Валюта,
	ПлановаяДатаОплаты,
	НачислениеВнеГрафика
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОсновнаяТаблица.ДоговорЛизинга.Владелец КАК Контрагент,
	ОсновнаяТаблица.ДоговорЛизинга КАК ДоговорЛизинга,
	ОсновнаяТаблица.Приложение КАК Приложение,
	ОсновнаяТаблица.СтатьяГрафика КАК Статья,
	ОсновнаяТаблица.Валюта КАК Валюта,
	ОсновнаяТаблица.НачалоИнтервалаРасчета КАК НачалоИнтервалаРасчета,
	ОсновнаяТаблица.КонецИнтервалаРасчета КАК КонецИнтервалаРасчета,
	ОсновнаяТаблица.НачислениеВнеГрафика КАК НачислениеВнеГрафика,
	ОсновнаяТаблица.ПлановаяДатаОплаты КАК ПлановаяДатаОплаты,
	ОсновнаяТаблица.ПервыйРабочийДень КАК ПервыйРабочийДень,
	ОсновнаяТаблица.СуммаКОплате КАК СуммаКОплате,
	ОсновнаяТаблица.СуммаНачисленная КАК СуммаНачисленная,
	ОсновнаяТаблица.ЭтоПлатежПоТекущемуГрафику КАК ЭтоПлатежПоТекущемуГрафикуПлатежей,
	ОсновнаяТаблица.НомерПлатежа КАК НомерПлатежа,
	ОсновнаяТаблица.ДатаОплаты КАК ДатаОплаты,
	ОсновнаяТаблица.СуммаОплаты КАК СуммаОплаты,
	ОсновнаяТаблица.СуммаОстаток КАК СуммаОстаток,
	ОсновнаяТаблица.ДатаПередачи КАК ДатаПередачи,
	ОсновнаяТаблица.ДнейСкорректированных КАК ДнейСкорректированных,
	ОсновнаяТаблица.ЭтоПросроченныйПлатеж КАК ЭтоПросроченныйПлатеж,
	ОсновнаяТаблица.ЭтоПросроченныйПлатежПоКалендарнымДням КАК ЭтоПросроченныйПлатежПоКалендарнымДням,
	ОсновнаяТаблица.ДатаИзмененияПараметров КАК ДатаИзмененияПараметров,
	ОсновнаяТаблица.СтавкаПени КАК СтавкаПени,
	ОсновнаяТаблица.ЛьготныйПериод КАК ЛьготныйПериод,
	ОсновнаяТаблица.СуммаПеней КАК СуммаПеней,
	ОсновнаяТаблица.СуммаПенейНарастающийИтог КАК СуммаПенейНарастающийИтог,
	МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0)) КАК ОбщаяСуммаОплаченныхПеней,
	ВЫБОР
		КОГДА МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0)) > ОсновнаяТаблица.СуммаПенейНарастающийИтог
			ТОГДА ОсновнаяТаблица.СуммаПеней
		КОГДА ОсновнаяТаблица.СуммаПенейНарастающийИтог - ОсновнаяТаблица.СуммаПеней > МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0))
			ТОГДА 0
		ИНАЧЕ МАКСИМУМ(ЕСТЬNULL(ОплатыПеней.СуммаОплаты, 0)) - ОсновнаяТаблица.СуммаПенейНарастающийИтог + ОсновнаяТаблица.СуммаПеней
	КОНЕЦ КАК ПениОплачено,
	ВЫБОР
		КОГДА ОсновнаяТаблица.ЭтоПросроченныйПлатеж
			ТОГДА ЕСТЬNULL(СУММА(ТаблицаВзаиморасчетовВесьПериод.ПросроченныйПлатеж), 0) + 1
		ИНАЧЕ 0
	КОНЕЦ КАК ПовторениеПросрочки,
	ОсновнаяТаблица.РазделительСтатейПоОплатеПеней КАК РазделительСтатейПоОплатеПеней
ПОМЕСТИТЬ ВтИтог
ИЗ
	ТаблицаРассчитанныхПенейСНарастающимИтогом КАК ОсновнаяТаблица
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаВзаиморасчетовВесьПериод КАК ТаблицаВзаиморасчетовВесьПериод
		ПО ОсновнаяТаблица.ДоговорЛизинга = ТаблицаВзаиморасчетовВесьПериод.ДоговорЛизинга
			И ОсновнаяТаблица.Приложение = ТаблицаВзаиморасчетовВесьПериод.Приложение
			И ОсновнаяТаблица.СтатьяГрафика = ТаблицаВзаиморасчетовВесьПериод.СтатьяГрафика
			И ОсновнаяТаблица.Валюта = ТаблицаВзаиморасчетовВесьПериод.Валюта
			И ОсновнаяТаблица.ПлановаяДатаОплаты > ТаблицаВзаиморасчетовВесьПериод.ПлановаяДатаОплаты
			И ОсновнаяТаблица.НачислениеВнеГрафика = ТаблицаВзаиморасчетовВесьПериод.НачислениеВнеГрафика
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОплатПенейВесьПериод КАК ОплатыПеней
		ПО ОсновнаяТаблица.ДоговорЛизинга = ОплатыПеней.ДоговорЛизинга
			И ОсновнаяТаблица.Приложение = ОплатыПеней.Приложение
			И ОсновнаяТаблица.Валюта = ОплатыПеней.Валюта
			И ОсновнаяТаблица.РазделительСтатейПоОплатеПеней = ОплатыПеней.РазделительСтатейПоОплатеПеней
ГДЕ
	ОсновнаяТаблица.ПлановаяДатаОплаты МЕЖДУ &НачалоПериода И &КонецПериода

СГРУППИРОВАТЬ ПО
	ОсновнаяТаблица.ДоговорЛизинга.Владелец,
	ОсновнаяТаблица.ДоговорЛизинга,
	ОсновнаяТаблица.Приложение,
	ОсновнаяТаблица.СтатьяГрафика,
	ОсновнаяТаблица.Валюта,
	ОсновнаяТаблица.ДатаПередачи,
	ОсновнаяТаблица.НачислениеВнеГрафика,
	ОсновнаяТаблица.ПлановаяДатаОплаты,
	ОсновнаяТаблица.ЭтоПросроченныйПлатеж,
	ОсновнаяТаблица.ЭтоПросроченныйПлатежПоКалендарнымДням,
	ОсновнаяТаблица.НомерПлатежа,
	ОсновнаяТаблица.ПервыйРабочийДень,
	ОсновнаяТаблица.ДатаОплаты,
	ОсновнаяТаблица.НачалоИнтервалаРасчета,
	ОсновнаяТаблица.СуммаКОплате,
	ОсновнаяТаблица.СуммаНачисленная,
	ОсновнаяТаблица.СуммаПенейНарастающийИтог,
	ОсновнаяТаблица.ЭтоПлатежПоТекущемуГрафику,
	ОсновнаяТаблица.СуммаОплаты,
	ОсновнаяТаблица.СуммаОстаток,
	ОсновнаяТаблица.ДнейСкорректированных,
	ОсновнаяТаблица.СтавкаПени,
	ОсновнаяТаблица.ЛьготныйПериод,
	ОсновнаяТаблица.СуммаПеней,
	ОсновнаяТаблица.ДатаИзмененияПараметров,
	ОсновнаяТаблица.КонецИнтервалаРасчета,
	ОсновнаяТаблица.РазделительСтатейПоОплатеПеней
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	&ДатаСреза КАК ДатаАктуальности,
	&КонецПериода КАК ДатаПринятияРешения,
	ВтИтог.Контрагент КАК Контрагент,
	ВтИтог.ДоговорЛизинга.Код КАК ДоговорКод,
	ВтИтог.ДоговорЛизинга.хлНомерДоговора КАК НомерДоговора,
	МАКСИМУМ(ВтИтог.ДатаОплаты) КАК ПоследнийДеньОплатыПросрочки,
	ВтИтог.ДатаПередачи КАК ДатаПередачи,
	ВтИтог.Контрагент.ИНН КАК ИНН
ИЗ
	ВтИтог КАК ВтИтог
ГДЕ
	ВтИтог.СуммаОстаток <= 0
	И ВтИтог.ЭтоПросроченныйПлатежПоКалендарнымДням = ИСТИНА
	И ВтИтог.ПервыйРабочийДень ЕСТЬ НЕ NULL 
	И ВтИтог.СуммаКОплате > 0

СГРУППИРОВАТЬ ПО
	ВтИтог.ДоговорЛизинга.хлНомерДоговора,
	ВтИтог.Контрагент,
	ВтИтог.ДоговорЛизинга.Код,
	ВтИтог.ДатаПередачи,
	ВтИтог.Контрагент.ИНН"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"ИмяПараметра",
{"Pattern",
{"S",50,1}
},"Имя параметра",22},
{1,"ЭтоВыражение",
{"Pattern"},"В",9},
{2,"ЗначениеПараметра",
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3},
{"#",5a49abd5-936d-4f46-8499-9cb204efe378},
{"B"},
{"S",100,1},
{"D"},
{"N",15,3,0}
},"Значение параметра",22}
},
{2,3,0,0,1,1,2,2,
{1,14,
{2,160,3,
{"S","ДоговорЛизинга"},
{"B",0},
{"#",376807bc-0d88-4c06-9eb2-42b72b970afb,25:836f94049cc883ef11edb2998899c864},0},
{2,161,3,
{"S","НачалоПериода"},
{"B",0},
{"D",20010101000000},0},
{2,162,3,
{"S","КонецПериода"},
{"B",0},
{"D",20210422000000},0},
{2,163,3,
{"S","ДатаСреза"},
{"B",0},
{"D",20230705000000},0},
{2,164,3,
{"S","НаборСтатейИсключаемыхИзБазыРасчетаПени"},
{"B",0},
{"#",c3ec4375-8577-46d5-be3b-185e29cc8b67,17853:00000000000000000000000000000000},0},
{2,165,3,
{"S","НазначениеПени"},
{"B",0},
{"#",6bcdbfc3-84d1-4e5c-8ca9-d8e2b284449a,10672:ab6d3182f5ebc532496b0dcec964ddde},0},
{2,166,3,
{"S","НачалоВеденияУчета"},
{"B",0},
{"D",20010101000000},0},
{2,167,3,
{"S","СтатьяКомпенсацияСтрахования"},
{"B",0},
{"#",6bcdbfc3-84d1-4e5c-8ca9-d8e2b284449a,10672:86c101a9072f8a0e40fec391bb9e00a9},0},
{2,168,3,
{"S","СтатьяЛП"},
{"B",0},
{"#",46acbd87-b2d2-42f3-a9cc-ae9d20da8355,531:b6f2001b78e1182a11de1aad5fa16558},0},
{2,169,3,
{"S","Страна"},
{"B",0},
{"#",4ee4f6c6-683e-4abc-8890-ed6cde5a53cb,33:8ce4d57185730a3b4108effa215d0c81},0},
{2,170,3,
{"S","ШтрафыЗаСтрахование"},
{"B",0},
{"#",46acbd87-b2d2-42f3-a9cc-ae9d20da8355,531:816494049cc883ef11e5523c750d54c3},0},
{2,171,3,
{"S","Статья"},
{"B",0},
{"#",46acbd87-b2d2-42f3-a9cc-ae9d20da8355,531:b6f2001b78e1182a11de1aad5fa16558},0},
{2,172,3,
{"S","ИНН_18072018"},
{"B",0},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3,
{6,1e512aab-1b41-4ef6-9375-f0137be9dd91,0,0,
{18,
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","0265027618"},
{4,0,
{0},"",-1,-1,0,0,""},0,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7723726742"},
{4,0,
{0},"",-1,-1,0,0,""},1,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","4711006487"},
{4,0,
{0},"",-1,-1,0,0,""},2,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","6658319534"},
{4,0,
{0},"",-1,-1,0,0,""},3,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","3664135561"},
{4,0,
{0},"",-1,-1,0,0,""},4,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","5751029972"},
{4,0,
{0},"",-1,-1,0,0,""},5,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","1215220375"},
{4,0,
{0},"",-1,-1,0,0,""},6,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","4205284488"},
{4,0,
{0},"",-1,-1,0,0,""},7,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","5610163414"},
{4,0,
{0},"",-1,-1,0,0,""},8,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","4802007304"},
{4,0,
{0},"",-1,-1,0,0,""},9,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","5024101800"},
{4,0,
{0},"",-1,-1,0,0,""},10,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7329015469"},
{4,0,
{0},"",-1,-1,0,0,""},11,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7718710806"},
{4,0,
{0},"",-1,-1,0,0,""},12,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","6027118233"},
{4,0,
{0},"",-1,-1,0,0,""},13,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","6632022458"},
{4,0,
{0},"",-1,-1,0,0,""},14,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","6714061973"},
{4,0,
{0},"",-1,-1,0,0,""},15,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","2310091450"},
{4,0,
{0},"",-1,-1,0,0,""},16,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","4826088197"},
{4,0,
{0},"",-1,-1,0,0,""},17,0,""}
}
},
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",5a49abd5-936d-4f46-8499-9cb204efe378},
{"B"},
{"S",10,1},
{"D","D"},
{"N",10,0,0}
},0,17}
},0},
{2,173,3,
{"S","ИНН_22042021"},
{"B",0},
{"#",4772b3b4-f4a3-49c0-a1a5-8cb5961511a3,
{6,1e512aab-1b41-4ef6-9375-f0137be9dd91,0,0,
{28,
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","4632199300"},
{4,0,
{0},"",-1,-1,0,0,""},18,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","3511003896"},
{4,0,
{0},"",-1,-1,0,0,""},19,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","5257060434"},
{4,0,
{0},"",-1,-1,0,0,""},20,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7805672390"},
{4,0,
{0},"",-1,-1,0,0,""},21,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","3448038482"},
{4,0,
{0},"",-1,-1,0,0,""},22,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7743761600"},
{4,0,
{0},"",-1,-1,0,0,""},23,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","2223627102"},
{4,0,
{0},"",-1,-1,0,0,""},24,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","4703148840"},
{4,0,
{0},"",-1,-1,0,0,""},25,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","0707015682"},
{4,0,
{0},"",-1,-1,0,0,""},26,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","3525096890"},
{4,0,
{0},"",-1,-1,0,0,""},27,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7816683273"},
{4,0,
{0},"",-1,-1,0,0,""},28,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","3406006496"},
{4,0,
{0},"",-1,-1,0,0,""},29,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","5047141212"},
{4,0,
{0},"",-1,-1,0,0,""},30,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","5308001174"},
{4,0,
{0},"",-1,-1,0,0,""},31,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7203085179"},
{4,0,
{0},"",-1,-1,0,0,""},32,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7709620173"},
{4,0,
{0},"",-1,-1,0,0,""},33,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7206045738"},
{4,0,
{0},"",-1,-1,0,0,""},34,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","2116001046"},
{4,0,
{0},"",-1,-1,0,0,""},39,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7735590140"},
{4,0,
{0},"",-1,-1,0,0,""},40,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","5257175837"},
{4,0,
{0},"",-1,-1,0,0,""},41,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","6230116508"},
{4,0,
{0},"",-1,-1,0,0,""},42,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7722643099"},
{4,0,
{0},"",-1,-1,0,0,""},43,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7729111311"},
{4,0,
{0},"",-1,-1,0,0,""},44,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","3849035954"},
{4,0,
{0},"",-1,-1,0,0,""},45,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7442002134"},
{4,0,
{0},"",-1,-1,0,0,""},46,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","7726362211"},
{4,0,
{0},"",-1,-1,0,0,""},47,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","5043183350"},
{4,0,
{0},"",-1,-1,0,0,""},48,0,""}
},
{1e512aab-1b41-4ef6-9375-f0137be9dd91,
{"",0,
{"S","3123462628"},
{4,0,
{0},"",-1,-1,0,0,""},50,0,""}
}
},
{"Pattern",
{"#",280f5f0e-9c8a-49cc-bf6d-4d296cc17a63},
{"#",5a49abd5-936d-4f46-8499-9cb204efe378},
{"B"},
{"S",10,1},
{"D","D"},
{"N",10,0,0}
},0,50}
},0}
},2,173},
{0,0}
}
},
{"N",1},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{2,
{0,"ИмяВарианта",
{"Pattern",
{"S"}
},"Имя варианта",15},
{1,"ТекстКода",
{"Pattern",
{"S"}
},"Текст кода",87}
},
{2,2,0,0,1,1,
{1,0},1,-1},
{0,0}
}
},
{"#",e199ca70-93cf-46ce-a54b-6edc88c3a296,
{#base64:AQE4EgAAAAAAAO+7v3siIyIsM2Q0OGZlYWUtYTljNi00YzVhLWEwOTktOWViNjQ3
NzYzMGM2LA0KezIsDQp7DQp7IlMiLCLQlNC+0LPQvtCy0L7RgNCb0LjQt9C40L3Q
s9CwIn0sDQp7IiMiLDQyMzgwMTlkLTdlNDktNGZjOS05MWRiLWI2Yjk1MWQ1Y2Y4
ZSwNCns1LA0Kew0KeyJTIiwi0J3QsNGH0LDQu9GM0L3QsNGP0KHRgtGA0L7QutCw
In0sDQp7Ik4iLDF9DQp9LA0Kew0KeyJTIiwi0JrQvtC90LXRh9C90LDRj9Ch0YLR
gNC+0LrQsCJ9LA0KeyJOIiwxfQ0KfSwNCnsNCnsiUyIsItCi0LjQv9CX0L3QsNGH
0LXQvdC40Y/QntCx0YrQtdC60YLQsCJ9LA0KeyJUIiwzNzY4MDdiYy0wZDg4LTRj
MDYtOWViMi00MmI3MmI5NzBhZmJ9DQp9LA0Kew0KeyJTIiwi0J/QvtC70Y/QodC4
0L3RhdGA0L7QvdC40LfQsNGG0LjQuCJ9LA0KeyIjIixhY2Y2MTkyZS04MWNhLTQ2
ZWYtOTNhNi01YTY5NjhiNzg2NjMsDQp7OSwNCns0LA0KezAsItCf0L7Qu9C10KHQ
uNC90YXRgNC+0L3QuNC30LDRhtC40LgiLA0KeyJQYXR0ZXJuIiwNCnsiUyJ9DQp9
LCLQn9C+0LvQtSDRgdC40L3RhdGA0L7QvdC40LfQsNGG0LjQuCIsMzF9LA0KezEs
ItCf0L7Qu9C10KHQuNC90YXRgNC+0L3QuNC30LDRhtC40LjQn9GA0LXQtNGB0YLQ
sNCy0LvQtdC90LjQtSIsDQp7IlBhdHRlcm4iLA0KeyJTIn0NCn0sItCf0YDQtdC0
0YHRgtCw0LLQu9C10L3QuNC1IiwzMX0sDQp7Miwi0J/QvtC70LXQodC40L3RhdGA
0L7QvdC40LfQsNGG0LjQuNCi0LjQv9CX0L3QsNGH0LXQvdC40Y8iLA0KeyJQYXR0
ZXJuIiwNCnsiIyIsZjVjNjUwNTAtM2JiYi0xMWQ1LWI5ODgtMDA1MGJhZTBhOTVk
fQ0KfSwi0KLQuNC/INC30L3QsNGH0LXQvdC40Y8iLDIxfSwNCnszLCLQndC+0LzQ
tdGA0JrQvtC70L7QvdC60LjQntGC0LHQvtGA0LAiLA0KeyJQYXR0ZXJuIiwNCnsi
TiIsMTAsMCwxfQ0KfSwi0J3QvtC80LXRgCDQutC+0LvQvtC90LrQuCDRgtCw0LHQ
u9C40YbRiyDQvtGC0LHQvtGA0LAiLDI2fQ0KfSwNCnsyLDQsMCwwLDEsMSwyLDIs
MywzLA0KezEsMSwNCnsyLDAsNCwNCnsiUyIsItGF0LvQndC+0LzQtdGA0JTQvtCz
0L7QstC+0YDQsCJ9LA0KeyJTIiwi0JTQvtCz0L7QstC+0YDQm9C40LfQuNC90LPQ
sC7QndC+0LzQtdGAINC00L7Qs9C+0LLQvtGA0LAifSwNCnsiIyIsZjVjNjUwNTAt
M2JiYi0xMWQ1LWI5ODgtMDA1MGJhZTBhOTVkLA0KeyJQYXR0ZXJuIiwNCnsiUyIs
MTAwLDF9DQp9DQp9LA0KeyJOIiwxfSwwfQ0KfSwzLDB9LA0KezAsMH0NCn0NCn0N
Cn0sDQp7DQp7IlMiLCLQotCw0LHQu9C40YfQvdGL0LnQlNC+0LrRg9C80LXQvdGC
0J7RgtCx0L7RgNCwIn0sDQp7IiMiLGU2MDMxMDNlLWEzMTgtNGVkYy1hMDE0LWIx
YzZjZjk0ZDQ5ZiwNCns4LDEsMTEsDQp7IiMiLCIiLDEsMSwiIyIsItCv0LfRi9C6
INC/0L4g0YPQvNC+0LvRh9Cw0L3QuNGOIiwi0K/Qt9GL0Log0L/QviDRg9C80L7Q
u9GH0LDQvdC40Y4iLDB9LA0KezEyOCw3Mn0sDQp7MH0sMCwNCnswLDB9LA0KezAs
MH0sDQp7MCwwfSwNCnswLDB9LA0KezAsMH0sDQp7MCwwfSwwLDIsMTYsMCwwLDEs
MCwNCnsxNiwxLA0KezEsMSwNCnsiIyIsItCQ0JsgMjUwNzIvMDEtMTQg0JrQl9Cd
In0NCn0sMH0sMSwwLDEsMCwNCnsxNiwwLA0KezEsMSwNCnsiIyIsItCQ0JsgMjY2
MDkvMDEtMTQg0KPQm9CdIn0NCn0sMH0sMiwwLDEsMCwNCnsxNiwwLA0KezEsMSwN
CnsiIyIsItCQ0JsgMjU1MDUvMDItMTQg0JLQoNCWIn0NCn0sMH0sMywwLDEsMCwN
CnsxNiwwLA0KezEsMSwNCnsiIyIsItCQ0JsgMjQxNDQvMDQtMTQg0JrQl9CdIn0N
Cn0sMH0sNCwwLDEsMCwNCnsxNiwwLA0KezEsMSwNCnsiIyIsItCQ0JsgMjYxMDcv
MDItMTQg0J/QndCXIn0NCn0sMH0sNSwwLDEsMCwNCnsxNiwwLA0KezEsMSwNCnsi
IyIsItCQ0JsgMjQ2ODUvMDItMTQg0JXQmtCRIn0NCn0sMH0sNiwwLDEsMCwNCnsx
NiwwLA0KezEsMSwNCnsiIyIsItCQ0JsgMzA5NTkvMDEtMTQg0J3QkdCnIn0NCn0s
MH0sNywwLDEsMCwNCnsxNiwwLA0KezEsMSwNCnsiIyIsItCQ0JsgNzQyNzgvMDEt
MTYg0KHQoNCiIn0NCn0sMH0sOCwwLDEsMCwNCnsxNiwwLA0KezEsMSwNCnsiIyIs
ItCQ0JsgOTI1MDAvMDEtMTcg0KHQnNCgIn0NCn0sMH0sOSwwLDEsMCwNCnsxNiww
LA0KezEsMSwNCnsiIyIsItCQ0JsgOTg3MDgvMDEtMTcg0KLQrtCcIn0NCn0sMH0s
MTAsMCwxLDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDExMTE2OC8wMS0x
OCDQntCg0JEifQ0KfSwwfSwxMSwwLDEsMCwNCnsxNiwwLA0KezEsMSwNCnsiIyIs
ItCQ0JsgMjE3MC8xNC0xOSDQmtCg0KEifQ0KfSwwfSwxMiwwLDEsMCwNCnsxNiww
LA0KezEsMSwNCnsiIyIsItCQ0JsgMTAzODE4LzAyLTE4In0NCn0sMH0sMTMsMCwx
LDAsDQp7MTYsMCwNCnsxLDEsDQp7IiMiLCLQkNCbIDEwMzgxOC8wMy0xOCJ9DQp9
LDB9LDE0LDAsMSwwLA0KezE2LDAsDQp7MSwxLA0KeyIjIiwi0JDQmyA5Mzk0My8w
Mi0xOCDQotCb0KIifQ0KfSwwfSwxNSwwLDEsMCwNCnsxNiwwLA0KezEsMSwNCnsi
IyIsItCQ0JsgNjY5ODgvMDItMTYg0JHQk9CUIn0NCn0sMH0sDQp7MSwwLDAwMDAw
MDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMCwxLDAsMn0sMTYsMCwwLDAs
MCwwLDAsMCwwLA0KezB9LA0KezB9LA0KezB9LA0KezB9LCIiLA0Kew0KezAsNiw2
LA0KeyJOIiwxMDAwfSw3LA0KeyJOIiwxMDAwfSw4LA0KeyJOIiwxMDAwfSw5LA0K
eyJOIiwxMDAwfSwxMCwNCnsiTiIsMTAwMH0sMTEsDQp7Ik4iLDEwMDB9DQp9DQp9
LA0KezAsLTEsLTEsLTEsLTEsMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAw
MDAwMDAwfSwwLDAsMCwwLDAsMCwwLDEsMCwxLDIsDQp7MjE3NiwyMDEsMn0sDQp7
MTI4LDIxN30sMCwwLDAsMCwzLA0KezMsMywNCnstMX0NCn0sDQp7MywzLA0Key0z
fQ0KfSwNCnszLDMsDQp7LTd9DQp9LDAsMCwwLCIiLDAsDQp7MywwLDAsMTAwLDEs
MSwwLDEsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwiIiwwLDAsMCwwLDAsMCww
fSwNCnswfSwwLDAsMCwxLDAsMH0NCn0NCn0NCn0NCn0NCn0sDQp7DQp7IlMiLCLR
hdC70J3QvtC80LXRgNCU0L7Qs9C+0LLQvtGA0LAifSwNCnsiIyIsNDIzODAxOWQt
N2U0OS00ZmM5LTkxZGItYjZiOTUxZDVjZjhlLA0KezUsDQp7DQp7IlMiLCLQndCw
0YfQsNC70YzQvdCw0Y/QodGC0YDQvtC60LAifSwNCnsiTiIsMH0NCn0sDQp7DQp7
IlMiLCLQmtC+0L3QtdGH0L3QsNGP0KHRgtGA0L7QutCwIn0sDQp7Ik4iLDB9DQp9
LA0Kew0KeyJTIiwi0KLQuNC/0JfQvdCw0YfQtdC90LjRj9Ce0LHRitC10LrRgtCw
In0sDQp7IlUifQ0KfSwNCnsNCnsiUyIsItCf0L7Qu9GP0KHQuNC90YXRgNC+0L3Q
uNC30LDRhtC40LgifSwNCnsiIyIsYWNmNjE5MmUtODFjYS00NmVmLTkzYTYtNWE2
OTY4Yjc4NjYzLA0KezksDQp7NCwNCnswLCLQn9C+0LvQtdCh0LjQvdGF0YDQvtC9
0LjQt9Cw0YbQuNC4IiwNCnsiUGF0dGVybiIsDQp7IlMifQ0KfSwi0J/QvtC70LUg
0YHQuNC90YXRgNC+0L3QuNC30LDRhtC40LgiLDMxfSwNCnsxLCLQn9C+0LvQtdCh
0LjQvdGF0YDQvtC90LjQt9Cw0YbQuNC40J/RgNC10LTRgdGC0LDQstC70LXQvdC4
0LUiLA0KeyJQYXR0ZXJuIiwNCnsiUyJ9DQp9LCLQn9GA0LXQtNGB0YLQsNCy0LvQ
tdC90LjQtSIsMzF9LA0KezIsItCf0L7Qu9C10KHQuNC90YXRgNC+0L3QuNC30LDR
htC40LjQotC40L/Ql9C90LDRh9C10L3QuNGPIiwNCnsiUGF0dGVybiIsDQp7IiMi
LGY1YzY1MDUwLTNiYmItMTFkNS1iOTg4LTAwNTBiYWUwYTk1ZH0NCn0sItCi0LjQ
vyDQt9C90LDRh9C10L3QuNGPIiwyMX0sDQp7Mywi0J3QvtC80LXRgNCa0L7Qu9C+
0L3QutC40J7RgtCx0L7RgNCwIiwNCnsiUGF0dGVybiIsDQp7Ik4iLDEwLDAsMX0N
Cn0sItCd0L7QvNC10YAg0LrQvtC70L7QvdC60Lgg0YLQsNCx0LvQuNGG0Ysg0L7R
gtCx0L7RgNCwIiwyNn0NCn0sDQp7Miw0LDAsMCwxLDEsMiwyLDMsMywNCnsxLDB9
LDMsLTF9LA0KezAsMH0NCn0NCn0NCn0sDQp7DQp7IlMiLCLQotCw0LHQu9C40YfQ
vdGL0LnQlNC+0LrRg9C80LXQvdGC0J7RgtCx0L7RgNCwIn0sDQp7IiMiLGU2MDMx
MDNlLWEzMTgtNGVkYy1hMDE0LWIxYzZjZjk0ZDQ5ZiwNCns4LDEsMTEsDQp7IiMi
LCIiLDEsMSwiIyIsItCv0LfRi9C6INC/0L4g0YPQvNC+0LvRh9Cw0L3QuNGOIiwi
0K/Qt9GL0Log0L/QviDRg9C80L7Qu9GH0LDQvdC40Y4iLDB9LA0KezEyOCw3Mn0s
DQp7MH0sMCwNCnswLDB9LA0KezAsMH0sDQp7MCwwfSwNCnswLDB9LA0KezAsMH0s
DQp7MCwwfSwwLDIsMCwNCnswLDAsMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAw
MDAwMDAwMDAwLDB9LDAsMCwwLDAsMCwwLDAsMCwwLA0KezB9LA0KezB9LA0KezB9
LA0KezB9LCIiLA0Kew0KezAsNiw2LA0KeyJOIiwxMDAwfSw3LA0KeyJOIiwxMDAw
fSw4LA0KeyJOIiwxMDAwfSw5LA0KeyJOIiwxMDAwfSwxMCwNCnsiTiIsMTAwMH0s
MTEsDQp7Ik4iLDEwMDB9DQp9DQp9LA0KezAsLTEsLTEsLTEsLTEsMDAwMDAwMDAt
MDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAwfSwwLDAsMCwwLDAsMCwwLDEsMCwx
LDAsMCwwLDAsMCwyLA0KezMsMywNCnstMX0NCn0sDQp7MywzLA0Key0zfQ0KfSww
LDAsMCwiIiwwLA0KezMsMCwwLDEwMCwxLDEsMCwxLDEsMCwwLDAsMCwwLDAsMCww
LDAsMCwwLDAsIiIsMCwwLDAsMCwwLDAsMH0sDQp7MH0sMCwwLDAsMSwwLDB9DQp9
DQp9DQp9DQp9DQp9DQp9DQp9}
},0}
}
},
{2,9,3,
{"S","СлужебнаяСтрокаДереваЗапросов!№;%:?*()_+/\=-0987654321ё"},
{"U"},
{"#",acf6192e-81ca-46ef-93a6-5a6968b78663,
{9,
{3,
{0,"Параметр",
{"Pattern",
{"S",100,1}
},"Заменить",29},
{1,"Значение",
{"Pattern",
{"S",999,1}
},"на",49},
{2,"Использовать",
{"Pattern",
{"B"}
},"Использовать",35}
},
{2,3,0,0,1,1,2,2,
{1,0},2,-1},
{0,0}
}
},0}
},5,9}
}
}
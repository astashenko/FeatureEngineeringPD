# План тестирования сбора данных

Тестирование проводится в 4 направлениях:
- План тестирования сбора данных
- Сравнение с витриной ЦАЛ
- Проверка отдельных случаев итогового варианта таблицы  по данным 1с
- Проверка состава и характеристик итогового варианта таблицы
- Тестирование данных по выборочно выгруженным из 1с

Сравнение с витриной ЦАЛ и Проверка contract_cnt с записями в DM.BEHAVIOR_MODEL_DAILY служат на этапе разработки и изменения запросов.

Проверку отдельных случаев итогового варианта таблицы  по данным 1с и Тестирование данных по выборочно выгруженным из 1с обязательно проводить после каждого сформированного  csv и итогового файла


### Сравнение с витриной ЦАЛ

Тестирование заключается в том. чтобы рассчитать фичи на 05.07.2023 - на эту дату есть выгрузка с prod ЦАЛ, поэтому если совпасть с этими данными, то значит, наш расчет повторяет штатные фичи, которые будут отправляться для PD-12

1. Подготовка тестовых данных для тестирования

 Необходимо запустить "src/testing/21prepare_test_data.ipynb"

2. Тестирование списка договоров, которые будут учитываться при расчете фичей 

Необходимо запустить  "src/testing/31test_portfolio.ipynb"

сравнение  "data/external/portfolio_tsal_for_test.pkl" - портфеля ЦАЛ (глубиной 5 лет) с last_contracts теми договорами, которые будут учитываться на дату принятия решения

3. Тестирование параметра OVERDUE_FLG наличия просрочки по договору на определенную дату

Необходимо запустить  "src/testing/32test_contract_overdue.ipynb"

сравнение  "data/external/contracts_overdue_tsal_for_test.pkl" -  с наличием просрочки в таблице overdue_contracts.pkl 

4. Тестирование показателя max_leas_ovd_pay_dt - дата последней оплаченной просроченной задолженности по лизинговым платежам с ЦАЛ

Необходимо запустить  "src/testing/33test_max_leas_ovd_pay_dt.ipynb"

сравнение  "data/external/last_overdue_dt_tsal_for_test.pkl" - с leas_ovd_pay_dt

5.  Тестирование всех агрегированных фичей с рассчитанными фичами в витрине ЦАЛ

Необходимо запустить "src/testing/41test_all_features.ipynb" 

проверяет агрегированные фичи в таблицах витрины ЦАЛ "data/external/model_tsal_for_test.pkl" и рассчитанной витрине "data/interm/test/target_features.pkl" 


### Проверка отдельных случаев итогового варианта таблицы  по данным 1с

Необходимо запустить  "src/testing/51test_manual.ipynb"
 
### Проверка состава и характеристик итогового варианта таблицы 

Необходимо запустить  "src/testing/52test_exploratory"

### Тестирование данных по выборочно выгруженным из 1с 

#### 1 этап Сбор тестовых данных из 1c 

делать однократно, если в external нет файлов
leas_ovd_pay_1c_testdata.pkl и overdue_1с_testdata.pkl или нужно их увеличить

Порядок подготовки: 

запустить в файле /src/1c/взаиморасчеты отчет.sel

1. есть ли просрочка на конец месяца все с флагом для inn 

Параметры:

    - ДатаСреза -  установить текущую дату ( на какую выгружались сведения из DM),
  
    - менять параметр хлПриложениеКДоговоруЛизинга.хлпДоговорКонтрагента.Владелец.ИНН = (&ИНН_yyyymmdd) на какие нужны инн
 
    - КонецПериода установить  на какую дату принятия решения. 
  
так перебрать несколько вариантов. Все данные собрать в один файл и результат сохранить в *data/interm/external_to_zip/overdue_contracts_1с.xlsx*
Далее запустить src/data/create_pickle_for_external функцию read_1c_overdue_contracts_full, которая создаст в папку external уже pkl файл, который будет использоваться для тестирования

2. день последней оплаты просрочки по всем договорам для inn 

Параметры:

    - ДатаСреза -  установить текущую дату ( на какую выгружались сведения из DM),
  
    - менять параметр хлПриложениеКДоговоруЛизинга.хлпДоговорКонтрагента.Владелец.ИНН = (&ИНН_yyyymmdd) на какие нужны инн
 
    - КонецПериода установить  на какую дату принятия решения. 
  
так перебрать несколько вариантов. Все данные собрать в один файл и результат сохранить в *data/interm/external_to_zip/lastoverdue_dt.xlsx*

Далее запустить src/data/create_pickle_for_external функцию read_1c_overdue_dt, которая создаст в папку external уже pkl файл, который будет использоваться для тестирования

#### 2 этап тестирование

1. Тестирование количество договоров за 6 месяцев

Необходимо запустить  "src/testing/61test_portfolio_1c.ipynb"

Проверка по данным 1с портфеля (количество договоров за 6 месяцев)

2. Тестирование параметра OVERDUE_FLG наличия просрочки по договору на определенную дату по 1с

Необходимо запустить  "src/testing/62test_contract_overdue_1с.ipynb"

3. Тестирование параметра max_leas_ovd_pay_dt - дата последней оплаченной просроченной задолженности по лизинговым платежам на определенную дату по 1с

Необходимо запустить  "src/testing/63test_overdue_dt_1c.ipynb"

##### Проверка contract_cnt с записями в DM.BEHAVIOR_MODEL_DAILY

является не обязательной 
Необходимо запустить  "src/testing/71test_beh.ipynb"